{"pages":[{"title":"categories","text":"","link":"/categories/index.html"},{"title":"tags","text":"","link":"/tags/index.html"},{"title":"","text":"","link":"/README.html"},{"title":"å†è°ˆæœ€é•¿å…¬å…±å­ä¸²","text":"åºè¨€è¿™æ¬¡é‡åˆ°è´å£³èŠ±åçš„éœ€æ±‚ï¼Œéœ€è¦ä½¿ç”¨æœ€é•¿å…¬å…±å­ä¸²å¯¹èŠ±ååšæ ¡éªŒã€‚è¿™ç§ç®—æ³•åœ¨é¢è¯•é¢˜ä¸­ç®—æ˜¯å¿…ä¼šé¢˜ï¼Œå„ç§å››å±‚å¾ªç¯ï¼Œä¸‰å±‚å¾ªç¯ï¼Œä¸¤å±‚å¾ªç¯çš„ä»£ç åœ¨æˆ‘è„‘ä¸­é—ªè¿‡ï¼Œä½†æ˜¯ä»Šå¤©å°±æ˜¯è¦å¸¦ä½ å®ç°ä¸ä¸€æ ·çš„æœ€é•¿å…¬å…±å­ä¸²ï¼ æ•™ç§‘ä¹¦å¼å®ç°ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä¸¤å±‚å¾ªç¯ï¼Œä½¿ç”¨äºŒç»´æ•°ç»„å­˜å‚¨çŠ¶æ€ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2^)ï¼Œç©ºé—´å¤æ‚åº¦O(n^2^)æˆ–O(2n) ä¸€å¼ å›¾è§£é‡ŠåŸç†ï¼š 12345678910111213141516 å…ˆ æ¨ª å‘ å¤„ ç† +---------------------------&gt; e a b c b c f + +---+---+---+---+---+---+---+ | a | 0 | 1 | 0 | 0 | 0 | 0 | 0 |çºµ | +---------------------------+å‘ | b | 0 | 0 | 2 | 0 | 1 | 0 | 0 |ç´¯ | +---------------------------+åŠ  | c | 0 | 0 | 0 | 3 | 0 | 2 | 0 | | +---------------------------+ | d | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---------------------------+ | e | 1 | 0 | 0 | 0 | 0 | 0 | 0 | v +---+---+---+---+---+---+---+ e a b c b c f ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦è‡³O(1)ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œåœ¨çºµå‘ç´¯åŠ æ—¶å®é™…åªéœ€è¦å·¦ä¸Šæ–¹çš„è®¡æ•°å™¨å³å¯, O(n^2^)çš„ç©ºé—´ç™½ç™½è¢«æµªè´¹äº†,æœ€ä¼˜çš„ç©ºé—´å¤æ‚åº¦åº”è¯¥æ˜¯O(1)ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ ä¸€å¼ å›¾è§£é‡ŠåŸç†ï¼š e a b c b c f +---+ +---+---+---+---+---+---+---+ a | 0 | | 1 | 0 | 0 | 0 | 0 | 0 | a +-------+ +-----------------------+ b | 0 | 0 | | 2 | 0 | 1 | 0 | 0 | b +-----------+ --------------------+ c | 0 | 0 | 0 | | 3 | 0 | 2 | 0 | c +---------------+ ----------------+ d | 0 | 0 | 0 | 0 | | 0 | 0 | 0 | d +-------------------+ +-----------+ e | 1 | 0 | 0 | 0 | 0 | | 0 | 0 | e +---+---+---+---+---+-------+ +---+---+ e a b c b c fç­”æ¡ˆå°±æ˜¯æ²¿ç€ç­‰é•¿å¯¹ç€çº¿å¤„ç†ã€‚ æœ‰æ„æ€çš„ä»£ç æŠ½è±¡å¤§å®¶å¯ä»¥æ ¹æ®ä¸Šé¢æ€è·¯å†™ä¸€ä¸‹ï¼Œä¸€èˆ¬ä¼šæŠŠç®—æ³•åˆ†æˆä¸¤éƒ¨åˆ†ï¼šå¤„ç†é•¿æ–¹å½¢çš„å·¦ä¸‹éƒ¨åˆ†å’Œå¤„ç†é•¿æ–¹å½¢çš„å³ä¸Šéƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†éƒ½æ˜¯åŒå±‚å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´è´Ÿè½½åº¦å·²ç»å˜ä¸ºäº†O(n^2^) ï¼ŒO(1)ã€‚ è‚¯å®šæœ‰äººå·²ç»å‘ç°è‡ªå·±çš„ä»£ç å¤„ç†å·¦ä¸‹è§’çš„ä»£ç å’Œå¤„ç†å³ä¸Šè§’çš„ä»£ç ä¸èƒ½å¤ç”¨ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å‘å·¦ä¸‹è§’å¤„ç†ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å‘å³ä¸Šè§’å¤„ç†ï¼Œæ˜æ˜å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å°±æ˜¯æ²¡å‘åˆå¹¶ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•æŠŠè¿™ä¸¤éƒ¨åˆ†å¤„ç†æŠ½è±¡æˆå…¬å…±ä»£ç å‘¢ï¼Ÿä¸å–å…³å­äº†ï¼Œç›´æ¥ä¸Šå›¾ï¼š 12345678910111213141516 + e | +--+ e a b c b c f a | 1|+---+---+---+---+---+---+---+ +-----+ | 1 | 0 | 0 | 0 | 0 | 0 | a b | 0| 2| +-----------------------+ +--------+ | 2 | 0 | 1 | 0 | 0 | b c | 0| 0| 3| --------------------+ ç¿» æŠ˜ +-----------+ | 3 | 0 | 2 | 0 | c +------------&gt; b | 0| 1| 0| 0| ----------------+ +--------------+ | 0 | 0 | 0 | d c | 0| 0| 2| 0| 0| +-----------+ +--------------+ | 0 | 0 | e f | 0| 0| 0| 0| 0| +---+---+ +--------------+ a b c d e å¦‚æœä½ æƒ³ä½¿ç”¨å…¬å…±ä»£ç åŒæ—¶å®ç°å¤„ç†å·¦ä¸‹è§’å’Œå³ä¸Šè§’æ˜¯ä¸å¯èƒ½çš„äº†ã€‚æ‰€ä»¥ä½ éœ€è¦æŠŠå³ä¸Šè§’çš„ä¸‰è§’ç¿»æŠ˜ï¼Œç„¶åä½ å°±å¾—åˆ°äº†ä¸¤ä¸ªä¸‰è§’ï¼š 12345678910111213141516 + e | +--+ a | 1| +---+ +-----+a | 0 | b | 0| 2| +-------+ +--------+b | 0 | 0 | c | 0| 0| 3| +-----------+ +-----------+c | 0 | 0 | 0 | b | 0| 1| 0| 0| +---------------+ +--------------+d | 0 | 0 | 0 | 0 | c | 0| 0| 2| 0| 0| +-------------------+ +--------------+e | 1 | 0 | 0 | 0 | 0 | f | 0| 0| 0| 0| 0| +---+---+---+---+---+------ +--------------+ e a b c b c f a b c d e è¿™æ ·å°±å˜æˆäº†å¤„ç†ä¸¤éå·¦ä¸‹è§’äº†ï¼Œä»£ç ä¹Ÿå¯ä»¥å®Œç¾å¤ç”¨ï¼ï¼ï¼ æœ€ç»ˆå®ç°æˆ‘çš„å®Œæ•´æ€è€ƒè¿‡ç¨‹å·²ç»åˆ†æå®Œæ¯•ï¼Œè¿™æ ·æ²¿å¯¹ç€çº¿å¤„ç†è¿˜æœ‰ä¸€ä¸ªå°å°çš„ä¼˜ç‚¹ï¼šæå‰ç»“æŸæœç´¢ã€‚è¿™ä¸€ç‚¹å¤§å®¶å¯ä»¥è‡ªè¡Œæ€è€ƒï¼Œè¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šã€‚ ç›´æ¥å¹²è´§ä¸Šåœºï¼š 1234567891011121314151617181920212223242526272829public class Solution { /** * @param A: A string * @param B: A string * @return: the length of the longest common substring. */ public int longestCommonSubstring(String A, String B) { // write your code here char[] achars = A.toCharArray(), bchars = B.toCharArray(); return getMaxLength(bchars, achars, getMaxLength(achars, bchars, 0, 0), 1); } private static int getMaxLength(char[] s1, char[] s2, int maxLength, int startIndex) { for (int start = startIndex; start &lt; s1.length; start++) { int upper = Math.min(s2.length, s1.length - start); // if (upper &lt;= maxLength) break; //æå‰ç»“æŸæœç´¢ for (int currentLineLength = 0, x = 0, y = start; x &lt; upper; x++, y++) { if (s1[y] == s2[x]) maxLength = Math.max(maxLength, ++currentLineLength); else { // if (upper - x - 1 &lt;= maxLength) break; //æå‰ç»“æŸæœç´¢ currentLineLength = 0; }; } } return maxLength; }} ç»“å°¾æ€ä¹ˆæ ·ï¼Œç»å†è¿™æ¬¡ä¼˜åŒ–è¿‡ç¨‹æ˜¯å¦æ„Ÿè§‰è‡ªå·±å¯¹æœ€é•¿å…¬å…±å­ä¸²çš„è®¤è¯†åˆæ›´æ·±äº†ä¸€æ­¥å‘¢ï¼Ÿè™½ç„¶ä¸èƒ½ä¿è¯æ˜¯é¦–åˆ›ï¼ˆä¹Ÿå¯èƒ½æ˜¯é¦–åˆ›ï¼Ÿï¼‰ï¼Œä½†æ˜¯è¿™æ¬¡ä¸€æ­¥ä¸€æ­¥çœŸåˆ‡æ€è€ƒä¼˜åŒ–ç›´åˆ°è·å¾—æˆæœè®©æˆ‘æ— æ¯”å…´å¥‹ã€‚ è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘å°±æ˜¯è¦ç»™æˆ‘ä»¬è´å£³æ‹›è˜å¼€å‘ç»„æ‰“ä¸ªå¹¿å‘Š&gt;_&gt;ï¼ŒæœŸå¾…æ›´å¤šçˆ±æ€è€ƒä¼˜ç§€çš„åŒå­¦åŠ å…¥ï¼ ![](/Users/sage/Desktop/å±å¹•å¿«ç…§ 2018-11-10 13.33.20.png)","link":"/blog-posts/2018-11-11-lcs.html"},{"title":"æ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢çš„ä¸€ç§æ€è·¯","text":"1. é—®é¢˜èƒŒæ™¯æƒé™ç³»ç»Ÿç°çŠ¶UCæƒé™ç³»ç»ŸåŸºäºè§’è‰²è®¿é—®æ§åˆ¶æŠ€æœ¯RBACï¼ˆRole Based Access Controlï¼‰ ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯èµ‹äºˆç”¨æˆ·æŸä¸ªè§’è‰²ï¼Œè§’è‰²ç»™ä¸è§’è‰²å¯¹åº”çš„æƒé™èƒ½è®¿é—®åŠæ“ä½œä¸åŒèŒƒå›´çš„èµ„æºã€‚ ä»€ä¹ˆæ˜¯æ•°æ®æƒé™ä»£è¡¨ä¸€ä¸ªè§’è‰²å¯¹åº”æŸä¸ªæƒé™æ‰€èƒ½æ“ä½œçš„æ•°æ®èŒƒå›´ï¼Œæ¯”å¦‚gitlabç»„ç®¡ç†å‘˜èƒ½çœ‹åˆ°ç»„ä¸‹çš„æ‰€æœ‰é¡¹ç›®ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·é…ç½®ï¼š åˆ›å»ºç»„ç®¡ç†å‘˜ åˆ†é…ç»™ç»„ç®¡ç†å‘˜æŸ¥çœ‹é¡¹ç›®ä»£ç çš„æƒé™ æŸ¥çœ‹é¡¹ç›®ä»£ç æƒé™è®¾ç½®çº¦æŸæ¡ä»¶ï¼Œçº¦æŸä¸ºè‡ªå·±ç»„ä¸‹çš„é¡¹ç›® å®é™…äº§ç”Ÿé‡åˆ°çš„é—®é¢˜å¯¹ç»å¤§å¤šæ•°ç®€å•çš„ç³»ç»Ÿæ¥è¯´ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªç³»ç»Ÿåªä¼šæœ‰ä¸€ä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²åªæœ‰ä¸€ä¸ªæ•°æ®æƒé™èŒƒå›´ï¼ˆå³ä½¿æœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼‰ã€‚ä½†æ˜¯éšç€äº§å“çš„åŠŸèƒ½è¿­ä»£ï¼Œç”¨æˆ·çš„å˜æ›´å’Œç³»ç»Ÿè®¾è®¡çš„åŸå› ï¼Œæ€»æœ‰ä¸€äº›ç‰¹æ®Šä¸”é‡è¦çš„ç”¨æˆ·åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­æ‹¥æœ‰å¤šä¸ªè§’è‰²ã€‚åœ¨å¤šè§’è‰²å’Œæ•°æ®æƒé™çš„ç»„åˆä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤æ•°çš„æ•°æ®æƒé™èŒƒå›´ã€‚ è€ƒè™‘åˆ°å®ç°å¤æ‚æ€§ï¼Œå¤§å¤šæ•°ç³»ç»Ÿé€‰æ‹©ä½¿ç”¨è§’è‰²åˆ‡æ¢çš„æ‰‹æ®µç®€åŒ–ç³»ç»Ÿå®ç°ï¼ŒåŒæ—¶å¯¹ç”¨æˆ·æš´éœ²å‡ºäº†ä»–ä»¬ä¸ç†Ÿæ‚‰çš„è§’è‰²è¿™ä¸€æ¦‚å¿µï¼Œé€ æˆè¿™äº›ç”¨æˆ·åœ¨ç³»ç»Ÿä½¿ç”¨ä¸­çš„å„ç§ä¸ä¾¿ã€‚ æœ¬æ–‡é‡ç‚¹è®¨è®ºåœ¨é¿å…è§’è‰²åˆ‡æ¢çš„å‰æä¸‹ï¼Œè¿›è¡Œå¤šè§’è‰²æ•°æ®èŒƒå›´æŸ¥è¯¢çš„ä¸€ç§æ€è·¯ã€‚ å…·ä½“éœ€è¦è§£å†³çš„éœ€æ±‚æˆ‘ä»¬çš„æ•°æ®æŠ¥è¡¨åå°ï¼Œä¸åŒçš„è§’è‰²æ‹¥æœ‰ä¸åŒçš„æ•°æ®æŸ¥çœ‹èŒƒå›´ï¼ˆä¸åŒè§’è‰²æ‰€èƒ½çœ‹åˆ°çš„å‘˜å·¥æ•°æ®å­—æ®µä¹Ÿå„ä¸ç›¸åŒï¼‰ï¼Œä¾‹å¦‚ï¼š è–ªé…¬ç®¡ç†å‘˜ï¼šæŸ¥çœ‹éé«˜èŒçº§å‘˜å·¥æ•°æ® é«˜çº§è–ªé…¬ç®¡ç†å‘˜ï¼š æŸ¥çœ‹é«˜èŒçº§å‘˜å·¥æ•°æ® é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ï¼šæŸ¥çœ‹æœ‰é•¿æœŸæ¿€åŠ±å‘˜å·¥æ•°æ® ç­‰ç­‰ ç®€å•æ¥è¯´ï¼Œæ‹¥æœ‰é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜å’Œé«˜çº§è–ªé…¬ç®¡ç†å‘˜çš„ç”¨æˆ·èƒ½å¦ç›´æ¥çœ‹åˆ°é«˜èŒçº§å‘˜å·¥æ•°æ®å’Œé•¿æœŸæ¿€åŠ±å‘˜å·¥æ•°æ®ï¼Ÿè‡³å°‘åœ¨ç›´è§‰ä¸Šæ˜¯å¯è¡Œçš„ã€‚ 2.å¤šè§’è‰²æ•°æ®èŒƒå›´æŸ¥è¯¢ç›´è§‰çš„åšæ³•å•è§’è‰²å•æ•°æ®èŒƒå›´å¯ä»¥ä½¿ç”¨ä¸€å¥sqlæŸ¥è¯¢å‡ºç»“æœï¼Œé‚£å¤šè§’è‰²å¤šæ•°æ®èŒƒå›´æ˜¯ä¸æ˜¯ä½¿ç”¨å¤šå¥sqlæŸ¥è¯¢å‡ºç»“æœåˆå¹¶å°±å¯ä»¥äº†ï¼Ÿ æ·±å…¥æ€è€ƒ å¤šè§’è‰²æ•°æ®èŒƒå›´å¯¹è¡Œçš„å½±å“ æŸ¥è¯¢æ¡ä»¶åˆå¹¶è¿˜æ˜¯ç»“æœåˆå¹¶ï¼Ÿ â€”-ç»“æœåˆå¹¶ å¦‚ä½•æ’åºï¼Ÿ â€”â€“å¤–éƒ¨æ’åºï¼Œæˆ–å…ˆå†…éƒ¨æ’åº,limit,å†å¤–éƒ¨æ’åº æœ‰é‡å¤æ•°æ®æ€ä¹ˆåŠï¼Ÿ â€”-ä½¿ç”¨groupbyå»é‡ æŸ¥è¯¢æ€§èƒ½æœ‰å½±å“å—ï¼Ÿâ€”-æœ‰ å…·ä½“ä½“ç°ï¼š 1234567select * from ((select id, sortvalue from table_1 where t_name = &apos;a&apos; order by sortvalue desc limit 20) -- å…ˆå†…éƒ¨æ’åº,limitunion all -- ç»“æœåˆå¹¶(select id, sortvalue from table_1 where t_name = &apos;b&apos; order by sortvalue desc limit 20) -- å…ˆå†…éƒ¨æ’åº,limitorder by sortvalue desc -- å¤–éƒ¨æ’åº) a group by id -- ä½¿ç”¨groupbyå»é‡limit 10, 10 æ·±å…¥æ€è€ƒ å¤šè§’è‰²æ•°æ®èŒƒå›´å¯¹åˆ—çš„å½±å“ è–ªé…¬ç®¡ç†å‘˜ï¼š æŸ¥çœ‹å‘˜å·¥è–ªé…¬å­—æ®µ é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ï¼šæŸ¥çœ‹å‘˜å·¥é•¿æœŸæ¿€åŠ±å­—æ®µ å¦‚ä½•è§£å†³ï¼Ÿæ–¹æ³•æœ‰å¾ˆå¤šï¼ ç»¼åˆæ€è€ƒï¼Œç»™å‡ºä¸€ç§è§£å†³æ–¹æ¡ˆ123graph LR A(æŸ¥è¯¢è¡ŒåŠè§’è‰²ä¿¡æ¯) --&gt; B(æ ¹æ®è§’è‰²æŸ¥è¯¢å¯¹åº”åˆ—å­—æ®µ) B --&gt; C(ç»“æœ) æ­¥éª¤ï¼š æŸ¥è¯¢å¤šè§’è‰²æ•°æ®èŒƒå›´ä¸‹çš„æ•°æ®ï¼Œé™„å¸¦è§’è‰²ä¿¡æ¯ 1234567select id, GROUP_CONCAT(a.role) as roles from ((select id, &apos;role_a&apos; as role from table_1 where sortvalue &gt; 10 order by `sortvalue` desc limit 2)union all(select id, &apos;role_b&apos; as role from table_1 where sortvalue &gt; 20 order by `sortvalue` desc limit 2) order by `sortvalue` desc ) a group by idlimit 0, 2 ç»“æœï¼š id roles 1 è–ªé…¬ç®¡ç†å‘˜ 5 è–ªé…¬ç®¡ç†å‘˜ï¼Œé•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ æ ¹æ®æ¯ä¸€è¡Œä¸åŒçš„è§’è‰²ï¼ŒæŸ¥è¯¢å‡ºå¯è§çš„å­—æ®µï¼Œä¾‹å¦‚id=1çš„è¡Œåªèƒ½æŸ¥çœ‹ROLE_Bå¯¹åº”å­—æ®µï¼Œè€Œid=5çš„è¡Œå¯ä»¥çœ‹åˆ°ROLE_A,ROLE_Bå¯¹åº”çš„ä¸¤ä¸ªè§’è‰²çš„å­—æ®µ 3.æ€»ç»“å’Œå»¶ä¼¸å¤šè§’è‰²æ•°æ®èŒƒå›´å†™æ“ä½œï¼Ÿéå†è§’è‰²ç›´åˆ°æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æƒé™å³å¯ã€‚ æ”¶è·è‡ªå·±ä¸è¡ŒåŠ¨ï¼Œç­‰äºç­‰ç€è¢«åˆ«äººå®‰æ’å“ˆå“ˆ è¿˜æœ‰ç–‘é—®ï¼Ÿè‡ªå·±æƒ³ã€‚è¿˜å¯ä»¥ç‚¹è¿™é‡Œ","link":"/blog-posts/2018-11-06-biz.html"},{"title":"ä»£ç å¤–çš„ç”Ÿå­˜ä¹‹é“-è¯»ä¹¦ç¬”è®°-èŒä¸šç¯‡","text":"èŒä¸šå‘å±•çš„é©±åŠ¨åŠ›åº”è¯¥æ¥è‡ªè‡ªèº«ï¼Œå·¥ä½œå±äºå…¬å¸ï¼ŒèŒä¸šç”Ÿæ¶¯å±äºè‡ªå·±ã€‚ ç¬¬ä¸€è¦åŠ¡ æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€å¤§å¤šæ•°äººå½¢æˆçš„é”™è¯¯çš„å¿ƒæ€: è®¤ä¸ºåœ¨ä¸ºå…¬å¸æ‰“å·¥ï¼Œæ²¡æœ‰æŠŠè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å½“ä½œç”Ÿæ„æ¥çœ‹å¾…ã€‚é“­è®°åœ¨å¿ƒï¼Œå¼€å§‹ç§¯æä¸»åŠ¨çš„ç®¡ç†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å§ã€‚ åƒä¼ä¸šä¸€æ ·æ€è€ƒè‡ªå·±èƒ½æä¾›ä»€ä¹ˆ:è‡ªå·±çš„èƒ½åŠ›å°±æ˜¯åˆ›é€ è½¯ä»¶è‡ªå·±éœ€è¦åšä»€ä¹ˆ: æŒç»­ä¸æ–­åœ°æ”¹è¿›å’Œå®Œå–„è‡ªå·±çš„äº§å“ ä¼ è¾¾è‡ªå·±çš„ä»·å€¼ï¼Œå’Œåƒä¸‡åŒè¡Œçš„ç‹¬ç‰¹ä¹‹å¤„ ä¸€å¤´æ‰è¿›å·¥ä½œä¸å¯èƒ½éåŒå‡¡å“ï¼Œä½ åº”è¯¥ï¼š ä¸“æ³¨äºä½ æ­£åœ¨æä¾›æ€æ ·çš„æœåŠ¡ï¼Œ ä»¥åŠå¦‚ä½•è¥é”€è¿™é¡¹æœåŠ¡ï¼› æƒ³æ–¹è®¾ æå‡ä½ çš„æœåŠ¡ï¼› æ€è€ƒä½ å¯ä»¥ä¸“æ³¨ä¸ºå“ªä¸€ ç‰¹å®šç±»å‹çš„å®¢æˆ·æˆ–è¡Œä¸šæä¾›ç‰¹å®šçš„æœåŠ¡ï¼› é›†ä¸­ç²¾åŠ›æˆä¸ºä¸€ä½ä¸“å®¶ï¼Œä¸“é—¨ä¸ºæŸä¸€ç‰¹å®šç±»å‹çš„å®¢æˆ·æä¾›ä¸“ä¸šçš„æ•´ä½“æœåŠ¡ï¼ˆ è®°ä½ï¼Œ ä½œä¸ºä¸€ä¸ªè½¯ä»¶å¼€å‘ äººå‘˜ï¼Œ ä½  åªæœ‰çœŸæ­£ä¸“æ³¨ äºä¸€ç±»å®¢æˆ·ï¼Œæ‰èƒ½æ‰¾åˆ°éå¸¸å¥½çš„å·¥ä½œï¼‰ã€‚ æ›´å¥½çš„å®£ä¼ è‡ªå·±çš„äº§å“ï¼Œæ›´å¥½çš„æ‰¾åˆ°ä½ çš„å®¢æˆ· ç¬¬äºŒè¦åŠ¡ è®¾å®šè‡ªå·±çš„ç›®æ ‡æ— è®ºå› ä¸ºä½•ç§åŸå› ä½ æ²¡æœ‰ä¸ºè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯è®¾å®šç›®æ ‡ï¼Œ ç°åœ¨éƒ½æ˜¯æ—¶å€™è®¾å®šç›®æ ‡äº†ã€‚ ä¸æ˜¯æ˜å¤©ï¼Œ ä¹Ÿä¸æ˜¯ä¸‹å‘¨ï¼Œ å°±æ˜¯ç°åœ¨ã€‚ æ²¡æœ‰æ˜ç¡®çš„æ–¹å‘ï¼Œ ä½ èµ°çš„æ¯ä¸€æ­¥éƒ½æ˜¯å¾’åŠ³çš„ã€‚ å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿå…ˆåœ¨å¿ƒä¸­æ ‘ç«‹ä¸€ä¸ªå¤§ç›®æ ‡ï¼Œç„¶ååˆ†è§£æˆå¤šä¸ªå°ç›®æ ‡ è¿½è¸ªä½ çš„ç›®æ ‡å®šæœŸæ ¸å¯¹è‡ªå·±çš„ç›®æ ‡ï¼Œå¿…è¦æ—¶è¿˜è¦è°ƒæ•´ã€‚ äººé™…äº¤å¾€èƒ½åŠ›","link":"/blog-posts/2018-12-27-softablity.html"},{"title":"2018ä¸‹åŠå¹´ä¹¦å•","text":"ç»æµé‡‘èç±»ï¼š ã€Šæ–¯å¦ç¦æç®€ç»æµå­¦ã€‹åˆ†å¾®è§‚å’Œå®è§‚ç»æµå­¦ æ²¡æœ‰æ•™ç§‘ä¹¦å¼çš„ä»‹ç» æ¯”è¾ƒå¥½è¯»ï¼Œæ¨è ã€Šéšæœºæ¼«æ­¥çš„å‚»ç“œã€‹ ç»éªŒä¹‹è°ˆ è§‚ç‚¹å¯ä»¥æ¥å— ã€Šä¹°æ™¾è¡£æ†çš„å°è´©ä¸ºä½•ä¸ä¼šå€’ã€‹ è´´è¿‘ç”Ÿæ´» è¿‡äºç®€å• ä¸æ¨è ã€Šå¯Œçˆ¸çˆ¸ ç©·çˆ¸çˆ¸ã€‹å°ç™½å…¥é—¨é¦–é€‰ æ¨è ã€Šå°å²›ç»æµå­¦ã€‹ æ·±å…¥æµ…å‡º æœ€åæ˜ å°„ä¸­å›½å’Œç¾å›½å…³ç³» åé¢æœ‰ç‚¹çœ‹ä¸æ‡‚ æ¨è å°è¯´ç±»ï¼š ã€Šè§£å¿§æ‚è´§åº—ã€‹ ä¸ªäººæ„Ÿè§‰ä¸€èˆ¬ ååŠéƒ¨åˆ†å‰§æƒ…æˆ‘éƒ½çŒœåˆ°äº† ã€Šäººé—´å¤±æ ¼ã€‹ é­å—åˆ°äº†ç¤¾ä¼šçš„æ¯’æ‰“ å¾ˆç°å® æœ‰ç‚¹è‡´éƒ å¿ƒé‡Œæ‰¿å—èƒ½åŠ›ä½çš„ä¸æ¨è ã€Šä¸‰ä½“ã€‹ ç¬¬ä¸€éƒ¨å¯ä»¥çš„ï¼Œåé¢ä¸€éƒ¨ä¸å¦‚ä¸€éƒ¨ ä½†æ˜¯æ¯”èµ·å…¶ä»–ç½‘ä¸Šå¤§ä¼—å–œæ¬¢çš„çˆ½æ–‡å¥½å¤šäº† æŠ€æœ¯ç±»ï¼š ã€Šjavaç¼–ç¨‹çš„é€»è¾‘ã€‹ æ¸©æ•…è€ŒçŸ¥æ–°ï¼ŒåŸºç¡€å¥½çš„ä¸ç”¨çœ‹äº† å°ç™½æ¨è ã€Škafkaæƒå¨æŒ‡å—ã€‹æ­£åœ¨çœ‹ ä½†æ˜¯çœŸçš„å†™çš„ä¸é”™ æ¨è ã€Šmybatisä»å…¥é—¨åˆ°ç²¾é€šã€‹ ä¸€èˆ¬èˆ¬ï¼Œåªæœ‰å…¥é—¨å§ ã€Šnettyæƒå¨æŒ‡å—ã€‹ ä¸€èˆ¬èˆ¬ ã€Šredisè®¾è®¡ä¸å®ç°ã€‹ çœŸè®¾è®¡ä¸å®ç° æ¨è ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹å¤šè¯»å‡ éä¹Ÿä¸ä¸ºè¿‡ æ¨è ã€ŠSpringBootå®æˆ˜ã€‹ è¯»çš„æ¯”è¾ƒæ—©æ²¡å½±å“äº† ä¸æ¨è ã€Šç®—æ³•å›¾è§£ã€‹ ç¨‹åº=æ•°æ®ç»“æ„+ç®—æ³• å°ç™½æ¨èï¼ˆæˆ‘å°±æ˜¯å°ç™½ï¼‰ å¿ƒç†ç±»ï¼š ã€Šä¹Œåˆä¹‹ä¼—ã€‹ äººåœ¨å°èŒƒå›´ä¸ºç§åˆ©è¡ŒåŠ¨ åœ¨æ°‘æ—èŒƒç•´ä¼šæŠ›å¼€ç§åˆ©åšå‡ºäº›è¿‡äºå´‡é«˜æˆ–ç²—é²çš„è¡Œä¸º æ¨è ã€ŠåŸç”Ÿå®¶åº­ã€‹ ä¸€ä¸ªäººå—ç«¥å¹´å®¶åº­çš„å½±å“æ˜¯æœ€å¤§çš„ï¼Œè¿™æœ¬ä¹¦èƒ½çœ‹æ‡‚æ˜¯ä¸€å›äº‹ï¼Œèƒ½åšå¥½æ˜¯å¦ä¸€å›äº‹","link":"/blog-posts/2018booklist.html"},{"title":"ã€Šé‡æ„-æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡ã€‹è¯»ä¹¦ç¬”è®°","text":"1.1 ä¸€ä¸ªç®€å•çš„ä¾‹å­ä¸€ä¸ªè®¡ç®—é¡¾å®¢ç§Ÿèµå½±ç‰‡è´¹ç”¨çš„ç¨‹åºï¼Œèƒ½å®¹æ˜“å†™æˆé¢æ¡å¼çš„ä»£ç ï¼ˆæµæ°´è´¦ï¼‰ï¼šé¡¾å®¢ç±»è°ƒç”¨å½±ç‰‡ç±»å’Œç§Ÿèµæ—¶é•¿è®¡ç®—è´¹ç”¨ å¯¹æœºå™¨æ¥è¨€åªè¦èƒ½è¿è¡Œæ­£ç¡®æ²¡æœ‰å¥½ä»£ç å’Œåä»£ç ä¹‹åˆ†ï¼Œä½†æ˜¯å¯¹ï¼ˆç»´æŠ¤çš„ï¼‰äººæ¥è¯´å¾ˆéš¾æ‰¾åˆ°ä¿®æ”¹ç‚¹ï¼Œå®¹æ˜“å¼•å…¥bug 1.2é‡æ„å‰å…ˆå†™æµ‹è¯•ä¿è¯é‡æ„ç»“æœåˆ©ç”¨å•å…ƒæµ‹è¯•ä¿è¯é‡æ„æ­£ç¡®æ€§ 1.3ä»¥å¾®å°çš„æ­¥ä¼ä¿®æ”¹ç¨‹åºï¼Œä¿è¯é—®é¢˜å¿«é€Ÿå‘ç°è§£å†³ä¸è¦ä¸ºä¿®æ”¹å˜é‡åæ„Ÿåˆ°ç¾è€»ï¼Œåªæœ‰å†™å‡ºäººèƒ½ç†è§£çš„ä»£ç æ‰æ˜¯å¥½ç¨‹åºå‘˜ é‡æ„å®Œå¯èƒ½ æ€§èƒ½å˜å·®ï¼Œä½†åŒæ—¶ä¼šå¸¦æ¥æ›´å¤šçš„æœºä¼šæ¥ä¼˜åŒ– 1.4å¹²è´§ï¼ç”¨å¤šæ€ä»£æ›¿switchswitchéœ€è¦å…³å¿ƒå…·ä½“æ¡ä»¶ï¼Œå¤šæ€å…·æœ‰switchä¸å…·å¤‡çš„ä¼˜åŠ¿ï¼šä¸éœ€è¦å…³å¿ƒå…·ä½“ç±»å‹ 2.1é‡æ„çš„å®šä¹‰é‡æ„ï¼šä¸æ”¹å˜è¿è¡Œç»“æœä¸‹ æé«˜ç†è§£æ€§ é™ä½ä¿®æ”¹æˆæœ¬ 2.2é‡æ„çš„åŸå›  ä»£ç ç»“æ„çš„æµå¤±æ˜¯ç´¯ç§¯æ€§çš„ï¼Œè¶Šéš¾çœ‹æ‡‚ä»£ç è®¾è®¡æ„å›¾ï¼Œè¶Šéš¾ä¿æŠ¤å…¶è®¾è®¡ æ¶ˆé™¤é‡å¤ä»£ç ï¼Œæ–¹ä¾¿ä¿®æ”¹ æˆ‘ä»¬ç¼–å†™ä»£ç æ—¶å¾ˆå®¹æ˜“å¿˜è®°è¯»è€…çš„æ„Ÿå—ï¼Œé€ æˆä»–äººæ—¶é—´çš„æµªè´¹ é‡æ„æ—¶çŠ¯é”™å¯ä»¥åŠ æ·±å¯¹ä»£ç æ„å›¾çš„ç†è§£ï¼Œå¯ä»¥å¸®åŠ©å‘ç°bug å¥½çš„ç»“æ„è®¾è®¡æ˜¯åŠ é€Ÿå¼€å‘çš„æ ¹æœ¬ 2.3é‡æ„çš„æ—¶æœº æ·»åŠ åŠŸèƒ½æ—¶é‡æ„ï¼Œåœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­æŠŠç»“æ„ç†æ¸…ï¼Œä¹Ÿå¯ä»¥æ›´ç®€å•çš„æ·»åŠ åŠŸèƒ½ ä¿®å¤é”™è¯¯æ—¶é‡æ„ å¤å®¡ä»£ç æ—¶é‡æ„ 2.4 é‡æ„çš„ä»·å€¼ç¨‹åºæœ‰ä¸¤é¢ä»·å€¼ï¼Œä»Šå¤©å¯ä»¥ä¸ºä½ åšä»€ä¹ˆå’Œæ˜å¤©å¯ä»¥ä¸ºä½ åšä»€ä¹ˆä¸ºäº†æ»¡è¶³æ˜å¤©çš„éœ€è¦ï¼Œä½ ä¼šé‡åˆ°ï¼š éš¾ä»¥é˜…è¯»ï¼Œé€»è¾‘é‡å¤ æ·»åŠ æ–°åŠŸèƒ½è®¸ä¿®æ”¹ä»¥å‰ä»£ç  å¤æ‚çš„æ¡ä»¶é€»è¾‘ç­‰ä»£ç  è€Œä½ å¸Œæœ›çœ‹åˆ°çš„æ˜¯ï¼š å®¹æ˜“é˜…è¯»ï¼Œæ‰€æœ‰é€»è¾‘åœ¨å”¯ä¸€æŒ‡å®šåœ°ç‚¹ï¼Œ æ–°çš„ä¿®æ”¹ä¸ä¼šå±åŠç°æœ‰è¡Œä¸º å°½å¯èƒ½ç®€å•è¡¨è¾¾é€»è¾‘æ¡ä»¶ é‡æ„å°±æ˜¯æŠŠç¨‹åºè½¬å˜ä¸ºè¿™äº›ç‰¹å¾çš„å·¥å…· 2.5å¦‚ä½•å‘Šè¯‰ï¼ˆå¯¹ä»˜ï¼‰ç»ç†å¾ˆå¤šç»ç†éƒ½æ˜¯è¿›åº¦é©±åŠ¨ï¼Œæ‰€ä»¥æ›´åŠ éœ€è¦é‡æ„å¸¦æ¥çš„å¥½å¤„ï¼Œæ‰€ä»¥ä¸è¦å‘Šè¯‰ä»–ä»¬ ä»–ä»¬ä¸ä¼šç†è§£çš„ 2.5.1å¼•å…¥é—´æ¥å±‚ä¸é‡æ„çš„å…³ç³»é—´æ¥å±‚ä¼˜ç‚¹ï¼š å…è®¸é€»è¾‘å…±äº« å¢åŠ è§£é‡Šæ„å›¾å’Œå®ç°çš„æœºä¼šï¼å¤šäº†ç±»åå’Œå‡½æ•°å éš”ç¦»å˜åŒ– å¤šæ€å°è£…æ¡ä»¶é€»è¾‘ 2.5.2ä½•æ—¶ä¸åº”è¯¥é‡æ„ è½¯ä»¶æ ¹æœ¬ä¸å·¥ä½œ æœ€åæœŸé™å·²è¿‘ æœªå®Œæˆçš„é‡æ„å¯ä»¥ç§°ä¹‹ä¸ºå€ºåŠ¡ï¼Œè¿Ÿæ—©è¦è¿˜ 2.5.3é‡æ„ä¸é¢„å…ˆè®¾è®¡çš„å…³ç³»é‡æ„å¯ä»¥èŠ‚çº¦ä¸å¿…è¦çš„æ—¶é—´ç²¾åŠ›èŠ±åœ¨é¢„å…ˆè®¾è®¡ä¸Šï¼Œè®©è½¯ä»¶è®¾è®¡å‘ç®€åŒ–å‘å±• 3ä»£ç çš„åå‘³é“ é‡å¤ä»£ç  è¿‡é•¿å‡½æ•° è¿‡å¤§ç±»ï¼Œè¿‡é•¿å‚æ•° ä¿®æ”¹ä¸€å¤„ç¨‹åºçš„åŸå› è¿‡å¤š/ä¸€ä¸ªåŸå› ä¿®æ”¹è¿‡å¤šçš„ç¨‹åº æ•°æ®ä¾èµ–è¿‡å¤š é‡å¤çš„å­—æ®µå’Œå‚æ•° æ€»æ˜¯æ”¾åœ¨ä¸€èµ·çš„å­—æ®µ switchè¯­å¥ å¹³è¡Œç»§æ‰¿å…³ç³» ä¸æ˜¯æ‰€æœ‰åˆ†æ”¯ä¸‹éƒ½éœ€è¦çš„ä¸´æ—¶å˜é‡ è¿‡åº¦è€¦åˆè°ƒç”¨é“¾ ä¸å¿…è¦çš„å§”æ‰˜ å¤±è¡€æ•°æ®ç±» é¢‘ç¹é‡å†™çˆ¶ç±»æ–¹æ³• è¿‡å¤šæ³¨é‡Š 4~12å…·ä½“å¦‚ä½•åšè‡ªå·±çœ‹ä¹¦å§","link":"/blog-posts/2018-9-8-reading.html"},{"title":"[ç‰‡æ®µ]ä½¿ç”¨TypeTokenåœ¨è¿è¡ŒæœŸä¿å­˜æ³›å‹ä¿¡æ¯","text":"ä¸€èˆ¬æ¥è¯´å¯ä»¥ä½¿ç”¨getGenericSuperclass è·å–å­ç±»èŒƒå‹ä¿¡æ¯ï¼Œä½†æ˜¯æ³›å‹æœ‰åµŒå¥—çš„è¯æƒ³è·å–å®Œæ•´ä¿¡æ¯è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ã€‚ä¾‹å¦‚ï¼šMessage&lt;List&gt; æœ‰ä¸¤ä¸ªæ³›å‹ä¿¡æ¯ã€‚ guavaä¸­æœ‰å¼ºå¤§çš„TypeTokenå¸®åŠ©ä½ ä¿å­˜å¤æ‚æ³›å‹ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒï¼š 123ParameterizedTypeReference&lt;Message&lt;T&gt;&gt; responseTypeRef = ParameterizedTypeReferenceBuilder.fromTypeToken( new TypeToken&lt;Message&lt;T&gt;&gt;() {}.where(new TypeParameter&lt;T&gt;() {}, new TypeToken&lt;List&lt;OrgSugVOV1&gt;&gt;() {})); å¦‚æœéœ€è¦åœ¨springæ¡†æ¶ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä¸€ä¸ªé€‚é…å™¨ï¼š 123456789101112131415161718192021222324252627282930313233343536public class ParameterizedTypeReferenceBuilder { public static &lt;T&gt; ParameterizedTypeReference&lt;T&gt; fromTypeToken(TypeToken&lt;T&gt; typeToken) { return new TypeTokenParameterizedTypeReference&lt;&gt;(typeToken); } private static class TypeTokenParameterizedTypeReference&lt;T&gt; extends ParameterizedTypeReference&lt;T&gt; { private final Type type; private TypeTokenParameterizedTypeReference(TypeToken&lt;T&gt; typeToken) { this.type = typeToken.getType(); } @Override public Type getType() { return type; } @Override public boolean equals(Object obj) { return (this == obj || (obj instanceof ParameterizedTypeReference &amp;&amp; this.type.equals(((ParameterizedTypeReference&lt;?&gt;) obj).getType()))); } @Override public int hashCode() { return this.type.hashCode(); } @Override public String toString() { return \"ParameterizedTypeReference&lt;\" + this.type + \"&gt;\"; } }} å…³äºjavaçš„æ³›å‹æˆ‘å°±ä¸å¤šåšåæ§½äº†ã€‚","link":"/blog-posts/2019-02-26-java-genic-type.html"},{"title":"[é¡¹ç›®] æ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢é‡åˆ°çš„å‘","text":"å‰æƒ…æ¦‚è¦ 1. é—®é¢˜èƒŒæ™¯ä½¿ç”¨å¤šä¸ªè§’è‰²æŸ¥è¯¢åˆ—è¡¨æ—¶ï¼Œä¼šé‡åˆ°ä¸¤ä¸ªç»´åº¦çš„ä¸åŒç‚¹ï¼š è¡Œç»´åº¦ï¼šå¤šä¸ªè§’è‰²èƒ½å¤Ÿçœ‹åˆ°è¡Œçš„å¹¶é›†ï¼Œsqléœ€è¦å¤šæ¬¡æŸ¥è¯¢å–å¹¶é›†ï¼Œä¹‹åè¿˜è¦å»é‡åˆ†é¡µæ’åº åˆ—ç»´åº¦ï¼šå¦‚æœä¸åŒè§’è‰²å¯è§åˆ—ä¸åŒï¼Œè®¡ç®—å‡ºå½“å‰è¡Œèƒ½çœ‹åˆ°åˆ—çš„å¹¶é›† ä¸¾ä¸€ä¸ªä¾‹å­ï¼š å‡è®¾å­˜åœ¨ä¸€ä¸ªç™»å½•å‘˜å·¥æ‹¥æœ‰ä¸¤ä¸ªè§’è‰²ï¼š é•¿æœŸæ¿€åŠ±è´Ÿè´£äººï¼šèƒ½çœ‹åˆ°æ‹¥æœ‰é•¿æœŸæ¿€åŠ±çš„äººï¼ˆè¡Œç»´åº¦ï¼‰ï¼Œèƒ½çœ‹åˆ°åŸºæœ¬ä¿¡æ¯å’Œé•¿æœŸæ¿€åŠ±ä¿¡æ¯ï¼ˆåˆ—ç»´åº¦ï¼‰ è–ªé…¬è´Ÿè´£äººï¼šèƒ½çœ‹åˆ°ä½èŒçº§çš„äººï¼ˆè¡Œç»´åº¦ï¼‰ï¼Œèƒ½çœ‹åˆ°åŸºæœ¬ä¿¡æ¯å’Œè–ªé…¬ä¿¡æ¯ï¼ˆåˆ—ç»´åº¦ï¼‰ é‚£ä¹ˆï¼Œåœ¨åˆ—è¡¨ä¸­ä»–èƒ½çœ‹è§ï¼š åŸºæœ¬ä¿¡æ¯ è–ªé…¬ä¿¡æ¯ é•¿æœŸæ¿€åŠ±ä¿¡æ¯ ä½èŒçº§/æ— é•¿æœŸæ¿€åŠ± âˆš âˆš x ä½èŒçº§/é•¿æœŸæ¿€åŠ± âˆš âˆš âˆš é«˜èŒçº§/æ— é•¿æœŸæ¿€åŠ± x x x é«˜èŒçº§/é•¿æœŸæ¿€åŠ± âˆš x âˆš 2. å®é™…é‡åˆ°çš„é—®é¢˜ï¼ˆå›°éš¾é‡é‡ï¼‰åŸºæœ¬æ€è·¯å·²ç»åœ¨å‰æœŸæ¦‚è¦é‡Œä»‹ç»ï¼Œæœ¬äººå·²ç»å®è·µäº†ä¸€æ®µæ—¶é—´ï¼ŒæŒ–äº†ä¸¤ä¸ªæ·±å‘æ­£åœ¨è§£å†³ä¸­ã€‚ æ€§èƒ½é—®é¢˜ï¼ˆå·²è§£å†³ï¼‰æœ€å¼€å§‹çš„å®ç°ä¸­æ•°æ®æ˜¯ä¸€æ¡ä¸€æ¡è¯»å–çš„ï¼ŒåŒæ—¶è–ªé…¬å­—æ®µå±äºåŠ å¯†ä¿¡æ¯ï¼Œä½¿ç”¨äº†ç¬¬ä¸‰æ–¹å¾®æœåŠ¡æä¾›è§£å¯†ï¼Œè¯»å–å­—æ®µå¤š+è§£å¯†å­—æ®µå¤š å¯¼è‡´äº†åœ¨ç™¾æ¡åˆ†é¡µçš„æƒ…å†µä¸‹æ¥å£åœ¨è¶…æ—¶çš„è¾¹ç¼˜ä¸æ–­è¯•æ¢ã€‚ã€‚ã€‚ è§£å†³æ–¹æ¡ˆï¼š åˆå¹¶æŸ¥è¯¢sql,æ‰¹é‡æŸ¥è¯¢æ•°æ® åˆå¹¶è§£å¯†è¯·æ±‚,æ‰¹é‡è°ƒç”¨è§£å¯†å¾®æœåŠ¡ å› ä¸ºä¹‹å‰ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è§£å¯†ä½¿ç”¨äº†mybatisçš„TypeHandleråšåˆ°å­—æ®µéšå¼åŠ è§£å¯†ï¼Œç›®å‰æˆ‘ä»¬çš„åšæ³•æ˜¯å¯¹äºå•æ¡æ•°æ®çš„åŠ è§£å¯†ï¼Œè¿˜æ˜¯ä¿æŒåŸæ¥çš„typeHandleråšæ³•ï¼Œè€Œå¯¹æ‰¹é‡æ•°æ®å¤„ç†ï¼Œé‡æ–°å†™ä¸€å¥—æ•°æ®å®ä½“ï¼ŒåŒæ—¶ä½¿ç”¨mybatisçš„æ‹¦æˆªå™¨å¯¹æŸ¥è¯¢çš„æ‰¹é‡æ•°æ®åšæ‰¹é‡è§£å¯†çš„å¤„ç†ã€‚å…·ä½“åšæ³•å¯ä»¥å‚è§æˆ‘çš„å¦ä¸€ç‰‡æ–‡ç« ï¼šã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µ-ç»­ æ‰¹é‡æŸ¥è¯¢å¸¦æ¥çš„é—®é¢˜æ‰¹é‡æŸ¥è¯¢è¿”å›çš„åˆ—è¡¨ä¸­åˆ—å­—æ®µéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè€Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯ä¸åŒçš„è¡Œèƒ½çœ‹è§ä¸åŒçš„åˆ—å­—æ®µï¼ŒæŠŠæ‰¹é‡æŸ¥è¯¢å‡ºæ¥çš„åˆ—è¡¨ç›´æ¥è¿”å›æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™ä¸ªé—®é¢˜å› ä¸ºç–å¿½å¯¼è‡´äº†çº¿ä¸Šçš„ä¸€æ¬¡æ•…éšœã€‚ æ‰€ä»¥ç›®å‰çš„æ€è·¯æ˜¯å…ˆåšä¸€æ¬¡æ•°æ®æ‰¹é‡é¢„å–ï¼Œä¹‹ååœ¨å¯¹åˆ—å­—æ®µåšå¤„ç†ï¼Œéšè—æ‰ä¸èƒ½çœ‹è§çš„å­—æ®µã€‚ 3. æ€»ç»“æ²¡æœ‰æƒ³åˆ°å½“æ—¶æƒ³è§£å†³æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢è¿™ä¸ªé—®é¢˜æ—¶ä¼šé‡åˆ°è¿™ä¹ˆå¤šå›°éš¾ï¼Œæƒ³æ³•æ˜¯æ­£ç¡®çš„ï¼Œåœ¨å®é™…æ‰§è¡Œæ—¶è¿˜æ˜¯å›°éš¾é‡é‡ã€‚å€¼å¾—æ¬£æ…°çš„åœ¨æœ€å¼€å§‹çš„æ—¶å€™æ€è·¯å’Œæ–¹å‘éƒ½æ˜¯æ­£ç¡®çš„ï¼ŒåŒæ—¶ä¹ŸæŠŠå…¶ä¸­é‡åˆ°çš„å„ç§é—®é¢˜å’Œå¿ƒå¾—è®°å½•äº†ä¸‹æ¥ï¼Œç»è¿‡å±‚å±‚ç§¯ç´¯ï¼Œæ‰åˆ°è¾¾ç°åœ¨çš„é«˜åº¦ã€‚ []: https://blog.yamato.moe/2018/11/06/2018-11-06-biz/ â€œæ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢çš„ä¸€ç§æ€è·¯â€[]: https://blog.yamato.moe/2019/04/04/Mybatis%20ResultSetHandler_2019-04-04%20%E7%BB%AD/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µ-ç»­â€[]: https://blog.yamato.moe/2019/01/09/Mybatis%20ResultSetHandler_2019-01-09/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µâ€","link":"/blog-posts/2019-05-17-æ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢é‡åˆ°çš„å‘.html"},{"title":"[é¡¹ç›®æ„Ÿæ‚Ÿ] è¯»ã€Šå†è°ˆæ•æ·å¼€å‘ä¸å»¶æœŸé£æ§ã€‹","text":"æœ¬äººæœ¬èº«ä¸å¤ªå–œæ¬¢æ–¹æ³•è®ºï¼Œæ„Ÿè§‰éƒ½æ˜¯å¥—è·¯ï¼Œç”Ÿæ¬ç¡¬å¥—ä¸é€‚åˆè‡ªå·±ï¼Œæ•æ·å¼€å‘å°±æ˜¯å…¶ä¸­è®©æˆ‘ä¿æŒè°¨æ…æ€åº¦çš„æ–¹æ³•è®ºä¹‹ä¸€ã€‚ æ•æ·å¼€å‘ä¸Scrumå¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è¯´ï¼Œèƒ½å¤Ÿå³å¿«åˆå¥½åœ°å®Œæˆå½“ç„¶æ˜¯éå¸¸æ£’çš„ï¼Œä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œå—é™äºé¡¹ç›®ç®¡ç†ä¸‰è¦ç´ ï¼šæ—¶é—´ã€è´¨é‡ã€æˆæœ¬ï¼Œåªèƒ½æŠ˜è¡·é€‰æ‹©ã€‚å› æ­¤ã€Œæ•æ·ã€ä½œä¸ºä¸€ç§æ–¹æ³•è®ºï¼ˆè™½ç„¶Agileè‡ªç§°ä¸ºCultureï¼‰è¢«æå‡ºï¼Œå…¶ä¸­Scrum(/skrÊŒm/ï¼Œä¸€ç§çƒç±»æ¯”èµ›)æ˜¯æ¯”è¾ƒçŸ¥åçš„å®ç°ç±»ä¹‹ä¸€ã€‚ åœ¨Scumä¸­ï¼Œå®ƒä¸»è¦å¼ºè°ƒå°†ç€‘å¸ƒå¼å¼€å‘æµç¨‹è½¬ä¸ºå¤šé˜¶æ®µå°è¿­ä»£ï¼Œå¯ä»¥ç†è§£ä¸ºCPUçš„å¤šçº§æµæ°´çº¿(Instruction pipeline)è®¾è®¡ï¼Œæµæ°´çº¿è®¾è®¡å°†CPUçš„è®¡ç®—é€»è¾‘æ‹†åˆ†ï¼Œå®ç°äº†å¤ç”¨è®¡ç®—æ¨¡å—ï¼Œè¿›è€Œæé«˜äº†æ—¶é’Ÿé¢‘ç‡ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†å¯„å­˜å™¨/åˆ†æ”¯é¢„æµ‹ç­‰ç®¡ç†æ¨¡å—å¢åŠ äº†å¤æ‚åº¦ã€‚ ç±»ä¼¼äºCPUæµæ°´çº¿æœºåˆ¶ï¼Œæ•æ·å¼€å‘æœ¬è´¨æ˜¯åœ¨ä¿æŒæ—¶é—´ã€è´¨é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æŠ•å…¥ç®¡ç†æˆæœ¬é™ä½å¼€å‘è¿‡ç¨‹çš„ç©ºè½¬æˆæœ¬ï¼Œè¿›è€Œæé«˜æ—¶é’Ÿå‘¨æœŸçš„æ–¹æ³•ã€‚ ç”¨ç™½è¯æ¥è¯´ï¼Œå¯ä»¥æŠŠè½¯ä»¶å¼€æ”¾æ¯”ä½œæµæ°´è½¦é—´ï¼ŒæŠŠPMï¼ŒSEæ¯”ä½œæµæ°´çº¿å·¥äººã€‚ æˆ‘è§è¿‡çš„çš„å‡æ•æ·ç„¶è€Œåˆ°äº†ç°å®ï¼Œç”±äºå„ç§åŸå› ï¼Œå´å¾ˆå®¹æ˜“æˆä¸ºå‡æ•æ· å°†å·¥ä½çš„éš”æ æ‹†å¼€å˜æˆç½‘å§â€œæ•æ·å²›â€ å¼ºè¡Œå°†Releaseè®¡åˆ’æ‹†æˆä¸€ä¸ªæœˆä¸€ç‰ˆï¼Œå°†Sprintæ‹†æˆ2å‘¨å°±çœ‹ä½œå¿«é€Ÿè¿­ä»£ï¼Œç…§ç€äººæœˆç¥è¯åç€æ æ‹›è˜ä¸€å †æ— è´£ä»»å¿ƒçš„å¼€å‘è®©ä½ å»â€œæ•æ·â€ï¼Œæ°¸è¿œæ— æ³•å®ç°â€œå…¨åŠŸèƒ½éƒ¨é˜Ÿâ€ å®¢æˆ·éš¾æ²Ÿé€šï¼ŒPOä½ä¼°å·¥ä½œé‡ï¼ŒSEè®¾è®¡ç¼ºé™·ï¼Œç¼–ç è´¨é‡ä½ç­‰åŸå› ï¼Œæœ€ç»ˆå¯¼è‡´å»¶æœŸä¸Šè¿°ä»»ä½•ä¸€ä¸ªé—®é¢˜ï¼Œéƒ½å¯èƒ½å¯¼è‡´æœ€ç»ˆé¡¹ç›®ä¸€é”…ç²¥ï¼Œå¯¼è‡´é«˜å±‚ç„¦è™‘ï¼Œä¸­å±‚è·‘è·¯ï¼Œåº•å±‚æ··æ—¥å­çš„ç»“æœã€‚ æ•æ·èƒ½å¤Ÿæä¾›å¼ºå¤§é«˜æ•ˆçš„æ–¹æ³•è®ºï¼Œä½†æ˜¯å‰ææ˜¯éœ€è¦æœ¬èº«åŸºç¡€è¿‡ç¡¬çš„å›¢é˜Ÿï¼Œæ•æ·åªèƒ½å¸®åŠ©å­˜åœ¨è¿›æ­¥ç“¶é¢ˆçš„å›¢é˜Ÿã€‚å¦‚æœé¡¹ç›®å·²ç»ç©ºå¿ƒåŒ–ï¼Œå€ºåŠ¡å¤šï¼Œè¿™ä¸æ˜¯æ•æ·æ–¹æ³•è®ºåº”è¯¥è§£å†³çš„é—®é¢˜ã€‚","link":"/blog-posts/2019-04-01-[é¡¹ç›®æ„Ÿæ‚Ÿ] è¯»ã€Šå†è°ˆæ•æ·å¼€å‘ä¸å»¶æœŸé£æ§ã€‹.html"},{"title":"æ„å»ºå¤§å‹æ”¯ä»˜ç³»ç»Ÿæ—¶åˆ†å¸ƒå¼æ¶æ„çš„å…³é”®ç‚¹","text":"SLAåœ¨æ„å»ºå¤§å‹ç³»ç»Ÿæ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°å„ç§é”™è¯¯ã€‚åœ¨è®¡åˆ’æ„å»ºä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œå®šä¹‰ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ååˆ†é‡è¦ã€‚ â€œå¥åº·çŠ¶æ€â€å¿…é¡»æ˜¯å¯åº¦é‡çš„ï¼Œä¸€èˆ¬åšæ³•æ˜¯ä½¿ç”¨SLAsæ¥åº¦é‡ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ã€‚æœ€å¸¸è§çš„SLAä¸º å¯è¾¾æ€§ ä»æ—¶é—´ç»´åº¦è¡¡é‡ï¼ˆ99.999%å¯è¾¾æ€§ï¼Œæ¯å¹´ä¸‹çº¿50åˆ†é’Ÿï¼‰ å‡†ç¡®æ€§ å¯¹äºæ•°æ®çš„ä¸¢å¤±æˆ–å¤±çœŸæ˜¯å¦å¯ä»¥æ¥å—ï¼Ÿå¯ä»¥è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”ï¼Ÿå¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œä¸æ¥å—ä»»ä½•æ•°æ®çš„ä¸¢å¤±å’Œå¤±çœŸ å®¹é‡ ç³»ç»Ÿæ”¯æŒå¹¶å‘ å»¶è¿Ÿ å“åº”å»¶è¿Ÿï¼Œä¸€èˆ¬è¡¡é‡95%è¯·æ±‚çš„å“åº”æ—¶é—´å’Œ99%è¯·æ±‚å“åº”æ—¶é—´ ç¡®ä¿æ–°ç³»ç»Ÿæ¯”è¢«æ›¿ä»£ç³»ç»Ÿâ€œæ›´å¥½â€ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢å››ä¸ªSLAæŒ‡æ ‡æ¥è¡¡é‡ï¼Œå¯è¾¾æ€§æ˜¯æœ€é‡è¦çš„éœ€æ±‚ã€‚ æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©éšç€æ–°ä¸šåŠ¡çš„å¢é•¿ï¼Œè´Ÿè½½ä¹Ÿä¼šå¢åŠ ã€‚æœ€å¸¸è§çš„ä¼¸ç¼©ç­–ç•¥æ˜¯å‚ç›´å’Œæ°´å¹³ä¼¸ç¼©ã€‚ æ°´å¹³ä¼¸ç¼©å°±æ˜¯å¢åŠ æ›´å¤šçš„æœºå™¨æˆ–èŠ‚ç‚¹ï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´æ°´å¹³ä¼¸ç¼©æ˜¯æœ€å¸¸æœ‰çš„æ–¹å¼ã€‚ å‚ç›´ä¼¸ç¼©åŸºæœ¬ä¸Šå°±æ˜¯ä¹°æ›´å¤§/å¥½çš„æœºå™¨ã€‚ ä¸€è‡´æ€§å¯è¾¾æ€§å¯¹äºä»»ä½•ç³»ç»Ÿéƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œä½†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸€èˆ¬éƒ½æ„å»ºåœ¨ä½å¯è¾¾æ€§çš„æœºå™¨ä¸Šï¼ˆæ¯”å¦‚ï¼šæœåŠ¡çš„å¯è¾¾æ€§è¦æ±‚99.999% æœºå™¨çš„å¯è¾¾æ€§ä¸º99.9%ï¼‰ã€‚ç®€å•çš„åšæ³•æ˜¯ç»´æŠ¤ä¸€ç»„æœºå™¨ç»„æˆé›†ç¾¤ï¼Œè¿™æ ·æœåŠ¡çš„å¯è¾¾æ€§ä¸ä¾èµ–å•ç‹¬çš„æœºå™¨ã€‚ ä¸€è‡´æ€§æ˜¯åœ¨é«˜å¯ç”¨ç³»ç»Ÿä¸­æœ€éœ€è¦å…³å¿ƒçš„ã€‚ä¸€ä¸ªä¸€è‡´æ€§ç³»ç»Ÿåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šçœ‹åˆ°å’Œè¿”å›çš„æ•°æ®åœ¨åŒä¸€æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚å¦‚æœä½¿ç”¨ä¸€ç»„æœºå™¨æ¥ç»„æˆé›†ç¾¤ï¼Œå®ƒä»¬è¿˜éœ€è¦äº’ç›¸å‘é€æ¶ˆæ¯æ¥ä¿æŒåŒæ­¥ï¼Œä½†æ˜¯å‘é€æ¶ˆæ¯å¯èƒ½å¤±è´¥ï¼Œè¿™æ ·ä¸€äº›èŠ‚ç‚¹å°±ä¼šå› ä¸ºä¸ä¸€è‡´è€Œä¸å¯è¾¾ã€‚ ä¸€è‡´æ€§æœ‰å¤šä¸ªæ¨¡å‹ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¸¸ç”¨çš„æ˜¯å¼ºä¸€è‡´æ€§ï¼Œå¼±ä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€è‡´æ€§è¦æ±‚è¶Šä½ï¼Œç³»ç»Ÿå¯ä»¥å·¥ä½œçš„æ›´å¿«ï¼Œä½†æ˜¯è¿”å›çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚ ç³»ç»Ÿä¸­çš„æ•°æ®éœ€è¦æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯åˆ°åº•æ˜¯æ€æ ·çš„ä¸€è‡´ï¼Ÿå¯¹äºä¸€äº›ç³»ç»Ÿï¼Œéœ€è¦å¼ºä¸€è‡´æ€§ï¼Œæ¯”å¦‚ä¸€æ¬¡æ”¯ä»˜å¿…é¡»æ˜¯å¼ºä¸€è‡´çš„å­˜å‚¨ä¸‹æ¥ã€‚å¯¹äºæ²¡é‚£ä¹ˆé‡è¦çš„éƒ¨åˆ†ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¯ä»¥è€ƒè™‘çš„æƒè¡¡ã€‚æ¯”å¦‚åˆ—å‡ºæœ€è¿‘çš„äº¤æ˜“ã€‚ æ•°æ®æŒä¹…æ€§æŒä¹…æ€§è¡¨ç¤ºä¸€æ—¦æ•°æ®æˆåŠŸæ·»åŠ åˆ°æ•°æ®å­˜å‚¨ï¼Œå®ƒå°±æ°¸è¿œå¯ä»¥è®¿é—®åˆ°ã€‚ä¸åŒçš„åˆ†å¸ƒå¼æ•°æ®åº“æ‹¥æœ‰ä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ä¸€èˆ¬ä½¿ç”¨å‰¯æœ¬æ¥å¢åŠ æ•°æ®æŒä¹…æ€§ã€‚ å¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œæ•°æ®ä¸å…è®¸ä¸¢å¤±ã€‚æˆ‘ä»¬æ„å»ºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨éœ€è¦æ”¯æŒé›†ç¾¤çº§åˆ«çš„æ•°æ®æŒä¹…å‹ã€‚ç›®å‰Cassandra, MongoDB, HDFSå’ŒDynamodb éƒ½æ”¯æŒå¤šç§çº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ‰§è¡Œè®¡ç®—ï¼Œå­˜å‚¨æ•°æ®ï¼Œäº’ç›¸å‘é€æ¶ˆæ¯ã€‚å‘é€æ¶ˆæ¯çš„å…³é”®æ˜¯æ¶ˆæ¯çš„å¯é åˆ°è¾¾ã€‚å¯¹äºå…³é”®ç³»ç»Ÿï¼Œç»å¸¸éœ€è¦æ¶ˆæ¯é›¶ä¸¢å¤±ã€‚ å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå‘é€æ¶ˆæ¯ä¸€èˆ¬çŸ³æ²¹åˆ†å¸ƒå¼æ¶ˆæ¯æœåŠ¡å‘é€ï¼Œå¦‚RabbitMQï¼ŒKafkaã€‚è¿™äº›æ¶ˆæ¯æœåŠ¡æ”¯æŒä¸åŒçº§åˆ«çš„æ¶ˆæ¯æŠ•é€’å¯é æ€§ã€‚ æ¶ˆæ¯ä¿æŒè¡¨ç¤ºå½“èŠ‚ç‚¹å¤„ç†æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œåœ¨é”™è¯¯è¢«è§£å†³å‰æ¶ˆæ¯ä¸€ç›´è¢«ä¿æŒç€ã€‚æ¶ˆæ¯çš„æŒä¹…æ€§ä¸€èˆ¬åœ¨æ¶ˆæ¯é˜Ÿåˆ—å±‚è¢«ä½¿ç”¨ã€‚å¦‚æœåœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™é˜Ÿåˆ—æˆ–èŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œé‚£åœ¨å®ƒä»¬é‡æ–°ä¸Šçº¿æ˜¯è¿˜èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚ åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­æˆ‘ä»¬éœ€è¦æ¯ä¸€æ¡æ¶ˆæ¯æŠ•é€’ä¸€æ¬¡ï¼Œåœ¨æ„å»ºç³»ç»Ÿä¸­ä¿è¯æŠ•é€’ä¸€æ¬¡å’ŒæŠ•é€’è‡³å°‘ä¸€æ¬¡åœ¨å®ç°ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚æœ€åæˆ‘ä»¬ä½¿ç”¨äº†kafkaæ¥ä¿è¯æŠ•é€’è‡³å°‘ä¸€æ¬¡ã€‚ å¹‚ç­‰æ€§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½å¯èƒ½å‡ºé”™ï¼Œè¿æ¥ä¼šä¸¢åŒ…æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯ç»å¸¸ä¼šé‡è¯•è¿™äº›è¯·æ±‚ã€‚ä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿä¿è¯æ— è®ºå¤šå°‘ç‰¹å®šçš„è¯·æ±‚è¢«æ‰§è¡Œï¼Œä¸€ä¸ªè¯·æ±‚å®é™…çš„æ“ä½œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚æ”¯ä»˜è¯·æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ”¯ä»˜å¹¶ä¸”è¯·æ±‚å·²ç»æˆåŠŸï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¶…æ—¶äº†ï¼Œå®¢æˆ·ç«¯æ˜¯èƒ½å¤Ÿé‡è¯•ç›¸åŒçš„è¯·æ±‚çš„ã€‚å¯¹äºä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿï¼Œä¸€ä¸ªä¸ªäººçš„æ”¯ä»˜æ˜¯ä¸èƒ½è¢«æ”¶å–ä¸¤æ¬¡çš„ã€‚ å¯¹å¹‚ç­‰çš„è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦æŸç§åˆ†å¸ƒå¼é”æœºåˆ¶ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¹è§‚é”æ¥å®ç°å¹‚ç­‰æ€§ï¼Œè¿™æ—¶ç³»ç»Ÿéœ€è¦å¼ºä¸€è‡´æ€§çš„é”æ¥æ‰§è¡Œæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç‰ˆæœ¬çš„ä¹è§‚é”æ¥æ£€æŸ¥æ˜¯å¦æœ‰å¯åŠ¨äº†é¢å¤–çš„æ“ä½œã€‚ æ ¹æ®ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œæ“ä½œçš„ç±»å‹ï¼Œæœ‰å¾ˆå¤šæ–¹å¼æ¥å®ç°å¹‚ç­‰æ€§ã€‚åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œå¹‚ç­‰æ€§æ—¶æœ€å®¹æ˜“å¿½ç•¥çš„ã€‚åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œå¹‚ç­‰æ“ä½œæ—¶æœ€é‡è¦çš„ï¼Œå®ƒé¿å…äº†åŒèŠ±å’ŒåŒæ”¶é—®é¢˜ã€‚æ¶ˆæ¯ç³»ç»Ÿå·²ç»ä¿è¯äº†æ¶ˆæ¯è‡³å°‘æ¶ˆè´¹ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯æ‰€æœ‰é‡å¤çš„æ¶ˆæ¯ä¿è¯å¹‚ç­‰æ€§å³å¯ã€‚æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ä¹è§‚é”ï¼Œå¹¶ä½¿ç”¨å¼ºä¸€è‡´æ€§å­˜å‚¨ä½œä¸ºä¹è§‚é”çš„æ•°æ®æºã€‚ åˆ†ç‰‡å’Œæ³•å®šäººæ•°åˆ†å¸ƒå¼ç³»ç»Ÿç»å¸¸éœ€è¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œè¿œè¶…ä¸€å°èŠ‚ç‚¹çš„å®¹é‡ã€‚ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆæ—¶ä½¿ç”¨åˆ†ç‰‡ï¼Œæ•°æ®ä½¿ç”¨æŸç§hashç®—æ³•è¢«æ°´å¹³åˆ†åŒºã€‚å°½ç®¡å¾ˆå¤šåˆ†å¸ƒå¼æ•°æ®åº“å±è”½äº†åˆ†ç‰‡çš„å®ç°ï¼Œä½†æ˜¯åˆ†ç‰‡è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œç‰¹åˆ«æ˜¯å…³äºé‡æ–°åˆ†ç‰‡ã€‚ è®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šä¸ªæ‹¥æœ‰æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ã€‚ä¸ºä¿è¯å¯¹æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ï¼Œä½¿ç”¨åŸºäºæŠ•ç¥¨çš„æ–¹å¼æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰è¶…è¿‡ä¸€å®šæ•°é‡çš„èŠ‚ç‚¹æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªæ“ä½œæ‰æ˜¯æˆåŠŸçš„ï¼Œè¿™ä¸ªå«åšæ³•å®šäººæ•°ã€‚ Actoræ¨¡å‹æè¿°åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æ™®éçš„åšæ³•æ˜¯ä½¿ç”¨Actoræ¨¡å‹ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯CSPã€‚ Actoræ¨¡å‹åŸºäºactoräº’ç›¸å‘é€æ¶ˆæ¯å¹¶ä½œå‡ºå›åº”ã€‚æ¯ä¸€ä¸ªactoråªèƒ½åšå°‘é‡çš„åŠ¨ä½œï¼Œåˆ›å»ºå…¶ä»–actors, å‘é€æ¶ˆæ¯æˆ–è€…å†³å®šå¦‚ä½•å¤„ç†ä¸‹ä¸ªæ¶ˆæ¯ã€‚é€šè¿‡è¿™äº›ç®€å•çš„è§„åˆ™ï¼Œå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥è¢«å‡†ç¡®æè¿°ï¼Œå¯ä»¥åœ¨actorå´©æºƒåè‡ªæˆ‘ä¿®å¤ã€‚ ä½¿ç”¨akkaæä¾›äº†æ ‡å‡†çš„åˆ†å¸ƒå¼æ¨¡å‹ï¼Œé¿å…æˆ‘ä»¬é‡å¤é€ è½®å­ã€‚ ååº”å¼æ¶æ„å½“æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œç›®æ ‡å¸¸å¸¸æ˜¯å®ƒä»¬çš„å¼¹æ€§ï¼Œä¼¸ç¼©æ€§ï¼Œå’Œæ‰©å±•æ€§ã€‚ååº”å¼æ¶æ„æ˜¯åœ¨è¿™ä¸ªé¢†åŸŸæœ€æµè¡Œå’Œæœ€é€šç”¨çš„æ–¹æ¡ˆã€‚","link":"/blog-posts/Distributed architecture concepts I learned while building a large payments system.html"},{"title":"IO Modle","text":"æ“ä½œç³»ç»ŸIOæ¨¡å‹ä¸Java IOJava IOæ¨¡å‹å’Œæ“ä½œç³»ç»ŸIOæ¨¡å‹æ¯æ¯ç›¸å…³ï¼Œä¹‹å‰é˜»å¡/éé˜»å¡ï¼ŒåŒæ­¥/éåŒæ­¥ä¹‹é—´çš„å…³ç³»ä¸€ç›´åˆ†ä¸æ¸…ï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦äº†è§£ä¸‹æ“ä½œç³»ç»Ÿ(linux)æä¾›äº†å“ªäº›æ¥å£æ¥è¿›è¡ŒIOã€‚ç›®å‰æˆ‘ä»¬åªéœ€è¦äº†è§£å³å¯ï¼Œä½¿ç”¨ç›¸å…³å¯ä»¥ç›´æ¥æŸ¥çœ‹java ioæ•™ç¨‹ã€‚ æœ€åŸºç¡€çš„çŸ¥è¯†ä»¥ä½¿ç”¨IOè¯»å–æ•°æ®ä¸ºä¾‹ï¼Œä¸€èˆ¬æ“ä½œç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„é˜¶æ®µè¿›è¡Œæ“ä½œï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œå¯ä»¥æ˜¯ä»ç£ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œæˆ–è€…æ˜¯ç½‘å¡æ¥å—åˆ°æ•°æ®åæ‹·è´åˆ°å†…æ ¸ç©ºé—´ã€‚ ä»å†…æ ¸ç©ºé—´å°†æ•°æ®æ‹·è´è‡³è¯·æ±‚æ•°æ®çš„è¿›ç¨‹ã€‚å¦‚æœæ˜¯javaå¯èƒ½è¿˜éœ€ä»è¿›ç¨‹æ‹·è´è‡³jvmå †å†…å­˜ã€‚ Blocking I/O Modelè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ¨¡å‹ï¼Œæœ›æ–‡ç”Ÿä¹‰å°±æ˜¯é˜»å¡IOï¼Œè¿›è¡ŒIOçš„ä¸¤ä¸ªé˜¶æ®µä¼šéƒ½é˜»å¡ç¨‹åºï¼Œç›´åˆ°è¯»å–åˆ°æ•°æ®æˆ–è€…è¿”å›é”™è¯¯æ‰ä¼šè¿”å›ã€‚ å…·ä½“æ¥è¯´ï¼Œé€šè¿‡è°ƒç”¨ç³»ç»Ÿrecvfromå‡½æ•°ï¼Œè€Œrecvfromå‡½æ•°ä¼šç­‰åˆ°å‡ºé”™æˆ–è€…æŠŠæ•°æ®æ‹·è´åˆ°è¿›ç¨‹å®Œæˆæ—¶æ‰ä¼šè¿”å›ã€‚ä¹‹åæˆ‘ä»¬ç¨‹åºåªéœ€è¦å¤„ç†é”™è¯¯æˆ–è€…å¤„ç†æ•°æ®å°±å¯ä»¥äº†ã€‚ é˜»å¡æ¨¡å‹å¯¹åº”javaä¸­ç»å¤§éƒ¨åˆ†IOæ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚apiï¼Œio stream apiï¼Œè¯¥æ¨¡å‹ä¼˜ç‚¹åœ¨äºç®€å•ç›´è§‚ï¼Œç¼ºç‚¹åœ¨é•¿æ—¶é—´é˜»å¡å¾ˆéš¾æ”¯æŒå¤§é‡å¹¶å‘IOè¯·æ±‚ã€‚ Nonblocking I/O Modelè¯¥æ¨¡å‹åœ¨javaä¸­æ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ ä½¿ç”¨è½®è¯¢æ–¹å¼è°ƒç”¨ç³»ç»Ÿrecvfromå‡½æ•°ï¼Œrecvfromå‡½æ•°åœ¨ç¬¬ä¸€é˜¶æ®µå®Œæˆå‰ä¸€ç›´è¿”å›é”™è¯¯ï¼Œç›´åˆ°ç¬¬ä¸€é˜¶æ®µå®Œæˆåï¼Œé˜»å¡è‡³ç¬¬äºŒé˜¶æ®µå®Œæˆã€‚ è¿™ä¸ªæ¨¡å‹ç¨æ˜¾é¸¡è‚‹ï¼Œç‰¹ç‚¹æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µæ˜¯éé˜»å¡çš„ï¼ˆè¿›ç¨‹ä¸ä¼šè¢«åˆ‡æ¢ï¼‰ï¼Œä»£ç ç›¸æ¯”é˜»å¡æ¨¡å‹æ¥è¯´ä¹Ÿæ›´å¤æ‚ã€‚ I/O Multiplexing Modeléå¸¸è‘—åçš„IOæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒå¤§é‡å¹¶å‘IOã€‚é€šè¿‡è°ƒç”¨selectæˆ–è€…pullå¹¶é˜»å¡ï¼Œè€Œä¸æ˜¯åœ¨å®é™…è°ƒç”¨ç³»ç»ŸIOæ—¶é˜»å¡ã€‚ä½¿ç”¨selecté˜»å¡åœ¨ç¬¬ä¸€é˜¶æ®µå’ŒBlocking I/Oçš„é˜»å¡ä¸å¤ªä¸€æ ·ï¼ŒBlocking I/Oé˜»å¡åœ¨å½“å‰IOæ“ä½œç¬¬ä¸€é˜¶æ®µï¼Œè€ŒI/Oå¤ç”¨åˆ™å¯ä»¥æ³¨å†Œå¤šä¸ªI/Oåœ¨selectå‡½æ•°ï¼Œå½“æœ‰ä¸€ä¸ªI/Oå°±ç»ªæ—¶selectå‡½æ•°å°±ä¼šè¿”å›ï¼Œå¦‚æœæ‰€æœ‰I/Oå¤„äºç¬¬ä¸€é˜¶æ®µé˜»å¡çŠ¶æ€åˆ™selectå‡½æ•°é˜»å¡ã€‚ ç›¸æ¯”è¾ƒBlocking I/O Modelå’ŒNonblocking I/O Modelï¼ŒI/O Multiplexing Modelæ˜æ˜¾èƒ½åœ¨çŸ­æ—¶é—´å†…å¤„ç†æ›´å¤šçš„I/Oã€‚å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹+Blocking I/O Modelä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯æœ‰å¯èƒ½æ¶ˆè€—è¿‡å¤šçº¿ç¨‹èµ„æºã€‚ I/O Multiplexing Modelå¯¹åº”java NIOçš„Selectorç­‰api Signal-Driven I/O Modelè¯¥æ¨¡å‹åœ¨javaä¸­æ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ è¯¥æ¨¡å‹ç‰¹ç‚¹æ˜¯ç¬¬ä¸€é˜¶æ®µè°ƒç”¨sigactionå‡½æ•°éé˜»å¡è¿”å›ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µå®Œæˆåå‘é€ä¿¡å·SIGIOè‡³è¿›ç¨‹ï¼Œä¹‹ååœ¨signal handlerä¸­è¿›è¡Œç¬¬äºŒé˜¶æ®µå¤„ç†ã€‚ç›¸å½“äºå¯¹Nonblocking I/O Modelçš„ä¸€ç§æ”¹è¿›ã€‚ Asynchronous I/O ModelAsynchronous I/O Modelç›¸æ¯”è¾ƒSignal-Driven I/O Modelçš„åŒºåˆ«åœ¨äºé€šçŸ¥çš„æ—¶æœºä¸åŒï¼šAsynchronous I/O Modelåœ¨ç¬¬ä¸€å’Œç¬¬äºŒé˜¶æ®µéƒ½å®Œæˆæ—¶é€šè¿‡ä¿¡å·é€šçŸ¥è¿›ç¨‹æ“ä½œå®Œæˆã€‚ Asynchronous I/O Modelå¯¹åº”javaä¸­AsynchronousSocketChannelï¼ŒAsynchronousServerSocketChannel å’Œ AsynchronousFileChannelç­‰apiã€‚ å„ä¸ªæ¨¡å‹æ¯”è¾ƒ","link":"/blog-posts/IO-Modle.html"},{"title":"[ç‰‡æ®µ] Mybatis ResultSetHandler å®è·µ","text":"è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å‘ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Overridepublic List&lt;Object&gt; handleResultSets(Statement stmt) throws SQLException { ErrorContext.instance().activity(\"handling results\").object(mappedStatement.getId()); final List&lt;Object&gt; multipleResults = new ArrayList&lt;Object&gt;(); int resultSetCount = 0; ResultSetWrapper rsw = getFirstResultSet(stmt); List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps(); int resultMapCount = resultMaps.size(); validateResultMapsCount(rsw, resultMapCount); while (rsw != null &amp;&amp; resultMapCount &gt; resultSetCount) { ResultMap resultMap = resultMaps.get(resultSetCount); handleResultSet(rsw, resultMap, multipleResults, null); rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } String[] resultSets = mappedStatement.getResultSets(); if (resultSets != null) { while (rsw != null &amp;&amp; resultSetCount &lt; resultSets.length) { ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]); if (parentMapping != null) { String nestedResultMapId = parentMapping.getNestedResultMapId(); ResultMap resultMap = configuration.getResultMap(nestedResultMapId); handleResultSet(rsw, resultMap, null, parentMapping); } rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } } return collapseSingleResultList(multipleResults);} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123package app.pooi.common.encrypt;import app.pooi.common.encrypt.anno.CipherSpi;import app.pooi.common.encrypt.anno.Encrypted;import lombok.Getter;import org.apache.ibatis.executor.resultset.ResultSetHandler;import org.apache.ibatis.plugin.*;import org.apache.ibatis.reflection.MetaObject;import org.apache.ibatis.reflection.SystemMetaObject;import java.lang.reflect.Field;import java.sql.Statement;import java.util.*;import java.util.function.Function;import java.util.logging.Logger;import java.util.stream.Collectors;@Intercepts({ @Signature(type = ResultSetHandler.class, method = \"handleResultSets\", args = {Statement.class}),})public class EncryptInterceptor implements Interceptor { private static final Logger logger = Logger.getLogger(EncryptInterceptor.class.getName()); private CipherSpi cipherSpi; public EncryptInterceptor(CipherSpi cipherSpi) { this.cipherSpi = cipherSpi; } @Override public Object intercept(Invocation invocation) throws Throwable { final Object proceed = invocation.proceed(); if (proceed == null) { return proceed; } List&lt;?&gt; results = (List&lt;?&gt;) proceed; if (results.isEmpty()) { return proceed; } final Object first = results.iterator().next(); final Class&lt;?&gt; modelClazz = first.getClass(); final List&lt;String&gt; fieldsNeedDecrypt = Arrays.stream(modelClazz.getDeclaredFields()) .filter(f -&gt; f.getAnnotation(Encrypted.class) != null) .filter(f -&gt; { boolean isString = f.getType() == String.class; if (!isString) { logger.warning(f.getName() + \"is not String, actual type is \" + f.getType().getSimpleName() + \" ignored\"); } return isString; }) .map(Field::getName) .collect(Collectors.toList()); final List&lt;List&lt;String&gt;&gt; partition = partition(fieldsNeedDecrypt, 20); for (Object r : results) { final MetaObject metaObject = SystemMetaObject.forObject(r); for (List&lt;String&gt; fields : partition) { final Map&lt;String, String&gt; fieldValueMap = fields.stream().collect(Collectors.toMap(Function.identity(), f -&gt; (String) metaObject.getValue(f))); final ArrayList&lt;String&gt; values = new ArrayList&lt;&gt;(fieldValueMap.values()); Map&lt;String, String&gt; decryptValues = cipherSpi.decrypt(values); fieldValueMap.entrySet() .stream() .map(e -&gt; Tuple2.of(e.getKey(), decryptValues.getOrDefault(e.getValue(), \"\"))) .forEach(e -&gt; metaObject.setValue(e.getT1(), e.getT2())); } } return results; } private &lt;T&gt; List&lt;List&lt;T&gt;&gt; partition(List&lt;T&gt; list, int batchCount) { if (!(batchCount &gt; 0)) { throw new IllegalArgumentException(\"batch count must greater than zero\"); } List&lt;List&lt;T&gt;&gt; partitionList = new ArrayList&lt;&gt;(list.size() / (batchCount + 1)); for (int i = 0; i &lt; list.size(); i += batchCount) { partitionList.add(list.stream().skip(i).limit(batchCount).collect(Collectors.toList())); } return partitionList; } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }}@Getterclass Tuple2&lt;T1, T2&gt; { private final T1 t1; private final T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); }}","link":"/blog-posts/Mybatis ResultSetHandler_2019-01-09.html"},{"title":"[ç‰‡æ®µ] Mybatis ResultSetHandler å®è·µ-ç»­","text":"è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µã€‚ ä¸Šæ¬¡çš„å±€é™æ˜¯åªèƒ½æ‰¹é‡è§£å¯†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰åŠ å¯†å­—æ®µï¼Œå¯¹æ‰¹é‡æ•°æ®æ¥è¯´ç¨æ˜¾ä¸è¶³ï¼Œè¿™ä¸ªä¸»è¦æ”¹è¿›äº†è¿™ä¸€ç‚¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Overridepublic List&lt;Object&gt; handleResultSets(Statement stmt) throws SQLException { ErrorContext.instance().activity(\"handling results\").object(mappedStatement.getId()); final List&lt;Object&gt; multipleResults = new ArrayList&lt;Object&gt;(); int resultSetCount = 0; ResultSetWrapper rsw = getFirstResultSet(stmt); List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps(); int resultMapCount = resultMaps.size(); validateResultMapsCount(rsw, resultMapCount); while (rsw != null &amp;&amp; resultMapCount &gt; resultSetCount) { ResultMap resultMap = resultMaps.get(resultSetCount); handleResultSet(rsw, resultMap, multipleResults, null); rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } String[] resultSets = mappedStatement.getResultSets(); if (resultSets != null) { while (rsw != null &amp;&amp; resultSetCount &lt; resultSets.length) { ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]); if (parentMapping != null) { String nestedResultMapId = parentMapping.getNestedResultMapId(); ResultMap resultMap = configuration.getResultMap(nestedResultMapId); handleResultSet(rsw, resultMap, null, parentMapping); } rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } } return collapseSingleResultList(multipleResults);} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130package app.pooi.common.encrypt;import app.pooi.common.encrypt.anno.CipherSpi;import app.pooi.common.encrypt.anno.Encrypted;import lombok.Getter;import org.apache.ibatis.executor.resultset.ResultSetHandler;import org.apache.ibatis.plugin.*;import org.apache.ibatis.reflection.MetaObject;import org.apache.ibatis.reflection.SystemMetaObject;import java.lang.reflect.Field;import java.sql.Statement;import java.util.*;import java.util.function.Function;import java.util.logging.Logger;import java.util.stream.Collectors;@Intercepts({ @Signature(type = ResultSetHandler.class, method = \"handleResultSets\", args = {Statement.class}),})public class DecryptInterceptor implements Interceptor { private static final Logger logger = Logger.getLogger(DecryptInterceptor.class.getName()); private CipherSpi cipherSpi; public DecryptInterceptor(CipherSpi cipherSpi) { this.cipherSpi = cipherSpi; } @Override public Object intercept(Invocation invocation) throws Throwable { final Object proceed = invocation.proceed(); if (proceed == null) { return proceed; } List&lt;?&gt; results = (List&lt;?&gt;) proceed; if (results.isEmpty()) { return proceed; } final Object first = results.iterator().next(); final Class&lt;?&gt; modelClazz = first.getClass(); final List&lt;String&gt; decryptFields = getDecryptFields(modelClazz); if (decryptFields.isEmpty()) { return proceed; } final List&lt;List&lt;String&gt;&gt; secret = Flux.fromIterable(results) .map(SystemMetaObject::forObject) .flatMapIterable(mo -&gt; decryptFields.stream().map(mo::getValue).collect(Collectors.toList())) .cast(String.class) .buffer(1000) .collectList() .block(); final Map&lt;String, String&gt; secretMap = secret.stream() .map(secrets -&gt; { try { return cipherSpi.batchDecrypt(secrets); } catch (Exception e) { e.printStackTrace(); return Maps.&lt;String, String&gt;newHashMap(); } }).reduce(Maps.newHashMap(), (m1, m2) -&gt; { m1.putAll(m2); return m1; }); secretMap.put(\"\", \"0\"); for (Object r : results) { final MetaObject metaObject = SystemMetaObject.forObject(r); decryptFields.forEach(f -&gt; metaObject.setValue(f, secretMap.get(metaObject.getValue(f)))); } return results; } @NotNull private List&lt;String&gt; getDecryptFields(Class&lt;?&gt; modelClazz) { return Arrays.stream(modelClazz.getDeclaredFields()) .filter(f -&gt; f.getAnnotation(Decrypted.class) != null) .filter(f -&gt; { boolean isString = f.getType() == String.class; if (!isString) { logger.warning(f.getName() + \"is not String, actual type is \" + f.getType().getSimpleName() + \" ignored\"); } return isString; }) .map(Field::getName) .collect(Collectors.toList()); } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }}@Getterclass Tuple2&lt;T1, T2&gt; { private final T1 t1; private final T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); }}","link":"/blog-posts/Mybatis ResultSetHandler_2019-04-04 ç»­.html"},{"title":"[ç‰‡æ®µ] Javaæ”¶é›†æ–¹æ³•å‚æ•°+Spring DataBinder","text":"æ”¶é›†å‚æ•°ç›®å‰æ˜¯ä½¿ç”¨äº†spring aop æ¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼ŒæŠŠæ–¹æ³•å‚æ•°åŒ…è£…æˆMapå½¢å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CollectArguments {}@Aspectpublic class ArgumentsCollector { private static final ThreadLocal&lt;Map&lt;String, Object&gt;&gt; ARGUMENTS = ThreadLocal.withInitial(ImmutableMap::of); static Map&lt;String, Object&gt; getArgs() { return ARGUMENTS.get(); } private Object[] args(Object[] args, int exceptLength) { if (exceptLength == args.length) { return args; } return Arrays.copyOf(args, exceptLength); } @Pointcut(\"@annotation(CollectArguments)\") void collectArgumentsAnnotationPointCut() { } @Before(\"collectArgumentsAnnotationPointCut()\") public void doAccessCheck(JoinPoint joinPoint) { final String[] parameterNames = ((MethodSignature) joinPoint.getSignature()).getParameterNames(); final Object[] args = args(joinPoint.getArgs(), parameterNames.length); ARGUMENTS.set(Collections.unmodifiableMap((IntStream.range(0, parameterNames.length - 1) .mapToObj(idx -&gt; Tuple2.of(parameterNames[idx], args[idx])) .collect(HashMap::new, (m, t) -&gt; m.put(t.getT1(), t.getT2()), HashMap::putAll)))); } @After(\"collectArgumentsAnnotationPointCut()\") public void remove() { ARGUMENTS.remove(); } @Data private static class Tuple2&lt;T1, T2&gt; { private T1 t1; private T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } public static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); } }} é€šè¿‡Mapæ„é€ å¯¹è±¡123456789101112public class BinderUtil { BinderUtil() { } @SuppressWarnings(\"unchecked\") public static &lt;T&gt; T getTarget(Class&lt;T&gt; beanClazz) { final DataBinder binder = new DataBinder(BeanUtils.instantiate(beanClazz)); binder.bind(new MutablePropertyValues(ArgumentsCollector.getArgs())); return (T) binder.getTarget(); }}","link":"/blog-posts/Spring_aop_argument_collector_2019-01-22.html"},{"title":"resilience4j-retryæºç é˜…è¯»","text":"resilience4j æºç è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ç®€å•çš„ï¼Œæ¯”è¾ƒé€‚åˆé˜…è¯»ã€‚ æ”¾ä¸€å¼ ä¸»è¦ç±»çš„ç»“æ„å›¾ï¼š Retryå…¥å£Retryæ¥å£æ˜¯æä¾›é‡è¯•åŠŸèƒ½çš„å…¥å£ï¼Œä¸»è¦æä¾›äº†æ–¹æ³•æ¨¡ç‰ˆï¼Œå…·ä½“æ ¡éªŒç»“æ„ï¼Œå¤±è´¥åå¤„ç†ç”±Contextå­ç±»å®ç°ã€‚ 1234567891011121314151617181920212223/** * Creates a retryable supplier. * * @param retry the retry context * @param supplier the original function * @param &lt;T&gt; the type of results supplied by this supplier * @return a retryable function */static &lt;T&gt; Supplier&lt;T&gt; decorateSupplier(Retry retry, Supplier&lt;T&gt; supplier) { return () -&gt; { Retry.Context&lt;T&gt; context = retry.context(); do try { T result = supplier.get(); final boolean validationOfResult = context.onResult(result); if (!validationOfResult) { context.onSuccess(); return result; } } catch (RuntimeException runtimeException) { context.onRuntimeError(runtimeException); } while (true); };} è¿™é‡Œæ‘˜æŠ„äº†ä¸€æ®µæ ¸å¿ƒä»£ç ï¼Œä½œç”¨æ˜¯å¾ªç¯ç›´åˆ°context.onResult(result)è¿”å›trueä¸ºæ­¢ï¼Œéœ€è¦ç•™æ„context.onResult/onRuntimeError/onErrorå¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œ onSuccessåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™é‡Œæ¯æ¬¡è¿›å…¥é‡è¯•éƒ½æ˜¯ä¸€ä¸ªæ–°çš„contextå¯¹è±¡ã€‚ Retry.ContextImpl1234567891011121314151617181920212223public boolean onResult(T result) { if (null != resultPredicate &amp;&amp; resultPredicate.test(result)) { int currentNumOfAttempts = numOfAttempts.incrementAndGet(); if (currentNumOfAttempts &gt;= maxAttempts) { return false; } else { waitIntervalAfterFailure(currentNumOfAttempts, null); return true; } } return false;}public void onRuntimeError(RuntimeException runtimeException) { if (exceptionPredicate.test(runtimeException)) { lastRuntimeException.set(runtimeException); throwOrSleepAfterRuntimeException(); } else { failedWithoutRetryCounter.increment(); publishRetryEvent(() -&gt; new RetryOnIgnoredErrorEvent(getName(), runtimeException)); throw runtimeException; }} å…ˆå…³æ³¨onResultï¼Œå®ƒè´Ÿè´£åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­é‡è¯•ï¼Œå¦‚æœé€šè¿‡æ ¡éªŒæˆ–è€…é‡è¯•è¶…è¿‡æ­¤æ•°ï¼Œä¼šåœæ­¢é‡è¯•ã€‚ onRuntimeError/onError, è´Ÿè´£æŠŠcatchçš„å¼‚å¸¸å­˜å‚¨åœ¨lastRuntimeExceptionä¸­ã€‚ 12345678910public void onSuccess() { int currentNumOfAttempts = numOfAttempts.get(); if (currentNumOfAttempts &gt; 0) { succeededAfterRetryCounter.increment(); Throwable throwable = Option.of(lastException.get()).getOrElse(lastRuntimeException.get()); publishRetryEvent(() -&gt; new RetryOnSuccessEvent(getName(), currentNumOfAttempts, throwable)); } else { succeededWithoutRetryCounter.increment(); }} onSuccessè´Ÿè´£ç»Ÿè®¡å’Œå‘é€äº‹ä»¶ã€‚ æ€»ç»“æ€»ä½“æ¥è¯´retryæ¯”è¾ƒç®€å•ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹æœ‰ä¸€ä¸ªå¦‚æœè®¾ç½®äº†ç»“æœæ ¡éªŒï¼Œå¦‚æœä¸€ç›´æ ¡éªŒä¸é€šè¿‡ï¼Œå°†è¿”å›æœªé€šè¿‡çš„ç»“æœï¼Œè€Œä¸æ˜¯è¿”å›å¤±è´¥ã€‚","link":"/blog-posts/resilience4j-retryæºç é˜…è¯».html"},{"title":"[ç‰‡æ®µ] SpringBoot Mybatisé…ç½®","text":"çº¯è®°å½•ï¼Œä¾›è‡ªå·±å‚è€ƒğŸ¤£ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140private final MybatisProperties properties;private final Interceptor[] interceptors;private final ResourceLoader resourceLoader;private final DatabaseIdProvider databaseIdProvider;private final List&lt;ConfigurationCustomizer&gt; configurationCustomizers;public DataSourceConfig(MybatisProperties properties, ObjectProvider&lt;Interceptor[]&gt; interceptorsProvider, ResourceLoader resourceLoader, ObjectProvider&lt;DatabaseIdProvider&gt; databaseIdProvider, ObjectProvider&lt;List&lt;ConfigurationCustomizer&gt;&gt; configurationCustomizersProvider) { this.properties = properties; this.interceptors = interceptorsProvider.getIfAvailable(); this.resourceLoader = resourceLoader; this.databaseIdProvider = databaseIdProvider.getIfAvailable(); this.configurationCustomizers = configurationCustomizersProvider.getIfAvailable();}/** * æ™®é€šæ•°æ®æº * ä¸»æ•°æ®æºï¼Œå¿…é¡»é…ç½®ï¼Œspringå¯åŠ¨æ—¶ä¼šæ‰§è¡Œåˆå§‹åŒ–æ•°æ®æ“ä½œï¼ˆæ— è®ºæ˜¯å¦çœŸçš„éœ€è¦ï¼‰ï¼Œé€‰æ‹©æŸ¥æ‰¾DataSource classç±»å‹çš„æ•°æ®æº * * @return {@link DataSource} */@Primary@Bean(name = BEANNAME_DATASOURCE_COMMON)@ConfigurationProperties(prefix = \"com.lianjia.confucius.bridge.boot.datasource.common\")public DataSource createDataSourceCommon() { return DataSourceBuilder.create().build();}/** * åªè¯»æ•°æ®æº * * @return {@link DataSource} */@Bean(name = BEANNAME_DATASOURCE_READONLY)@ConfigurationProperties(prefix = \"com.lianjia.confucius.bridge.boot.datasource.readonly\")public DataSource createDataSourceReadonly() { return DataSourceBuilder.create().build();}private SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception { SqlSessionFactoryBean factory = new SqlSessionFactoryBean(); factory.setDataSource(dataSource); factory.setVfs(SpringBootVFS.class); if (StringUtils.hasText(this.properties.getConfigLocation())) { factory.setConfigLocation(this.resourceLoader.getResource(this.properties.getConfigLocation())); } org.apache.ibatis.session.Configuration configuration = this.properties.getConfiguration(); if (configuration == null &amp;&amp; !StringUtils.hasText(this.properties.getConfigLocation())) { configuration = new org.apache.ibatis.session.Configuration(); } if (configuration != null &amp;&amp; !CollectionUtils.isEmpty(this.configurationCustomizers)) { for (ConfigurationCustomizer customizer : this.configurationCustomizers) { customizer.customize(configuration); } } factory.setConfiguration(configuration); if (this.properties.getConfigurationProperties() != null) { factory.setConfigurationProperties(this.properties.getConfigurationProperties()); } if (!ObjectUtils.isEmpty(this.interceptors)) { factory.setPlugins(this.interceptors); } if (this.databaseIdProvider != null) { factory.setDatabaseIdProvider(this.databaseIdProvider); } if (StringUtils.hasLength(this.properties.getTypeAliasesPackage())) { factory.setTypeAliasesPackage(this.properties.getTypeAliasesPackage()); } if (StringUtils.hasLength(this.properties.getTypeHandlersPackage())) { factory.setTypeHandlersPackage(this.properties.getTypeHandlersPackage()); } if (!ObjectUtils.isEmpty(this.properties.resolveMapperLocations())) { factory.setMapperLocations(this.properties.resolveMapperLocations()); } return factory.getObject();}public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory) { ExecutorType executorType = this.properties.getExecutorType(); if (executorType != null) { return new SqlSessionTemplate(sqlSessionFactory, executorType); } else { return new SqlSessionTemplate(sqlSessionFactory); }}@Bean@Primarypublic SqlSessionFactory primarySqlSessionFactory() throws Exception { return this.sqlSessionFactory(this.createDataSourceCommon());}@Beanpublic SqlSessionFactory secondarySqlSessionFactory() throws Exception { return this.sqlSessionFactory(this.createDataSourceReadonly());}/** * å®ä¾‹æ™®é€šçš„ sqlSession * * @return SqlSession * @throws Exception when any exception occured */@Bean(name = BEANNAME_SQLSESSION_COMMON)public SqlSession initSqlSessionCommon() throws Exception { return this.sqlSessionTemplate(this.primarySqlSessionFactory());}/** * å®ä¾‹åªè¯»çš„ sqlSession * * @return SqlSession * @throws Exception when any exception occured */@Bean(name = BEANNAME_SQLSESSION_READONLY)public SqlSession initSqlSessionReadonly() throws Exception { return this.sqlSessionTemplate(this.secondarySqlSessionFactory());}@MapperScan(annotationClass = PrimaryMapper.class, sqlSessionTemplateRef = BEANNAME_SQLSESSION_COMMON, basePackageClasses = ITalentApplicationSpringBootStart.class)static class PrimaryMapperConfiguration {}@MapperScan(annotationClass = SecondaryMapper.class, sqlSessionTemplateRef = BEANNAME_SQLSESSION_READONLY, basePackageClasses = ITalentApplicationSpringBootStart.class)static class SecondaryMapperConfiguration {}","link":"/blog-posts/ã€ç‰‡æ®µã€‘SpringBoot Mybatisé…ç½®.html"},{"title":"[ç‰‡æ®µ] @CreatedBy / @ModifiedBy æ‹¦æˆªå™¨å®ç°","text":"æ‹¦æˆªå™¨å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package app.pooi.common.entity;import app.pooi.common.entity.anno.CreatedBy;import app.pooi.common.entity.anno.ModifiedBy;import lombok.Data;import org.apache.ibatis.executor.Executor;import org.apache.ibatis.mapping.MappedStatement;import org.apache.ibatis.plugin.Intercepts;import org.apache.ibatis.plugin.Invocation;import org.apache.ibatis.plugin.Plugin;import org.apache.ibatis.plugin.Signature;import java.util.Arrays;import java.util.Properties;import java.util.function.Supplier;@Data@Intercepts({ @Signature(type = Executor.class, method = \"update\", args = {MappedStatement.class, Object.class}),})public class EntityInterceptor implements org.apache.ibatis.plugin.Interceptor { private Supplier&lt;Long&gt; auditorAware; @Override public Object intercept(Invocation invocation) throws Throwable { Executor executor = (Executor) invocation.getTarget(); MappedStatement ms = (MappedStatement) invocation.getArgs()[0]; Object o = invocation.getArgs()[1]; Arrays.stream(o.getClass().getDeclaredFields()) .forEach(field -&gt; { final CreatedBy createdBy = field.getAnnotation(CreatedBy.class); final ModifiedBy modifiedBy = field.getAnnotation(ModifiedBy.class); if (createdBy != null || modifiedBy != null) { field.setAccessible(true); try { field.set(o, auditorAware.get()); } catch (IllegalAccessException ignore) { } } }); return invocation.proceed(); } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }} é…ç½®ï¼š 1234567891011121314@Configurationstatic class MybatisInterceptorConfig { @Bean public Interceptor[] configurationCustomizer(CipherSpi cipherSpi) { final EntityInterceptor entityInterceptor = new EntityInterceptor(); entityInterceptor.setAuditorAware(() -&gt; { final String header = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getHeader(XHeaders.LOGIN_USER_ID); return Long.valueOf(header); }); return new Interceptor[]{new DecryptInterceptor(cipherSpi), entityInterceptor}; }}","link":"/blog-posts/ã€ç‰‡æ®µã€‘@CreatedBy  @ModifiedBy.html"},{"title":"[æ„Ÿæ‚Ÿ] 2018æˆ‘çš„æ‰€è§æ‰€é—»æ‰€æ„Ÿ","text":"1. æˆ‘å°±å–œæ¬¢å†™ä»£ç è¡Œä¸è¡Œï¼Ÿå¦‚æœåˆšåˆšæŠ•å…¥å·¥ä½œï¼Œå·¥ä½œè¿˜æ— æ³•å®Œå…¨èƒœä»»ï¼Œé‚£æˆ‘çš„å»ºè®®æ˜¯å¤šå†™å†™ä»£ç ï¼Œæ‰“æ€ªå‡çº§å®Œæˆè‡ªå·±çš„å¹´åº¦ç»©æ•ˆã€‚ å¦‚æœå·²ç»èƒ½å¤Ÿèƒœä»»å½“å‰å·¥ä½œï¼Œä¸‹ä¸€æ­¥åº”è¯¥é›†ä¸­åœ¨ææ•ˆä¸Šã€‚è¿™ä¸€æ­¥å’Œä¹‹å‰è‡ªå·±ç§¯ç´¯çš„ç»éªŒå’ŒçŸ¥è¯†å¯†ä¸å¯åˆ†ï¼Œåªæœ‰çœŸæ­£äº†è§£ä»£ç æ‡‚ä»£ç ï¼Œæ‰èƒ½ä»åŒé¾„äººä¸­çš„â€œç†Ÿç»ƒå·¥â€è„±é¢–è€Œå‡ºï¼Œä¸¤è€…çš„ææ•ˆè™½ç„¶ç»“æœä¸€æ ·ï¼Œä½†æ˜¯æœ¬è´¨å´å®Œå…¨ä¸ä¸€æ ·ã€‚ å¦‚æœå·²ç»æ‘†è„±äº†ç†Ÿç»ƒå·¥çš„ç§°å·ï¼Œå®é™…ä¸Šå·²ç»å®Œæˆäº†è‡ªæˆ‘ææ•ˆï¼Œæå‰å®Œæˆè‡ªå·±çš„æœ¬èŒä»»åŠ¡ï¼Œä¸‹ä¸€æ­¥å¯ä»¥è®¡åˆ’æ¨åŠ¨å›¢é˜Ÿçš„æ•ˆç‡ã€‚ å¦‚æœå¤ªè¿‡ä¸“æ³¨æŠ€æœ¯ï¼Œä¸“å¿ƒè‡ªå·±çš„ä¸€äº©ä¸‰åˆ†ç”°ï¼Œç›¸å½“äºç»™è‡ªå·±è®¾é™æˆæ¯•ä¸šä¸¤ä¸‰å¹´çš„æ°´å¹³ã€‚è¿™ç§äººåº”è¯¥è¢«æ‰“ä¸Šä¸èƒœä»»çš„æ ‡ç­¾ï¼Œåœ¨å¯’å†¬ä¸­å¾ˆå®¹æ˜“è¢«ä¼˜åŒ–æ‰ã€‚ä¸“æ³¨æŠ€æœ¯è¿˜æœ‰ä¸€ä¸ªè¯¯åŒºï¼Œå°±æ˜¯å®¹æ˜“æŠŠâ€œå®æ–½ç»†èŠ‚â€å’Œâ€œæŠ€æœ¯â€ä¸¤è€…æ··æ·†ï¼Œç‰¹åˆ«åœ¨è½¯ä»¶è¡Œä¸šâ€œå®æ–½ç»†èŠ‚â€å¾ˆå®¹æ˜“éšæ—¶ä»£æ”¹å˜ï¼ŒåŸºæœ¬ä¸‰å¹´å°±ä¼šå¤§å˜æ ·ï¼Œè€Œâ€œæŠ€æœ¯â€ç±»ä¼¼äºâ€œçŸ¥è¯†â€ä¸ä¼šè¿‡æ—¶ã€‚çœ‹åˆ°è¿™é‡Œå¤§å®¶å¯ä»¥è‡ªå·±æ€è€ƒä¸‹ï¼Œè‡ªå·±å­¦åˆ°çš„åˆ°åº•æ˜¯â€œå®æ–½ç»†èŠ‚â€è¿˜æ˜¯çœŸæ­£çš„â€œæŠ€æœ¯â€ã€‚ 2.å¦‚ä½•æ¨åŠ¨å›¢é˜Ÿè¿›æ­¥æ­å–œä½ è·¨è¿‡äº†ç¬¬ä¸€é“åï¼Œæ¨åŠ¨å›¢é˜Ÿè¿›æ­¥ä¸æ˜¯ä¸€ä¸ªäººçš„äº‹ï¼Œä¸€èˆ¬æ¨åŠ¨å›¢é˜Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸ªäººå½±å“å›¢é˜Ÿï¼Œå›¢é˜Ÿè‡ªæˆ‘é©±åŠ¨ã€‚ ä¸ªäººå½±å“å›¢é˜Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠè‡ªæˆ‘ææ•ˆæ‰€ç§¯ç´¯çš„ç»éªŒå’ŒçŸ¥è¯†å…±äº«ç»™æ•´ä¸ªå›¢é˜Ÿï¼Œå®Œæˆçš„æ‰‹æ®µå¯ä»¥æ˜¯åšå®¢åˆ†äº«ï¼Œä¼šè®®åˆ†äº«ï¼Œæ–‡æ¡£åˆ†äº«ã€‚ å›¢é˜Ÿè‡ªæˆ‘é©±åŠ¨ï¼Œå®é™…ä¸Šæˆ‘æŠŠæ•´ä¸ªå›¢é˜Ÿæ‹Ÿä½œäº†ä¸€ä¸ªäººï¼Œä¸€ä¸ªäººæ‰¾å‡ºåˆ«äººçš„ç¼ºç‚¹å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æ‰¾å‡ºä¸€ä¸ªå›¢é˜Ÿçš„é—®é¢˜å´æ²¡é‚£ä¹ˆå®¹æ˜“ï¼ŒåŒæ—¶ä¹Ÿä¼šå—åˆ°å…¬å¸å’Œé¢†å¯¼çš„å±€é™ï¼Œæ¯”å¦‚ä¸€äº›é¡¹ç›®ç®¡ç†çš„é¢†å¯¼å°±æ˜¯äºŒä¼ æ‰‹ï¼Œåªå‚¬ä½ è¿›åº¦çš„é‚£ç§ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½ ä¸»åŠ¨æ‰¾ä»–è®¨è®ºã€‚ å¦‚ä½•æ‰¾åˆ°å›¢é˜Ÿçš„ç¼ºç‚¹ï¼Ÿå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå¤§ç±»çš„å¥—è·¯ï¼šç®¡ç†æ‰‹æ®µå’ŒæŠ€æœ¯æ‰‹æ®µã€‚ ç®¡ç†æ‰‹æ®µå¯ä»¥ä»çŸ¥è¯†ç®¡ç†ã€ä»£ç è§„èŒƒã€éœ€æ±‚åˆ†æä¸‰å¤„ç€æ‰‹ï¼š çŸ¥è¯†ç®¡ç†ï¼š å»ºç«‹çŸ¥è¯†åº“ï¼Œé¿å…é‡å¤çš„åŸ¹è®­ï¼Œé‡å¤çš„è§£ç­”é—®é¢˜ ä»£ç è§„èŒƒï¼šå€ŸåŠ©ä»£ç ç¼ºé™·æ£€æŸ¥å·¥å…·ï¼Œå…·ä½“åˆ°è´Ÿè´£äººæå‡ä»£ç è§„èŒƒ éœ€æ±‚åˆ†æï¼šé¿å…ä½æ•ˆï¼Œæ— æ•ˆä¼šè®®ï¼Œé¿å…å„ç§å¦¥åä¸‹äº§ç”Ÿçš„éœ€æ±‚ æŠ€æœ¯æ‰‹æ®µæ¯”è¾ƒç®€å•ï¼š é‡æ„å‡çº§ï¼šå¼ƒç”¨è€çš„æ¶æ„ï¼Œæ‹¥æŠ±æ–°æŠ€æœ¯ï¼Œå¸¦é¢†å›¢é˜Ÿæå‡æŠ€æœ¯ å†…éƒ¨é€ è½®å­ï¼šå†…éƒ¨å®šåˆ¶å·¥å…·ï¼Œå¸®åŠ©å›¢é˜Ÿé«˜æ•ˆå®Œæˆä»»åŠ¡ æ‰¾åˆ°äº†å›¢é˜Ÿçš„ç¼ºç‚¹æ¥ä¸‹æ¥å¯ä»¥åˆ¶å®šåº¦é‡ï¼Œè¡¡é‡å›¢é˜Ÿçš„æ¨è¿›ç¨‹åº¦ï¼Œå¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œåº¦é‡ï¼š è·Ÿè‡ªå·±æ¯”è¾ƒï¼šæ¯”å¦‚è¿™æ¬¡åšéœ€æ±‚ææµ‹bugæ•°å‡å°‘ï¼Œéœ€æ±‚delayå°‘äº†ï¼Œæ»¡è¶³éœ€æ±‚ä¸éœ€è¦ä¸Šçº¿åªè¦é…ç½®ä¸Šçº¿ï¼Œç­‰ç­‰ å’Œåˆ«çš„å›¢é˜Ÿæ¯”è¾ƒï¼šè¿™ä¸ªæ¯”è¾ƒå‡¶æ®‹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ç”¨ä»€ä¹ˆåº¦é‡æ¯”ï¼Œä½†æ˜¯æœ‰çš„å¤§å…¬å¸å°±æ˜¯è¿™æ ·åšçš„ã€‚ 3.æ€»ç»“ä¸æ™‹å‡ä»å‘ç°ç¼ºç‚¹åˆ°æœ€åå¾—åˆ°æˆæœå®Œæˆå›¢é˜Ÿæ¨è¿›ç›®æ ‡ï¼Œæ˜¯æ—¶å€™å†™ä¸ªpptåœ¨é¢†å¯¼é¢å‰å¹ä¸€æ³¢äº†ï¼Œè¿™ä¸ªå°±ä¸ç”¨æˆ‘æ•™äº†ã€‚","link":"/blog-posts/ã€å½’æ¡£ã€‘2018æˆ‘çš„æ‰€è§æ‰€é—»æ‰€æ„Ÿ.html"},{"title":"AbstractQueuedSynchronizerè§£æ","text":"AbstractQueuedSynchronizer æ•°æ®ç»“æ„123456789101112131415161718 /** * Head of the wait queue , lazily initialized . Except for * initialization , it is modified only via method setHead . Note : * If head exists , its waitStatus is guaranteed not to be * CANCELLED . */ private transient volatile Node head; /** * Tail of the wait queue , lazily initialized . Modified only via * method enq to add new wait node . */ private transient volatile Node tail; /** * The synchronization state . */ private volatile int state; ç¨å¾®æ³¨æ„ä¸‹åœ¨çº¿ç¨‹äº‰ç”¨é”æ˜¯æ‰ä¼šåˆå§‹åŒ–é“¾è¡¨ AbstractQueuedSynchronizer.Node æ•°æ®ç»“æ„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * Status field , taking on only the values : * SIGNAL : The successor of this node is ( or will soon be ) * blocked ( via park ), so the current node must * unpark its successor when it releases or * cancels . To avoid races , acquire methods must * first indicate they need a signal , * then retry the atomic acquire , and then , * on failure , block . * CANCELLED : This node is cancelled due to timeout or interrupt . * Nodes never leave this state . In particular , * a thread with cancelled node never again blocks . * CONDITION : This node is currently on a condition queue . * It will not be used as a sync queue node * until transferred , at which time the status * will be set to 0. ( Use of this value here has * nothing to do with the other uses of the * field , but simplifies mechanics .) * PROPAGATE : A releaseShared should be propagated to other * nodes . This is set ( for head node only ) in * doReleaseShared to ensure propagation * continues , even if other operations have * since intervened . * 0: None of the above * * The values are arranged numerically to simplify use . * Non - negative values mean that a node doesn ' t need to * signal . So , most code doesn ' t need to check for particular * values , just for sign . * * The field is initialized to 0 for normal sync nodes , and * CONDITION for condition nodes . It is modified using CAS * ( or when possible , unconditional volatile writes ). */ volatile int waitStatus; /** * Link to predecessor node that current node / thread relies on * for checking waitStatus . Assigned during enqueuing , and nulled * out ( for sake of GC ) only upon dequeuing . Also , upon * cancellation of a predecessor , we short - circuit while * finding a non - cancelled one , which will always exist * because the head node is never cancelled : A node becomes * head only as a result of successful acquire . A * cancelled thread never succeeds in acquiring , and a thread only * cancels itself , not any other node . */ volatile Node prev; /** * Link to the successor node that the current node / thread * unparks upon release . Assigned during enqueuing , adjusted * when bypassing cancelled predecessors , and nulled out ( for * sake of GC ) when dequeued . The enq operation does not * assign next field of a predecessor until after attachment , * so seeing a null next field does not necessarily mean that * node is at end of queue . However , if a next field appears * to be null , we can scan prev ' s from the tail to * double - check . The next field of cancelled nodes is set to * point to the node itself instead of null , to make life * easier for isOnSyncQueue . */ volatile Node next; /** * The thread that enqueued this node . Initialized on * construction and nulled out after use . */ volatile Thread thread; /** * Link to next node waiting on condition , or the special * value SHARED . Because condition queues are accessed only * when holding in exclusive mode , we just need a simple * linked queue to hold nodes while they are waiting on * conditions . They are then transferred to the queue to * re - acquire . And because conditions can only be exclusive , * we save a field by using special value to indicate shared * mode . */ Node nextWaiter; AbstractQueuedSynchronizer** çš„æ•°æ®ç»“æ„ï¼ˆç›—ç”¨çš„å›¾ï¼‰ AbstractQueuedSynchronizer åšäº†ä»€ä¹ˆ ?å†…éƒ¨ç»´æŠ¤stateå’ŒCLHé˜Ÿåˆ—ï¼Œè´Ÿè´£åœ¨èµ„æºäº‰ç”¨æ—¶çº¿ç¨‹å…¥é˜Ÿï¼Œèµ„æºé‡Šæ”¾æ—¶å”¤é†’é˜Ÿåˆ—ä¸­çº¿ç¨‹ã€‚ è€Œå®ç°ç±»åªéœ€è¦å®ç° ä»€ä¹ˆæ¡ä»¶è·å–èµ„æºæˆåŠŸ å’Œ ä»€ä¹ˆæ¡ä»¶é‡Šæ”¾èµ„æº æˆåŠŸå°±å¯ä»¥äº† æ‰€ä»¥ï¼Œæœ€ç®€å•çš„CountDownLatchä½¿ç”¨AbstractQueuedSynchronizerå®ç°éå¸¸ç®€å•ï¼š ç”³æ˜AbstractQueuedSynchronizerçš„stateæ•°é‡ï¼ˆæ¯”å¦‚åä¸ªï¼‰ awaitæ–¹æ³•å°è¯•è·å–èµ„æºï¼Œå¦‚æœstate&gt;0è¡¨ç¤ºè·å–å¤±è´¥ï¼ˆ ä»€ä¹ˆæ¡ä»¶è·å–èµ„æºæˆåŠŸ ï¼ŒCountDownLatchå®ç°ï¼‰ï¼Œè·å–å¤±è´¥çº¿ç¨‹ä¼‘çœ ï¼ˆAbstractQueuedSynchronizerè´Ÿè´£ï¼‰ countDownæ–¹æ³•state-1ï¼Œå¦‚æœstate==0è¡¨ç¤ºèµ„æºé‡Šæ”¾æˆåŠŸ( ä»€ä¹ˆæ¡ä»¶é‡Šæ”¾èµ„æºæˆåŠŸ ï¼ŒCountDownLatchå®ç°)ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­æ‰€æœ‰çº¿ç¨‹ï¼ˆAbstractQueuedSynchronizerè´Ÿè´£ï¼‰ AbstractQueuedSynchronizer æ€ä¹ˆåšçš„?é¡ºç€ReentrantLock lockã€unlockçœ‹ä¸€éæˆ‘ä»¬å°±å¤§è‡´æ€»ç»“å‡ºAbstractQueuedSynchronizerå·¥ä½œåŸç†äº† å…ˆç®€å•ä»‹ç»ä¸‹ReentrantLockç‰¹æ€§ï¼šå¯é‡å…¥ï¼Œä¸­æ–­ï¼Œæœ‰è¶…æ—¶æœºåˆ¶ã€‚ ReentrantLock lock() æµç¨‹ ( å†ç›—å›¾ ) é»„è‰²è¡¨ç¤ºReentrantLockå®ç°ï¼Œç»¿è‰²è¡¨ç¤ºAbstractQueuedSynchronizerå†…éƒ¨å®ç° lockæ–¹æ³•å…¥å£ ç›´æ¥è°ƒç”¨ AbstractQueuedSynchronizer.acquireæ–¹æ³• tryAcquire addWaiter acquireQueued AbstractQueuedSynchronizer.acquire12345**public** final void acquire ( int arg) { **if** (! tryAcquire (arg) &amp;&amp; acquireQueued ( addWaiter ( Node . EXCLUSIVE ), arg)) selfInterrupt (); } è·å–çš„é”çš„é€»è¾‘ï¼šç›´æ¥è·å–æˆåŠŸåˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰è·å–æˆåŠŸå…¥é˜Ÿä¼‘çœ ï¼ˆå¯¹å°±æ˜¯è¿™ä¹ˆç®€å•ï¼‰ ä¸‹é¢æˆ‘ä»¬ä»”ç»†ä¸€ä¸ªä¸€ä¸ªæ–¹æ³•çœ‹ ReentrantLock.tryAcquireæˆ‘è¿™é‡Œè´´çš„æ—¶éå…¬å¹³çš„æ‰€è·å–ï¼Œå…¬å¹³å’Œä¸å…¬å¹³çš„åŒºåˆ«åœ¨äºå…¬å¹³é”è€è€å®å®çš„ä¼šè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œéå…¬å¹³é”ä¼šå…ˆæ£€æŸ¥èµ„æºæ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨ä¸ç®¡é˜Ÿåˆ—ä¸­çš„æƒ…å†µç›´æ¥å°è¯•è·å–é”ã€‚ 123456789101112131415161718final boolean nonfairTryAcquire ( int acquires) { final Thread current = Thread . currentThread (); int c = getState (); if (c == 0 ) { if ( compareAndSetState ( 0 , acquires)) { setExclusiveOwnerThread (current); return true ; } } else if (current == getExclusiveOwnerThread ()) { int nextc = c + acquires; if (nextc &lt; 0 ) // overflow throw new Error ( \"Maximum lock count exceeded\" ); setState (nextc); return true ; } return false ; } ReentrantLock.tryAcquireè¯»å–åˆ°state==0æ—¶å°è¯•å ç”¨é”ï¼Œå¹¶ä¿è¯åŒä¸€çº¿ç¨‹å¯ä»¥é‡å¤å ç”¨ã€‚å…¶ä»–æƒ…å†µä¸‹è·å–èµ„æºå¤±è´¥ã€‚å¦‚æœè·å–æˆåŠŸå°±æ²¡å•¥äº‹äº†ï¼Œä¸è¿‡å…³é”®ä¸å°±æ˜¯é”äº‰ç”¨çš„æ—¶å€™æ˜¯å¦‚ä½•å¤„ç†çš„å—ï¼Ÿ AbstractQueuedSynchronizer.addWaiter(Node.EXCLUSIVE)12345678910111213141516private Node addWaiter ( Node mode) { Node node = new Node (mode); for (;;) { Node oldTail = tail; if (oldTail != null ) { node. setPrevRelaxed (oldTail); if ( compareAndSetTail (oldTail, node)) { oldTail. next = node; return node; } } else { initializeSyncQueue (); } } } ä¸€æ—¦é”äº‰ç”¨ï¼Œä¸€å®šä¼šåˆå§‹åŒ–é˜Ÿåˆ—ï¼ˆå› ä¸ºæ’é˜Ÿçš„çº¿ç¨‹éœ€è¦å‰é©±èŠ‚ç‚¹å”¤é†’ï¼Œæ‰€ä»¥è¦åˆå§‹åŒ–ä¸€ä¸ªå‰é©±èŠ‚ç‚¹ï¼‰ï¼Œä¹‹åè‡ªæ—‹æˆä¸ºé˜Ÿåˆ—å°¾èŠ‚ç‚¹ã€‚ ç®€å•æ¥è¯´å°±æ˜¯è·å–ä¸åˆ°é”å°±æ”¾è¿›é˜Ÿåˆ—é‡Œç»´æŠ¤èµ·æ¥ï¼Œç­‰é”é‡Šæ”¾çš„æ—¶å€™å†ç”¨ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª å¾ˆå…·æœ‰å‚è€ƒæ€§çš„å°ç»†èŠ‚ ï¼šå…ˆè®¾ç½®æ–°èŠ‚ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œè‡ªæ—‹æˆä¸ºå°¾èŠ‚ç‚¹åè®¾ç½®å‰é©±çš„åé©± AbstractQueuedSynchronizer.acquireQueued1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253final boolean acquireQueued ( final Node node, int arg) { boolean interrupted = false ; try { for (;;) { final Node p = node. predecessor (); if (p == head &amp;&amp; tryAcquire (arg)) { setHead (node); p. next = null ; // help GC return interrupted; } if ( shouldParkAfterFailedAcquire (p, node)) interrupted |= parkAndCheckInterrupt (); } } catch ( Throwable t) { cancelAcquire (node); if (interrupted) selfInterrupt (); throw t; } } private static boolean shouldParkAfterFailedAcquire ( Node pred, Node node) { int ws = pred. waitStatus ; if (ws == Node . SIGNAL ) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true ; if (ws &gt; 0 ) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node. prev = pred = pred. prev ; } while (pred. waitStatus &gt; 0 ); pred. next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ pred. compareAndSetWaitStatus (ws, Node . SIGNAL ); } return false ; } private final boolean parkAndCheckInterrupt () { LockSupport . park ( this ); return Thread . interrupted (); } å‰é¢åªæ˜¯ç»´æŠ¤ä¸‹é“¾è¡¨æ•°æ®ç»“æ„ï¼Œè¿™é‡Œè´Ÿè´£æ‰¾åˆ°åˆé€‚çš„å”¤é†’å‰é©±ï¼Œç„¶åè®©çº¿ç¨‹ä¼‘çœ ã€‚ è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªå¾ªç¯è¿‡ç¨‹ï¼š æ£€æŸ¥æ˜¯å¦èƒ½è·å–åˆ°é”ï¼Œè·å–åˆ°åˆ™è¿”å› å¤±è´¥åˆ™å¯»æ‰¾å‰é¢æœ€è¿‘çš„æœªæ”¾å¼ƒäº‰ç”¨çš„å‰é©±ï¼ŒæŠŠå‰é©±çš„waitStatusè®¾ç½®ä¸º-1ï¼Œå¹¶æŠŠæ”¾å¼ƒäº‰ç”¨çš„èŠ‚ç‚¹æŠ›å¼ƒ æ£€æŸ¥æ˜¯å¦èƒ½ä¼‘çœ  ä½¿ç”¨Usafe.parkä¼‘çœ ï¼ˆä¸æ˜¯waitï¼‰ ReentrantLock lock æ€»ç»“ ReentrantLock unlock()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public final boolean release ( int arg) { if ( tryRelease (arg)) { Node h = head; if (h != null &amp;&amp; h. waitStatus != 0 ) unparkSuccessor (h); return true ; } return false ; } protected final boolean tryRelease ( int releases) { int c = getState () - releases; if ( Thread . currentThread () != getExclusiveOwnerThread ()) throw new IllegalMonitorStateException (); boolean free = false ; if (c == 0 ) { free = true ; setExclusiveOwnerThread ( null ); } setState (c); return free; } private void unparkSuccessor ( Node node) { /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node. waitStatus ; if (ws &lt; 0 ) node. compareAndSetWaitStatus (ws, 0 ); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node. next ; if (s == null || s. waitStatus &gt; 0 ) { s = null ; for ( Node p = tail; p != node &amp;&amp; p != null ; p = p. prev ) if (p. waitStatus &lt;= 0 ) s = p; } if (s != null ) LockSupport . unpark (s. thread ); } unlockçš„ä»£ç ç‰¹åˆ«ç®€å•ï¼š æ¯unlockä¸€æ¬¡state-1 state == 0 æ—¶èµ„æºæˆåŠŸé‡Šæ”¾ å¦‚æœé‡Šæ”¾æˆåŠŸï¼Œå”¤é†’ç¬¬äºŒä¸ªèŠ‚ç‚¹ å¦‚æœç¬¬äºŒä¸ªèŠ‚ç‚¹æ²¡å¼•ç”¨æˆ–è€…æ”¾å¼ƒäº‰ç”¨ï¼Œä»é˜Ÿå°¾å¼€å§‹å¯»æ‰¾å¯ä»¥å”¤é†’çš„çº¿ç¨‹","link":"/blog-posts/AbstractQueuedSynchronizerè§£æ.html"},{"title":"[ç‰‡æ®µ] ä½¿ç”¨redisåˆ›å»ºç®€æ˜“æœç´¢å¼•æ“ï¼ˆæ ¸å¿ƒç¯‡ï¼‰","text":"æ”¯æŒandæŸ¥è¯¢ã€å¤šé€‰ã€å¤šå­—æ®µæ’åºåˆ†é¡µï¼Œç¼ºå°‘çš„åŠŸèƒ½ï¼šor æ¡ä»¶ æ ¸å¿ƒç±»ï¼Œæœ‰ä¸€äº›æµ‹è¯•ä»£ç ï¼Œå°†å°±ä¸€ä¸‹ã€‚å¦å¤–éœ€è¦spring-data-redis 2.0ç‰ˆæœ¬ä»¥ä¸Š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382package app.pooi.redissearch.search;import app.pooi.redissearch.search.anno.CreateIndex;import app.pooi.redissearch.search.anno.Field;import com.google.common.collect.Lists;import com.google.common.collect.Sets;import lombok.Data;import org.apache.commons.lang3.ArrayUtils;import org.springframework.dao.DataAccessException;import org.springframework.data.redis.connection.RedisZSetCommands;import org.springframework.data.redis.core.*;import org.springframework.data.redis.hash.Jackson2HashMapper;import org.springframework.stereotype.Service;import org.springframework.web.bind.annotation.*;import reactor.util.function.Tuple2;import reactor.util.function.Tuples;import java.util.*;import java.util.concurrent.TimeUnit;import java.util.function.Consumer;import java.util.function.Function;import java.util.regex.Matcher;import java.util.regex.Pattern;import java.util.stream.Collectors;import java.util.stream.Stream;import static app.pooi.redissearch.search.SearchCore.Util.*;@RestController@Servicepublic class SearchCore { private StringRedisTemplate redisTemplate; private Jackson2HashMapper hashMapper = new Jackson2HashMapper(true); @Data private static class Person { private Long id; private String name; private Integer age; private Long ctime; } @PostMapping(\"/person\") @CreateIndex( index = \"person\", documentId = \"#p0.id\", fields = { @Field(propertyName = \"name\", value = \"#p0.name\"), @Field(propertyName = \"age\", value = \"#p0.age\", sort = true), @Field(propertyName = \"ctime\", value = \"#p0.ctime\", sort = true) }) Person addPerson(Person person) { return person; } public SearchCore(StringRedisTemplate redisTemplate) { this.redisTemplate = redisTemplate; } public void indexMeta(String index, Map&lt;String, FieldMeta&gt; fieldMeta) { this.redisTemplate.opsForHash().putAll(genIdxMetaName(index), hashMapper.toHash(fieldMeta)); } @PostMapping(\"/index\") public int indexDocument( final String index, final String field, final String documentId, final String document) { return this.indexDocument(index, field, documentId, document, doc -&gt; Lists.newArrayList(doc.split(\"\"))); } public int indexDocument( final String index, final String field, final String documentId, final String document, final Function&lt;String, List&lt;String&gt;&gt; tokenizer) { final List&lt;String&gt; tokens = tokenizer != null ? tokenizer.apply(document) : Collections.singletonList(document); final String docKey = genDocIdxName(index, documentId); final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations; final String[] idxs = tokens.stream() .map(word -&gt; genIdxName(index, field, word)) .peek(idx -&gt; ((StringRedisTemplate) operations).opsForSet().add(idx, documentId)) .toArray(String[]::new); template.opsForSet().add(docKey, idxs); return null; } }); return results.size(); } public int indexSortField( final String index, final String field, final String documentId, final Double document) { final String docKey = genDocIdxName(index, documentId); final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations; final String idxName = genSortIdxName(index, field); template.opsForZSet().add(idxName, documentId, document); template.opsForSet().add(docKey, idxName); return null; } }); return results.size(); } @DeleteMapping(\"/index\") public int deleteDocumentIndex(final String index, final String documentId) { final String docKey = genDocIdxName(index, documentId); final Boolean hasKey = redisTemplate.hasKey(docKey); if (!hasKey) { return 0; } final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final Set&lt;String&gt; idx = redisTemplate.opsForSet().members(docKey); ((StringRedisTemplate) operations).delete(idx); ((StringRedisTemplate) operations).delete(docKey); return null; } }); return results.size(); } @PatchMapping(\"/index\") public int updateDocumentIndex(final String index, final String field, final String documentId, final String document) { this.deleteDocumentIndex(index, documentId); return this.indexDocument(index, field, documentId, document); } public int updateSortField(final String index, final String field, final String documentId, final Double document) { this.deleteDocumentIndex(index, documentId); return this.indexSortField(index, field, documentId, document); } private Consumer&lt;SetOperations&lt;String, String&gt;&gt; operateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey) { switch (method) { case \"intersectAndStore\": return (so) -&gt; so.intersectAndStore(key, keys, destKey); case \"unionAndStore\": return (so) -&gt; so.unionAndStore(key, keys, destKey); case \"differenceAndStore\": return (so) -&gt; so.differenceAndStore(key, keys, destKey); default: return so -&gt; { }; } } private Consumer&lt;ZSetOperations&lt;String, String&gt;&gt; zOperateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey, final RedisZSetCommands.Weights weights) { switch (method) { case \"intersectAndStore\": return (so) -&gt; so.intersectAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights); case \"unionAndStore\": return (so) -&gt; so.unionAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights); default: return so -&gt; { }; } } private String common(String index, String method, List&lt;String&gt; keys, long ttl) { final String destKey = Util.genQueryIdxName(index); redisTemplate.executePipelined(new SessionCallback&lt;String&gt;() { @Override public &lt;K, V&gt; String execute(RedisOperations&lt;K, V&gt; operations) throws DataAccessException { operateAndStore(method, keys.stream().limit(1L).findFirst().get(), keys.stream().skip(1L).collect(Collectors.toList()), destKey) .accept(((StringRedisTemplate) operations).opsForSet()); ((StringRedisTemplate) operations).expire(destKey, ttl, TimeUnit.SECONDS); return null; } }); return destKey; } public String intersect(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"intersectAndStore\", keys, ttl); } public String union(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"unionAndStore\", keys, ttl); } public String diff(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"differenceAndStore\", keys, ttl); } private static Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parse(String query) { final Pattern pattern = Pattern.compile(\"[+-]?([\\\\w\\\\d]+):(\\\\S+)\"); final Matcher matcher = pattern.matcher(query); Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = Sets.newHashSet(); Set&lt;Tuple2&lt;String, String&gt;&gt; want = Sets.newHashSet(); while (matcher.find()) { String word = matcher.group(); String prefix = null; if (word.length() &gt; 1) { prefix = word.substring(0, 1); } final Tuple2&lt;String, String&gt; t = Tuples.of(matcher.group(1), matcher.group(2)); if (\"-\".equals(prefix)) { unwant.add(t); } else { want.add(t); } } return Tuples.of(want, unwant); } public String query( String index, String query) { final Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parseResult = parse(query); final Set&lt;Tuple2&lt;String, String&gt;&gt; want = parseResult.getT1(); final Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = parseResult.getT2(); if (want.isEmpty()) { return \"\"; } final Map&lt;String, FieldMeta&gt; entries = (Map&lt;String, FieldMeta&gt;) hashMapper.fromHash(redisTemplate.&lt;String, Object&gt;opsForHash().entries(genIdxMetaName(index))); // union final List&lt;Tuple2&lt;String, String&gt;&gt; unionFields = want.stream() .filter(w -&gt; w.getT2().contains(\",\")) .filter(w -&gt; \"true\".equals(entries.get(w.getT1()).getSort())) .collect(Collectors.toList()); final List&lt;String&gt; unionIdx = unionFields.stream() .flatMap(w -&gt; Arrays.stream(w.getT2().split(\",\")).map(value -&gt; Tuples.of(w.getT1(), value))) .map(w -&gt; genIdxName(index, w.getT1(), w.getT2())) .collect(Collectors.toList()); final String unionResultId = unionIdx.isEmpty() ? \"\" : this.union(index, unionIdx, 30L); want.removeAll(unionFields); // intersect final List&lt;String&gt; intersectIdx = want.stream() .flatMap(t -&gt; { if (\"true\".equals(entries.get(t.getT1()).getSort())) return Stream.of(t); return Arrays.stream(t.getT2().split(\"\")).map(value -&gt; Tuples.of(t.getT1(), value)); }) .map(w -&gt; genIdxName(index, w.getT1(), w.getT2())) .collect(Collectors.toList()); if (!unionResultId.isEmpty()) intersectIdx.add(unionResultId); String intersectResult = this.intersect(index, intersectIdx, 30L); // diff return unwant.isEmpty() ? intersectResult : this.diff(index, Stream.concat(Stream.of(intersectResult), unwant.stream().map(w -&gt; genIdxName(index, w.getT1(), w.getT2()))).collect(Collectors.toList()), 30L); } @GetMapping(\"/query/{index}\") public Set&lt;String&gt; queryAndSort( @PathVariable(\"index\") String index, @RequestParam(\"param\") String query, @RequestParam(\"sort\") String sort, Integer start, Integer stop ) { final String[] sorts = sort.split(\" \"); final Map&lt;String, Integer&gt; map = Arrays.stream(sorts).collect( Collectors.toMap(f -&gt; { if (f.startsWith(\"+\") || f.startsWith(\"-\")) { f = f.substring(1); } return genSortIdxName(\"person\", f); }, field -&gt; field.startsWith(\"-\") ? -1 : 1) ); final int[] weights = map.values() .stream() .mapToInt(Integer::intValue) .toArray();// if (!sort.startsWith(\"+\") &amp;&amp; !sort.startsWith(\"-\")) {// sort = \"+\" + sort;// }// boolean desc = sort.startsWith(\"-\");// sort = sort.substring(1); String queryId = this.query(index, query); Long size; if (queryId.length() == 0 || (size = redisTemplate.opsForSet().size(queryId)) == null || size == 0) { return Collections.emptySet(); } final String resultId = genQueryIdxName(index);// String sortField = sort; redisTemplate.executePipelined(new SessionCallback&lt;Object&gt;() { @Override public &lt;K, V&gt; Object execute(RedisOperations&lt;K, V&gt; operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations;// template.opsForZSet().intersectAndStore(genSortIdxName(index, sortField), queryId, resultId); SearchCore.this.zOperateAndStore(\"intersectAndStore\", map.keySet().stream().limit(1L).findFirst().get(), Stream.concat(map.keySet().stream().skip(1L), Stream.of(queryId)).collect(Collectors.toList()), resultId, RedisZSetCommands.Weights.of(ArrayUtils.add(weights, 0))).accept(template.opsForZSet());// template.opsForZSet().size(resultId); template.expire(resultId, 30L, TimeUnit.SECONDS); return null; } }); // sort return redisTemplate.opsForZSet().range(resultId, start, stop); } static class Util { private Util() { } static String genIdxMetaName(String index) { return String.format(\"meta:idx:%s\", index); } static String genIdxName(String index, String field, String value) { return String.format(\"idx:%s:%s:%s\", index, field, value); } static String genSortIdxName(String index, String field) { return String.format(\"idx:%s:%s\", index, field); } static String genQueryIdxName(String index) { return String.format(\"idx:%s:q:%s\", index, UUID.randomUUID().toString()); } static String genDocIdxName(String index, String documentId) { return String.format(\"doc:%s:%s\", index, documentId); } }} è¾…åŠ©ç±» 123456789101112131415161718import lombok.Data;@Datapublic class FieldMeta { private String sort = \"false\"; private String splitFun = \"\"; public FieldMeta() { } public FieldMeta(boolean sort) { this.sort = Boolean.toString(sort); }} åšä¸€ä¸ªè½»é‡çº§çš„æœç´¢è¿˜æ˜¯å¯ä»¥çš„ã€‚","link":"/blog-posts/[ç‰‡æ®µ]ä½¿ç”¨redisåˆ›å»ºç®€æ˜“æœç´¢å¼•æ“ï¼ˆæ ¸å¿ƒç¯‡ï¼‰.html"},{"title":"LeetCodeäºŒå‰æ ‘åŸºç¡€ç®—æ³•","text":"æ ‘çš„é«˜åº¦104. Maximum Depth of Binary Tree (Easy) é€’å½’è®¡ç®—äºŒå‰æ ‘å·¦å³ä¸¤è¾¹æ·±åº¦ï¼Œå–æœ€å¤§å€¼ã€‚ 12345678910111213141516171819/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int maxDepth(TreeNode root) { if (root == null) return 0; int left = maxDepth(root.left); int right = maxDepth(root.right); return Math.max(left, right) + 1; }} å¹³è¡¡æ ‘110. Balanced Binary Tree (Easy) é€’å½’éå†äºŒå‰æ ‘å·¦å³å­æ ‘æ·±åº¦ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private boolean balance = true; public boolean isBalanced(TreeNode root) { visitTree(root); return balance; } private int visitTree(TreeNode root) { if (root == null) return 0; int left = visitTree(root.left); int right = visitTree(root.right); if (Math.abs(left - right) &gt; 1 ) this.balance = false; return Math.max(left, right) + 1; }} ä¸¤èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„543. Diameter of Binary Tree (Easy) é€’å½’éå†äºŒå‰æ ‘å·¦å³å­æ ‘æ·±åº¦ï¼Œ è·¯å¾„å°±æ˜¯ä¸¤è¾¹å­æ ‘æ·±åº¦ä¹‹å’Œ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int max; public int diameterOfBinaryTree(TreeNode root) { deep(root); return max; } private int deep(TreeNode root) { if (root == null) return 0; int left = deep(root.left); int right = deep(root.right); max = Math.max(max,left+right); return Math.max(left, right) + 1; }} ç¿»è½¬æ ‘226. Invert Binary Tree (Easy) é€’å½’äº¤æ¢å·¦å³å­æ ‘çš„å¼•ç”¨ 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode invertTree(TreeNode root) { if (root == null) return root; TreeNode right =root.right; root.right = invertTree(root.left); root.left = invertTree(right); return root; }} å½’å¹¶ä¸¤æ£µæ ‘617. Merge Two Binary Trees (Easy) é€’å½’æ—¶å¦‚æœå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç©ºï¼Œå¯ä»¥ç›´æ¥å¤ç”¨è¯¥èŠ‚ç‚¹ã€‚å¦‚æœæ–°å»ºèŠ‚ç‚¹ï¼Œéœ€è¦æ‹·è´èŠ‚ç‚¹çš„å·¦å³å­æ ‘å¼•ç”¨ï¼Œé€’å½’æ—¶ä¼šç”¨åˆ°ã€‚ 1234567891011121314151617181920/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode mergeTrees(TreeNode t1, TreeNode t2) { if (t1 == null &amp;&amp; t2 == null ) return null; if (t1 == null) return t2; if (t2 == null) return t1; TreeNode root = new TreeNode(t1.val + t2.val); root.left = mergeTrees(t1.left, t2.left); root.right = mergeTrees(t1.right, t2.right); return root; }} åˆ¤æ–­è·¯å¾„å’Œæ˜¯å¦ç­‰äºä¸€ä¸ªæ•°Leetcode : 112. Path Sum (Easy) é€’å½’æŸ¥è¯¢å­æ ‘å’Œæ˜¯å¦ç­‰äºç›®æ ‡å’Œ 12345678910111213141516/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean hasPathSum(TreeNode root, int sum) { if (root == null) return false; if (root.val == sum &amp;&amp; root.left == null &amp;&amp; root.right == null) return true; return hasPathSum(root.left, sum - root.val) || hasPathSum(root.right, sum - root.val); }} ç»Ÿè®¡è·¯å¾„å’Œç­‰äºä¸€ä¸ªæ•°çš„è·¯å¾„æ•°é‡437. Path Sum III (Easy) åŒå±‚é€’å½’ ä»¥å½“å‰èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ å½“å‰èŠ‚ç‚¹ä»¥ä¸‹èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ ä»¥rootä¸ºæ ¹èŠ‚ç‚¹çš„è·¯å¾„æ•°é‡= ä»¥rootä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ+rootå·¦èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ+rootå³èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ 123456789101112131415161718192021222324/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int pathSum(TreeNode root, int sum) { if (root == null) return 0; //ç»“æœæ•° ç­‰äº ä»¥å½“å‰rootä¸ºçˆ¶èŠ‚ç‚¹å’Œ rootä»¥ä¸‹ä¸ºçˆ¶èŠ‚ç‚¹ç»“æœæ•°ä¹‹å’Œ return sum(root, sum) + pathSum(root.left, sum) + pathSum(root.right, sum); } // è®¡ç®—ä»¥å½“å‰nodeä¸ºçˆ¶èŠ‚ç‚¹èƒ½éƒ½å¤šå°‘è·¯å¾„æ•° private int sum(TreeNode node, int sum) { if (node == null) return 0; int count = 0; if (node.val == sum) count++; count += sum(node.left, sum - node.val) + sum(node.right, sum - node.val); return count; }} å­æ ‘572. Subtree of Another Tree (Easy) 12345678910111213141516171819202122/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean isSubtree(TreeNode s, TreeNode t) { if (s == null) return false; return isSubRoot(s, t) || isSubtree(s.left, t) || isSubtree(s.right, t); } public boolean isSubRoot(TreeNode node, TreeNode t) { if (node == null &amp;&amp; t == null) return true; if (node == null || t == null) return false; if (node.val != t.val) return false; return isSubRoot(node.left, t.left) &amp;&amp; isSubRoot(node.right, t.right); }} æ ‘çš„å¯¹ç§°101. Symmetric Tree (Easy) 12345678910111213141516171819202122/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean isSymmetric(TreeNode root) { if (root == null) return true; return isSymmetric(root.left, root.right); } public boolean isSymmetric(TreeNode left, TreeNode right) { if (left == null &amp;&amp; right == null) return true; if (left == null || right == null) return false; if (left.val != right.val) return false; return isSymmetric(left.left, right.right) &amp;&amp; isSymmetric(left.right, right.left); }} æœ€å°è·¯å¾„111. Minimum Depth of Binary Tree (Easy) å’Œæœ€å¤§è·¯å¾„ç±»ä¼¼ 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int minDepth(TreeNode root) { if (root == null) return 0; int left = minDepth(root.left); int right = minDepth(root.right); if (left == 0 || right == 0) return left + right + 1; return Math.min(left, right) + 1; }} ç»Ÿè®¡å·¦å¶å­èŠ‚ç‚¹çš„å’Œ404. Sum of Left Leaves (Easy) 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int sumOfLeftLeaves(TreeNode root) { if (root == null) return 0; if (root.left != null &amp;&amp; root.left.left == null &amp;&amp; root.left.right == null) return root.left.val + sumOfLeftLeaves(root.right); return sumOfLeftLeaves(root.left) + sumOfLeftLeaves(root.right); }}` ç›¸åŒèŠ‚ç‚¹å€¼çš„æœ€å¤§è·¯å¾„é•¿åº¦687. Longest Univalue Path (Easy) é€’å½’æŸ¥æ‰¾å·¦å³å­æ ‘ç›¸åŒèŠ‚ç‚¹å€¼æœ€å¤§è·¯å¾„ï¼Œæœ€å¤§è·¯å¾„çš„è®¡ç®—ï¼šå¦‚æœç›¸ç­‰è·¯å¾„+1ï¼Œå¦‚æœä¸ç›¸ç­‰ç½®ä¸º0ã€‚ 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int path = 0; public int longestUnivaluePath(TreeNode root) { visit(root); return path; } private int visit(TreeNode root) { if (root == null) return 0; int left = visit(root.left); int right = visit(root.right); left = (root.left != null &amp;&amp; root.val == root.left.val) ? left + 1 : 0; right = (root.right != null &amp;&amp; root.val == root.right.val)? right + 1 : 0; path = Math.max(path, left+right); return Math.max(left, right ); }} é—´éš”éå†337. House Robber III (Medium) é€’å½’æŸ¥è¯¢ä¸¤ç§æƒ…å†µ å¦‚æœä»å½“å‰èŠ‚ç‚¹å¼€å§‹ ä»å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¼€å§‹ 1234567891011121314151617181920/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int rob(TreeNode root) { if (root == null) return 0; int val1 = root.val, val2 = 0; if (root.left != null) val1+= rob(root.left.left) + rob(root.left.right); if (root.right != null) val1+= rob(root.right.left) + rob(root.right.right); val2 = rob(root.left) + rob(root.right); return Math.max(val1, val2); }} æ‰¾å‡ºäºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹Second Minimum Node In a Binary Tree (Easy) ç¬¬äºŒå°èŠ‚ç‚¹åœ¨å­æ ‘èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœå­æ ‘å€¼ä¸æ ¹èŠ‚ç‚¹ç›¸ç­‰ï¼Œç»§ç»­å‘ä¸‹æŸ¥æ‰¾ 123456789101112131415161718192021/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int findSecondMinimumValue(TreeNode root) { if (root == null) return -1; if (root.left == null) return -1; int left = root.left.val, right = root.right.val; if (root.val == root.left.val) left = findSecondMinimumValue(root.left); if (root.val == root.right.val) right = findSecondMinimumValue(root.right); if (left != -1 &amp;&amp; right != -1) return Math.min(left, right); if (left &gt; -1) return left; return right; }} äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼637. Average of Levels in Binary Tree (Easy) BFS 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public List&lt;Double&gt; averageOfLevels(TreeNode root) { List&lt;Double&gt; ret = new ArrayList&lt;&gt;(); if (root == null) return ret; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while(!queue.isEmpty()) { int count = queue.size(); double sum = 0d; for(int i = 0; i &lt; count; i++) { TreeNode node = queue.poll(); sum+= node.val; if (node.left != null) queue.add(node.left); if (node.right != null) queue.add(node.right); } ret.add(sum/count); } return ret; }} æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼513. Find Bottom Left Tree Value (Easy) DFS 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int val = 0; public int findBottomLeftValue(TreeNode root) { if (root == null) return val; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while(!queue.isEmpty()) { // è¿™ä¸€è¡Œçš„æ•°é‡ int count = queue.size(); for (int i = 0; i &lt; count; i++) { TreeNode node = queue.poll(); if(i == 0) val = node.val; if (node.left != null) queue.add(node.left); if (node.right != null) queue.add(node.right); } } return val; }} éé€’å½’å®ç°äºŒå‰æ ‘çš„ååºéå†å…¥æ ˆæ¡ä»¶ï¼š æœªè®¿é—®è¿‡è¯¥èŠ‚ç‚¹å‡ºæ ˆæ¡ä»¶ï¼š è®¿é—®è¿‡è¯¥èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); private Set&lt;TreeNode&gt; visited = new HashSet&lt;&gt;(); public List&lt;Integer&gt; postorderTraversal(TreeNode root) { if (root == null) return res; stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.peek(); if ((node.left == null &amp;&amp; node.right == null) || visited.contains(node)) { TreeNode i = stack.pop(); res.add(i.val); } else { visited.add(node); if (node.right != null) stack.push(node.right); if (node.left != null) stack.push(node.left); } } return res; } private void visit(TreeNode root) { if(root == null) return; visit(root.left); visit(root.right); res.add(root.val); }} éé€’å½’å®ç°äºŒå‰æ ‘çš„å‰åºéå†å…¥æ ˆæ¡ä»¶ï¼š æ— å‡ºæ ˆæ¡ä»¶ï¼š ç›´æ¥å‡ºæ ˆ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); public List&lt;Integer&gt; preorderTraversal(TreeNode root) { if (root == null) return res; stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); res.add(node.val); if (node.right != null) stack.push(node.right); if (node.left != null) stack.push(node.left); } return res; }} éé€’å½’å®ç°äºŒå‰æ ‘çš„ä¸­åºéå†å…¥æ ˆæ¡ä»¶ï¼š æœªè®¿é—®è¿‡è¯¥èŠ‚ç‚¹å‡ºæ ˆæ¡ä»¶ï¼š è®¿é—®è¿‡è¯¥èŠ‚ç‚¹å…¥æ ˆé¡ºåº: right -&gt; middle -&gt; left 12345678910111213141516171819202122232425262728293031323334353637/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); private Set&lt;TreeNode&gt; visited = new HashSet&lt;&gt;(); public List&lt;Integer&gt; inorderTraversal(TreeNode root) { if (root == null) return res; push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); if ((node.left == null &amp;&amp; node.right == null) || visited.contains(node)) { res.add(node.val); } else { push(node); } } return res; } private void push(TreeNode root) { if (root == null) return; visited.add(root); if (root.right != null) stack.push(root.right); stack.push(root); if (root.left != null) stack.push(root.left); }}","link":"/blog-posts/2019-06-15æ ‘ç®—æ³•.html"}],"posts":[],"tags":[{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/tags/å·¥ä½œ/"},{"name":"ä»£ç ","slug":"ä»£ç ","link":"/tags/ä»£ç /"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/tags/ç®—æ³•/"},{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","link":"/tags/è¯»ä¹¦/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"æ„Ÿæ‚Ÿ","slug":"æ„Ÿæ‚Ÿ","link":"/tags/æ„Ÿæ‚Ÿ/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"mybatis","slug":"mybatis","link":"/tags/mybatis/"},{"name":"spring","slug":"spring","link":"/tags/spring/"},{"name":"aop","slug":"aop","link":"/tags/aop/"},{"name":"å›¢é˜Ÿ","slug":"å›¢é˜Ÿ","link":"/tags/å›¢é˜Ÿ/"},{"name":"æœç´¢","slug":"æœç´¢","link":"/tags/æœç´¢/"},{"name":"redis","slug":"redis","link":"/tags/redis/"}],"categories":[{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/categories/å·¥ä½œ/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/categories/ç®—æ³•/"},{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","link":"/categories/è¯»ä¹¦/"},{"name":"æŒ‘æˆ˜","slug":"å·¥ä½œ/æŒ‘æˆ˜","link":"/categories/å·¥ä½œ/æŒ‘æˆ˜/"},{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","link":"/categories/JavaåŸºç¡€/"},{"name":"å­—ç¬¦ä¸²","slug":"ç®—æ³•/å­—ç¬¦ä¸²","link":"/categories/ç®—æ³•/å­—ç¬¦ä¸²/"},{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","link":"/categories/Javaæ¡†æ¶/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","link":"/categories/ä¸­é—´ä»¶/"},{"name":"æ€»ç»“","slug":"å·¥ä½œ/æ€»ç»“","link":"/categories/å·¥ä½œ/æ€»ç»“/"},{"name":"Mybatis","slug":"Javaæ¡†æ¶/Mybatis","link":"/categories/Javaæ¡†æ¶/Mybatis/"},{"name":"Spring","slug":"Javaæ¡†æ¶/Spring","link":"/categories/Javaæ¡†æ¶/Spring/"},{"name":"resilience4j","slug":"ä¸­é—´ä»¶/resilience4j","link":"/categories/ä¸­é—´ä»¶/resilience4j/"},{"name":"Javaå¹¶å‘","slug":"Javaå¹¶å‘","link":"/categories/Javaå¹¶å‘/"},{"name":"æœç´¢å¼•æ“","slug":"ä¸­é—´ä»¶/æœç´¢å¼•æ“","link":"/categories/ä¸­é—´ä»¶/æœç´¢å¼•æ“/"},{"name":"äºŒå‰æ ‘","slug":"ç®—æ³•/äºŒå‰æ ‘","link":"/categories/ç®—æ³•/äºŒå‰æ ‘/"}]}