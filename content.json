{"pages":[{"title":"about","text":"to be continueâ€¦","link":"/about/index.html"},{"title":"tags","text":"","link":"/tags/index.html"},{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"2018ä¸‹åŠå¹´ä¹¦å•","text":"ç»æµé‡‘èç±»ï¼š ã€Šæ–¯å¦ç¦æç®€ç»æµå­¦ã€‹åˆ†å¾®è§‚å’Œå®è§‚ç»æµå­¦ æ²¡æœ‰æ•™ç§‘ä¹¦å¼çš„ä»‹ç» æ¯”è¾ƒå¥½è¯»ï¼Œæ¨è ã€Šéšæœºæ¼«æ­¥çš„å‚»ç“œã€‹ ç»éªŒä¹‹è°ˆ è§‚ç‚¹å¯ä»¥æ¥å— ã€Šä¹°æ™¾è¡£æ†çš„å°è´©ä¸ºä½•ä¸ä¼šå€’ã€‹ è´´è¿‘ç”Ÿæ´» è¿‡äºç®€å• ä¸æ¨è ã€Šå¯Œçˆ¸çˆ¸ ç©·çˆ¸çˆ¸ã€‹å°ç™½å…¥é—¨é¦–é€‰ æ¨è ã€Šå°å²›ç»æµå­¦ã€‹ æ·±å…¥æµ…å‡º æœ€åæ˜ å°„ä¸­å›½å’Œç¾å›½å…³ç³» åé¢æœ‰ç‚¹çœ‹ä¸æ‡‚ æ¨è å°è¯´ç±»ï¼š ã€Šè§£å¿§æ‚è´§åº—ã€‹ ä¸ªäººæ„Ÿè§‰ä¸€èˆ¬ ååŠéƒ¨åˆ†å‰§æƒ…æˆ‘éƒ½çŒœåˆ°äº† ã€Šäººé—´å¤±æ ¼ã€‹ é­å—åˆ°äº†ç¤¾ä¼šçš„æ¯’æ‰“ å¾ˆç°å® æœ‰ç‚¹è‡´éƒ å¿ƒé‡Œæ‰¿å—èƒ½åŠ›ä½çš„ä¸æ¨è ã€Šä¸‰ä½“ã€‹ ç¬¬ä¸€éƒ¨å¯ä»¥çš„ï¼Œåé¢ä¸€éƒ¨ä¸å¦‚ä¸€éƒ¨ ä½†æ˜¯æ¯”èµ·å…¶ä»–ç½‘ä¸Šå¤§ä¼—å–œæ¬¢çš„çˆ½æ–‡å¥½å¤šäº† æŠ€æœ¯ç±»ï¼š ã€Šjavaç¼–ç¨‹çš„é€»è¾‘ã€‹ æ¸©æ•…è€ŒçŸ¥æ–°ï¼ŒåŸºç¡€å¥½çš„ä¸ç”¨çœ‹äº† å°ç™½æ¨è ã€Škafkaæƒå¨æŒ‡å—ã€‹æ­£åœ¨çœ‹ ä½†æ˜¯çœŸçš„å†™çš„ä¸é”™ æ¨è ã€Šmybatisä»å…¥é—¨åˆ°ç²¾é€šã€‹ ä¸€èˆ¬èˆ¬ï¼Œåªæœ‰å…¥é—¨å§ ã€Šnettyæƒå¨æŒ‡å—ã€‹ ä¸€èˆ¬èˆ¬ ã€Šredisè®¾è®¡ä¸å®ç°ã€‹ çœŸè®¾è®¡ä¸å®ç° æ¨è ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹å¤šè¯»å‡ éä¹Ÿä¸ä¸ºè¿‡ æ¨è ã€ŠSpringBootå®æˆ˜ã€‹ è¯»çš„æ¯”è¾ƒæ—©æ²¡å½±å“äº† ä¸æ¨è ã€Šç®—æ³•å›¾è§£ã€‹ ç¨‹åº=æ•°æ®ç»“æ„+ç®—æ³• å°ç™½æ¨èï¼ˆæˆ‘å°±æ˜¯å°ç™½ï¼‰ å¿ƒç†ç±»ï¼š ã€Šä¹Œåˆä¹‹ä¼—ã€‹ äººåœ¨å°èŒƒå›´ä¸ºç§åˆ©è¡ŒåŠ¨ åœ¨æ°‘æ—èŒƒç•´ä¼šæŠ›å¼€ç§åˆ©åšå‡ºäº›è¿‡äºå´‡é«˜æˆ–ç²—é²çš„è¡Œä¸º æ¨è ã€ŠåŸç”Ÿå®¶åº­ã€‹ ä¸€ä¸ªäººå—ç«¥å¹´å®¶åº­çš„å½±å“æ˜¯æœ€å¤§çš„ï¼Œè¿™æœ¬ä¹¦èƒ½çœ‹æ‡‚æ˜¯ä¸€å›äº‹ï¼Œèƒ½åšå¥½æ˜¯å¦ä¸€å›äº‹","link":"/2018/2018-09-04-2018%E4%B8%8B%E5%8D%8A%E5%B9%B4%E4%B9%A6%E5%8D%95/"},{"title":"ã€Šé‡æ„-æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡ã€‹è¯»ä¹¦ç¬”è®°","text":"1.1 ä¸€ä¸ªç®€å•çš„ä¾‹å­ä¸€ä¸ªè®¡ç®—é¡¾å®¢ç§Ÿèµå½±ç‰‡è´¹ç”¨çš„ç¨‹åºï¼Œèƒ½å®¹æ˜“å†™æˆé¢æ¡å¼çš„ä»£ç ï¼ˆæµæ°´è´¦ï¼‰ï¼šé¡¾å®¢ç±»è°ƒç”¨å½±ç‰‡ç±»å’Œç§Ÿèµæ—¶é•¿è®¡ç®—è´¹ç”¨ å¯¹æœºå™¨æ¥è¨€åªè¦èƒ½è¿è¡Œæ­£ç¡®æ²¡æœ‰å¥½ä»£ç å’Œåä»£ç ä¹‹åˆ†ï¼Œä½†æ˜¯å¯¹ï¼ˆç»´æŠ¤çš„ï¼‰äººæ¥è¯´å¾ˆéš¾æ‰¾åˆ°ä¿®æ”¹ç‚¹ï¼Œå®¹æ˜“å¼•å…¥bug 1.2é‡æ„å‰å…ˆå†™æµ‹è¯•ä¿è¯é‡æ„ç»“æœåˆ©ç”¨å•å…ƒæµ‹è¯•ä¿è¯é‡æ„æ­£ç¡®æ€§ 1.3ä»¥å¾®å°çš„æ­¥ä¼ä¿®æ”¹ç¨‹åºï¼Œä¿è¯é—®é¢˜å¿«é€Ÿå‘ç°è§£å†³ä¸è¦ä¸ºä¿®æ”¹å˜é‡åæ„Ÿåˆ°ç¾è€»ï¼Œåªæœ‰å†™å‡ºäººèƒ½ç†è§£çš„ä»£ç æ‰æ˜¯å¥½ç¨‹åºå‘˜ é‡æ„å®Œå¯èƒ½ æ€§èƒ½å˜å·®ï¼Œä½†åŒæ—¶ä¼šå¸¦æ¥æ›´å¤šçš„æœºä¼šæ¥ä¼˜åŒ– 1.4å¹²è´§ï¼ç”¨å¤šæ€ä»£æ›¿switchswitchéœ€è¦å…³å¿ƒå…·ä½“æ¡ä»¶ï¼Œå¤šæ€å…·æœ‰switchä¸å…·å¤‡çš„ä¼˜åŠ¿ï¼šä¸éœ€è¦å…³å¿ƒå…·ä½“ç±»å‹ 2.1é‡æ„çš„å®šä¹‰é‡æ„ï¼šä¸æ”¹å˜è¿è¡Œç»“æœä¸‹ æé«˜ç†è§£æ€§ é™ä½ä¿®æ”¹æˆæœ¬ 2.2é‡æ„çš„åŸå›  ä»£ç ç»“æ„çš„æµå¤±æ˜¯ç´¯ç§¯æ€§çš„ï¼Œè¶Šéš¾çœ‹æ‡‚ä»£ç è®¾è®¡æ„å›¾ï¼Œè¶Šéš¾ä¿æŠ¤å…¶è®¾è®¡ æ¶ˆé™¤é‡å¤ä»£ç ï¼Œæ–¹ä¾¿ä¿®æ”¹ æˆ‘ä»¬ç¼–å†™ä»£ç æ—¶å¾ˆå®¹æ˜“å¿˜è®°è¯»è€…çš„æ„Ÿå—ï¼Œé€ æˆä»–äººæ—¶é—´çš„æµªè´¹ é‡æ„æ—¶çŠ¯é”™å¯ä»¥åŠ æ·±å¯¹ä»£ç æ„å›¾çš„ç†è§£ï¼Œå¯ä»¥å¸®åŠ©å‘ç°bug å¥½çš„ç»“æ„è®¾è®¡æ˜¯åŠ é€Ÿå¼€å‘çš„æ ¹æœ¬ 2.3é‡æ„çš„æ—¶æœº æ·»åŠ åŠŸèƒ½æ—¶é‡æ„ï¼Œåœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­æŠŠç»“æ„ç†æ¸…ï¼Œä¹Ÿå¯ä»¥æ›´ç®€å•çš„æ·»åŠ åŠŸèƒ½ ä¿®å¤é”™è¯¯æ—¶é‡æ„ å¤å®¡ä»£ç æ—¶é‡æ„ 2.4 é‡æ„çš„ä»·å€¼ç¨‹åºæœ‰ä¸¤é¢ä»·å€¼ï¼Œä»Šå¤©å¯ä»¥ä¸ºä½ åšä»€ä¹ˆå’Œæ˜å¤©å¯ä»¥ä¸ºä½ åšä»€ä¹ˆä¸ºäº†æ»¡è¶³æ˜å¤©çš„éœ€è¦ï¼Œä½ ä¼šé‡åˆ°ï¼š éš¾ä»¥é˜…è¯»ï¼Œé€»è¾‘é‡å¤ æ·»åŠ æ–°åŠŸèƒ½è®¸ä¿®æ”¹ä»¥å‰ä»£ç  å¤æ‚çš„æ¡ä»¶é€»è¾‘ç­‰ä»£ç  è€Œä½ å¸Œæœ›çœ‹åˆ°çš„æ˜¯ï¼š å®¹æ˜“é˜…è¯»ï¼Œæ‰€æœ‰é€»è¾‘åœ¨å”¯ä¸€æŒ‡å®šåœ°ç‚¹ï¼Œ æ–°çš„ä¿®æ”¹ä¸ä¼šå±åŠç°æœ‰è¡Œä¸º å°½å¯èƒ½ç®€å•è¡¨è¾¾é€»è¾‘æ¡ä»¶ é‡æ„å°±æ˜¯æŠŠç¨‹åºè½¬å˜ä¸ºè¿™äº›ç‰¹å¾çš„å·¥å…· 2.5å¦‚ä½•å‘Šè¯‰ï¼ˆå¯¹ä»˜ï¼‰ç»ç†å¾ˆå¤šç»ç†éƒ½æ˜¯è¿›åº¦é©±åŠ¨ï¼Œæ‰€ä»¥æ›´åŠ éœ€è¦é‡æ„å¸¦æ¥çš„å¥½å¤„ï¼Œæ‰€ä»¥ä¸è¦å‘Šè¯‰ä»–ä»¬ ä»–ä»¬ä¸ä¼šç†è§£çš„ 2.5.1å¼•å…¥é—´æ¥å±‚ä¸é‡æ„çš„å…³ç³»é—´æ¥å±‚ä¼˜ç‚¹ï¼š å…è®¸é€»è¾‘å…±äº« å¢åŠ è§£é‡Šæ„å›¾å’Œå®ç°çš„æœºä¼šï¼å¤šäº†ç±»åå’Œå‡½æ•°å éš”ç¦»å˜åŒ– å¤šæ€å°è£…æ¡ä»¶é€»è¾‘ 2.5.2ä½•æ—¶ä¸åº”è¯¥é‡æ„ è½¯ä»¶æ ¹æœ¬ä¸å·¥ä½œ æœ€åæœŸé™å·²è¿‘ æœªå®Œæˆçš„é‡æ„å¯ä»¥ç§°ä¹‹ä¸ºå€ºåŠ¡ï¼Œè¿Ÿæ—©è¦è¿˜ 2.5.3é‡æ„ä¸é¢„å…ˆè®¾è®¡çš„å…³ç³»é‡æ„å¯ä»¥èŠ‚çº¦ä¸å¿…è¦çš„æ—¶é—´ç²¾åŠ›èŠ±åœ¨é¢„å…ˆè®¾è®¡ä¸Šï¼Œè®©è½¯ä»¶è®¾è®¡å‘ç®€åŒ–å‘å±• 3ä»£ç çš„åå‘³é“ é‡å¤ä»£ç  è¿‡é•¿å‡½æ•° è¿‡å¤§ç±»ï¼Œè¿‡é•¿å‚æ•° ä¿®æ”¹ä¸€å¤„ç¨‹åºçš„åŸå› è¿‡å¤š/ä¸€ä¸ªåŸå› ä¿®æ”¹è¿‡å¤šçš„ç¨‹åº æ•°æ®ä¾èµ–è¿‡å¤š é‡å¤çš„å­—æ®µå’Œå‚æ•° æ€»æ˜¯æ”¾åœ¨ä¸€èµ·çš„å­—æ®µ switchè¯­å¥ å¹³è¡Œç»§æ‰¿å…³ç³» ä¸æ˜¯æ‰€æœ‰åˆ†æ”¯ä¸‹éƒ½éœ€è¦çš„ä¸´æ—¶å˜é‡ è¿‡åº¦è€¦åˆè°ƒç”¨é“¾ ä¸å¿…è¦çš„å§”æ‰˜ å¤±è¡€æ•°æ®ç±» é¢‘ç¹é‡å†™çˆ¶ç±»æ–¹æ³• è¿‡å¤šæ³¨é‡Š 4~12å…·ä½“å¦‚ä½•åšè‡ªå·±çœ‹ä¹¦å§","link":"/2018/2018-09-08-%E3%80%8A%E9%87%8D%E6%9E%84-%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"title":"æ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢çš„ä¸€ç§æ€è·¯","text":"1. é—®é¢˜èƒŒæ™¯æƒé™ç³»ç»Ÿç°çŠ¶UCæƒé™ç³»ç»ŸåŸºäºè§’è‰²è®¿é—®æ§åˆ¶æŠ€æœ¯RBACï¼ˆRole Based Access Controlï¼‰ ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯èµ‹äºˆç”¨æˆ·æŸä¸ªè§’è‰²ï¼Œè§’è‰²ç»™ä¸è§’è‰²å¯¹åº”çš„æƒé™èƒ½è®¿é—®åŠæ“ä½œä¸åŒèŒƒå›´çš„èµ„æºã€‚ ä»€ä¹ˆæ˜¯æ•°æ®æƒé™ä»£è¡¨ä¸€ä¸ªè§’è‰²å¯¹åº”æŸä¸ªæƒé™æ‰€èƒ½æ“ä½œçš„æ•°æ®èŒƒå›´ï¼Œæ¯”å¦‚gitlabç»„ç®¡ç†å‘˜èƒ½çœ‹åˆ°ç»„ä¸‹çš„æ‰€æœ‰é¡¹ç›®ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·é…ç½®ï¼š åˆ›å»ºç»„ç®¡ç†å‘˜ åˆ†é…ç»™ç»„ç®¡ç†å‘˜æŸ¥çœ‹é¡¹ç›®ä»£ç çš„æƒé™ æŸ¥çœ‹é¡¹ç›®ä»£ç æƒé™è®¾ç½®çº¦æŸæ¡ä»¶ï¼Œçº¦æŸä¸ºè‡ªå·±ç»„ä¸‹çš„é¡¹ç›® å®é™…äº§ç”Ÿé‡åˆ°çš„é—®é¢˜å¯¹ç»å¤§å¤šæ•°ç®€å•çš„ç³»ç»Ÿæ¥è¯´ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªç³»ç»Ÿåªä¼šæœ‰ä¸€ä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²åªæœ‰ä¸€ä¸ªæ•°æ®æƒé™èŒƒå›´ï¼ˆå³ä½¿æœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼‰ã€‚ä½†æ˜¯éšç€äº§å“çš„åŠŸèƒ½è¿­ä»£ï¼Œç”¨æˆ·çš„å˜æ›´å’Œç³»ç»Ÿè®¾è®¡çš„åŸå› ï¼Œæ€»æœ‰ä¸€äº›ç‰¹æ®Šä¸”é‡è¦çš„ç”¨æˆ·åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­æ‹¥æœ‰å¤šä¸ªè§’è‰²ã€‚åœ¨å¤šè§’è‰²å’Œæ•°æ®æƒé™çš„ç»„åˆä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤æ•°çš„æ•°æ®æƒé™èŒƒå›´ã€‚ è€ƒè™‘åˆ°å®ç°å¤æ‚æ€§ï¼Œå¤§å¤šæ•°ç³»ç»Ÿé€‰æ‹©ä½¿ç”¨è§’è‰²åˆ‡æ¢çš„æ‰‹æ®µç®€åŒ–ç³»ç»Ÿå®ç°ï¼ŒåŒæ—¶å¯¹ç”¨æˆ·æš´éœ²å‡ºäº†ä»–ä»¬ä¸ç†Ÿæ‚‰çš„è§’è‰²è¿™ä¸€æ¦‚å¿µï¼Œé€ æˆè¿™äº›ç”¨æˆ·åœ¨ç³»ç»Ÿä½¿ç”¨ä¸­çš„å„ç§ä¸ä¾¿ã€‚ æœ¬æ–‡é‡ç‚¹è®¨è®ºåœ¨é¿å…è§’è‰²åˆ‡æ¢çš„å‰æä¸‹ï¼Œè¿›è¡Œå¤šè§’è‰²æ•°æ®èŒƒå›´æŸ¥è¯¢çš„ä¸€ç§æ€è·¯ã€‚ å…·ä½“éœ€è¦è§£å†³çš„éœ€æ±‚æˆ‘ä»¬çš„æ•°æ®æŠ¥è¡¨åå°ï¼Œä¸åŒçš„è§’è‰²æ‹¥æœ‰ä¸åŒçš„æ•°æ®æŸ¥çœ‹èŒƒå›´ï¼ˆä¸åŒè§’è‰²æ‰€èƒ½çœ‹åˆ°çš„å‘˜å·¥æ•°æ®å­—æ®µä¹Ÿå„ä¸ç›¸åŒï¼‰ï¼Œä¾‹å¦‚ï¼š è–ªé…¬ç®¡ç†å‘˜ï¼šæŸ¥çœ‹éé«˜èŒçº§å‘˜å·¥æ•°æ® é«˜çº§è–ªé…¬ç®¡ç†å‘˜ï¼š æŸ¥çœ‹é«˜èŒçº§å‘˜å·¥æ•°æ® é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ï¼šæŸ¥çœ‹æœ‰é•¿æœŸæ¿€åŠ±å‘˜å·¥æ•°æ® ç­‰ç­‰ ç®€å•æ¥è¯´ï¼Œæ‹¥æœ‰é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜å’Œé«˜çº§è–ªé…¬ç®¡ç†å‘˜çš„ç”¨æˆ·èƒ½å¦ç›´æ¥çœ‹åˆ°é«˜èŒçº§å‘˜å·¥æ•°æ®å’Œé•¿æœŸæ¿€åŠ±å‘˜å·¥æ•°æ®ï¼Ÿè‡³å°‘åœ¨ç›´è§‰ä¸Šæ˜¯å¯è¡Œçš„ã€‚ 2.å¤šè§’è‰²æ•°æ®èŒƒå›´æŸ¥è¯¢ç›´è§‰çš„åšæ³•å•è§’è‰²å•æ•°æ®èŒƒå›´å¯ä»¥ä½¿ç”¨ä¸€å¥sqlæŸ¥è¯¢å‡ºç»“æœï¼Œé‚£å¤šè§’è‰²å¤šæ•°æ®èŒƒå›´æ˜¯ä¸æ˜¯ä½¿ç”¨å¤šå¥sqlæŸ¥è¯¢å‡ºç»“æœåˆå¹¶å°±å¯ä»¥äº†ï¼Ÿ æ·±å…¥æ€è€ƒ å¤šè§’è‰²æ•°æ®èŒƒå›´å¯¹è¡Œçš„å½±å“ æŸ¥è¯¢æ¡ä»¶åˆå¹¶è¿˜æ˜¯ç»“æœåˆå¹¶ï¼Ÿ â€”-ç»“æœåˆå¹¶ å¦‚ä½•æ’åºï¼Ÿ â€”â€“å¤–éƒ¨æ’åºï¼Œæˆ–å…ˆå†…éƒ¨æ’åº,limit,å†å¤–éƒ¨æ’åº æœ‰é‡å¤æ•°æ®æ€ä¹ˆåŠï¼Ÿ â€”-ä½¿ç”¨groupbyå»é‡ æŸ¥è¯¢æ€§èƒ½æœ‰å½±å“å—ï¼Ÿâ€”-æœ‰ å…·ä½“ä½“ç°ï¼š 1234567select * from ((select id, sortvalue from table_1 where t_name = 'a' order by sortvalue desc limit 20) -- å…ˆå†…éƒ¨æ’åº,limitunion all -- ç»“æœåˆå¹¶(select id, sortvalue from table_1 where t_name = 'b' order by sortvalue desc limit 20) -- å…ˆå†…éƒ¨æ’åº,limitorder by sortvalue desc -- å¤–éƒ¨æ’åº) a group by id -- ä½¿ç”¨groupbyå»é‡limit 10, 10 æ·±å…¥æ€è€ƒ å¤šè§’è‰²æ•°æ®èŒƒå›´å¯¹åˆ—çš„å½±å“ è–ªé…¬ç®¡ç†å‘˜ï¼š æŸ¥çœ‹å‘˜å·¥è–ªé…¬å­—æ®µ é•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ï¼šæŸ¥çœ‹å‘˜å·¥é•¿æœŸæ¿€åŠ±å­—æ®µ å¦‚ä½•è§£å†³ï¼Ÿæ–¹æ³•æœ‰å¾ˆå¤šï¼ ç»¼åˆæ€è€ƒï¼Œç»™å‡ºä¸€ç§è§£å†³æ–¹æ¡ˆ123graph LR A(æŸ¥è¯¢è¡ŒåŠè§’è‰²ä¿¡æ¯) --&gt; B(æ ¹æ®è§’è‰²æŸ¥è¯¢å¯¹åº”åˆ—å­—æ®µ) B --&gt; C(ç»“æœ) æ­¥éª¤ï¼š æŸ¥è¯¢å¤šè§’è‰²æ•°æ®èŒƒå›´ä¸‹çš„æ•°æ®ï¼Œé™„å¸¦è§’è‰²ä¿¡æ¯ 1234567select id, GROUP_CONCAT(a.role) as roles from ((select id, 'role_a' as role from table_1 where sortvalue &gt; 10 order by `sortvalue` desc limit 2)union all(select id, 'role_b' as role from table_1 where sortvalue &gt; 20 order by `sortvalue` desc limit 2) order by `sortvalue` desc ) a group by idlimit 0, 2 ç»“æœï¼š id roles 1 è–ªé…¬ç®¡ç†å‘˜ 5 è–ªé…¬ç®¡ç†å‘˜ï¼Œé•¿æœŸæ¿€åŠ±ç®¡ç†å‘˜ æ ¹æ®æ¯ä¸€è¡Œä¸åŒçš„è§’è‰²ï¼ŒæŸ¥è¯¢å‡ºå¯è§çš„å­—æ®µï¼Œä¾‹å¦‚id=1çš„è¡Œåªèƒ½æŸ¥çœ‹ROLE_Bå¯¹åº”å­—æ®µï¼Œè€Œid=5çš„è¡Œå¯ä»¥çœ‹åˆ°ROLE_A,ROLE_Bå¯¹åº”çš„ä¸¤ä¸ªè§’è‰²çš„å­—æ®µ 3.æ€»ç»“å’Œå»¶ä¼¸å¤šè§’è‰²æ•°æ®èŒƒå›´å†™æ“ä½œï¼Ÿéå†è§’è‰²ç›´åˆ°æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æƒé™å³å¯ã€‚ æ”¶è·è‡ªå·±ä¸è¡ŒåŠ¨ï¼Œç­‰äºç­‰ç€è¢«åˆ«äººå®‰æ’å“ˆå“ˆ è¿˜æœ‰ç–‘é—®ï¼Ÿè‡ªå·±æƒ³ã€‚è¿˜å¯ä»¥ç‚¹è¿™é‡Œ","link":"/2018/2018-11-06-%E6%A0%B9%E6%8D%AE%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%81%BF%E5%85%8D%E8%A7%92%E8%89%B2%E5%88%87%E6%8D%A2%E7%9A%84%E4%B8%80%E7%A7%8D%E6%80%9D%E8%B7%AF/"},{"title":"å†è°ˆæœ€é•¿å…¬å…±å­ä¸²","text":"åºè¨€è¿™æ¬¡é‡åˆ°è´å£³èŠ±åçš„éœ€æ±‚ï¼Œéœ€è¦ä½¿ç”¨æœ€é•¿å…¬å…±å­ä¸²å¯¹èŠ±ååšæ ¡éªŒã€‚è¿™ç§ç®—æ³•åœ¨é¢è¯•é¢˜ä¸­ç®—æ˜¯å¿…ä¼šé¢˜ï¼Œå„ç§å››å±‚å¾ªç¯ï¼Œä¸‰å±‚å¾ªç¯ï¼Œä¸¤å±‚å¾ªç¯çš„ä»£ç åœ¨æˆ‘è„‘ä¸­é—ªè¿‡ï¼Œä½†æ˜¯ä»Šå¤©å°±æ˜¯è¦å¸¦ä½ å®ç°ä¸ä¸€æ ·çš„æœ€é•¿å…¬å…±å­ä¸²ï¼ æ•™ç§‘ä¹¦å¼å®ç°ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä¸¤å±‚å¾ªç¯ï¼Œä½¿ç”¨äºŒç»´æ•°ç»„å­˜å‚¨çŠ¶æ€ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2^)ï¼Œç©ºé—´å¤æ‚åº¦O(n^2^)æˆ–O(2n) ä¸€å¼ å›¾è§£é‡ŠåŸç†ï¼š 12345678910111213141516 å…ˆ æ¨ª å‘ å¤„ ç† +---------------------------&gt; e a b c b c f + +---+---+---+---+---+---+---+ | a | 0 | 1 | 0 | 0 | 0 | 0 | 0 |çºµ | +---------------------------+å‘ | b | 0 | 0 | 2 | 0 | 1 | 0 | 0 |ç´¯ | +---------------------------+åŠ  | c | 0 | 0 | 0 | 3 | 0 | 2 | 0 | | +---------------------------+ | d | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +---------------------------+ | e | 1 | 0 | 0 | 0 | 0 | 0 | 0 | v +---+---+---+---+---+---+---+ e a b c b c f ä¼˜åŒ–ç©ºé—´å¤æ‚åº¦è‡³O(1)ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œåœ¨çºµå‘ç´¯åŠ æ—¶å®é™…åªéœ€è¦å·¦ä¸Šæ–¹çš„è®¡æ•°å™¨å³å¯, O(n^2^)çš„ç©ºé—´ç™½ç™½è¢«æµªè´¹äº†,æœ€ä¼˜çš„ç©ºé—´å¤æ‚åº¦åº”è¯¥æ˜¯O(1)ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ ä¸€å¼ å›¾è§£é‡ŠåŸç†ï¼š e a b c b c f +---+ +---+---+---+---+---+---+---+ a | 0 | | 1 | 0 | 0 | 0 | 0 | 0 | a +-------+ +-----------------------+ b | 0 | 0 | | 2 | 0 | 1 | 0 | 0 | b +-----------+ --------------------+ c | 0 | 0 | 0 | | 3 | 0 | 2 | 0 | c +---------------+ ----------------+ d | 0 | 0 | 0 | 0 | | 0 | 0 | 0 | d +-------------------+ +-----------+ e | 1 | 0 | 0 | 0 | 0 | | 0 | 0 | e +---+---+---+---+---+-------+ +---+---+ e a b c b c fç­”æ¡ˆå°±æ˜¯æ²¿ç€ç­‰é•¿å¯¹ç€çº¿å¤„ç†ã€‚ æœ‰æ„æ€çš„ä»£ç æŠ½è±¡å¤§å®¶å¯ä»¥æ ¹æ®ä¸Šé¢æ€è·¯å†™ä¸€ä¸‹ï¼Œä¸€èˆ¬ä¼šæŠŠç®—æ³•åˆ†æˆä¸¤éƒ¨åˆ†ï¼šå¤„ç†é•¿æ–¹å½¢çš„å·¦ä¸‹éƒ¨åˆ†å’Œå¤„ç†é•¿æ–¹å½¢çš„å³ä¸Šéƒ¨åˆ†ï¼Œä¸¤éƒ¨åˆ†éƒ½æ˜¯åŒå±‚å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´è´Ÿè½½åº¦å·²ç»å˜ä¸ºäº†O(n^2^) ï¼ŒO(1)ã€‚ è‚¯å®šæœ‰äººå·²ç»å‘ç°è‡ªå·±çš„ä»£ç å¤„ç†å·¦ä¸‹è§’çš„ä»£ç å’Œå¤„ç†å³ä¸Šè§’çš„ä»£ç ä¸èƒ½å¤ç”¨ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å‘å·¦ä¸‹è§’å¤„ç†ï¼Œä¸€ä¸ªæ˜¯ä»ä¸­é—´å‘å³ä¸Šè§’å¤„ç†ï¼Œæ˜æ˜å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å°±æ˜¯æ²¡å‘åˆå¹¶ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•æŠŠè¿™ä¸¤éƒ¨åˆ†å¤„ç†æŠ½è±¡æˆå…¬å…±ä»£ç å‘¢ï¼Ÿä¸å–å…³å­äº†ï¼Œç›´æ¥ä¸Šå›¾ï¼š 12345678910111213141516 + e | +--+ e a b c b c f a | 1|+---+---+---+---+---+---+---+ +-----+ | 1 | 0 | 0 | 0 | 0 | 0 | a b | 0| 2| +-----------------------+ +--------+ | 2 | 0 | 1 | 0 | 0 | b c | 0| 0| 3| --------------------+ ç¿» æŠ˜ +-----------+ | 3 | 0 | 2 | 0 | c +------------&gt; b | 0| 1| 0| 0| ----------------+ +--------------+ | 0 | 0 | 0 | d c | 0| 0| 2| 0| 0| +-----------+ +--------------+ | 0 | 0 | e f | 0| 0| 0| 0| 0| +---+---+ +--------------+ a b c d e å¦‚æœä½ æƒ³ä½¿ç”¨å…¬å…±ä»£ç åŒæ—¶å®ç°å¤„ç†å·¦ä¸‹è§’å’Œå³ä¸Šè§’æ˜¯ä¸å¯èƒ½çš„äº†ã€‚æ‰€ä»¥ä½ éœ€è¦æŠŠå³ä¸Šè§’çš„ä¸‰è§’ç¿»æŠ˜ï¼Œç„¶åä½ å°±å¾—åˆ°äº†ä¸¤ä¸ªä¸‰è§’ï¼š 12345678910111213141516 + e | +--+ a | 1| +---+ +-----+a | 0 | b | 0| 2| +-------+ +--------+b | 0 | 0 | c | 0| 0| 3| +-----------+ +-----------+c | 0 | 0 | 0 | b | 0| 1| 0| 0| +---------------+ +--------------+d | 0 | 0 | 0 | 0 | c | 0| 0| 2| 0| 0| +-------------------+ +--------------+e | 1 | 0 | 0 | 0 | 0 | f | 0| 0| 0| 0| 0| +---+---+---+---+---+------ +--------------+ e a b c b c f a b c d e è¿™æ ·å°±å˜æˆäº†å¤„ç†ä¸¤éå·¦ä¸‹è§’äº†ï¼Œä»£ç ä¹Ÿå¯ä»¥å®Œç¾å¤ç”¨ï¼ï¼ï¼ æœ€ç»ˆå®ç°æˆ‘çš„å®Œæ•´æ€è€ƒè¿‡ç¨‹å·²ç»åˆ†æå®Œæ¯•ï¼Œè¿™æ ·æ²¿å¯¹ç€çº¿å¤„ç†è¿˜æœ‰ä¸€ä¸ªå°å°çš„ä¼˜ç‚¹ï¼šæå‰ç»“æŸæœç´¢ã€‚è¿™ä¸€ç‚¹å¤§å®¶å¯ä»¥è‡ªè¡Œæ€è€ƒï¼Œè¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šã€‚ ç›´æ¥å¹²è´§ä¸Šåœºï¼š 1234567891011121314151617181920212223242526272829public class Solution { /** * @param A: A string * @param B: A string * @return: the length of the longest common substring. */ public int longestCommonSubstring(String A, String B) { // write your code here char[] achars = A.toCharArray(), bchars = B.toCharArray(); return getMaxLength(bchars, achars, getMaxLength(achars, bchars, 0, 0), 1); } private static int getMaxLength(char[] s1, char[] s2, int maxLength, int startIndex) { for (int start = startIndex; start &lt; s1.length; start++) { int upper = Math.min(s2.length, s1.length - start); // if (upper &lt;= maxLength) break; //æå‰ç»“æŸæœç´¢ for (int currentLineLength = 0, x = 0, y = start; x &lt; upper; x++, y++) { if (s1[y] == s2[x]) maxLength = Math.max(maxLength, ++currentLineLength); else { // if (upper - x - 1 &lt;= maxLength) break; //æå‰ç»“æŸæœç´¢ currentLineLength = 0; }; } } return maxLength; }} ç»“å°¾æ€ä¹ˆæ ·ï¼Œç»å†è¿™æ¬¡ä¼˜åŒ–è¿‡ç¨‹æ˜¯å¦æ„Ÿè§‰è‡ªå·±å¯¹æœ€é•¿å…¬å…±å­ä¸²çš„è®¤è¯†åˆæ›´æ·±äº†ä¸€æ­¥å‘¢ï¼Ÿè™½ç„¶ä¸èƒ½ä¿è¯æ˜¯é¦–åˆ›ï¼ˆä¹Ÿå¯èƒ½æ˜¯é¦–åˆ›ï¼Ÿï¼‰ï¼Œä½†æ˜¯è¿™æ¬¡ä¸€æ­¥ä¸€æ­¥çœŸåˆ‡æ€è€ƒä¼˜åŒ–ç›´åˆ°è·å¾—æˆæœè®©æˆ‘æ— æ¯”å…´å¥‹ã€‚ è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘å°±æ˜¯è¦ç»™æˆ‘ä»¬è´å£³æ‹›è˜å¼€å‘ç»„æ‰“ä¸ªå¹¿å‘Š&gt;_&gt;ï¼ŒæœŸå¾…æ›´å¤šçˆ±æ€è€ƒä¼˜ç§€çš„åŒå­¦åŠ å…¥ï¼ ![](/Users/sage/Desktop/å±å¹•å¿«ç…§ 2018-11-10 13.33.20.png)","link":"/2018/2018-11-11-%E5%86%8D%E8%B0%88%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E4%B8%B2/"},{"title":"[æ„Ÿæ‚Ÿ] 2018æˆ‘çš„æ‰€è§æ‰€é—»æ‰€æ„Ÿ","text":"1. æˆ‘å°±å–œæ¬¢å†™ä»£ç è¡Œä¸è¡Œï¼Ÿå¦‚æœåˆšåˆšæŠ•å…¥å·¥ä½œï¼Œå·¥ä½œè¿˜æ— æ³•å®Œå…¨èƒœä»»ï¼Œé‚£æˆ‘çš„å»ºè®®æ˜¯å¤šå†™å†™ä»£ç ï¼Œæ‰“æ€ªå‡çº§å®Œæˆè‡ªå·±çš„å¹´åº¦ç»©æ•ˆã€‚ å¦‚æœå·²ç»èƒ½å¤Ÿèƒœä»»å½“å‰å·¥ä½œï¼Œä¸‹ä¸€æ­¥åº”è¯¥é›†ä¸­åœ¨ææ•ˆä¸Šã€‚è¿™ä¸€æ­¥å’Œä¹‹å‰è‡ªå·±ç§¯ç´¯çš„ç»éªŒå’ŒçŸ¥è¯†å¯†ä¸å¯åˆ†ï¼Œåªæœ‰çœŸæ­£äº†è§£ä»£ç æ‡‚ä»£ç ï¼Œæ‰èƒ½ä»åŒé¾„äººä¸­çš„â€œç†Ÿç»ƒå·¥â€è„±é¢–è€Œå‡ºï¼Œä¸¤è€…çš„ææ•ˆè™½ç„¶ç»“æœä¸€æ ·ï¼Œä½†æ˜¯æœ¬è´¨å´å®Œå…¨ä¸ä¸€æ ·ã€‚ å¦‚æœå·²ç»æ‘†è„±äº†ç†Ÿç»ƒå·¥çš„ç§°å·ï¼Œå®é™…ä¸Šå·²ç»å®Œæˆäº†è‡ªæˆ‘ææ•ˆï¼Œæå‰å®Œæˆè‡ªå·±çš„æœ¬èŒä»»åŠ¡ï¼Œä¸‹ä¸€æ­¥å¯ä»¥è®¡åˆ’æ¨åŠ¨å›¢é˜Ÿçš„æ•ˆç‡ã€‚ å¦‚æœå¤ªè¿‡ä¸“æ³¨æŠ€æœ¯ï¼Œä¸“å¿ƒè‡ªå·±çš„ä¸€äº©ä¸‰åˆ†ç”°ï¼Œç›¸å½“äºç»™è‡ªå·±è®¾é™æˆæ¯•ä¸šä¸¤ä¸‰å¹´çš„æ°´å¹³ã€‚è¿™ç§äººåº”è¯¥è¢«æ‰“ä¸Šä¸èƒœä»»çš„æ ‡ç­¾ï¼Œåœ¨å¯’å†¬ä¸­å¾ˆå®¹æ˜“è¢«ä¼˜åŒ–æ‰ã€‚ä¸“æ³¨æŠ€æœ¯è¿˜æœ‰ä¸€ä¸ªè¯¯åŒºï¼Œå°±æ˜¯å®¹æ˜“æŠŠâ€œå®æ–½ç»†èŠ‚â€å’Œâ€œæŠ€æœ¯â€ä¸¤è€…æ··æ·†ï¼Œç‰¹åˆ«åœ¨è½¯ä»¶è¡Œä¸šâ€œå®æ–½ç»†èŠ‚â€å¾ˆå®¹æ˜“éšæ—¶ä»£æ”¹å˜ï¼ŒåŸºæœ¬ä¸‰å¹´å°±ä¼šå¤§å˜æ ·ï¼Œè€Œâ€œæŠ€æœ¯â€ç±»ä¼¼äºâ€œçŸ¥è¯†â€ä¸ä¼šè¿‡æ—¶ã€‚çœ‹åˆ°è¿™é‡Œå¤§å®¶å¯ä»¥è‡ªå·±æ€è€ƒä¸‹ï¼Œè‡ªå·±å­¦åˆ°çš„åˆ°åº•æ˜¯â€œå®æ–½ç»†èŠ‚â€è¿˜æ˜¯çœŸæ­£çš„â€œæŠ€æœ¯â€ã€‚ 2.å¦‚ä½•æ¨åŠ¨å›¢é˜Ÿè¿›æ­¥æ­å–œä½ è·¨è¿‡äº†ç¬¬ä¸€é“åï¼Œæ¨åŠ¨å›¢é˜Ÿè¿›æ­¥ä¸æ˜¯ä¸€ä¸ªäººçš„äº‹ï¼Œä¸€èˆ¬æ¨åŠ¨å›¢é˜Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸ªäººå½±å“å›¢é˜Ÿï¼Œå›¢é˜Ÿè‡ªæˆ‘é©±åŠ¨ã€‚ ä¸ªäººå½±å“å›¢é˜Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠè‡ªæˆ‘ææ•ˆæ‰€ç§¯ç´¯çš„ç»éªŒå’ŒçŸ¥è¯†å…±äº«ç»™æ•´ä¸ªå›¢é˜Ÿï¼Œå®Œæˆçš„æ‰‹æ®µå¯ä»¥æ˜¯åšå®¢åˆ†äº«ï¼Œä¼šè®®åˆ†äº«ï¼Œæ–‡æ¡£åˆ†äº«ã€‚ å›¢é˜Ÿè‡ªæˆ‘é©±åŠ¨ï¼Œå®é™…ä¸Šæˆ‘æŠŠæ•´ä¸ªå›¢é˜Ÿæ‹Ÿä½œäº†ä¸€ä¸ªäººï¼Œä¸€ä¸ªäººæ‰¾å‡ºåˆ«äººçš„ç¼ºç‚¹å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æ‰¾å‡ºä¸€ä¸ªå›¢é˜Ÿçš„é—®é¢˜å´æ²¡é‚£ä¹ˆå®¹æ˜“ï¼ŒåŒæ—¶ä¹Ÿä¼šå—åˆ°å…¬å¸å’Œé¢†å¯¼çš„å±€é™ï¼Œæ¯”å¦‚ä¸€äº›é¡¹ç›®ç®¡ç†çš„é¢†å¯¼å°±æ˜¯äºŒä¼ æ‰‹ï¼Œåªå‚¬ä½ è¿›åº¦çš„é‚£ç§ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½ ä¸»åŠ¨æ‰¾ä»–è®¨è®ºã€‚ å¦‚ä½•æ‰¾åˆ°å›¢é˜Ÿçš„ç¼ºç‚¹ï¼Ÿå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå¤§ç±»çš„å¥—è·¯ï¼šç®¡ç†æ‰‹æ®µå’ŒæŠ€æœ¯æ‰‹æ®µã€‚ ç®¡ç†æ‰‹æ®µå¯ä»¥ä»çŸ¥è¯†ç®¡ç†ã€ä»£ç è§„èŒƒã€éœ€æ±‚åˆ†æä¸‰å¤„ç€æ‰‹ï¼š çŸ¥è¯†ç®¡ç†ï¼š å»ºç«‹çŸ¥è¯†åº“ï¼Œé¿å…é‡å¤çš„åŸ¹è®­ï¼Œé‡å¤çš„è§£ç­”é—®é¢˜ ä»£ç è§„èŒƒï¼šå€ŸåŠ©ä»£ç ç¼ºé™·æ£€æŸ¥å·¥å…·ï¼Œå…·ä½“åˆ°è´Ÿè´£äººæå‡ä»£ç è§„èŒƒ éœ€æ±‚åˆ†æï¼šé¿å…ä½æ•ˆï¼Œæ— æ•ˆä¼šè®®ï¼Œé¿å…å„ç§å¦¥åä¸‹äº§ç”Ÿçš„éœ€æ±‚ æŠ€æœ¯æ‰‹æ®µæ¯”è¾ƒç®€å•ï¼š é‡æ„å‡çº§ï¼šå¼ƒç”¨è€çš„æ¶æ„ï¼Œæ‹¥æŠ±æ–°æŠ€æœ¯ï¼Œå¸¦é¢†å›¢é˜Ÿæå‡æŠ€æœ¯ å†…éƒ¨é€ è½®å­ï¼šå†…éƒ¨å®šåˆ¶å·¥å…·ï¼Œå¸®åŠ©å›¢é˜Ÿé«˜æ•ˆå®Œæˆä»»åŠ¡ æ‰¾åˆ°äº†å›¢é˜Ÿçš„ç¼ºç‚¹æ¥ä¸‹æ¥å¯ä»¥åˆ¶å®šåº¦é‡ï¼Œè¡¡é‡å›¢é˜Ÿçš„æ¨è¿›ç¨‹åº¦ï¼Œå¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œåº¦é‡ï¼š è·Ÿè‡ªå·±æ¯”è¾ƒï¼šæ¯”å¦‚è¿™æ¬¡åšéœ€æ±‚ææµ‹bugæ•°å‡å°‘ï¼Œéœ€æ±‚delayå°‘äº†ï¼Œæ»¡è¶³éœ€æ±‚ä¸éœ€è¦ä¸Šçº¿åªè¦é…ç½®ä¸Šçº¿ï¼Œç­‰ç­‰ å’Œåˆ«çš„å›¢é˜Ÿæ¯”è¾ƒï¼šè¿™ä¸ªæ¯”è¾ƒå‡¶æ®‹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ç”¨ä»€ä¹ˆåº¦é‡æ¯”ï¼Œä½†æ˜¯æœ‰çš„å¤§å…¬å¸å°±æ˜¯è¿™æ ·åšçš„ã€‚ 3.æ€»ç»“ä¸æ™‹å‡ä»å‘ç°ç¼ºç‚¹åˆ°æœ€åå¾—åˆ°æˆæœå®Œæˆå›¢é˜Ÿæ¨è¿›ç›®æ ‡ï¼Œæ˜¯æ—¶å€™å†™ä¸ªpptåœ¨é¢†å¯¼é¢å‰å¹ä¸€æ³¢äº†ï¼Œè¿™ä¸ªå°±ä¸ç”¨æˆ‘æ•™äº†ã€‚","link":"/2018/2018-12-21-2018%E6%88%91%E7%9A%84%E6%89%80%E8%A7%81%E6%89%80%E9%97%BB%E6%89%80%E6%84%9F/"},{"title":"ä»£ç å¤–çš„ç”Ÿå­˜ä¹‹é“-è¯»ä¹¦ç¬”è®°-èŒä¸šç¯‡","text":"èŒä¸šå‘å±•çš„é©±åŠ¨åŠ›åº”è¯¥æ¥è‡ªè‡ªèº«ï¼Œå·¥ä½œå±äºå…¬å¸ï¼ŒèŒä¸šç”Ÿæ¶¯å±äºè‡ªå·±ã€‚ ç¬¬ä¸€è¦åŠ¡ æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€å¤§å¤šæ•°äººå½¢æˆçš„é”™è¯¯çš„å¿ƒæ€: è®¤ä¸ºåœ¨ä¸ºå…¬å¸æ‰“å·¥ï¼Œæ²¡æœ‰æŠŠè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å½“ä½œç”Ÿæ„æ¥çœ‹å¾…ã€‚é“­è®°åœ¨å¿ƒï¼Œå¼€å§‹ç§¯æä¸»åŠ¨çš„ç®¡ç†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å§ã€‚ åƒä¼ä¸šä¸€æ ·æ€è€ƒè‡ªå·±èƒ½æä¾›ä»€ä¹ˆ:è‡ªå·±çš„èƒ½åŠ›å°±æ˜¯åˆ›é€ è½¯ä»¶è‡ªå·±éœ€è¦åšä»€ä¹ˆ: æŒç»­ä¸æ–­åœ°æ”¹è¿›å’Œå®Œå–„è‡ªå·±çš„äº§å“ ä¼ è¾¾è‡ªå·±çš„ä»·å€¼ï¼Œå’Œåƒä¸‡åŒè¡Œçš„ç‹¬ç‰¹ä¹‹å¤„ ä¸€å¤´æ‰è¿›å·¥ä½œä¸å¯èƒ½éåŒå‡¡å“ï¼Œä½ åº”è¯¥ï¼š ä¸“æ³¨äºä½ æ­£åœ¨æä¾›æ€æ ·çš„æœåŠ¡ï¼Œ ä»¥åŠå¦‚ä½•è¥é”€è¿™é¡¹æœåŠ¡ï¼› æƒ³æ–¹è®¾ æå‡ä½ çš„æœåŠ¡ï¼› æ€è€ƒä½ å¯ä»¥ä¸“æ³¨ä¸ºå“ªä¸€ ç‰¹å®šç±»å‹çš„å®¢æˆ·æˆ–è¡Œä¸šæä¾›ç‰¹å®šçš„æœåŠ¡ï¼› é›†ä¸­ç²¾åŠ›æˆä¸ºä¸€ä½ä¸“å®¶ï¼Œä¸“é—¨ä¸ºæŸä¸€ç‰¹å®šç±»å‹çš„å®¢æˆ·æä¾›ä¸“ä¸šçš„æ•´ä½“æœåŠ¡ï¼ˆ è®°ä½ï¼Œ ä½œä¸ºä¸€ä¸ªè½¯ä»¶å¼€å‘ äººå‘˜ï¼Œ ä½  åªæœ‰çœŸæ­£ä¸“æ³¨ äºä¸€ç±»å®¢æˆ·ï¼Œæ‰èƒ½æ‰¾åˆ°éå¸¸å¥½çš„å·¥ä½œï¼‰ã€‚ æ›´å¥½çš„å®£ä¼ è‡ªå·±çš„äº§å“ï¼Œæ›´å¥½çš„æ‰¾åˆ°ä½ çš„å®¢æˆ· ç¬¬äºŒè¦åŠ¡ è®¾å®šè‡ªå·±çš„ç›®æ ‡æ— è®ºå› ä¸ºä½•ç§åŸå› ä½ æ²¡æœ‰ä¸ºè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯è®¾å®šç›®æ ‡ï¼Œ ç°åœ¨éƒ½æ˜¯æ—¶å€™è®¾å®šç›®æ ‡äº†ã€‚ ä¸æ˜¯æ˜å¤©ï¼Œ ä¹Ÿä¸æ˜¯ä¸‹å‘¨ï¼Œ å°±æ˜¯ç°åœ¨ã€‚ æ²¡æœ‰æ˜ç¡®çš„æ–¹å‘ï¼Œ ä½ èµ°çš„æ¯ä¸€æ­¥éƒ½æ˜¯å¾’åŠ³çš„ã€‚ å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿå…ˆåœ¨å¿ƒä¸­æ ‘ç«‹ä¸€ä¸ªå¤§ç›®æ ‡ï¼Œç„¶ååˆ†è§£æˆå¤šä¸ªå°ç›®æ ‡ è¿½è¸ªä½ çš„ç›®æ ‡å®šæœŸæ ¸å¯¹è‡ªå·±çš„ç›®æ ‡ï¼Œå¿…è¦æ—¶è¿˜è¦è°ƒæ•´ã€‚ äººé™…äº¤å¾€èƒ½åŠ›","link":"/2018/2018-12-27-%E4%BB%A3%E7%A0%81%E5%A4%96%E7%9A%84%E7%94%9F%E5%AD%98%E4%B9%8B%E9%81%93-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E8%81%8C%E4%B8%9A%E7%AF%87/"},{"title":"æ„å»ºå¤§å‹æ”¯ä»˜ç³»ç»Ÿæ—¶åˆ†å¸ƒå¼æ¶æ„çš„å…³é”®ç‚¹","text":"SLAåœ¨æ„å»ºå¤§å‹ç³»ç»Ÿæ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°å„ç§é”™è¯¯ã€‚åœ¨è®¡åˆ’æ„å»ºä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œå®šä¹‰ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ååˆ†é‡è¦ã€‚ â€œå¥åº·çŠ¶æ€â€å¿…é¡»æ˜¯å¯åº¦é‡çš„ï¼Œä¸€èˆ¬åšæ³•æ˜¯ä½¿ç”¨SLAsæ¥åº¦é‡ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ã€‚æœ€å¸¸è§çš„SLAä¸º å¯è¾¾æ€§ ä»æ—¶é—´ç»´åº¦è¡¡é‡ï¼ˆ99.999%å¯è¾¾æ€§ï¼Œæ¯å¹´ä¸‹çº¿50åˆ†é’Ÿï¼‰ å‡†ç¡®æ€§ å¯¹äºæ•°æ®çš„ä¸¢å¤±æˆ–å¤±çœŸæ˜¯å¦å¯ä»¥æ¥å—ï¼Ÿå¯ä»¥è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”ï¼Ÿå¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œä¸æ¥å—ä»»ä½•æ•°æ®çš„ä¸¢å¤±å’Œå¤±çœŸ å®¹é‡ ç³»ç»Ÿæ”¯æŒå¹¶å‘ å»¶è¿Ÿ å“åº”å»¶è¿Ÿï¼Œä¸€èˆ¬è¡¡é‡95%è¯·æ±‚çš„å“åº”æ—¶é—´å’Œ99%è¯·æ±‚å“åº”æ—¶é—´ ç¡®ä¿æ–°ç³»ç»Ÿæ¯”è¢«æ›¿ä»£ç³»ç»Ÿâ€œæ›´å¥½â€ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢å››ä¸ªSLAæŒ‡æ ‡æ¥è¡¡é‡ï¼Œå¯è¾¾æ€§æ˜¯æœ€é‡è¦çš„éœ€æ±‚ã€‚ æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©éšç€æ–°ä¸šåŠ¡çš„å¢é•¿ï¼Œè´Ÿè½½ä¹Ÿä¼šå¢åŠ ã€‚æœ€å¸¸è§çš„ä¼¸ç¼©ç­–ç•¥æ˜¯å‚ç›´å’Œæ°´å¹³ä¼¸ç¼©ã€‚ æ°´å¹³ä¼¸ç¼©å°±æ˜¯å¢åŠ æ›´å¤šçš„æœºå™¨æˆ–èŠ‚ç‚¹ï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´æ°´å¹³ä¼¸ç¼©æ˜¯æœ€å¸¸æœ‰çš„æ–¹å¼ã€‚ å‚ç›´ä¼¸ç¼©åŸºæœ¬ä¸Šå°±æ˜¯ä¹°æ›´å¤§/å¥½çš„æœºå™¨ã€‚ ä¸€è‡´æ€§å¯è¾¾æ€§å¯¹äºä»»ä½•ç³»ç»Ÿéƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œä½†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸€èˆ¬éƒ½æ„å»ºåœ¨ä½å¯è¾¾æ€§çš„æœºå™¨ä¸Šï¼ˆæ¯”å¦‚ï¼šæœåŠ¡çš„å¯è¾¾æ€§è¦æ±‚99.999% æœºå™¨çš„å¯è¾¾æ€§ä¸º99.9%ï¼‰ã€‚ç®€å•çš„åšæ³•æ˜¯ç»´æŠ¤ä¸€ç»„æœºå™¨ç»„æˆé›†ç¾¤ï¼Œè¿™æ ·æœåŠ¡çš„å¯è¾¾æ€§ä¸ä¾èµ–å•ç‹¬çš„æœºå™¨ã€‚ ä¸€è‡´æ€§æ˜¯åœ¨é«˜å¯ç”¨ç³»ç»Ÿä¸­æœ€éœ€è¦å…³å¿ƒçš„ã€‚ä¸€ä¸ªä¸€è‡´æ€§ç³»ç»Ÿåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šçœ‹åˆ°å’Œè¿”å›çš„æ•°æ®åœ¨åŒä¸€æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚å¦‚æœä½¿ç”¨ä¸€ç»„æœºå™¨æ¥ç»„æˆé›†ç¾¤ï¼Œå®ƒä»¬è¿˜éœ€è¦äº’ç›¸å‘é€æ¶ˆæ¯æ¥ä¿æŒåŒæ­¥ï¼Œä½†æ˜¯å‘é€æ¶ˆæ¯å¯èƒ½å¤±è´¥ï¼Œè¿™æ ·ä¸€äº›èŠ‚ç‚¹å°±ä¼šå› ä¸ºä¸ä¸€è‡´è€Œä¸å¯è¾¾ã€‚ ä¸€è‡´æ€§æœ‰å¤šä¸ªæ¨¡å‹ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¸¸ç”¨çš„æ˜¯å¼ºä¸€è‡´æ€§ï¼Œå¼±ä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€è‡´æ€§è¦æ±‚è¶Šä½ï¼Œç³»ç»Ÿå¯ä»¥å·¥ä½œçš„æ›´å¿«ï¼Œä½†æ˜¯è¿”å›çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚ ç³»ç»Ÿä¸­çš„æ•°æ®éœ€è¦æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯åˆ°åº•æ˜¯æ€æ ·çš„ä¸€è‡´ï¼Ÿå¯¹äºä¸€äº›ç³»ç»Ÿï¼Œéœ€è¦å¼ºä¸€è‡´æ€§ï¼Œæ¯”å¦‚ä¸€æ¬¡æ”¯ä»˜å¿…é¡»æ˜¯å¼ºä¸€è‡´çš„å­˜å‚¨ä¸‹æ¥ã€‚å¯¹äºæ²¡é‚£ä¹ˆé‡è¦çš„éƒ¨åˆ†ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¯ä»¥è€ƒè™‘çš„æƒè¡¡ã€‚æ¯”å¦‚åˆ—å‡ºæœ€è¿‘çš„äº¤æ˜“ã€‚ æ•°æ®æŒä¹…æ€§æŒä¹…æ€§è¡¨ç¤ºä¸€æ—¦æ•°æ®æˆåŠŸæ·»åŠ åˆ°æ•°æ®å­˜å‚¨ï¼Œå®ƒå°±æ°¸è¿œå¯ä»¥è®¿é—®åˆ°ã€‚ä¸åŒçš„åˆ†å¸ƒå¼æ•°æ®åº“æ‹¥æœ‰ä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ä¸€èˆ¬ä½¿ç”¨å‰¯æœ¬æ¥å¢åŠ æ•°æ®æŒä¹…æ€§ã€‚ å¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œæ•°æ®ä¸å…è®¸ä¸¢å¤±ã€‚æˆ‘ä»¬æ„å»ºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨éœ€è¦æ”¯æŒé›†ç¾¤çº§åˆ«çš„æ•°æ®æŒä¹…å‹ã€‚ç›®å‰Cassandra, MongoDB, HDFSå’ŒDynamodb éƒ½æ”¯æŒå¤šç§çº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ‰§è¡Œè®¡ç®—ï¼Œå­˜å‚¨æ•°æ®ï¼Œäº’ç›¸å‘é€æ¶ˆæ¯ã€‚å‘é€æ¶ˆæ¯çš„å…³é”®æ˜¯æ¶ˆæ¯çš„å¯é åˆ°è¾¾ã€‚å¯¹äºå…³é”®ç³»ç»Ÿï¼Œç»å¸¸éœ€è¦æ¶ˆæ¯é›¶ä¸¢å¤±ã€‚ å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå‘é€æ¶ˆæ¯ä¸€èˆ¬çŸ³æ²¹åˆ†å¸ƒå¼æ¶ˆæ¯æœåŠ¡å‘é€ï¼Œå¦‚RabbitMQï¼ŒKafkaã€‚è¿™äº›æ¶ˆæ¯æœåŠ¡æ”¯æŒä¸åŒçº§åˆ«çš„æ¶ˆæ¯æŠ•é€’å¯é æ€§ã€‚ æ¶ˆæ¯ä¿æŒè¡¨ç¤ºå½“èŠ‚ç‚¹å¤„ç†æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œåœ¨é”™è¯¯è¢«è§£å†³å‰æ¶ˆæ¯ä¸€ç›´è¢«ä¿æŒç€ã€‚æ¶ˆæ¯çš„æŒä¹…æ€§ä¸€èˆ¬åœ¨æ¶ˆæ¯é˜Ÿåˆ—å±‚è¢«ä½¿ç”¨ã€‚å¦‚æœåœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™é˜Ÿåˆ—æˆ–èŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œé‚£åœ¨å®ƒä»¬é‡æ–°ä¸Šçº¿æ˜¯è¿˜èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚ åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­æˆ‘ä»¬éœ€è¦æ¯ä¸€æ¡æ¶ˆæ¯æŠ•é€’ä¸€æ¬¡ï¼Œåœ¨æ„å»ºç³»ç»Ÿä¸­ä¿è¯æŠ•é€’ä¸€æ¬¡å’ŒæŠ•é€’è‡³å°‘ä¸€æ¬¡åœ¨å®ç°ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚æœ€åæˆ‘ä»¬ä½¿ç”¨äº†kafkaæ¥ä¿è¯æŠ•é€’è‡³å°‘ä¸€æ¬¡ã€‚ å¹‚ç­‰æ€§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½å¯èƒ½å‡ºé”™ï¼Œè¿æ¥ä¼šä¸¢åŒ…æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯ç»å¸¸ä¼šé‡è¯•è¿™äº›è¯·æ±‚ã€‚ä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿä¿è¯æ— è®ºå¤šå°‘ç‰¹å®šçš„è¯·æ±‚è¢«æ‰§è¡Œï¼Œä¸€ä¸ªè¯·æ±‚å®é™…çš„æ“ä½œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚æ”¯ä»˜è¯·æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ”¯ä»˜å¹¶ä¸”è¯·æ±‚å·²ç»æˆåŠŸï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¶…æ—¶äº†ï¼Œå®¢æˆ·ç«¯æ˜¯èƒ½å¤Ÿé‡è¯•ç›¸åŒçš„è¯·æ±‚çš„ã€‚å¯¹äºä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿï¼Œä¸€ä¸ªä¸ªäººçš„æ”¯ä»˜æ˜¯ä¸èƒ½è¢«æ”¶å–ä¸¤æ¬¡çš„ã€‚ å¯¹å¹‚ç­‰çš„è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦æŸç§åˆ†å¸ƒå¼é”æœºåˆ¶ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¹è§‚é”æ¥å®ç°å¹‚ç­‰æ€§ï¼Œè¿™æ—¶ç³»ç»Ÿéœ€è¦å¼ºä¸€è‡´æ€§çš„é”æ¥æ‰§è¡Œæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç‰ˆæœ¬çš„ä¹è§‚é”æ¥æ£€æŸ¥æ˜¯å¦æœ‰å¯åŠ¨äº†é¢å¤–çš„æ“ä½œã€‚ æ ¹æ®ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œæ“ä½œçš„ç±»å‹ï¼Œæœ‰å¾ˆå¤šæ–¹å¼æ¥å®ç°å¹‚ç­‰æ€§ã€‚åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œå¹‚ç­‰æ€§æ—¶æœ€å®¹æ˜“å¿½ç•¥çš„ã€‚åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œå¹‚ç­‰æ“ä½œæ—¶æœ€é‡è¦çš„ï¼Œå®ƒé¿å…äº†åŒèŠ±å’ŒåŒæ”¶é—®é¢˜ã€‚æ¶ˆæ¯ç³»ç»Ÿå·²ç»ä¿è¯äº†æ¶ˆæ¯è‡³å°‘æ¶ˆè´¹ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯æ‰€æœ‰é‡å¤çš„æ¶ˆæ¯ä¿è¯å¹‚ç­‰æ€§å³å¯ã€‚æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ä¹è§‚é”ï¼Œå¹¶ä½¿ç”¨å¼ºä¸€è‡´æ€§å­˜å‚¨ä½œä¸ºä¹è§‚é”çš„æ•°æ®æºã€‚ åˆ†ç‰‡å’Œæ³•å®šäººæ•°åˆ†å¸ƒå¼ç³»ç»Ÿç»å¸¸éœ€è¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œè¿œè¶…ä¸€å°èŠ‚ç‚¹çš„å®¹é‡ã€‚ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆæ—¶ä½¿ç”¨åˆ†ç‰‡ï¼Œæ•°æ®ä½¿ç”¨æŸç§hashç®—æ³•è¢«æ°´å¹³åˆ†åŒºã€‚å°½ç®¡å¾ˆå¤šåˆ†å¸ƒå¼æ•°æ®åº“å±è”½äº†åˆ†ç‰‡çš„å®ç°ï¼Œä½†æ˜¯åˆ†ç‰‡è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œç‰¹åˆ«æ˜¯å…³äºé‡æ–°åˆ†ç‰‡ã€‚ è®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šä¸ªæ‹¥æœ‰æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ã€‚ä¸ºä¿è¯å¯¹æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ï¼Œä½¿ç”¨åŸºäºæŠ•ç¥¨çš„æ–¹å¼æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰è¶…è¿‡ä¸€å®šæ•°é‡çš„èŠ‚ç‚¹æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªæ“ä½œæ‰æ˜¯æˆåŠŸçš„ï¼Œè¿™ä¸ªå«åšæ³•å®šäººæ•°ã€‚ Actoræ¨¡å‹æè¿°åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æ™®éçš„åšæ³•æ˜¯ä½¿ç”¨Actoræ¨¡å‹ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯CSPã€‚ Actoræ¨¡å‹åŸºäºactoräº’ç›¸å‘é€æ¶ˆæ¯å¹¶ä½œå‡ºå›åº”ã€‚æ¯ä¸€ä¸ªactoråªèƒ½åšå°‘é‡çš„åŠ¨ä½œï¼Œåˆ›å»ºå…¶ä»–actors, å‘é€æ¶ˆæ¯æˆ–è€…å†³å®šå¦‚ä½•å¤„ç†ä¸‹ä¸ªæ¶ˆæ¯ã€‚é€šè¿‡è¿™äº›ç®€å•çš„è§„åˆ™ï¼Œå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥è¢«å‡†ç¡®æè¿°ï¼Œå¯ä»¥åœ¨actorå´©æºƒåè‡ªæˆ‘ä¿®å¤ã€‚ ä½¿ç”¨akkaæä¾›äº†æ ‡å‡†çš„åˆ†å¸ƒå¼æ¨¡å‹ï¼Œé¿å…æˆ‘ä»¬é‡å¤é€ è½®å­ã€‚ ååº”å¼æ¶æ„å½“æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œç›®æ ‡å¸¸å¸¸æ˜¯å®ƒä»¬çš„å¼¹æ€§ï¼Œä¼¸ç¼©æ€§ï¼Œå’Œæ‰©å±•æ€§ã€‚ååº”å¼æ¶æ„æ˜¯åœ¨è¿™ä¸ªé¢†åŸŸæœ€æµè¡Œå’Œæœ€é€šç”¨çš„æ–¹æ¡ˆã€‚","link":"/2018/2018-11-19-%E6%9E%84%E5%BB%BA%E5%A4%A7%E5%9E%8B%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E5%85%B3%E9%94%AE%E7%82%B9/"},{"title":"[ç‰‡æ®µ] Javaæ”¶é›†æ–¹æ³•å‚æ•°+Spring DataBinder","text":"æ”¶é›†å‚æ•°ç›®å‰æ˜¯ä½¿ç”¨äº†spring aop æ¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼ŒæŠŠæ–¹æ³•å‚æ•°åŒ…è£…æˆMapå½¢å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CollectArguments {}@Aspectpublic class ArgumentsCollector { private static final ThreadLocal&lt;Map&lt;String, Object&gt;&gt; ARGUMENTS = ThreadLocal.withInitial(ImmutableMap::of); static Map&lt;String, Object&gt; getArgs() { return ARGUMENTS.get(); } private Object[] args(Object[] args, int exceptLength) { if (exceptLength == args.length) { return args; } return Arrays.copyOf(args, exceptLength); } @Pointcut(\"@annotation(CollectArguments)\") void collectArgumentsAnnotationPointCut() { } @Before(\"collectArgumentsAnnotationPointCut()\") public void doAccessCheck(JoinPoint joinPoint) { final String[] parameterNames = ((MethodSignature) joinPoint.getSignature()).getParameterNames(); final Object[] args = args(joinPoint.getArgs(), parameterNames.length); ARGUMENTS.set(Collections.unmodifiableMap((IntStream.range(0, parameterNames.length - 1) .mapToObj(idx -&gt; Tuple2.of(parameterNames[idx], args[idx])) .collect(HashMap::new, (m, t) -&gt; m.put(t.getT1(), t.getT2()), HashMap::putAll)))); } @After(\"collectArgumentsAnnotationPointCut()\") public void remove() { ARGUMENTS.remove(); } @Data private static class Tuple2&lt;T1, T2&gt; { private T1 t1; private T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } public static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); } }} é€šè¿‡Mapæ„é€ å¯¹è±¡123456789101112public class BinderUtil { BinderUtil() { } @SuppressWarnings(\"unchecked\") public static &lt;T&gt; T getTarget(Class&lt;T&gt; beanClazz) { final DataBinder binder = new DataBinder(BeanUtils.instantiate(beanClazz)); binder.bind(new MutablePropertyValues(ArgumentsCollector.getArgs())); return (T) binder.getTarget(); }}","link":"/2019/2019-01-22-Java%E6%94%B6%E9%9B%86%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0+Spring_DataBinder/"},{"title":"[ç‰‡æ®µ] @CreatedBy &#x2F; @ModifiedBy æ‹¦æˆªå™¨å®ç°","text":"æ‹¦æˆªå™¨å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package app.pooi.common.entity;import app.pooi.common.entity.anno.CreatedBy;import app.pooi.common.entity.anno.ModifiedBy;import lombok.Data;import org.apache.ibatis.executor.Executor;import org.apache.ibatis.mapping.MappedStatement;import org.apache.ibatis.plugin.Intercepts;import org.apache.ibatis.plugin.Invocation;import org.apache.ibatis.plugin.Plugin;import org.apache.ibatis.plugin.Signature;import java.util.Arrays;import java.util.Properties;import java.util.function.Supplier;@Data@Intercepts({ @Signature(type = Executor.class, method = \"update\", args = {MappedStatement.class, Object.class}),})public class EntityInterceptor implements org.apache.ibatis.plugin.Interceptor { private Supplier&lt;Long&gt; auditorAware; @Override public Object intercept(Invocation invocation) throws Throwable { Executor executor = (Executor) invocation.getTarget(); MappedStatement ms = (MappedStatement) invocation.getArgs()[0]; Object o = invocation.getArgs()[1]; Arrays.stream(o.getClass().getDeclaredFields()) .forEach(field -&gt; { final CreatedBy createdBy = field.getAnnotation(CreatedBy.class); final ModifiedBy modifiedBy = field.getAnnotation(ModifiedBy.class); if (createdBy != null || modifiedBy != null) { field.setAccessible(true); try { field.set(o, auditorAware.get()); } catch (IllegalAccessException ignore) { } } }); return invocation.proceed(); } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }} é…ç½®ï¼š 1234567891011121314@Configurationstatic class MybatisInterceptorConfig { @Bean public Interceptor[] configurationCustomizer(CipherSpi cipherSpi) { final EntityInterceptor entityInterceptor = new EntityInterceptor(); entityInterceptor.setAuditorAware(() -&gt; { final String header = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getHeader(XHeaders.LOGIN_USER_ID); return Long.valueOf(header); }); return new Interceptor[]{new DecryptInterceptor(cipherSpi), entityInterceptor}; }}","link":"/2019/2019-02-11-@CreatedBy%20_@ModifiedBy_%E6%8B%A6%E6%88%AA%E5%99%A8%E5%AE%9E%E7%8E%B0/"},{"title":"[ç‰‡æ®µ] Mybatis ResultSetHandlerå®è·µ","text":"è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å‘ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Overridepublic List&lt;Object&gt; handleResultSets(Statement stmt) throws SQLException { ErrorContext.instance().activity(\"handling results\").object(mappedStatement.getId()); final List&lt;Object&gt; multipleResults = new ArrayList&lt;Object&gt;(); int resultSetCount = 0; ResultSetWrapper rsw = getFirstResultSet(stmt); List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps(); int resultMapCount = resultMaps.size(); validateResultMapsCount(rsw, resultMapCount); while (rsw != null &amp;&amp; resultMapCount &gt; resultSetCount) { ResultMap resultMap = resultMaps.get(resultSetCount); handleResultSet(rsw, resultMap, multipleResults, null); rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } String[] resultSets = mappedStatement.getResultSets(); if (resultSets != null) { while (rsw != null &amp;&amp; resultSetCount &lt; resultSets.length) { ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]); if (parentMapping != null) { String nestedResultMapId = parentMapping.getNestedResultMapId(); ResultMap resultMap = configuration.getResultMap(nestedResultMapId); handleResultSet(rsw, resultMap, null, parentMapping); } rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } } return collapseSingleResultList(multipleResults);} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123package app.pooi.common.encrypt;import app.pooi.common.encrypt.anno.CipherSpi;import app.pooi.common.encrypt.anno.Encrypted;import lombok.Getter;import org.apache.ibatis.executor.resultset.ResultSetHandler;import org.apache.ibatis.plugin.*;import org.apache.ibatis.reflection.MetaObject;import org.apache.ibatis.reflection.SystemMetaObject;import java.lang.reflect.Field;import java.sql.Statement;import java.util.*;import java.util.function.Function;import java.util.logging.Logger;import java.util.stream.Collectors;@Intercepts({ @Signature(type = ResultSetHandler.class, method = \"handleResultSets\", args = {Statement.class}),})public class EncryptInterceptor implements Interceptor { private static final Logger logger = Logger.getLogger(EncryptInterceptor.class.getName()); private CipherSpi cipherSpi; public EncryptInterceptor(CipherSpi cipherSpi) { this.cipherSpi = cipherSpi; } @Override public Object intercept(Invocation invocation) throws Throwable { final Object proceed = invocation.proceed(); if (proceed == null) { return proceed; } List&lt;?&gt; results = (List&lt;?&gt;) proceed; if (results.isEmpty()) { return proceed; } final Object first = results.iterator().next(); final Class&lt;?&gt; modelClazz = first.getClass(); final List&lt;String&gt; fieldsNeedDecrypt = Arrays.stream(modelClazz.getDeclaredFields()) .filter(f -&gt; f.getAnnotation(Encrypted.class) != null) .filter(f -&gt; { boolean isString = f.getType() == String.class; if (!isString) { logger.warning(f.getName() + \"is not String, actual type is \" + f.getType().getSimpleName() + \" ignored\"); } return isString; }) .map(Field::getName) .collect(Collectors.toList()); final List&lt;List&lt;String&gt;&gt; partition = partition(fieldsNeedDecrypt, 20); for (Object r : results) { final MetaObject metaObject = SystemMetaObject.forObject(r); for (List&lt;String&gt; fields : partition) { final Map&lt;String, String&gt; fieldValueMap = fields.stream().collect(Collectors.toMap(Function.identity(), f -&gt; (String) metaObject.getValue(f))); final ArrayList&lt;String&gt; values = new ArrayList&lt;&gt;(fieldValueMap.values()); Map&lt;String, String&gt; decryptValues = cipherSpi.decrypt(values); fieldValueMap.entrySet() .stream() .map(e -&gt; Tuple2.of(e.getKey(), decryptValues.getOrDefault(e.getValue(), \"\"))) .forEach(e -&gt; metaObject.setValue(e.getT1(), e.getT2())); } } return results; } private &lt;T&gt; List&lt;List&lt;T&gt;&gt; partition(List&lt;T&gt; list, int batchCount) { if (!(batchCount &gt; 0)) { throw new IllegalArgumentException(\"batch count must greater than zero\"); } List&lt;List&lt;T&gt;&gt; partitionList = new ArrayList&lt;&gt;(list.size() / (batchCount + 1)); for (int i = 0; i &lt; list.size(); i += batchCount) { partitionList.add(list.stream().skip(i).limit(batchCount).collect(Collectors.toList())); } return partitionList; } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }}@Getterclass Tuple2&lt;T1, T2&gt; { private final T1 t1; private final T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); }}","link":"/2019/2019-01-09-Mybatis_ResultSetHandler%E5%AE%9E%E8%B7%B5/"},{"title":"[ç‰‡æ®µ] SpringBoot Mybatisé…ç½®","text":"çº¯è®°å½•ï¼Œä¾›è‡ªå·±å‚è€ƒğŸ¤£ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140private final MybatisProperties properties;private final Interceptor[] interceptors;private final ResourceLoader resourceLoader;private final DatabaseIdProvider databaseIdProvider;private final List&lt;ConfigurationCustomizer&gt; configurationCustomizers;public DataSourceConfig(MybatisProperties properties, ObjectProvider&lt;Interceptor[]&gt; interceptorsProvider, ResourceLoader resourceLoader, ObjectProvider&lt;DatabaseIdProvider&gt; databaseIdProvider, ObjectProvider&lt;List&lt;ConfigurationCustomizer&gt;&gt; configurationCustomizersProvider) { this.properties = properties; this.interceptors = interceptorsProvider.getIfAvailable(); this.resourceLoader = resourceLoader; this.databaseIdProvider = databaseIdProvider.getIfAvailable(); this.configurationCustomizers = configurationCustomizersProvider.getIfAvailable();}/** * æ™®é€šæ•°æ®æº * ä¸»æ•°æ®æºï¼Œå¿…é¡»é…ç½®ï¼Œspringå¯åŠ¨æ—¶ä¼šæ‰§è¡Œåˆå§‹åŒ–æ•°æ®æ“ä½œï¼ˆæ— è®ºæ˜¯å¦çœŸçš„éœ€è¦ï¼‰ï¼Œé€‰æ‹©æŸ¥æ‰¾DataSource classç±»å‹çš„æ•°æ®æº * * @return {@link DataSource} */@Primary@Bean(name = BEANNAME_DATASOURCE_COMMON)@ConfigurationProperties(prefix = \"com.lianjia.confucius.bridge.boot.datasource.common\")public DataSource createDataSourceCommon() { return DataSourceBuilder.create().build();}/** * åªè¯»æ•°æ®æº * * @return {@link DataSource} */@Bean(name = BEANNAME_DATASOURCE_READONLY)@ConfigurationProperties(prefix = \"com.lianjia.confucius.bridge.boot.datasource.readonly\")public DataSource createDataSourceReadonly() { return DataSourceBuilder.create().build();}private SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception { SqlSessionFactoryBean factory = new SqlSessionFactoryBean(); factory.setDataSource(dataSource); factory.setVfs(SpringBootVFS.class); if (StringUtils.hasText(this.properties.getConfigLocation())) { factory.setConfigLocation(this.resourceLoader.getResource(this.properties.getConfigLocation())); } org.apache.ibatis.session.Configuration configuration = this.properties.getConfiguration(); if (configuration == null &amp;&amp; !StringUtils.hasText(this.properties.getConfigLocation())) { configuration = new org.apache.ibatis.session.Configuration(); } if (configuration != null &amp;&amp; !CollectionUtils.isEmpty(this.configurationCustomizers)) { for (ConfigurationCustomizer customizer : this.configurationCustomizers) { customizer.customize(configuration); } } factory.setConfiguration(configuration); if (this.properties.getConfigurationProperties() != null) { factory.setConfigurationProperties(this.properties.getConfigurationProperties()); } if (!ObjectUtils.isEmpty(this.interceptors)) { factory.setPlugins(this.interceptors); } if (this.databaseIdProvider != null) { factory.setDatabaseIdProvider(this.databaseIdProvider); } if (StringUtils.hasLength(this.properties.getTypeAliasesPackage())) { factory.setTypeAliasesPackage(this.properties.getTypeAliasesPackage()); } if (StringUtils.hasLength(this.properties.getTypeHandlersPackage())) { factory.setTypeHandlersPackage(this.properties.getTypeHandlersPackage()); } if (!ObjectUtils.isEmpty(this.properties.resolveMapperLocations())) { factory.setMapperLocations(this.properties.resolveMapperLocations()); } return factory.getObject();}public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory) { ExecutorType executorType = this.properties.getExecutorType(); if (executorType != null) { return new SqlSessionTemplate(sqlSessionFactory, executorType); } else { return new SqlSessionTemplate(sqlSessionFactory); }}@Bean@Primarypublic SqlSessionFactory primarySqlSessionFactory() throws Exception { return this.sqlSessionFactory(this.createDataSourceCommon());}@Beanpublic SqlSessionFactory secondarySqlSessionFactory() throws Exception { return this.sqlSessionFactory(this.createDataSourceReadonly());}/** * å®ä¾‹æ™®é€šçš„ sqlSession * * @return SqlSession * @throws Exception when any exception occured */@Bean(name = BEANNAME_SQLSESSION_COMMON)public SqlSession initSqlSessionCommon() throws Exception { return this.sqlSessionTemplate(this.primarySqlSessionFactory());}/** * å®ä¾‹åªè¯»çš„ sqlSession * * @return SqlSession * @throws Exception when any exception occured */@Bean(name = BEANNAME_SQLSESSION_READONLY)public SqlSession initSqlSessionReadonly() throws Exception { return this.sqlSessionTemplate(this.secondarySqlSessionFactory());}@MapperScan(annotationClass = PrimaryMapper.class, sqlSessionTemplateRef = BEANNAME_SQLSESSION_COMMON, basePackageClasses = ITalentApplicationSpringBootStart.class)static class PrimaryMapperConfiguration {}@MapperScan(annotationClass = SecondaryMapper.class, sqlSessionTemplateRef = BEANNAME_SQLSESSION_READONLY, basePackageClasses = ITalentApplicationSpringBootStart.class)static class SecondaryMapperConfiguration {}","link":"/2019/2019-03-13-SpringBoot_Mybatis%E9%85%8D%E7%BD%AE/"},{"title":"[ç‰‡æ®µ] ä½¿ç”¨TypeTokenåœ¨è¿è¡ŒæœŸä¿å­˜æ³›å‹ä¿¡æ¯","text":"ä¸€èˆ¬æ¥è¯´å¯ä»¥ä½¿ç”¨getGenericSuperclass è·å–å­ç±»èŒƒå‹ä¿¡æ¯ï¼Œä½†æ˜¯æ³›å‹æœ‰åµŒå¥—çš„è¯æƒ³è·å–å®Œæ•´ä¿¡æ¯è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ã€‚ä¾‹å¦‚ï¼šMessage&lt;List&gt; æœ‰ä¸¤ä¸ªæ³›å‹ä¿¡æ¯ã€‚ guavaä¸­æœ‰å¼ºå¤§çš„TypeTokenå¸®åŠ©ä½ ä¿å­˜å¤æ‚æ³›å‹ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒï¼š 123ParameterizedTypeReference&lt;Message&lt;T&gt;&gt; responseTypeRef = ParameterizedTypeReferenceBuilder.fromTypeToken( new TypeToken&lt;Message&lt;T&gt;&gt;() {}.where(new TypeParameter&lt;T&gt;() {}, new TypeToken&lt;List&lt;OrgSugVOV1&gt;&gt;() {})); å¦‚æœéœ€è¦åœ¨springæ¡†æ¶ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä¸€ä¸ªé€‚é…å™¨ï¼š 123456789101112131415161718192021222324252627282930313233343536public class ParameterizedTypeReferenceBuilder { public static &lt;T&gt; ParameterizedTypeReference&lt;T&gt; fromTypeToken(TypeToken&lt;T&gt; typeToken) { return new TypeTokenParameterizedTypeReference&lt;&gt;(typeToken); } private static class TypeTokenParameterizedTypeReference&lt;T&gt; extends ParameterizedTypeReference&lt;T&gt; { private final Type type; private TypeTokenParameterizedTypeReference(TypeToken&lt;T&gt; typeToken) { this.type = typeToken.getType(); } @Override public Type getType() { return type; } @Override public boolean equals(Object obj) { return (this == obj || (obj instanceof ParameterizedTypeReference &amp;&amp; this.type.equals(((ParameterizedTypeReference&lt;?&gt;) obj).getType()))); } @Override public int hashCode() { return this.type.hashCode(); } @Override public String toString() { return \"ParameterizedTypeReference&lt;\" + this.type + \"&gt;\"; } }} å…³äºjavaçš„æ³›å‹æˆ‘å°±ä¸å¤šåšåæ§½äº†ã€‚","link":"/2019/2019-02-26-%E4%BD%BF%E7%94%A8TypeToken%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%9C%9F%E4%BF%9D%E5%AD%98%E6%B3%9B%E5%9E%8B%E4%BF%A1%E6%81%AF/"},{"title":"[é¡¹ç›®æ„Ÿæ‚Ÿ] è¯»ã€Šå†è°ˆæ•æ·å¼€å‘ä¸å»¶æœŸé£æ§ã€‹","text":"æœ¬äººæœ¬èº«ä¸å¤ªå–œæ¬¢æ–¹æ³•è®ºï¼Œæ„Ÿè§‰éƒ½æ˜¯å¥—è·¯ï¼Œç”Ÿæ¬ç¡¬å¥—ä¸é€‚åˆè‡ªå·±ï¼Œæ•æ·å¼€å‘å°±æ˜¯å…¶ä¸­è®©æˆ‘ä¿æŒè°¨æ…æ€åº¦çš„æ–¹æ³•è®ºä¹‹ä¸€ã€‚ æ•æ·å¼€å‘ä¸Scrumå¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è¯´ï¼Œèƒ½å¤Ÿå³å¿«åˆå¥½åœ°å®Œæˆå½“ç„¶æ˜¯éå¸¸æ£’çš„ï¼Œä½†æ˜¯ä¼—æ‰€å‘¨çŸ¥ï¼Œå—é™äºé¡¹ç›®ç®¡ç†ä¸‰è¦ç´ ï¼šæ—¶é—´ã€è´¨é‡ã€æˆæœ¬ï¼Œåªèƒ½æŠ˜è¡·é€‰æ‹©ã€‚å› æ­¤ã€Œæ•æ·ã€ä½œä¸ºä¸€ç§æ–¹æ³•è®ºï¼ˆè™½ç„¶Agileè‡ªç§°ä¸ºCultureï¼‰è¢«æå‡ºï¼Œå…¶ä¸­Scrum(/skrÊŒm/ï¼Œä¸€ç§çƒç±»æ¯”èµ›)æ˜¯æ¯”è¾ƒçŸ¥åçš„å®ç°ç±»ä¹‹ä¸€ã€‚ åœ¨Scumä¸­ï¼Œå®ƒä¸»è¦å¼ºè°ƒå°†ç€‘å¸ƒå¼å¼€å‘æµç¨‹è½¬ä¸ºå¤šé˜¶æ®µå°è¿­ä»£ï¼Œå¯ä»¥ç†è§£ä¸ºCPUçš„å¤šçº§æµæ°´çº¿(Instruction pipeline)è®¾è®¡ï¼Œæµæ°´çº¿è®¾è®¡å°†CPUçš„è®¡ç®—é€»è¾‘æ‹†åˆ†ï¼Œå®ç°äº†å¤ç”¨è®¡ç®—æ¨¡å—ï¼Œè¿›è€Œæé«˜äº†æ—¶é’Ÿé¢‘ç‡ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†å¯„å­˜å™¨/åˆ†æ”¯é¢„æµ‹ç­‰ç®¡ç†æ¨¡å—å¢åŠ äº†å¤æ‚åº¦ã€‚ ç±»ä¼¼äºCPUæµæ°´çº¿æœºåˆ¶ï¼Œæ•æ·å¼€å‘æœ¬è´¨æ˜¯åœ¨ä¿æŒæ—¶é—´ã€è´¨é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æŠ•å…¥ç®¡ç†æˆæœ¬é™ä½å¼€å‘è¿‡ç¨‹çš„ç©ºè½¬æˆæœ¬ï¼Œè¿›è€Œæé«˜æ—¶é’Ÿå‘¨æœŸçš„æ–¹æ³•ã€‚ ç”¨ç™½è¯æ¥è¯´ï¼Œå¯ä»¥æŠŠè½¯ä»¶å¼€æ”¾æ¯”ä½œæµæ°´è½¦é—´ï¼ŒæŠŠPMï¼ŒSEæ¯”ä½œæµæ°´çº¿å·¥äººã€‚ æˆ‘è§è¿‡çš„çš„å‡æ•æ·ç„¶è€Œåˆ°äº†ç°å®ï¼Œç”±äºå„ç§åŸå› ï¼Œå´å¾ˆå®¹æ˜“æˆä¸ºå‡æ•æ· å°†å·¥ä½çš„éš”æ æ‹†å¼€å˜æˆç½‘å§â€œæ•æ·å²›â€ å¼ºè¡Œå°†Releaseè®¡åˆ’æ‹†æˆä¸€ä¸ªæœˆä¸€ç‰ˆï¼Œå°†Sprintæ‹†æˆ2å‘¨å°±çœ‹ä½œå¿«é€Ÿè¿­ä»£ï¼Œç…§ç€äººæœˆç¥è¯åç€æ æ‹›è˜ä¸€å †æ— è´£ä»»å¿ƒçš„å¼€å‘è®©ä½ å»â€œæ•æ·â€ï¼Œæ°¸è¿œæ— æ³•å®ç°â€œå…¨åŠŸèƒ½éƒ¨é˜Ÿâ€ å®¢æˆ·éš¾æ²Ÿé€šï¼ŒPOä½ä¼°å·¥ä½œé‡ï¼ŒSEè®¾è®¡ç¼ºé™·ï¼Œç¼–ç è´¨é‡ä½ç­‰åŸå› ï¼Œæœ€ç»ˆå¯¼è‡´å»¶æœŸä¸Šè¿°ä»»ä½•ä¸€ä¸ªé—®é¢˜ï¼Œéƒ½å¯èƒ½å¯¼è‡´æœ€ç»ˆé¡¹ç›®ä¸€é”…ç²¥ï¼Œå¯¼è‡´é«˜å±‚ç„¦è™‘ï¼Œä¸­å±‚è·‘è·¯ï¼Œåº•å±‚æ··æ—¥å­çš„ç»“æœã€‚ æ•æ·èƒ½å¤Ÿæä¾›å¼ºå¤§é«˜æ•ˆçš„æ–¹æ³•è®ºï¼Œä½†æ˜¯å‰ææ˜¯éœ€è¦æœ¬èº«åŸºç¡€è¿‡ç¡¬çš„å›¢é˜Ÿï¼Œæ•æ·åªèƒ½å¸®åŠ©å­˜åœ¨è¿›æ­¥ç“¶é¢ˆçš„å›¢é˜Ÿã€‚å¦‚æœé¡¹ç›®å·²ç»ç©ºå¿ƒåŒ–ï¼Œå€ºåŠ¡å¤šï¼Œè¿™ä¸æ˜¯æ•æ·æ–¹æ³•è®ºåº”è¯¥è§£å†³çš„é—®é¢˜ã€‚","link":"/2019/2019-04-01-%E8%AF%BB%E3%80%8A%E5%86%8D%E8%B0%88%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91%E4%B8%8E%E5%BB%B6%E6%9C%9F%E9%A3%8E%E6%8E%A7%E3%80%8B/"},{"title":"resilience4j-retryæºç é˜…è¯»","text":"resilience4j æºç è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ç®€å•çš„ï¼Œæ¯”è¾ƒé€‚åˆé˜…è¯»ã€‚ æ”¾ä¸€å¼ ä¸»è¦ç±»çš„ç»“æ„å›¾ï¼š Retryå…¥å£Retryæ¥å£æ˜¯æä¾›é‡è¯•åŠŸèƒ½çš„å…¥å£ï¼Œä¸»è¦æä¾›äº†æ–¹æ³•æ¨¡ç‰ˆï¼Œå…·ä½“æ ¡éªŒç»“æ„ï¼Œå¤±è´¥åå¤„ç†ç”±Contextå­ç±»å®ç°ã€‚ 1234567891011121314151617181920212223/** * Creates a retryable supplier. * * @param retry the retry context * @param supplier the original function * @param &lt;T&gt; the type of results supplied by this supplier * @return a retryable function */static &lt;T&gt; Supplier&lt;T&gt; decorateSupplier(Retry retry, Supplier&lt;T&gt; supplier) { return () -&gt; { Retry.Context&lt;T&gt; context = retry.context(); do try { T result = supplier.get(); final boolean validationOfResult = context.onResult(result); if (!validationOfResult) { context.onSuccess(); return result; } } catch (RuntimeException runtimeException) { context.onRuntimeError(runtimeException); } while (true); };} è¿™é‡Œæ‘˜æŠ„äº†ä¸€æ®µæ ¸å¿ƒä»£ç ï¼Œä½œç”¨æ˜¯å¾ªç¯ç›´åˆ°context.onResult(result)è¿”å›trueä¸ºæ­¢ï¼Œéœ€è¦ç•™æ„context.onResult/onRuntimeError/onErrorå¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œ onSuccessåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™é‡Œæ¯æ¬¡è¿›å…¥é‡è¯•éƒ½æ˜¯ä¸€ä¸ªæ–°çš„contextå¯¹è±¡ã€‚ Retry.ContextImpl1234567891011121314151617181920212223public boolean onResult(T result) { if (null != resultPredicate &amp;&amp; resultPredicate.test(result)) { int currentNumOfAttempts = numOfAttempts.incrementAndGet(); if (currentNumOfAttempts &gt;= maxAttempts) { return false; } else { waitIntervalAfterFailure(currentNumOfAttempts, null); return true; } } return false;}public void onRuntimeError(RuntimeException runtimeException) { if (exceptionPredicate.test(runtimeException)) { lastRuntimeException.set(runtimeException); throwOrSleepAfterRuntimeException(); } else { failedWithoutRetryCounter.increment(); publishRetryEvent(() -&gt; new RetryOnIgnoredErrorEvent(getName(), runtimeException)); throw runtimeException; }} å…ˆå…³æ³¨onResultï¼Œå®ƒè´Ÿè´£åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­é‡è¯•ï¼Œå¦‚æœé€šè¿‡æ ¡éªŒæˆ–è€…é‡è¯•è¶…è¿‡æ­¤æ•°ï¼Œä¼šåœæ­¢é‡è¯•ã€‚ onRuntimeError/onError, è´Ÿè´£æŠŠcatchçš„å¼‚å¸¸å­˜å‚¨åœ¨lastRuntimeExceptionä¸­ã€‚ 12345678910public void onSuccess() { int currentNumOfAttempts = numOfAttempts.get(); if (currentNumOfAttempts &gt; 0) { succeededAfterRetryCounter.increment(); Throwable throwable = Option.of(lastException.get()).getOrElse(lastRuntimeException.get()); publishRetryEvent(() -&gt; new RetryOnSuccessEvent(getName(), currentNumOfAttempts, throwable)); } else { succeededWithoutRetryCounter.increment(); }} onSuccessè´Ÿè´£ç»Ÿè®¡å’Œå‘é€äº‹ä»¶ã€‚ æ€»ç»“æ€»ä½“æ¥è¯´retryæ¯”è¾ƒç®€å•ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹æœ‰ä¸€ä¸ªå¦‚æœè®¾ç½®äº†ç»“æœæ ¡éªŒï¼Œå¦‚æœä¸€ç›´æ ¡éªŒä¸é€šè¿‡ï¼Œå°†è¿”å›æœªé€šè¿‡çš„ç»“æœï¼Œè€Œä¸æ˜¯è¿”å›å¤±è´¥ã€‚","link":"/2019/2019-04-18-resilience4j-retry%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"},{"title":"IO Modle","text":"æ“ä½œç³»ç»ŸIOæ¨¡å‹ä¸Java IOJava IOæ¨¡å‹å’Œæ“ä½œç³»ç»ŸIOæ¨¡å‹æ¯æ¯ç›¸å…³ï¼Œä¹‹å‰é˜»å¡/éé˜»å¡ï¼ŒåŒæ­¥/éåŒæ­¥ä¹‹é—´çš„å…³ç³»ä¸€ç›´åˆ†ä¸æ¸…ï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦äº†è§£ä¸‹æ“ä½œç³»ç»Ÿ(linux)æä¾›äº†å“ªäº›æ¥å£æ¥è¿›è¡ŒIOã€‚ç›®å‰æˆ‘ä»¬åªéœ€è¦äº†è§£å³å¯ï¼Œä½¿ç”¨ç›¸å…³å¯ä»¥ç›´æ¥æŸ¥çœ‹java ioæ•™ç¨‹ã€‚ æœ€åŸºç¡€çš„çŸ¥è¯†ä»¥ä½¿ç”¨IOè¯»å–æ•°æ®ä¸ºä¾‹ï¼Œä¸€èˆ¬æ“ä½œç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„é˜¶æ®µè¿›è¡Œæ“ä½œï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œå¯ä»¥æ˜¯ä»ç£ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œæˆ–è€…æ˜¯ç½‘å¡æ¥å—åˆ°æ•°æ®åæ‹·è´åˆ°å†…æ ¸ç©ºé—´ã€‚ ä»å†…æ ¸ç©ºé—´å°†æ•°æ®æ‹·è´è‡³è¯·æ±‚æ•°æ®çš„è¿›ç¨‹ã€‚å¦‚æœæ˜¯javaå¯èƒ½è¿˜éœ€ä»è¿›ç¨‹æ‹·è´è‡³jvmå †å†…å­˜ã€‚ Blocking I/O Modelè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ¨¡å‹ï¼Œæœ›æ–‡ç”Ÿä¹‰å°±æ˜¯é˜»å¡IOï¼Œè¿›è¡ŒIOçš„ä¸¤ä¸ªé˜¶æ®µä¼šéƒ½é˜»å¡ç¨‹åºï¼Œç›´åˆ°è¯»å–åˆ°æ•°æ®æˆ–è€…è¿”å›é”™è¯¯æ‰ä¼šè¿”å›ã€‚ å…·ä½“æ¥è¯´ï¼Œé€šè¿‡è°ƒç”¨ç³»ç»Ÿrecvfromå‡½æ•°ï¼Œè€Œrecvfromå‡½æ•°ä¼šç­‰åˆ°å‡ºé”™æˆ–è€…æŠŠæ•°æ®æ‹·è´åˆ°è¿›ç¨‹å®Œæˆæ—¶æ‰ä¼šè¿”å›ã€‚ä¹‹åæˆ‘ä»¬ç¨‹åºåªéœ€è¦å¤„ç†é”™è¯¯æˆ–è€…å¤„ç†æ•°æ®å°±å¯ä»¥äº†ã€‚ é˜»å¡æ¨¡å‹å¯¹åº”javaä¸­ç»å¤§éƒ¨åˆ†IOæ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚apiï¼Œio stream apiï¼Œè¯¥æ¨¡å‹ä¼˜ç‚¹åœ¨äºç®€å•ç›´è§‚ï¼Œç¼ºç‚¹åœ¨é•¿æ—¶é—´é˜»å¡å¾ˆéš¾æ”¯æŒå¤§é‡å¹¶å‘IOè¯·æ±‚ã€‚ Nonblocking I/O Modelè¯¥æ¨¡å‹åœ¨javaä¸­æ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ ä½¿ç”¨è½®è¯¢æ–¹å¼è°ƒç”¨ç³»ç»Ÿrecvfromå‡½æ•°ï¼Œrecvfromå‡½æ•°åœ¨ç¬¬ä¸€é˜¶æ®µå®Œæˆå‰ä¸€ç›´è¿”å›é”™è¯¯ï¼Œç›´åˆ°ç¬¬ä¸€é˜¶æ®µå®Œæˆåï¼Œé˜»å¡è‡³ç¬¬äºŒé˜¶æ®µå®Œæˆã€‚ è¿™ä¸ªæ¨¡å‹ç¨æ˜¾é¸¡è‚‹ï¼Œç‰¹ç‚¹æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µæ˜¯éé˜»å¡çš„ï¼ˆè¿›ç¨‹ä¸ä¼šè¢«åˆ‡æ¢ï¼‰ï¼Œä»£ç ç›¸æ¯”é˜»å¡æ¨¡å‹æ¥è¯´ä¹Ÿæ›´å¤æ‚ã€‚ I/O Multiplexing Modeléå¸¸è‘—åçš„IOæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒå¤§é‡å¹¶å‘IOã€‚é€šè¿‡è°ƒç”¨selectæˆ–è€…pullå¹¶é˜»å¡ï¼Œè€Œä¸æ˜¯åœ¨å®é™…è°ƒç”¨ç³»ç»ŸIOæ—¶é˜»å¡ã€‚ä½¿ç”¨selecté˜»å¡åœ¨ç¬¬ä¸€é˜¶æ®µå’ŒBlocking I/Oçš„é˜»å¡ä¸å¤ªä¸€æ ·ï¼ŒBlocking I/Oé˜»å¡åœ¨å½“å‰IOæ“ä½œç¬¬ä¸€é˜¶æ®µï¼Œè€ŒI/Oå¤ç”¨åˆ™å¯ä»¥æ³¨å†Œå¤šä¸ªI/Oåœ¨selectå‡½æ•°ï¼Œå½“æœ‰ä¸€ä¸ªI/Oå°±ç»ªæ—¶selectå‡½æ•°å°±ä¼šè¿”å›ï¼Œå¦‚æœæ‰€æœ‰I/Oå¤„äºç¬¬ä¸€é˜¶æ®µé˜»å¡çŠ¶æ€åˆ™selectå‡½æ•°é˜»å¡ã€‚ ç›¸æ¯”è¾ƒBlocking I/O Modelå’ŒNonblocking I/O Modelï¼ŒI/O Multiplexing Modelæ˜æ˜¾èƒ½åœ¨çŸ­æ—¶é—´å†…å¤„ç†æ›´å¤šçš„I/Oã€‚å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹+Blocking I/O Modelä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯æœ‰å¯èƒ½æ¶ˆè€—è¿‡å¤šçº¿ç¨‹èµ„æºã€‚ I/O Multiplexing Modelå¯¹åº”java NIOçš„Selectorç­‰api Signal-Driven I/O Modelè¯¥æ¨¡å‹åœ¨javaä¸­æ²¡æœ‰å¯¹åº”ï¼Œæ‰€ä»¥è¿™é‡Œåªåšç®€å•ä»‹ç»ã€‚ è¯¥æ¨¡å‹ç‰¹ç‚¹æ˜¯ç¬¬ä¸€é˜¶æ®µè°ƒç”¨sigactionå‡½æ•°éé˜»å¡è¿”å›ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µå®Œæˆåå‘é€ä¿¡å·SIGIOè‡³è¿›ç¨‹ï¼Œä¹‹ååœ¨signal handlerä¸­è¿›è¡Œç¬¬äºŒé˜¶æ®µå¤„ç†ã€‚ç›¸å½“äºå¯¹Nonblocking I/O Modelçš„ä¸€ç§æ”¹è¿›ã€‚ Asynchronous I/O ModelAsynchronous I/O Modelç›¸æ¯”è¾ƒSignal-Driven I/O Modelçš„åŒºåˆ«åœ¨äºé€šçŸ¥çš„æ—¶æœºä¸åŒï¼šAsynchronous I/O Modelåœ¨ç¬¬ä¸€å’Œç¬¬äºŒé˜¶æ®µéƒ½å®Œæˆæ—¶é€šè¿‡ä¿¡å·é€šçŸ¥è¿›ç¨‹æ“ä½œå®Œæˆã€‚ Asynchronous I/O Modelå¯¹åº”javaä¸­AsynchronousSocketChannelï¼ŒAsynchronousServerSocketChannel å’Œ AsynchronousFileChannelç­‰apiã€‚ å„ä¸ªæ¨¡å‹æ¯”è¾ƒ","link":"/2019/2019-05-20-IO-Modle/"},{"title":"[é¡¹ç›®] æ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢é‡åˆ°çš„å‘","text":"å‰æƒ…æ¦‚è¦ 1. é—®é¢˜èƒŒæ™¯ä½¿ç”¨å¤šä¸ªè§’è‰²æŸ¥è¯¢åˆ—è¡¨æ—¶ï¼Œä¼šé‡åˆ°ä¸¤ä¸ªç»´åº¦çš„ä¸åŒç‚¹ï¼š è¡Œç»´åº¦ï¼šå¤šä¸ªè§’è‰²èƒ½å¤Ÿçœ‹åˆ°è¡Œçš„å¹¶é›†ï¼Œsqléœ€è¦å¤šæ¬¡æŸ¥è¯¢å–å¹¶é›†ï¼Œä¹‹åè¿˜è¦å»é‡åˆ†é¡µæ’åº åˆ—ç»´åº¦ï¼šå¦‚æœä¸åŒè§’è‰²å¯è§åˆ—ä¸åŒï¼Œè®¡ç®—å‡ºå½“å‰è¡Œèƒ½çœ‹åˆ°åˆ—çš„å¹¶é›† ä¸¾ä¸€ä¸ªä¾‹å­ï¼š å‡è®¾å­˜åœ¨ä¸€ä¸ªç™»å½•å‘˜å·¥æ‹¥æœ‰ä¸¤ä¸ªè§’è‰²ï¼š é•¿æœŸæ¿€åŠ±è´Ÿè´£äººï¼šèƒ½çœ‹åˆ°æ‹¥æœ‰é•¿æœŸæ¿€åŠ±çš„äººï¼ˆè¡Œç»´åº¦ï¼‰ï¼Œèƒ½çœ‹åˆ°åŸºæœ¬ä¿¡æ¯å’Œé•¿æœŸæ¿€åŠ±ä¿¡æ¯ï¼ˆåˆ—ç»´åº¦ï¼‰ è–ªé…¬è´Ÿè´£äººï¼šèƒ½çœ‹åˆ°ä½èŒçº§çš„äººï¼ˆè¡Œç»´åº¦ï¼‰ï¼Œèƒ½çœ‹åˆ°åŸºæœ¬ä¿¡æ¯å’Œè–ªé…¬ä¿¡æ¯ï¼ˆåˆ—ç»´åº¦ï¼‰ é‚£ä¹ˆï¼Œåœ¨åˆ—è¡¨ä¸­ä»–èƒ½çœ‹è§ï¼š åŸºæœ¬ä¿¡æ¯ è–ªé…¬ä¿¡æ¯ é•¿æœŸæ¿€åŠ±ä¿¡æ¯ ä½èŒçº§/æ— é•¿æœŸæ¿€åŠ± âˆš âˆš x ä½èŒçº§/é•¿æœŸæ¿€åŠ± âˆš âˆš âˆš é«˜èŒçº§/æ— é•¿æœŸæ¿€åŠ± x x x é«˜èŒçº§/é•¿æœŸæ¿€åŠ± âˆš x âˆš 2. å®é™…é‡åˆ°çš„é—®é¢˜ï¼ˆå›°éš¾é‡é‡ï¼‰åŸºæœ¬æ€è·¯å·²ç»åœ¨å‰æœŸæ¦‚è¦é‡Œä»‹ç»ï¼Œæœ¬äººå·²ç»å®è·µäº†ä¸€æ®µæ—¶é—´ï¼ŒæŒ–äº†ä¸¤ä¸ªæ·±å‘æ­£åœ¨è§£å†³ä¸­ã€‚ æ€§èƒ½é—®é¢˜ï¼ˆå·²è§£å†³ï¼‰æœ€å¼€å§‹çš„å®ç°ä¸­æ•°æ®æ˜¯ä¸€æ¡ä¸€æ¡è¯»å–çš„ï¼ŒåŒæ—¶è–ªé…¬å­—æ®µå±äºåŠ å¯†ä¿¡æ¯ï¼Œä½¿ç”¨äº†ç¬¬ä¸‰æ–¹å¾®æœåŠ¡æä¾›è§£å¯†ï¼Œè¯»å–å­—æ®µå¤š+è§£å¯†å­—æ®µå¤š å¯¼è‡´äº†åœ¨ç™¾æ¡åˆ†é¡µçš„æƒ…å†µä¸‹æ¥å£åœ¨è¶…æ—¶çš„è¾¹ç¼˜ä¸æ–­è¯•æ¢ã€‚ã€‚ã€‚ è§£å†³æ–¹æ¡ˆï¼š åˆå¹¶æŸ¥è¯¢sql,æ‰¹é‡æŸ¥è¯¢æ•°æ® åˆå¹¶è§£å¯†è¯·æ±‚,æ‰¹é‡è°ƒç”¨è§£å¯†å¾®æœåŠ¡ å› ä¸ºä¹‹å‰ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è§£å¯†ä½¿ç”¨äº†mybatisçš„TypeHandleråšåˆ°å­—æ®µéšå¼åŠ è§£å¯†ï¼Œç›®å‰æˆ‘ä»¬çš„åšæ³•æ˜¯å¯¹äºå•æ¡æ•°æ®çš„åŠ è§£å¯†ï¼Œè¿˜æ˜¯ä¿æŒåŸæ¥çš„typeHandleråšæ³•ï¼Œè€Œå¯¹æ‰¹é‡æ•°æ®å¤„ç†ï¼Œé‡æ–°å†™ä¸€å¥—æ•°æ®å®ä½“ï¼ŒåŒæ—¶ä½¿ç”¨mybatisçš„æ‹¦æˆªå™¨å¯¹æŸ¥è¯¢çš„æ‰¹é‡æ•°æ®åšæ‰¹é‡è§£å¯†çš„å¤„ç†ã€‚å…·ä½“åšæ³•å¯ä»¥å‚è§æˆ‘çš„å¦ä¸€ç‰‡æ–‡ç« ï¼šã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µ-ç»­ æ‰¹é‡æŸ¥è¯¢å¸¦æ¥çš„é—®é¢˜æ‰¹é‡æŸ¥è¯¢è¿”å›çš„åˆ—è¡¨ä¸­åˆ—å­—æ®µéƒ½æ˜¯ä¸€è‡´çš„ï¼Œè€Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯ä¸åŒçš„è¡Œèƒ½çœ‹è§ä¸åŒçš„åˆ—å­—æ®µï¼ŒæŠŠæ‰¹é‡æŸ¥è¯¢å‡ºæ¥çš„åˆ—è¡¨ç›´æ¥è¿”å›æ˜¯æœ‰é—®é¢˜çš„ï¼Œè¿™ä¸ªé—®é¢˜å› ä¸ºç–å¿½å¯¼è‡´äº†çº¿ä¸Šçš„ä¸€æ¬¡æ•…éšœã€‚ æ‰€ä»¥ç›®å‰çš„æ€è·¯æ˜¯å…ˆåšä¸€æ¬¡æ•°æ®æ‰¹é‡é¢„å–ï¼Œä¹‹ååœ¨å¯¹åˆ—å­—æ®µåšå¤„ç†ï¼Œéšè—æ‰ä¸èƒ½çœ‹è§çš„å­—æ®µã€‚ 3. æ€»ç»“æ²¡æœ‰æƒ³åˆ°å½“æ—¶æƒ³è§£å†³æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢è¿™ä¸ªé—®é¢˜æ—¶ä¼šé‡åˆ°è¿™ä¹ˆå¤šå›°éš¾ï¼Œæƒ³æ³•æ˜¯æ­£ç¡®çš„ï¼Œåœ¨å®é™…æ‰§è¡Œæ—¶è¿˜æ˜¯å›°éš¾é‡é‡ã€‚å€¼å¾—æ¬£æ…°çš„åœ¨æœ€å¼€å§‹çš„æ—¶å€™æ€è·¯å’Œæ–¹å‘éƒ½æ˜¯æ­£ç¡®çš„ï¼ŒåŒæ—¶ä¹ŸæŠŠå…¶ä¸­é‡åˆ°çš„å„ç§é—®é¢˜å’Œå¿ƒå¾—è®°å½•äº†ä¸‹æ¥ï¼Œç»è¿‡å±‚å±‚ç§¯ç´¯ï¼Œæ‰åˆ°è¾¾ç°åœ¨çš„é«˜åº¦ã€‚ []: https://blog.yamato.moe/2018/11/06/2018-11-06-biz/ â€œæ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢çš„ä¸€ç§æ€è·¯â€[]: https://blog.yamato.moe/2019/04/04/Mybatis%20ResultSetHandler_2019-04-04%20%E7%BB%AD/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µ-ç»­â€[]: https://blog.yamato.moe/2019/01/09/Mybatis%20ResultSetHandler_2019-01-09/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µâ€","link":"/2019/2019-05-17-%E6%A0%B9%E6%8D%AE%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%81%BF%E5%85%8D%E8%A7%92%E8%89%B2%E5%88%87%E6%8D%A2%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"},{"title":"å­£åº¦æ€»ç»“ å¦‚ä½•ç®¡ç†è‡ªæˆ‘æ—¶é—´","text":"æœ€è¿‘è¿™ä¸ªå­£åº¦æœ€è¿‘æ¯”è¾ƒå¿™ï¼Œç®—äº†ä¸‹è‡ªå·±å¯ä»¥åˆ©ç”¨çš„ç©ºé—²æ—¶é—´ï¼Œå¿™æ—¶ä¸€å¤©å¯èƒ½åªæœ‰1åˆ°3ä¸ªå°æ—¶ç©ºé—²æ—¶é—´ï¼Œç”šè‡³ä¸€å¤©æ²¡æœ‰ç©ºä½™æ—¶é—´ã€‚ä¸€å‘¨å¤§çº¦åªæœ‰30å°æ—¶æ—¶é—´æ˜¯å¯ä»¥åˆ©ç”¨çš„ï¼Œå¦‚æœç®—ä¸Šç©æ‰‹æœºæ—¶é—´åªä¼šæ›´çŸ­ï¼Œå¦‚æœå†æŠŠè¿™äº›æ—¶é—´å†æµªè´¹æ‰ï¼Œå¯èƒ½æœ€è¿‘åŠå¹´çš„æˆé•¿å°±åªæœ‰ä¸€äº›é¡¹ç›®ç»éªŒè€Œå·²äº†ã€‚æ‰€å¹¸å¹³å¸¸å…³æ³¨çš„åšå®¢å’Œã€Šè½¯æŠ€èƒ½ã€‹è¿™æœ¬ä¹¦é‡Œæœ‰æåŠä¸€äº›å…³äºè‡ªæˆ‘æ—¶é—´ç®¡ç†ç›¸å…³å†…å®¹ï¼Œæˆ‘ç®€å•å®è·µäº†2ä¸ªæœˆï¼Œåˆ†äº«ä¸‹è¿™æ–¹é¢çš„å¿ƒå¾—æ„Ÿæ‚Ÿã€‚ è®¡åˆ’å’Œä¼‘æ¯ã€Šè½¯æŠ€èƒ½ã€‹ä¸­ä½œè€…æ˜¯å¦‚ä½•åšè®¡åˆ’çš„ï¼Ÿ å­£åº¦è®¡åˆ’ æ˜ç¡®å®è§‚ç›®æ ‡ï¼Œä»¥åŠå¦‚ä½•å®ç° æœˆè®¡åˆ’ ä¼°ç®—å½“æœˆèƒ½å®Œæˆå¤šå°‘å·¥ä½œé‡ å‘¨è®¡åˆ’ ä¸ºæ¯å‘¨å®‰æ’å¿…é¡»å®Œæˆçš„å¼ºåˆ¶æ€§ä»»åŠ¡ æ—¥è®¡åˆ’ æ’é™¤å¹²æ‰°ï¼ŒæŒ‰éœ€è°ƒæ•´ ä¼‘æ¯ æ¯éš”ä¸€æ®µæ—¶é—´ä¼‘æ¯ï¼Œåªåšå¼ºåˆ¶æ€§ä»»åŠ¡ å¾ˆæƒ­æ„§ï¼Œå·¥ä½œåˆšå¼€å§‹ä¸€ä¸¤å¹´æˆ‘å°‘æœ‰è®¡åˆ’ï¼Œå•çº¯å‡­å€Ÿå¥½å¥‡å¿ƒå­¦ä¹ åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚å¤§çº¦ä»å»å¹´å†™å¹´åº¦æ€»ç»“å¼€å§‹æ‰åˆšåˆšåšä¸€äº›è®¡åˆ’ã€‚ç›®å‰æˆ‘ä½¿ç”¨å¾®è½¯to-doè·Ÿè¸ªè‡ªå·±çš„è®¡åˆ’è¿›åº¦å’Œdeadlineæ•ˆæœæ˜¾è‘—ï¼Œæ²»å¥½äº†æˆ‘çš„æ‹–å»¶ç—‡ã€‚ ç®€å•æ¥è¯´ã€Šè½¯æŠ€èƒ½ã€‹ä¸­é˜è¿°çš„å‡ ä¸ªè§‚ç‚¹æˆ‘æ„Ÿè§‰ååˆ†å—ç›Šï¼š è¦æœ‰è®¡åˆ’ å®Œæˆè®¡åˆ’æ—¶ä¿æŒä¸“æ³¨ ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•å¯ä»¥ä¿è¯ä¿è¯ä¸€æ®µæ—¶é—´çš„ä¸“æ³¨ï¼Œ åŒæ—¶è¿˜å¯ä»¥ç¡®å®šè‡ªå·±çš„å·¥ä½œæ•ˆç‡ï¼Œ æ€»ç»“ä¸è¶³æé«˜è‡ªèº«æ•ˆç‡ï¼Œä»è€Œå¸®åŠ©è‡ªå·±ç²¾ç¡®ä¸”é«˜æ•ˆçš„æŒ‡å®šè®¡åˆ’ åªæœ‰ä½ å®Œæˆäº†è®¡åˆ’çš„å·¥ä½œï¼Œæ¥ä¸‹æ¥çš„ä¼‘æ¯æ—¶é—´æ‰èƒ½å®‰å¿ƒ è¿™è¾¹å¹´è¯»ä¹¦æƒ…å†µè¿™åŠå¹´çœ‹çš„ä¹¦æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯åˆ·é¢˜å’Œåšå®¢æ€»ç»“å†™çš„å¤šäº†äº› æŠ€æœ¯ç±»ï¼šã€Šsqlåæ¨¡å¼ã€‹æ¨èï¼Œ åº”è¯¥å«æ•°æ®åº“ç»“æ„è®¾è®¡çš„æœ€ä½³å®è·µã€Šè½¯æŠ€èƒ½ï¼Œä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹ æœ‰å¾ˆå¤šäº‹æ¯”ä»£ç æ›´é‡è¦çš„å¤šï¼Œæ¨è å¿ƒç†ç±»ï¼šã€Šä½ çš„ç¯äº®ç€å—ã€‹ è§£å†³é—®é¢˜å‰ï¼Œå…ˆè¦ææ¸…æ¥šé—®é¢˜çš„æœ¬è´¨ã€‚ ä¸€èˆ¬èˆ¬","link":"/2019/2019-06-24-%E5%AD%A3%E5%BA%A6%E6%80%BB%E7%BB%93_%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E8%87%AA%E6%88%91%E6%97%B6%E9%97%B4/"},{"title":"[ç‰‡æ®µ] Mybatis ResultSetHandlerå®è·µ-ç»­","text":"è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µã€‚ ä¸Šæ¬¡çš„å±€é™æ˜¯åªèƒ½æ‰¹é‡è§£å¯†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰åŠ å¯†å­—æ®µï¼Œå¯¹æ‰¹é‡æ•°æ®æ¥è¯´ç¨æ˜¾ä¸è¶³ï¼Œè¿™ä¸ªä¸»è¦æ”¹è¿›äº†è¿™ä¸€ç‚¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Overridepublic List&lt;Object&gt; handleResultSets(Statement stmt) throws SQLException { ErrorContext.instance().activity(\"handling results\").object(mappedStatement.getId()); final List&lt;Object&gt; multipleResults = new ArrayList&lt;Object&gt;(); int resultSetCount = 0; ResultSetWrapper rsw = getFirstResultSet(stmt); List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps(); int resultMapCount = resultMaps.size(); validateResultMapsCount(rsw, resultMapCount); while (rsw != null &amp;&amp; resultMapCount &gt; resultSetCount) { ResultMap resultMap = resultMaps.get(resultSetCount); handleResultSet(rsw, resultMap, multipleResults, null); rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } String[] resultSets = mappedStatement.getResultSets(); if (resultSets != null) { while (rsw != null &amp;&amp; resultSetCount &lt; resultSets.length) { ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]); if (parentMapping != null) { String nestedResultMapId = parentMapping.getNestedResultMapId(); ResultMap resultMap = configuration.getResultMap(nestedResultMapId); handleResultSet(rsw, resultMap, null, parentMapping); } rsw = getNextResultSet(stmt); cleanUpAfterHandlingResultSet(); resultSetCount++; } } return collapseSingleResultList(multipleResults);} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130package app.pooi.common.encrypt;import app.pooi.common.encrypt.anno.CipherSpi;import app.pooi.common.encrypt.anno.Encrypted;import lombok.Getter;import org.apache.ibatis.executor.resultset.ResultSetHandler;import org.apache.ibatis.plugin.*;import org.apache.ibatis.reflection.MetaObject;import org.apache.ibatis.reflection.SystemMetaObject;import java.lang.reflect.Field;import java.sql.Statement;import java.util.*;import java.util.function.Function;import java.util.logging.Logger;import java.util.stream.Collectors;@Intercepts({ @Signature(type = ResultSetHandler.class, method = \"handleResultSets\", args = {Statement.class}),})public class DecryptInterceptor implements Interceptor { private static final Logger logger = Logger.getLogger(DecryptInterceptor.class.getName()); private CipherSpi cipherSpi; public DecryptInterceptor(CipherSpi cipherSpi) { this.cipherSpi = cipherSpi; } @Override public Object intercept(Invocation invocation) throws Throwable { final Object proceed = invocation.proceed(); if (proceed == null) { return proceed; } List&lt;?&gt; results = (List&lt;?&gt;) proceed; if (results.isEmpty()) { return proceed; } final Object first = results.iterator().next(); final Class&lt;?&gt; modelClazz = first.getClass(); final List&lt;String&gt; decryptFields = getDecryptFields(modelClazz); if (decryptFields.isEmpty()) { return proceed; } final List&lt;List&lt;String&gt;&gt; secret = Flux.fromIterable(results) .map(SystemMetaObject::forObject) .flatMapIterable(mo -&gt; decryptFields.stream().map(mo::getValue).collect(Collectors.toList())) .cast(String.class) .buffer(1000) .collectList() .block(); final Map&lt;String, String&gt; secretMap = secret.stream() .map(secrets -&gt; { try { return cipherSpi.batchDecrypt(secrets); } catch (Exception e) { e.printStackTrace(); return Maps.&lt;String, String&gt;newHashMap(); } }).reduce(Maps.newHashMap(), (m1, m2) -&gt; { m1.putAll(m2); return m1; }); secretMap.put(\"\", \"0\"); for (Object r : results) { final MetaObject metaObject = SystemMetaObject.forObject(r); decryptFields.forEach(f -&gt; metaObject.setValue(f, secretMap.get(metaObject.getValue(f)))); } return results; } @NotNull private List&lt;String&gt; getDecryptFields(Class&lt;?&gt; modelClazz) { return Arrays.stream(modelClazz.getDeclaredFields()) .filter(f -&gt; f.getAnnotation(Decrypted.class) != null) .filter(f -&gt; { boolean isString = f.getType() == String.class; if (!isString) { logger.warning(f.getName() + \"is not String, actual type is \" + f.getType().getSimpleName() + \" ignored\"); } return isString; }) .map(Field::getName) .collect(Collectors.toList()); } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }}@Getterclass Tuple2&lt;T1, T2&gt; { private final T1 t1; private final T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); }}","link":"/2019/2019-04-04-Mybatis_ResultSetHandler%E5%AE%9E%E8%B7%B5-%E7%BB%AD/"},{"title":"[é¡¹ç›®] å¤šè§’è‰²æƒé™å±•ç¤ºæ•°æ®çš„ä¸€ç§å®ç°","text":"å¤šè§’è‰²æƒé™å¦‚æœé‡åˆ°ä¸åŒè§’è‰²èƒ½çœ‹åˆ°ä¸åŒçš„åˆ—å¯ä»¥æ€ä¹ˆåš é€è¡Œè¯»å– æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼Œå®ç°ç®€å•ã€‚ä½†æ˜¯åœ¨å¾®æœåŠ¡ä¸­è°ƒç”¨æ¥å£æ¬¡æ•°å¤ªå¤šï¼Œæ€§èƒ½å¾ˆå·®ã€‚ æ‰¹é‡è¯»å– å®ç°è¾ƒå¤æ‚ï¼Œä½†æ˜¯æ€§èƒ½å¥½å¾ˆå¤šï¼Œä¸‹é¢ä¸»è¦ä»‹ç»è¿™ç§æ–¹æ³•çš„æ€è·¯ æ‰¹é‡è¯»å–ä»¥åˆ†é¡µè¯»å–æ•°æ®ä¸ºä¾‹ï¼š è¯»å–ç¬¬ä¸€é¡µæ•°æ®ï¼ŒåŒ…å«éœ€è¦å±•ç¤ºæ•°æ®çš„idå’Œæ‰€å±æƒé™ï¼ˆå¤šä¸ªï¼‰ ä¸ºä»€ä¹ˆéœ€è¦æ‰€å±æƒé™è¿™ä¸ªå­—æ®µå‘¢ï¼Ÿ å› ä¸ºå†³å®šèƒ½å¦çœ‹åˆ°è¿™è¡Œæ˜¯æœ‰ä½ æ‰€æ‹¥æœ‰çš„æ‰€æœ‰æƒé™å†³å®šçš„ï¼Œè€Œå†³å®šèƒ½å¦çœ‹åˆ°å“ªä¸ªåˆ—æ˜¯ç”±è¿™è¡Œæ‰€æ‹¥æœ‰çš„æƒé™å†³å®šçš„ã€‚ å¦‚ä½•è·å–è¯¥è¡Œæ‰€æ‹¥æœ‰çš„æƒé™å‘¢ï¼Œæˆ‘çš„åšæ³•æ˜¯åˆ†ä¸åŒçš„æƒé™æŸ¥è¯¢ç»“æœé€šè¿‡union ç»„åˆèµ·æ¥ å°†ç¬¬ä¸€é¡µæ•°æ®åŸå§‹é¡ºåºä¿å­˜ï¼Œ ç„¶åæŒ‰è¡Œæ‹¥æœ‰æƒé™åˆ†ç»„ è®°å½•åŸå§‹é¡ºåºæ˜¯å› ä¸ºåé¢åˆ†ç»„åä¼šæ‰“ä¹±ï¼Œ ä¸ºä»€ä¹ˆè¦åˆ†ç»„ï¼Ÿåˆ†ç»„ååŒæ ·çš„æŸ¥è¯¢æ‰èƒ½èšåˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥ç®€åŒ–ä»£ç  æ ¹æ®æƒé™åˆ†ç»„å¤šæ¬¡æŸ¥è¯¢æ‰€éœ€è¦çš„å­—æ®µï¼Œç„¶åå°†æŸ¥è¯¢ç»“æœåˆå¹¶ è¿™é‡Œæˆ‘ä½¿ç”¨çš„graphqlæ¥é€‰æ‹©éœ€è¦æŸ¥è¯¢çš„å­—æ®µ æœ€åè¿˜åŸæˆåŸæ¥çš„é¡ºåº å¯ä»¥ä½¿ç”¨guava Orderingå·¥å…·ç±»æ–¹ä¾¿ç”ŸæˆCompartor []: https://blog.yamato.moe/2018/11/06/2018-11-06-biz/ â€œæ ¹æ®æƒé™æŸ¥è¯¢æ—¶é¿å…è§’è‰²åˆ‡æ¢çš„ä¸€ç§æ€è·¯â€[]: https://blog.yamato.moe/2019/04/04/Mybatis%20ResultSetHandler_2019-04-04%20%E7%BB%AD/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µ-ç»­â€[]: https://blog.yamato.moe/2019/01/09/Mybatis%20ResultSetHandler_2019-01-09/ â€œã€ç‰‡æ®µã€‘ Mybatis ResultSetHandler å®è·µâ€","link":"/2019/2019-07-29-%E5%A4%9A%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%80%E7%A7%8D%E5%AE%9E%E7%8E%B0/"},{"title":"LeetCode æœ€é•¿å›æ–‡å­ä¸²ç®—æ³•","text":"Manacher ç®—æ³• å®¹æ˜“ç†è§£ï¼Œå®ç°èµ·æ¥ä¹Ÿæ²¡ä»€ä¹ˆå¤§å‘ï¼Œå¤æ‚åº¦è¿˜æ˜¯ O(n)çš„ï¼Œ èŠ±åŠä¸ªå°æ—¶å®ç°ä¸‹å¾ˆæœ‰æ„æ€ 12345678910111213141516171819202122232425262728293031323334353637class Solution { public String longestPalindrome(String s) { StringBuilder sb = new StringBuilder(2 + 2 * s.length()); sb.append(&quot;^&quot;); for (int i = 0; i &lt; s.length(); i++) { sb.append(&quot;#&quot;).append(s.charAt(i)); } sb.append(&quot;#$&quot;); String s2 = sb.toString(); int maxStart = 1, max = 0, rC = 1, rR = 1; int[] p = new int[s2.length()]; for (int i = 1; i &lt; s2.length() - 1; i++ ) { p[i] = i &lt; rR ? Math.min(p[2 * rC - i], rR - i) : 0; while (s2.charAt(i+p[i]+1) == s2.charAt(i - p[i] - 1)) { p[i] = p[i]+1; } if (i + p[i] &gt; rR) { rC = i; rR = i + p[i]; } if (p[i] &gt; max) { maxStart = i - p[i]; max = p[i]; } } return s2.substring(maxStart,maxStart + 2*max+1).replace(&quot;#&quot;, &quot;&quot;); }}","link":"/2019/2019-08-10-LeetCode_%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2%E7%AE%97%E6%B3%95/"},{"title":"LeetCodeä¸¤ä¸ªç»å…¸çš„æ’åºç®—æ³•","text":"LeetCodeä¸¤ä¸ªç»å…¸çš„æ’åºç®—æ³•è¿™å›æ˜¯æ ‡é¢˜å…šï¼Œ è®°å½•ä¸‹ä¸¤ä¸ªåˆ†è€Œæ²»ä¹‹çš„æ’åºç®—æ³•ï¼ˆæ‰‹å†™ï¼‰ï¼Œåˆ†è€Œæ²»ä¹‹çš„ç®—æ³•å¾ˆå®¹æ˜“æ”¹é€ æˆå¹¶è¡Œç®—æ³•ï¼Œè‚¯å®šæ˜¯æœªæ¥çš„æ½®æµï¼Œ leetcodeå·²é€šè¿‡ï¼Œ ä¸¤ä¸ªç®—æ³•éƒ½ä½¿ç”¨äº†åŸåœ°(inplace)æ›´æ–°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263class Solution { public List&lt;Integer&gt; sortArray(int[] nums) { // merge(nums, 0, nums.length - 1); sort(nums, 0, nums.length - 1); return IntStream.of(nums).boxed().collect(Collectors.toList()); } //-------------------å½’å¹¶æ’åº-------------------// private void merge(int[] nums, int start, int end) { if (start &gt;= end) return; int midIdx = start + (end - start) / 2; merge(nums, start, midIdx); merge(nums, midIdx+1, end); concat(nums, start, midIdx, end); } private void concat(int[] nums, int start, int midIdx, int end) { int[] tmp = new int[end - start + 1]; int lp = start, rp = midIdx + 1, i = 0; while (lp &lt;= midIdx &amp;&amp; rp &lt;= end) { tmp[i++] = nums[lp] &lt; nums[rp] ? nums[lp++] : nums[rp++]; } while (lp &lt;= midIdx) { tmp[i++] = nums[lp++]; } while (rp &lt;= end) { tmp[i++] = nums[rp++]; } System.arraycopy(tmp, 0, nums, start, tmp.length); } //-------------------å¿«é€Ÿæ’åº-------------------// private void sort(int[] nums, int start, int end) { if (start &gt;= end) return; int bIdx = partition(nums, start, end); sort(nums, start, bIdx - 1); sort(nums, bIdx + 1, end); } private int partition(int[] nums, int start, int end) { int idx = start, base = nums[end]; for (int i = start; i &lt; end; i++) { if (nums[i] &lt; base) { swap(nums, idx++, i); } } swap(nums, idx, end); return idx; } private void swap(int[] nums, int i, int j) { int tmp = nums[i]; nums[i] = nums[j]; nums[j] = tmp; }}","link":"/2019/2019-11-20-LeetCode_%E4%B8%A4%E4%B8%AA%E7%BB%8F%E5%85%B8%E7%9A%84%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"},{"title":"ç¼“å­˜ä¸“é¢˜(ä¸€) ç¼“å­˜æ¦‚è¿°","text":"ç¼“å­˜åˆ†ç±»åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¸¸è§çš„ç¼“å­˜ä¸»è¦å°±æ˜¯é™æ€ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜å’Œçƒ­ç‚¹æœ¬åœ°ç¼“å­˜è¿™ä¸‰ç§ã€‚ é™æ€ç¼“å­˜åœ¨ Web 1.0 æ—¶æœŸæ˜¯éå¸¸è‘—åçš„ï¼Œå®ƒä¸€èˆ¬é€šè¿‡ç”Ÿæˆ Velocity æ¨¡æ¿æˆ–è€…é™æ€ HTML æ–‡ä»¶æ¥å®ç°é™æ€ç¼“å­˜ï¼Œåœ¨ Nginx ä¸Šéƒ¨ç½²é™æ€ç¼“å­˜å¯ä»¥å‡å°‘å¯¹äºåå°åº”ç”¨æœåŠ¡å™¨çš„å‹åŠ›ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨åšä¸€äº›å†…å®¹ç®¡ç†ç³»ç»Ÿçš„æ—¶å€™ï¼Œåå°ä¼šå½•å…¥å¾ˆå¤šçš„æ–‡ç« ï¼Œå‰å°åœ¨ç½‘ç«™ä¸Šå±•ç¤ºæ–‡ç« å†…å®¹ï¼Œå°±åƒæ–°æµªï¼Œç½‘æ˜“è¿™ç§é—¨æˆ·ç½‘ç«™ä¸€æ ·ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ–‡ç« å½•å…¥åˆ°æ•°æ®åº“é‡Œé¢ï¼Œç„¶åå‰ç«¯å±•ç¤ºçš„æ—¶å€™ç©¿é€æŸ¥è¯¢æ•°æ®åº“æ¥è·å–æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¹æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚å³ä½¿æˆ‘ä»¬ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜æ¥æŒ¡è¯»è¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºåƒæ—¥å‡ PV å‡ åäº¿çš„å¤§å‹é—¨æˆ·ç½‘ç«™æ¥è¯´ï¼ŒåŸºäºæˆæœ¬è€ƒè™‘ä»ç„¶æ˜¯ä¸åˆ’ç®—çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è§£å†³æ€è·¯æ˜¯æ¯ç¯‡æ–‡ç« åœ¨å½•å…¥çš„æ—¶å€™æ¸²æŸ“æˆé™æ€é¡µé¢ï¼Œæ”¾ç½®åœ¨æ‰€æœ‰çš„å‰ç«¯ Nginx æˆ–è€… Squid ç­‰ Web æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ç”¨æˆ·åœ¨è®¿é—®çš„æ—¶å€™ä¼šä¼˜å…ˆè®¿é—® Web æœåŠ¡å™¨ä¸Šçš„é™æ€é¡µé¢ï¼Œåœ¨å¯¹æ—§çš„æ–‡ç« æ‰§è¡Œä¸€å®šçš„æ¸…ç†ç­–ç•¥åï¼Œä¾ç„¶å¯ä»¥ä¿è¯ 99% ä»¥ä¸Šçš„ç¼“å­˜å‘½ä¸­ç‡ã€‚ è¿™ç§ç¼“å­˜åªèƒ½é’ˆå¯¹é™æ€æ•°æ®æ¥ç¼“å­˜ï¼Œå¯¹äºåŠ¨æ€è¯·æ±‚å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•é’ˆå¯¹åŠ¨æ€è¯·æ±‚åšç¼“å­˜å‘¢ï¼Ÿè¿™æ—¶ä½ å°±éœ€è¦åˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚ åˆ†å¸ƒå¼ç¼“å­˜çš„å¤§åå¯è°“æ˜¯å¦‚é›·è´¯è€³äº†ï¼Œæˆ‘ä»¬å¹³æ—¶è€³ç†Ÿèƒ½è¯¦çš„ Memcachedã€Redis å°±æ˜¯åˆ†å¸ƒå¼ç¼“å­˜çš„å…¸å‹ä¾‹å­ã€‚å®ƒä»¬æ€§èƒ½å¼ºåŠ²ï¼Œé€šè¿‡ä¸€äº›åˆ†å¸ƒå¼çš„æ–¹æ¡ˆç»„æˆé›†ç¾¤å¯ä»¥çªç ´å•æœºçš„é™åˆ¶ã€‚æ‰€ä»¥åœ¨æ•´ä½“æ¶æ„ä¸­ï¼Œåˆ†å¸ƒå¼ç¼“å­˜æ‰¿æ‹…ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚ å¯¹äºé™æ€çš„èµ„æºçš„ç¼“å­˜ä½ å¯ä»¥é€‰æ‹©é™æ€ç¼“å­˜ï¼Œå¯¹äºåŠ¨æ€çš„è¯·æ±‚ä½ å¯ä»¥é€‰æ‹©åˆ†å¸ƒå¼ç¼“å­˜ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¦è€ƒè™‘çƒ­ç‚¹æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯å½“æˆ‘ä»¬é‡åˆ°æç«¯çš„çƒ­ç‚¹æ•°æ®æŸ¥è¯¢çš„æ—¶å€™ã€‚çƒ­ç‚¹æœ¬åœ°ç¼“å­˜ä¸»è¦éƒ¨ç½²åœ¨åº”ç”¨æœåŠ¡å™¨çš„ä»£ç ä¸­ï¼Œç”¨äºé˜»æŒ¡çƒ­ç‚¹æŸ¥è¯¢å¯¹äºåˆ†å¸ƒå¼ç¼“å­˜èŠ‚ç‚¹æˆ–è€…æ•°æ®åº“çš„å‹åŠ›ã€‚ æ¯”å¦‚æŸä¸€ä½æ˜æ˜Ÿåœ¨å¾®åšä¸Šæœ‰äº†çƒ­ç‚¹è¯é¢˜ï¼Œâ€œåƒç“œç¾¤ä¼—â€ä¼šåˆ°ä»– (å¥¹) çš„å¾®åšé¦–é¡µå›´è§‚ï¼Œè¿™å°±ä¼šå¼•å‘è¿™ä¸ªç”¨æˆ·ä¿¡æ¯çš„çƒ­ç‚¹æŸ¥è¯¢ã€‚è¿™äº›æŸ¥è¯¢é€šå¸¸ä¼šå‘½ä¸­æŸä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹æˆ–è€…æŸä¸€ä¸ªæ•°æ®åº“åˆ†åŒºï¼ŒçŸ­æ—¶é—´å†…ä¼šå½¢æˆæé«˜çš„çƒ­ç‚¹æŸ¥è¯¢ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­ä½¿ç”¨ä¸€äº›æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œå¦‚ HashMapï¼ŒGuava Cache æˆ–è€…æ˜¯ Ehcache ç­‰ï¼Œå®ƒä»¬å’Œåº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œä¼˜åŠ¿æ˜¯ä¸éœ€è¦è·¨ç½‘ç»œè°ƒåº¦ï¼Œé€Ÿåº¦æå¿«ï¼Œæ‰€ä»¥å¯ä»¥æ¥é˜»æŒ¡çŸ­æ—¶é—´å†…çš„çƒ­ç‚¹æŸ¥è¯¢ã€‚æ¥çœ‹ä¸ªä¾‹å­ã€‚ æ¯”æ–¹è¯´ä½ çš„å‚ç›´ç”µå•†ç³»ç»Ÿçš„é¦–é¡µæœ‰ä¸€äº›æ¨èçš„å•†å“ï¼Œè¿™äº›å•†å“ä¿¡æ¯æ˜¯ç”±ç¼–è¾‘åœ¨åå°å½•å…¥å’Œå˜æ›´ã€‚ä½ åˆ†æç¼–è¾‘å½•å…¥æ–°çš„å•†å“æˆ–è€…å˜æ›´æŸä¸ªå•†å“çš„ä¿¡æ¯åï¼Œåœ¨é¡µé¢çš„å±•ç¤ºæ˜¯å…è®¸æœ‰ä¸€äº›å»¶è¿Ÿçš„ï¼Œæ¯”å¦‚è¯´ 30 ç§’çš„å»¶è¿Ÿï¼Œå¹¶ä¸”é¦–é¡µè¯·æ±‚é‡æœ€å¤§ï¼Œå³ä½¿ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ä¹Ÿå¾ˆéš¾æŠ—ä½ï¼Œæ‰€ä»¥ä½ å†³å®šä½¿ç”¨ Guava Cache æ¥å°†æ‰€æœ‰çš„æ¨èå•†å“çš„ä¿¡æ¯ç¼“å­˜èµ·æ¥ï¼Œå¹¶ä¸”è®¾ç½®æ¯éš” 30 ç§’é‡æ–°ä»æ•°æ®åº“ä¸­åŠ è½½æœ€æ–°çš„æ‰€æœ‰å•†å“ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åˆå§‹åŒ– Guava çš„ Loading Cacheï¼š 123456789CacheBuilder&lt;String, List&lt;Product&gt;&gt; cacheBuilder = CacheBuilder.newBuilder().maximumSize(maxSize).recordStats(); // è®¾ç½®ç¼“å­˜æœ€å¤§å€¼cacheBuilder = cacheBuilder.refreshAfterWrite(30, TimeUnit.Seconds); // è®¾ç½®åˆ·æ–°é—´éš” LoadingCache&lt;String, List&lt;Product&gt;&gt; cache = cacheBuilder.build(new CacheLoader&lt;String, List&lt;Product&gt;&gt;() { @Override public List&lt;Product&gt; load(String k) throws Exception { return productService.loadAll(); // è·å–æ‰€æœ‰å•†å“ }}); è¿™æ ·ï¼Œä½ åœ¨è·å–æ‰€æœ‰å•†å“ä¿¡æ¯çš„æ—¶å€™å¯ä»¥è°ƒç”¨ Loading Cache çš„ get æ–¹æ³•ï¼Œå°±å¯ä»¥ä¼˜å…ˆä»æœ¬åœ°ç¼“å­˜ä¸­è·å–å•†å“ä¿¡æ¯ï¼Œå¦‚æœæœ¬åœ°ç¼“å­˜ä¸å­˜åœ¨ï¼Œä¼šä½¿ç”¨ CacheLoader ä¸­çš„é€»è¾‘ä»æ•°æ®åº“ä¸­åŠ è½½æ‰€æœ‰çš„å•†å“ã€‚ ç”±äºæœ¬åœ°ç¼“å­˜æ˜¯éƒ¨ç½²åœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ï¼Œè€Œæˆ‘ä»¬åº”ç”¨æœåŠ¡å™¨é€šå¸¸ä¼šéƒ¨ç½²å¤šå°ï¼Œå½“æ•°æ®æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡®å®šå“ªå°æœåŠ¡å™¨æœ¬åœ°ä¸­äº†ç¼“å­˜ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤æ‰€æœ‰æœåŠ¡å™¨çš„ç¼“å­˜ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šç­‰å¾…ç¼“å­˜è¿‡æœŸã€‚å› æ­¤ï¼Œè¿™ç§ç¼“å­˜çš„æœ‰æ•ˆæœŸå¾ˆçŸ­ï¼Œé€šå¸¸ä¸ºåˆ†é’Ÿæˆ–è€…ç§’çº§åˆ«ï¼Œä»¥é¿å…è¿”å›å‰ç«¯è„æ•°æ®ã€‚ ç¼“å­˜çš„ä¸è¶³é€šè¿‡äº†è§£ä¸Šé¢çš„å†…å®¹ï¼Œä½ ä¸éš¾å‘ç°ï¼Œç¼“å­˜çš„ä¸»è¦ä½œç”¨æ˜¯æå‡è®¿é—®é€Ÿåº¦ï¼Œä»è€Œèƒ½å¤ŸæŠ—ä½æ›´é«˜çš„å¹¶å‘ã€‚é‚£ä¹ˆï¼Œç¼“å­˜æ˜¯ä¸æ˜¯èƒ½å¤Ÿè§£å†³ä¸€åˆ‡é—®é¢˜ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ã€‚äº‹ç‰©éƒ½æ˜¯å…·æœ‰ä¸¤é¢æ€§çš„ï¼Œç¼“å­˜ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘ä»¬è¦äº†è§£å®ƒçš„ä¼˜åŠ¿çš„åŒæ—¶ä¹Ÿéœ€è¦äº†è§£å®ƒæœ‰å“ªäº›ä¸è¶³ï¼Œä»è€Œæ‰¬é•¿é¿çŸ­ï¼Œå°†å®ƒçš„ä½œç”¨å‘æŒ¥åˆ°æœ€å¤§ã€‚ é¦–å…ˆï¼Œç¼“å­˜æ¯”è¾ƒé€‚åˆäºè¯»å¤šå†™å°‘çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¹¶ä¸”æ•°æ®æœ€å¥½å¸¦æœ‰ä¸€å®šçš„çƒ­ç‚¹å±æ€§ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜æ¯•ç«Ÿä¼šå—é™äºå­˜å‚¨ä»‹è´¨ä¸å¯èƒ½ç¼“å­˜æ‰€æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå½“æ•°æ®æœ‰çƒ­ç‚¹å±æ€§çš„æ—¶å€™æ‰èƒ½ä¿è¯ä¸€å®šçš„ç¼“å­˜å‘½ä¸­ç‡ã€‚æ¯”å¦‚è¯´ç±»ä¼¼å¾®åšã€æœ‹å‹åœˆè¿™ç§ 20% çš„å†…å®¹ä¼šå åˆ° 80% çš„æµé‡ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦å½“ä¸šåŠ¡åœºæ™¯è¯»å°‘å†™å¤šæ—¶æˆ–è€…æ²¡æœ‰æ˜æ˜¾çƒ­ç‚¹æ—¶ï¼Œæ¯”å¦‚åœ¨æœç´¢çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªäººæœç´¢çš„è¯éƒ½ä¼šä¸åŒï¼Œæ²¡æœ‰æ˜æ˜¾çš„çƒ­ç‚¹ï¼Œé‚£ä¹ˆè¿™æ—¶ç¼“å­˜çš„ä½œç”¨å°±ä¸æ˜æ˜¾äº†ã€‚ å…¶æ¬¡ï¼Œç¼“å­˜ä¼šç»™æ•´ä½“ç³»ç»Ÿå¸¦æ¥å¤æ‚åº¦ï¼Œå¹¶ä¸”ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚å½“æ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œæ›´æ–°ç¼“å­˜å¤±è´¥çš„åœºæ™¯ä¸‹ï¼Œç¼“å­˜ä¸­å°±ä¼šå­˜åœ¨è„æ•°æ®ã€‚å¯¹äºè¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´æˆ–è€…æ‰‹åŠ¨æ¸…ç†çš„æ–¹å¼æ¥è§£å†³ã€‚ å†æ¬¡ï¼Œä¹‹å‰æåˆ°ç¼“å­˜é€šå¸¸ä½¿ç”¨å†…å­˜ä½œä¸ºå­˜å‚¨ä»‹è´¨ï¼Œä½†æ˜¯å†…å­˜å¹¶ä¸æ˜¯æ— é™çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç¼“å­˜çš„æ—¶å€™è¦åšæ•°æ®å­˜å‚¨é‡çº§çš„è¯„ä¼°ï¼Œå¯¹äºå¯é¢„è§çš„éœ€è¦æ¶ˆè€—æå¤§å­˜å‚¨æˆæœ¬çš„æ•°æ®ï¼Œè¦æ…ç”¨ç¼“å­˜æ–¹æ¡ˆã€‚åŒæ—¶ï¼Œç¼“å­˜ä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç¼“å­˜ä¸­çš„ä¼šæ˜¯çƒ­ç‚¹æ•°æ®ã€‚ æœ€åï¼Œç¼“å­˜ä¼šç»™è¿ç»´ä¹Ÿå¸¦æ¥ä¸€å®šçš„æˆæœ¬ï¼Œè¿ç»´éœ€è¦å¯¹ç¼“å­˜ç»„ä»¶æœ‰ä¸€å®šçš„äº†è§£ï¼Œåœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™ä¹Ÿå¤šäº†ä¸€ä¸ªç»„ä»¶éœ€è¦è€ƒè™‘åœ¨å†…ã€‚ è™½ç„¶æœ‰è¿™ä¹ˆå¤šçš„ä¸è¶³ï¼Œä½†æ˜¯ç¼“å­˜å¯¹äºæ€§èƒ½çš„æå‡æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œæˆ‘ä»¬åœ¨åšæ¶æ„è®¾è®¡çš„æ—¶å€™ä¹Ÿéœ€è¦æŠŠå®ƒè€ƒè™‘åœ¨å†…ï¼Œåªæ˜¯åœ¨åšå…·ä½“æ–¹æ¡ˆçš„æ—¶å€™éœ€è¦å¯¹ç¼“å­˜çš„è®¾è®¡æœ‰æ›´ç»†è‡´çš„æ€è€ƒï¼Œæ‰èƒ½æœ€å¤§åŒ–çš„å‘æŒ¥ç¼“å­˜çš„ä¼˜åŠ¿ã€‚","link":"/2019/2019-12-01-%E7%BC%93%E5%AD%98%E4%B8%93%E9%A2%98(%E4%B8%80)_%E7%BC%93%E5%AD%98%E6%A6%82%E8%BF%B0/"},{"title":"NoSqlç›¸å¯¹äºå…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿","text":"ä½¿ç”¨ NoSQL æå‡å†™å…¥æ€§èƒ½æ•°æ®åº“ç³»ç»Ÿå¤§å¤šä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„æœºæ¢°ç£ç›˜ï¼Œå¯¹äºæœºæ¢°ç£ç›˜çš„è®¿é—®æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯éšæœº IOï¼›å¦ä¸€ç§æ˜¯é¡ºåº IOã€‚éšæœº IO å°±éœ€è¦èŠ±è´¹æ—¶é—´åšæ˜‚è´µçš„ç£ç›˜å¯»é“ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®ƒçš„è¯»å†™æ•ˆç‡è¦æ¯”é¡ºåº IO å°ä¸¤åˆ°ä¸‰ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦æå‡å†™å…¥çš„æ€§èƒ½å°±è¦å°½é‡å‡å°‘éšæœº IOã€‚ ä»¥ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œæ›´æ–° binlogã€redologã€undolog éƒ½æ˜¯åœ¨åšé¡ºåº IOï¼Œè€Œæ›´æ–° datafile å’Œç´¢å¼•æ–‡ä»¶åˆ™æ˜¯åœ¨åšéšæœº IOï¼Œè€Œä¸ºäº†å‡å°‘éšæœº IO çš„å‘ç”Ÿï¼Œå…³ç³»æ•°æ®åº“å·²ç»åšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è¯´å†™å…¥æ—¶å…ˆå†™å…¥å†…å­˜ï¼Œç„¶åæ‰¹é‡åˆ·æ–°åˆ°ç£ç›˜ä¸Šï¼Œä½†æ˜¯éšæœº IO è¿˜æ˜¯ä¼šå‘ç”Ÿã€‚ ç´¢å¼•åœ¨ InnoDB å¼•æ“ä¸­æ˜¯ä»¥ B+ æ ‘æ–¹å¼æ¥ç»„ç»‡çš„ï¼Œè€Œ MySQL ä¸»é”®æ˜¯èšç°‡ç´¢å¼•ï¼ˆä¸€ç§ç´¢å¼•ç±»å‹ï¼Œæ•°æ®ä¸ç´¢å¼•æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼‰ï¼Œæ—¢ç„¶æ•°æ®å’Œç´¢å¼•æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆåœ¨æ•°æ®æ’å…¥æˆ–è€…æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œå†æŠŠæ•°æ®å†™åˆ°ç‰¹å®šçš„ä½ç½®ä¸Šï¼Œè¿™å°±äº§ç”Ÿäº†éšæœºçš„ IOã€‚è€Œä¸”ä¸€æ—¦å‘ç”Ÿäº†é¡µåˆ†è£‚ï¼Œå°±ä¸å¯é¿å…ä¼šåšæ•°æ®çš„ç§»åŠ¨ï¼Œä¹Ÿä¼šæå¤§åœ°æŸè€—å†™å…¥æ€§èƒ½ã€‚ NoSQL æ•°æ®åº“æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ å®ƒä»¬æœ‰å¤šç§çš„è§£å†³æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ç»™ä½ è®²ä¸€ç§æœ€å¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å¾ˆå¤š NoSQL æ•°æ®åº“éƒ½åœ¨ä½¿ç”¨çš„åŸºäº LSM æ ‘çš„å­˜å‚¨å¼•æ“ï¼Œè¿™ç§ç®—æ³•ä½¿ç”¨æœ€å¤šï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç€é‡å‰–æä¸€ä¸‹ã€‚ LSM æ ‘ï¼ˆLog-Structured Merge Treeï¼‰ç‰ºç‰²äº†ä¸€å®šçš„è¯»æ€§èƒ½æ¥æ¢å–å†™å…¥æ•°æ®çš„é«˜æ€§èƒ½ï¼ŒHbaseã€Cassandraã€LevelDB éƒ½æ˜¯ç”¨è¿™ç§ç®—æ³•ä½œä¸ºå­˜å‚¨çš„å¼•æ“ã€‚ å®ƒçš„æ€æƒ³å¾ˆç®€å•ï¼Œæ•°æ®é¦–å…ˆä¼šå†™å…¥åˆ°ä¸€ä¸ªå«åš MemTable çš„å†…å­˜ç»“æ„ä¸­ï¼Œåœ¨ MemTable ä¸­æ•°æ®æ˜¯æŒ‰ç…§å†™å…¥çš„ Key æ¥æ’åºçš„ã€‚ä¸ºäº†é˜²æ­¢ MemTable é‡Œé¢çš„æ•°æ®å› ä¸ºæœºå™¨æ‰ç”µæˆ–è€…é‡å¯è€Œä¸¢å¤±ï¼Œä¸€èˆ¬ä¼šé€šè¿‡å†™ Write Ahead Log çš„æ–¹å¼å°†æ•°æ®å¤‡ä»½åœ¨ç£ç›˜ä¸Šã€‚ MemTable åœ¨ç´¯ç§¯åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œå®ƒä¼šè¢«åˆ·æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ–‡ä»¶å«åš SSTableï¼ˆSorted String Tableï¼‰ã€‚å½“ SSTable è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†è¿™äº› SSTable åˆå¹¶ï¼Œå‡å°‘æ–‡ä»¶çš„æ•°é‡ï¼Œå› ä¸º SSTable éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥åˆå¹¶çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ å½“ä» LSM æ ‘é‡Œé¢è¯»æ•°æ®æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆä» MemTable ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰æ‰¾åˆ°ï¼Œå†ä» SSTable ä¸­æŸ¥æ‰¾æ•°æ®ã€‚å› ä¸ºå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯å¾ˆé«˜çš„ï¼Œåªæ˜¯å› ä¸ºæ•°æ®è¢«æ‹†åˆ†æˆå¤šä¸ª SSTableï¼Œæ‰€ä»¥è¯»å–çš„æ•ˆç‡ä¼šä½äº B+ æ ‘ç´¢å¼•ã€‚ å’Œ LSM æ ‘ç±»ä¼¼çš„ç®—æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è¯´ TokuDB ä½¿ç”¨çš„åä¸º Fractal tree çš„ç´¢å¼•ç»“æ„ï¼Œå®ƒä»¬çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†éšæœº IO å˜æˆé¡ºåºçš„ IOï¼Œä»è€Œæå‡å†™å…¥çš„æ€§èƒ½ã€‚ æå‡æ‰©å±•æ€§å¦å¤–ï¼Œåœ¨æ‰©å±•æ€§æ–¹é¢ï¼Œå¾ˆå¤š NoSQL æ•°æ®åº“ä¹Ÿæœ‰ç€å…ˆå¤©çš„ä¼˜åŠ¿ã€‚è¿˜æ˜¯ä»¥ä½ çš„å‚ç›´ç”µå•†ç³»ç»Ÿä¸ºä¾‹ï¼Œä½ å·²ç»ä¸ºä½ çš„ç”µå•†ç³»ç»Ÿå¢åŠ äº†è¯„è®ºç³»ç»Ÿï¼Œå¼€å§‹ä½ çš„è¯„ä¼°æ¯”è¾ƒä¹è§‚ï¼Œè§‰å¾—ç”µå•†ç³»ç»Ÿçš„è¯„è®ºé‡çº§ä¸ä¼šå¢é•¿å¾ˆå¿«ï¼Œæ‰€ä»¥å°±ä¸ºå®ƒåˆ†äº† 8 ä¸ªåº“ï¼Œæ¯ä¸ªåº“æ‹†åˆ†æˆ 16 å¼ è¡¨ã€‚ ä½†æ˜¯è¯„è®ºç³»ç»Ÿä¸Šçº¿ä¹‹åï¼Œå­˜å‚¨é‡çº§å¢é•¿çš„å¼‚å¸¸è¿…çŒ›ï¼Œä½ ä¸å¾—ä¸å°†æ•°æ®åº“æ‹†åˆ†æˆæ›´å¤šçš„åº“è¡¨ï¼Œè€Œæ•°æ®ä¹Ÿè¦é‡æ–°è¿ç§»åˆ°æ–°çš„åº“è¡¨ä¸­ï¼Œè¿‡ç¨‹éå¸¸ç—›è‹¦ï¼Œè€Œä¸”æ•°æ®è¿ç§»çš„è¿‡ç¨‹ä¹Ÿéå¸¸å®¹æ˜“å‡ºé”™ã€‚ è¿™æ—¶ï¼Œä½ è€ƒè™‘æ˜¯å¦å¯ä»¥è€ƒè™‘ä½¿ç”¨ NoSQL æ•°æ®åº“æ¥å½»åº•è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼Œç»è¿‡è°ƒç ”ä½ å‘ç°å®ƒä»¬åœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘åˆ°äº†åˆ†å¸ƒå¼å’Œå¤§æ•°æ®å­˜å‚¨çš„åœºæ™¯ï¼Œæ¯”å¦‚åƒ MongoDB å°±æœ‰ä¸‰ä¸ªæ‰©å±•æ€§æ–¹é¢çš„ç‰¹æ€§ã€‚ å…¶ä¸€æ˜¯ Replicaï¼Œä¹Ÿå«åšå‰¯æœ¬é›†ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸»ä»åˆ†ç¦»ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å°†æ•°æ®æ‹·è´æˆå¤šä»½æ¥ä¿è¯å½“ä¸»æŒ‚æ‰åæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚åŒæ—¶å‘¢ï¼ŒReplica è¿˜å¯ä»¥åˆ†æ‹…è¯»è¯·æ±‚ã€‚Replica ä¸­æœ‰ä¸»èŠ‚ç‚¹æ¥æ‰¿æ‹…å†™è¯·æ±‚ï¼Œå¹¶ä¸”æŠŠå¯¹æ•°æ®å˜åŠ¨è®°å½•åˆ° oplog é‡Œï¼ˆç±»ä¼¼äº binlogï¼‰ï¼›ä»èŠ‚ç‚¹æ¥æ”¶åˆ° oplog åå°±ä¼šä¿®æ”¹è‡ªèº«çš„æ•°æ®ä»¥ä¿æŒå’Œä¸»èŠ‚ç‚¹çš„ä¸€è‡´ã€‚ä¸€æ—¦ä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼ŒMongoDB ä¼šä»ä»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥ç»§ç»­æä¾›å†™æ•°æ®æœåŠ¡ã€‚ å…¶äºŒæ˜¯ Shardï¼Œä¹Ÿå«åšåˆ†ç‰‡ï¼Œä½ å¯ä»¥ç†è§£ä¸ºåˆ†åº“åˆ†è¡¨ï¼Œå³å°†æ•°æ®æŒ‰ç…§æŸç§è§„åˆ™æ‹†åˆ†æˆå¤šä»½ï¼Œå­˜å‚¨åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚MongoDB çš„ Sharding ç‰¹æ€§ä¸€èˆ¬éœ€è¦ä¸‰ä¸ªè§’è‰²æ¥æ”¯æŒï¼Œä¸€ä¸ªæ˜¯ Shard Serverï¼Œå®ƒæ˜¯å®é™…å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Mongod è¿›ç¨‹ï¼›äºŒæ˜¯ Config Serverï¼Œä¹Ÿæ˜¯ä¸€ç»„ Mongod è¿›ç¨‹ï¼Œä¸»è¦å­˜å‚¨ä¸€äº›å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚è¯´å“ªäº›åˆ†ç‰‡å­˜å‚¨äº†å“ªäº›æ•°æ®ç­‰ï¼›æœ€åæ˜¯ Route Serverï¼Œå®ƒä¸å®é™…å­˜å‚¨æ•°æ®ï¼Œä»…ä»…ä½œä¸ºè·¯ç”±ä½¿ç”¨ï¼Œå®ƒä» Config Server ä¸­è·å–å…ƒä¿¡æ¯åï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„ Shard Server ä¸­ã€‚ å…¶ä¸‰æ˜¯è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯å½“ MongoDB å‘ç° Shard ä¹‹é—´æ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼Œä¼šå¯åŠ¨ Balancer è¿›ç¨‹å¯¹æ•°æ®åšé‡æ–°çš„åˆ†é…ï¼Œæœ€ç»ˆè®©ä¸åŒ Shard Server çš„æ•°æ®å¯ä»¥å°½é‡çš„å‡è¡¡ã€‚å½“æˆ‘ä»¬çš„ Shard Server å­˜å‚¨ç©ºé—´ä¸è¶³éœ€è¦æ‰©å®¹æ—¶ï¼Œæ•°æ®ä¼šè‡ªåŠ¨è¢«ç§»åŠ¨åˆ°æ–°çš„ Shard Server ä¸Šï¼Œå‡å°‘äº†æ•°æ®è¿ç§»å’ŒéªŒè¯çš„æˆæœ¬ã€‚ ä½ å¯ä»¥çœ‹åˆ°ï¼ŒNoSQL æ•°æ®åº“ä¸­å†…ç½®çš„æ‰©å±•æ€§æ–¹é¢çš„ç‰¹æ€§å¯ä»¥è®©æˆ‘ä»¬ä¸å†éœ€è¦å¯¹æ•°æ®åº“åšåˆ†åº“åˆ†è¡¨å’Œä¸»ä»åˆ†ç¦»ï¼Œä¹Ÿæ˜¯å¯¹ä¼ ç»Ÿæ•°æ®åº“ä¸€ä¸ªè‰¯å¥½çš„è¡¥å……ã€‚","link":"/2019/2019-12-01-NoSql%E7%9B%B8%E5%AF%B9%E4%BA%8E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BC%98%E5%8A%BF/"},{"title":"ç¼“å­˜ä¸“é¢˜(äºŒ) Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰ç­–ç•¥","text":"æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ç§æœ€ç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”æ–¹è¯´åœ¨ä½ çš„ç”µå•†ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç”¨æˆ·è¡¨ï¼Œè¡¨ä¸­åªæœ‰ ID å’Œå¹´é¾„ä¸¤ä¸ªå­—æ®µï¼Œç¼“å­˜ä¸­æˆ‘ä»¬ä»¥ ID ä¸º Key å­˜å‚¨ç”¨æˆ·çš„å¹´é¾„ä¿¡æ¯ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è¦æŠŠ ID ä¸º 1 çš„ç”¨æˆ·çš„å¹´é¾„ä» 19 å˜æ›´ä¸º 20ï¼Œè¦å¦‚ä½•åšå‘¢ï¼Ÿ ä½ å¯èƒ½ä¼šäº§ç”Ÿè¿™æ ·çš„æ€è·¯ï¼šå…ˆæ›´æ–°æ•°æ®åº“ä¸­ ID ä¸º 1 çš„è®°å½•ï¼Œå†æ›´æ–°ç¼“å­˜ä¸­ Key ä¸º 1 çš„æ•°æ®ã€‚ è¿™ä¸ªæ€è·¯ä¼šé€ æˆç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼ŒA è¯·æ±‚å°†æ•°æ®åº“ä¸­ ID ä¸º 1 çš„ç”¨æˆ·å¹´é¾„ä» 19 å˜æ›´ä¸º 20ï¼Œä¸æ­¤åŒæ—¶ï¼Œè¯·æ±‚ B ä¹Ÿå¼€å§‹æ›´æ–° ID ä¸º 1 çš„ç”¨æˆ·æ•°æ®ï¼Œå®ƒæŠŠæ•°æ®åº“ä¸­è®°å½•çš„å¹´é¾„å˜æ›´ä¸º 21ï¼Œç„¶åå˜æ›´ç¼“å­˜ä¸­çš„ç”¨æˆ·å¹´é¾„ä¸º 21ã€‚ç´§æ¥ç€ï¼ŒA è¯·æ±‚å¼€å§‹æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œå®ƒä¼šæŠŠç¼“å­˜ä¸­çš„å¹´é¾„å˜æ›´ä¸º 20ã€‚æ­¤æ—¶ï¼Œæ•°æ®åº“ä¸­ç”¨æˆ·å¹´é¾„æ˜¯ 21ï¼Œè€Œç¼“å­˜ä¸­çš„ç”¨æˆ·å¹´é¾„å´æ˜¯ 20ã€‚ ä¸ºä»€ä¹ˆäº§ç”Ÿè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå› ä¸ºå˜æ›´æ•°æ®åº“å’Œå˜æ›´ç¼“å­˜æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œè€Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹æ“ä½œåšä»»ä½•çš„å¹¶å‘æ§åˆ¶ã€‚é‚£ä¹ˆå½“ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ›´æ–°å®ƒä»¬çš„æ—¶å€™ï¼Œå°±ä¼šå› ä¸ºå†™å…¥é¡ºåºçš„ä¸åŒé€ æˆæ•°æ®çš„ä¸ä¸€è‡´ã€‚ å¦å¤–ï¼Œç›´æ¥æ›´æ–°ç¼“å­˜è¿˜å­˜åœ¨å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸¢å¤±æ›´æ–°ã€‚è¿˜æ˜¯ä»¥æˆ‘ä»¬çš„ç”µå•†ç³»ç»Ÿä¸ºä¾‹ï¼Œå‡å¦‚ç”µå•†ç³»ç»Ÿä¸­çš„è´¦æˆ·è¡¨æœ‰ä¸‰ä¸ªå­—æ®µï¼šIDã€æˆ·åå’Œé‡‘é¢ï¼Œè¿™ä¸ªæ—¶å€™ç¼“å­˜ä¸­å­˜å‚¨çš„å°±ä¸åªæ˜¯é‡‘é¢ä¿¡æ¯ï¼Œè€Œæ˜¯å®Œæ•´çš„è´¦æˆ·ä¿¡æ¯äº†ã€‚å½“æ›´æ–°ç¼“å­˜ä¸­è´¦æˆ·é‡‘é¢æ—¶ï¼Œä½ éœ€è¦ä»ç¼“å­˜ä¸­æŸ¥è¯¢å®Œæ•´çš„è´¦æˆ·æ•°æ®ï¼ŒæŠŠé‡‘é¢å˜æ›´åå†å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šæœ‰å¹¶å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´åŸæœ‰é‡‘é¢æ˜¯ 20ï¼ŒA è¯·æ±‚ä»ç¼“å­˜ä¸­è¯»åˆ°æ•°æ®ï¼Œå¹¶ä¸”æŠŠé‡‘é¢åŠ  1ï¼Œå˜æ›´æˆ 21ï¼Œåœ¨æœªå†™å…¥ç¼“å­˜ä¹‹å‰åˆæœ‰è¯·æ±‚ B ä¹Ÿè¯»åˆ°ç¼“å­˜çš„æ•°æ®åæŠŠé‡‘é¢ä¹ŸåŠ  1ï¼Œä¹Ÿå˜æ›´æˆ 21ï¼Œä¸¤ä¸ªè¯·æ±‚åŒæ—¶æŠŠé‡‘é¢å†™å›ç¼“å­˜ï¼Œè¿™æ—¶ç¼“å­˜é‡Œé¢çš„é‡‘é¢æ˜¯ 21ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šé¢„æœŸæ˜¯é‡‘é¢æ•°åŠ  2ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ã€‚ é‚£æˆ‘ä»¬è¦å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ›´æ–°æ•°æ®æ—¶ä¸æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡äº†æ•°æ®ä¹‹åï¼Œå†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚ è¿™ä¸ªç­–ç•¥å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æœ€å¸¸è§çš„ç­–ç•¥ï¼ŒCache Aside ç­–ç•¥ï¼ˆä¹Ÿå«æ—è·¯ç¼“å­˜ç­–ç•¥ï¼‰ï¼Œè¿™ä¸ªç­–ç•¥æ•°æ®ä»¥æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ºå‡†ï¼Œç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æŒ‰éœ€åŠ è½½çš„ã€‚å®ƒå¯ä»¥åˆ†ä¸ºè¯»ç­–ç•¥å’Œå†™ç­–ç•¥ï¼Œå…¶ä¸­è¯»ç­–ç•¥çš„æ­¥éª¤æ˜¯ï¼š ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼› å¦‚æœç¼“å­˜å‘½ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ï¼› å¦‚æœç¼“å­˜ä¸å‘½ä¸­ï¼Œåˆ™ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼› æŸ¥è¯¢åˆ°æ•°æ®åï¼Œå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”è¿”å›ç»™ç”¨æˆ·ã€‚ å†™ç­–ç•¥çš„æ­¥éª¤æ˜¯ï¼š æ›´æ–°æ•°æ®åº“ä¸­çš„è®°å½•ï¼› åˆ é™¤ç¼“å­˜è®°å½•ã€‚ ä½ ä¹Ÿè®¸ä¼šé—®äº†ï¼Œåœ¨å†™ç­–ç•¥ä¸­ï¼Œèƒ½å¦å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºè¿™æ ·ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¥ç”¨æˆ·è¡¨çš„åœºæ™¯ä¸ºä¾‹è§£é‡Šä¸€ä¸‹ã€‚ å‡è®¾æŸä¸ªç”¨æˆ·çš„å¹´é¾„æ˜¯ 20ï¼Œè¯·æ±‚ A è¦æ›´æ–°ç”¨æˆ·å¹´é¾„ä¸º 21ï¼Œæ‰€ä»¥å®ƒä¼šåˆ é™¤ç¼“å­˜ä¸­çš„å†…å®¹ã€‚è¿™æ—¶ï¼Œå¦ä¸€ä¸ªè¯·æ±‚ B è¦è¯»å–è¿™ä¸ªç”¨æˆ·çš„å¹´é¾„ï¼Œå®ƒæŸ¥è¯¢ç¼“å­˜å‘ç°æœªå‘½ä¸­åï¼Œä¼šä»æ•°æ®åº“ä¸­è¯»å–åˆ°å¹´é¾„ä¸º 20ï¼Œå¹¶ä¸”å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åè¯·æ±‚ A ç»§ç»­æ›´æ”¹æ•°æ®åº“ï¼Œå°†ç”¨æˆ·çš„å¹´é¾„æ›´æ–°ä¸º 21ï¼Œè¿™å°±é€ æˆäº†ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸ä¸€è‡´ã€‚ é‚£ä¹ˆåƒ Cache Aside ç­–ç•¥è¿™æ ·å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜å°±æ²¡æœ‰é—®é¢˜äº†å—ï¼Ÿå…¶å®åœ¨ç†è®ºä¸Šè¿˜æ˜¯æœ‰ç¼ºé™·çš„ã€‚å‡å¦‚æŸä¸ªç”¨æˆ·æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œè¯·æ±‚ A è¯»å–æ•°æ®æ—¶ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¹´é¾„ä¸º 20ï¼Œåœ¨æœªå†™å…¥ç¼“å­˜ä¸­æ—¶å¦ä¸€ä¸ªè¯·æ±‚ B æ›´æ–°æ•°æ®ã€‚å®ƒæ›´æ–°æ•°æ®åº“ä¸­çš„å¹´é¾„ä¸º 21ï¼Œå¹¶ä¸”æ¸…ç©ºç¼“å­˜ã€‚è¿™æ—¶è¯·æ±‚ A æŠŠä»æ•°æ®åº“ä¸­è¯»åˆ°çš„å¹´é¾„ä¸º 20 çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œé€ æˆç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ã€‚ ä¸è¿‡è¿™ç§é—®é¢˜å‡ºç°çš„å‡ ç‡å¹¶ä¸é«˜ï¼ŒåŸå› æ˜¯ç¼“å­˜çš„å†™å…¥é€šå¸¸è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ï¼Œæ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”æ¸…ç©ºäº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚è€Œä¸€æ—¦è¯·æ±‚ A æ—©äºè¯·æ±‚ B æ¸…ç©ºç¼“å­˜ä¹‹å‰æ›´æ–°äº†ç¼“å­˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„è¯·æ±‚å°±ä¼šå› ä¸ºç¼“å­˜ä¸ºç©ºè€Œä»æ•°æ®åº“ä¸­é‡æ–°åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°è¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µã€‚ Cache Aside ç­–ç•¥æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æœ€ç»å¸¸ä½¿ç”¨çš„ç¼“å­˜ç­–ç•¥ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ä¹Ÿè¦å­¦ä¼šä¾æƒ…å†µè€Œå˜ã€‚æ¯”å¦‚è¯´å½“æ–°æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼ŒæŒ‰ç…§è¿™ä¸ªæ›´æ–°ç­–ç•¥ï¼Œä½ è¦å†™æ•°æ®åº“ï¼Œç„¶åæ¸…ç†ç¼“å­˜ï¼ˆå½“ç„¶ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ç»™ä½ æ¸…ç†ï¼‰ã€‚å¯å½“æˆ‘æ³¨å†Œç”¨æˆ·åç«‹å³è¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”æ•°æ®åº“ä¸»ä»åˆ†ç¦»æ—¶ï¼Œä¼šå‡ºç°å› ä¸ºä¸»ä»å»¶è¿Ÿæ‰€ä»¥è¯»ä¸åˆ°ç”¨æˆ·ä¿¡æ¯çš„æƒ…å†µã€‚ è€Œè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ°æ°æ˜¯åœ¨æ’å…¥æ–°æ•°æ®åˆ°æ•°æ®åº“ä¹‹åå†™å…¥ç¼“å­˜ï¼Œè¿™æ ·åç»­çš„è¯»è¯·æ±‚å°±ä¼šä»ç¼“å­˜ä¸­è¯»åˆ°æ•°æ®äº†ã€‚å¹¶ä¸”å› ä¸ºæ˜¯æ–°æ³¨å†Œçš„ç”¨æˆ·ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¹¶å‘æ›´æ–°ç”¨æˆ·ä¿¡æ¯çš„æƒ…å†µã€‚ Cache Aside å­˜åœ¨çš„æœ€å¤§çš„é—®é¢˜æ˜¯å½“å†™å…¥æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹åœ°æ¸…ç†ï¼Œè¿™æ ·ä¼šå¯¹ç¼“å­˜çš„å‘½ä¸­ç‡æœ‰ä¸€äº›å½±å“ã€‚å¦‚æœä½ çš„ä¸šåŠ¡å¯¹ç¼“å­˜å‘½ä¸­ç‡æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š ä¸€ç§åšæ³•æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶ä¹Ÿæ›´æ–°ç¼“å­˜ï¼Œåªæ˜¯åœ¨æ›´æ–°ç¼“å­˜å‰å…ˆåŠ ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå› ä¸ºè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ›´æ–°ç¼“å­˜ï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜äº†ã€‚å½“ç„¶è¿™ä¹ˆåšå¯¹äºå†™å…¥çš„æ€§èƒ½ä¼šæœ‰ä¸€äº›å½±å“ï¼› å¦ä¸€ç§åšæ³•åŒæ ·ä¹Ÿæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ›´æ–°ç¼“å­˜ï¼Œåªæ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å³ä½¿å‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«åœ°è¿‡æœŸï¼Œå¯¹ä¸šåŠ¡çš„å½±å“ä¹Ÿæ˜¯å¯ä»¥æ¥å—ã€‚","link":"/2019/2019-12-01-%E7%BC%93%E5%AD%98%E4%B8%93%E9%A2%98(%E4%BA%8C)_Cache%20Aside(%E6%97%81%E8%B7%AF%E7%BC%93%E5%AD%98)%E7%AD%96%E7%95%A5/"},{"title":"ç¼“å­˜ä¸“é¢˜(ä¸‰) Write Throughï¼ˆè¯»ç©¿ å†™ç©¿ï¼‰ç­–ç•¥","text":"è¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒåŸåˆ™æ˜¯ç”¨æˆ·åªä¸ç¼“å­˜æ‰“äº¤é“ï¼Œç”±ç¼“å­˜å’Œæ•°æ®åº“é€šä¿¡ï¼Œå†™å…¥æˆ–è€…è¯»å–æ•°æ®ã€‚è¿™å°±å¥½æ¯”ä½ åœ¨æ±‡æŠ¥å·¥ä½œçš„æ—¶å€™åªå¯¹ä½ çš„ç›´æ¥ä¸Šçº§æ±‡æŠ¥ï¼Œå†ç”±ä½ çš„ç›´æ¥ä¸Šçº§æ±‡æŠ¥ç»™ä»–çš„ä¸Šçº§ï¼Œä½ æ˜¯ä¸èƒ½è¶Šçº§æ±‡æŠ¥çš„ã€‚ Write Through çš„ç­–ç•¥æ˜¯è¿™æ ·çš„ï¼šå…ˆæŸ¥è¯¢è¦å†™å…¥çš„æ•°æ®åœ¨ç¼“å­˜ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”ç”±ç¼“å­˜ç»„ä»¶åŒæ­¥æ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œå¦‚æœç¼“å­˜ä¸­æ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æƒ…å†µå«åšâ€œWrite Missï¼ˆå†™å¤±æ•ˆï¼‰â€ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¤ç§â€œWrite Missâ€æ–¹å¼ï¼šä¸€ä¸ªæ˜¯â€œWrite Allocateï¼ˆæŒ‰å†™åˆ†é…ï¼‰â€ï¼Œåšæ³•æ˜¯å†™å…¥ç¼“å­˜ç›¸åº”ä½ç½®ï¼Œå†ç”±ç¼“å­˜ç»„ä»¶åŒæ­¥æ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼›å¦ä¸€ä¸ªæ˜¯â€œNo-write allocateï¼ˆä¸æŒ‰å†™åˆ†é…ï¼‰â€ï¼Œåšæ³•æ˜¯ä¸å†™å…¥ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯ç›´æ¥æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚ åœ¨ Write Through ç­–ç•¥ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©â€œNo-write allocateâ€æ–¹å¼ï¼ŒåŸå› æ˜¯æ— è®ºé‡‡ç”¨å“ªç§â€œWrite Missâ€æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½éœ€è¦åŒæ­¥å°†æ•°æ®æ›´æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œâ€œNo-write allocateâ€æ–¹å¼ç›¸æ¯”â€œWrite Allocateâ€è¿˜å‡å°‘äº†ä¸€æ¬¡ç¼“å­˜çš„å†™å…¥ï¼Œèƒ½å¤Ÿæå‡å†™å…¥çš„æ€§èƒ½ã€‚ Read Through ç­–ç•¥å°±ç®€å•ä¸€äº›ï¼Œå®ƒçš„æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼šå…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç”±ç¼“å­˜ç»„ä»¶è´Ÿè´£ä»æ•°æ®åº“ä¸­åŒæ­¥åŠ è½½æ•°æ®ã€‚ ä¸‹é¢æ˜¯ Read Through/Write Through ç­–ç•¥çš„ç¤ºæ„å›¾ï¼š Read Through/Write Through ç­–ç•¥çš„ç‰¹ç‚¹æ˜¯ç”±ç¼“å­˜èŠ‚ç‚¹è€Œéç”¨æˆ·æ¥å’Œæ•°æ®åº“æ‰“äº¤é“ï¼Œåœ¨æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ç›¸æ¯” Cache Aside ç­–ç•¥è¦å°‘è§ä¸€äº›ï¼ŒåŸå› æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜ç»„ä»¶ï¼Œæ— è®ºæ˜¯ Memcached è¿˜æ˜¯ Redis éƒ½ä¸æä¾›å†™å…¥æ•°æ®åº“ï¼Œæˆ–è€…è‡ªåŠ¨åŠ è½½æ•°æ®åº“ä¸­çš„æ•°æ®çš„åŠŸèƒ½ã€‚è€Œæˆ‘ä»¬åœ¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ç§ç­–ç•¥ï¼Œæ¯”å¦‚è¯´åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„æœ¬åœ°ç¼“å­˜ Guava Cache ä¸­çš„ Loading Cache å°±æœ‰ Read Through ç­–ç•¥çš„å½±å­ã€‚ æˆ‘ä»¬çœ‹åˆ° Write Through ç­–ç•¥ä¸­å†™æ•°æ®åº“æ˜¯åŒæ­¥çš„ï¼Œè¿™å¯¹äºæ€§èƒ½æ¥è¯´ä¼šæœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œå› ä¸ºç›¸æ¯”äºå†™ç¼“å­˜ï¼ŒåŒæ­¥å†™æ•°æ®åº“çš„å»¶è¿Ÿå°±è¦é«˜å¾ˆå¤šäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯å¦å¼‚æ­¥åœ°æ›´æ–°æ•°æ®åº“ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦æåˆ°çš„â€œWrite Backâ€ç­–ç•¥ã€‚ Write Backï¼ˆå†™å›ï¼‰ç­–ç•¥è¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨å†™å…¥æ•°æ®æ—¶åªå†™å…¥ç¼“å­˜ï¼Œå¹¶ä¸”æŠŠç¼“å­˜å—å„¿æ ‡è®°ä¸ºâ€œè„â€çš„ã€‚è€Œè„å—å„¿åªæœ‰è¢«å†æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šå°†å…¶ä¸­çš„æ•°æ®å†™å…¥åˆ°åç«¯å­˜å‚¨ä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨â€œWrite Missâ€çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯â€œWrite Allocateâ€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨å†™å…¥åç«¯å­˜å‚¨çš„åŒæ—¶è¦å†™å…¥ç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä¹‹åçš„å†™è¯·æ±‚ä¸­éƒ½åªéœ€è¦æ›´æ–°ç¼“å­˜å³å¯ï¼Œè€Œæ— éœ€æ›´æ–°åç«¯å­˜å‚¨äº†ï¼Œæˆ‘å°† Write back ç­–ç•¥çš„ç¤ºæ„å›¾æ”¾åœ¨äº†ä¸‹é¢ï¼š å‘ç°äº†å—ï¼Ÿå…¶å®è¿™ç§ç­–ç•¥ä¸èƒ½è¢«åº”ç”¨åˆ°æˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®åº“å’Œç¼“å­˜çš„åœºæ™¯ä¸­ï¼Œå®ƒæ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­çš„è®¾è®¡ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å‘ç£ç›˜ä¸­å†™æ•°æ®æ—¶é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ç­–ç•¥ã€‚æ— è®ºæ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„ Page Cacheï¼Œè¿˜æ˜¯æ—¥å¿—çš„å¼‚æ­¥åˆ·ç›˜ï¼Œäº¦æˆ–æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„å¼‚æ­¥å†™å…¥ç£ç›˜ï¼Œå¤§å¤šé‡‡ç”¨äº†è¿™ç§ç­–ç•¥ã€‚å› ä¸ºè¿™ä¸ªç­–ç•¥åœ¨æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿æ¯‹åº¸ç½®ç–‘ï¼Œå®ƒé¿å…äº†ç›´æ¥å†™ç£ç›˜é€ æˆçš„éšæœºå†™é—®é¢˜ï¼Œæ¯•ç«Ÿå†™å†…å­˜å’Œå†™ç£ç›˜çš„éšæœº I/O çš„å»¶è¿Ÿç›¸å·®äº†å‡ ä¸ªæ•°é‡çº§å‘¢ã€‚ ä½†å› ä¸ºç¼“å­˜ä¸€èˆ¬ä½¿ç”¨å†…å­˜ï¼Œè€Œå†…å­˜æ˜¯éæŒä¹…åŒ–çš„ï¼Œæ‰€ä»¥ä¸€æ—¦ç¼“å­˜æœºå™¨æ‰ç”µï¼Œå°±ä¼šé€ æˆåŸæœ¬ç¼“å­˜ä¸­çš„è„å—å„¿æ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥ä½ ä¼šå‘ç°ç³»ç»Ÿåœ¨æ‰ç”µä¹‹åï¼Œä¹‹å‰å†™å…¥çš„æ–‡ä»¶ä¼šæœ‰éƒ¨åˆ†ä¸¢å¤±ï¼Œå°±æ˜¯å› ä¸º Page Cache è¿˜æ²¡æœ‰æ¥å¾—åŠåˆ·ç›˜é€ æˆçš„ã€‚ å½“ç„¶ï¼Œä½ ä¾ç„¶å¯ä»¥åœ¨ä¸€äº›åœºæ™¯ä¸‹ä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘æƒ³ç»™ä½ çš„è½åœ°å»ºè®®æ˜¯ï¼šä½ åœ¨å‘ä½é€Ÿè®¾å¤‡å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å†…å­˜é‡Œå…ˆæš‚å­˜ä¸€æ®µæ—¶é—´çš„æ•°æ®ï¼Œç”šè‡³åšä¸€äº›ç»Ÿè®¡æ±‡æ€»ï¼Œç„¶åå®šæ—¶åœ°åˆ·æ–°åˆ°ä½é€Ÿè®¾å¤‡ä¸Šã€‚æ¯”å¦‚è¯´ï¼Œä½ åœ¨ç»Ÿè®¡ä½ çš„æ¥å£å“åº”æ—¶é—´çš„æ—¶å€™ï¼Œéœ€è¦å°†æ¯æ¬¡è¯·æ±‚çš„å“åº”æ—¶é—´æ‰“å°åˆ°æ—¥å¿—ä¸­ï¼Œç„¶åç›‘æ§ç³»ç»Ÿæ”¶é›†æ—¥å¿—åå†åšç»Ÿè®¡ã€‚ä½†æ˜¯å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½æ‰“å°æ—¥å¿—æ— ç–‘ä¼šå¢åŠ ç£ç›˜ I/Oï¼Œé‚£ä¹ˆä¸å¦‚æŠŠä¸€æ®µæ—¶é—´çš„å“åº”æ—¶é—´æš‚å­˜èµ·æ¥ï¼Œç»è¿‡ç®€å•çš„ç»Ÿè®¡å¹³å‡è€—æ—¶ï¼Œæ¯ä¸ªè€—æ—¶åŒºé—´çš„è¯·æ±‚æ•°é‡ç­‰ç­‰ï¼Œç„¶åå®šæ—¶åœ°ï¼Œæ‰¹é‡åœ°æ‰“å°åˆ°æ—¥å¿—ä¸­ã€‚","link":"/2019/2019-12-01-Write_Through(%E8%AF%BB%E7%A9%BF%E5%86%99%E7%A9%BF)%E7%AD%96%E7%95%A5/"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—(ä¸€)-å¦‚ä½•è§£å†³æ¶ˆæ¯ä¸¢å¤±","text":"æ¶ˆæ¯ä¼šä¸¢å¤±çš„ç¯èŠ‚æ¶ˆæ¯ä»è¢«å†™å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåˆ°è¢«æ¶ˆè´¹è€…æ¶ˆè´¹å®Œæˆï¼Œè¿™ä¸ªé“¾è·¯ä¸Šä¼šæœ‰å“ªäº›åœ°æ–¹å­˜åœ¨ä¸¢å¤±æ¶ˆæ¯çš„å¯èƒ½å‘¢ï¼Ÿå…¶å®ï¼Œä¸»è¦å­˜åœ¨ä¸‰ä¸ªåœºæ™¯ï¼š æ¶ˆæ¯ä»ç”Ÿäº§è€…å†™å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„è¿‡ç¨‹ã€‚ æ¶ˆæ¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å­˜å‚¨åœºæ™¯ã€‚ æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹çš„è¿‡ç¨‹ã€‚ 1. åœ¨æ¶ˆæ¯ç”Ÿäº§çš„è¿‡ç¨‹ä¸­ä¸¢å¤±æ¶ˆæ¯æ¶ˆæ¯çš„ç”Ÿäº§è€…ä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡æœåŠ¡å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç‹¬ç«‹éƒ¨ç½²åœ¨å•ç‹¬çš„æœåŠ¡å™¨ä¸Šçš„ã€‚ä¸¤è€…ä¹‹é—´çš„ç½‘ç»œè™½ç„¶æ˜¯å†…ç½‘ï¼Œä½†æ˜¯ä¹Ÿä¼šå­˜åœ¨æŠ–åŠ¨çš„å¯èƒ½ï¼Œè€Œä¸€æ—¦å‘ç”ŸæŠ–åŠ¨ï¼Œæ¶ˆæ¯å°±æœ‰å¯èƒ½å› ä¸ºç½‘ç»œçš„é”™è¯¯è€Œä¸¢å¤±ã€‚ é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘å»ºè®®ä½ é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯æ¶ˆæ¯é‡ä¼ ï¼šä¹Ÿå°±æ˜¯å½“ä½ å‘ç°å‘é€è¶…æ—¶åä½ å°±å°†æ¶ˆæ¯é‡æ–°å‘ä¸€æ¬¡ï¼Œä½†æ˜¯ä½ ä¹Ÿä¸èƒ½æ— é™åˆ¶åœ°é‡ä¼ æ¶ˆæ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å‘ç”Ÿæ•…éšœï¼Œæˆ–è€…æ˜¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ç½‘ç»œæ–­å¼€äº†ï¼Œé‡è¯• 2ï½3 æ¬¡å°±å¯ä»¥äº†ã€‚ ä¸è¿‡ï¼Œè¿™ç§æ–¹æ¡ˆå¯èƒ½ä¼šé€ æˆæ¶ˆæ¯çš„é‡å¤ï¼Œä»è€Œå¯¼è‡´åœ¨æ¶ˆè´¹çš„æ—¶å€™ä¼šé‡å¤æ¶ˆè´¹åŒæ ·çš„æ¶ˆæ¯ã€‚æ¯”æ–¹è¯´ï¼Œæ¶ˆæ¯ç”Ÿäº§æ—¶ç”±äºæ¶ˆæ¯é˜Ÿåˆ—å¤„ç†æ…¢æˆ–è€…ç½‘ç»œçš„æŠ–åŠ¨ï¼Œå¯¼è‡´è™½ç„¶æœ€ç»ˆå†™å…¥æ¶ˆæ¯é˜Ÿåˆ—æˆåŠŸï¼Œä½†åœ¨ç”Ÿäº§ç«¯å´è¶…æ—¶äº†ï¼Œç”Ÿäº§è€…é‡ä¼ è¿™æ¡æ¶ˆæ¯å°±ä¼šå½¢æˆé‡å¤çš„æ¶ˆæ¯ã€‚ 2. åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸¢å¤±æ¶ˆæ¯æ‹¿ Kafka ä¸¾ä¾‹ï¼Œæ¶ˆæ¯åœ¨ Kafka ä¸­æ˜¯å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„ï¼Œè€Œä¸ºäº†å‡å°‘æ¶ˆæ¯å­˜å‚¨æ—¶å¯¹ç£ç›˜çš„éšæœº I/Oï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†æ¶ˆæ¯å…ˆå†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„ Page Cache ä¸­ï¼Œç„¶åå†æ‰¾åˆé€‚çš„æ—¶æœºåˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚ æ¯”å¦‚ï¼ŒKafka å¯ä»¥é…ç½®å½“è¾¾åˆ°æŸä¸€æ—¶é—´é—´éš”ï¼Œæˆ–è€…ç´¯ç§¯ä¸€å®šçš„æ¶ˆæ¯æ•°é‡çš„æ—¶å€™å†åˆ·ç›˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„å¼‚æ­¥åˆ·ç›˜ã€‚ ä¸è¿‡ï¼Œå¦‚æœå‘ç”Ÿæœºå™¨æ‰ç”µæˆ–è€…æœºå™¨å¼‚å¸¸é‡å¯ï¼Œé‚£ä¹ˆ Page Cache ä¸­è¿˜æ²¡æœ‰æ¥å¾—åŠåˆ·ç›˜çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±äº†ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ ä½ å¯èƒ½ä¼šæŠŠåˆ·ç›˜çš„é—´éš”è®¾ç½®å¾ˆçŸ­ï¼Œæˆ–è€…è®¾ç½®ç´¯ç§¯ä¸€æ¡æ¶ˆæ¯å°±å°±åˆ·ç›˜ï¼Œä½†è¿™æ ·é¢‘ç¹åˆ·ç›˜ä¼šå¯¹æ€§èƒ½æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œè€Œä¸”ä»ç»éªŒæ¥çœ‹ï¼Œå‡ºç°æœºå™¨å®•æœºæˆ–è€…æ‰ç”µçš„å‡ ç‡ä¹Ÿä¸é«˜ï¼Œæ‰€ä»¥æˆ‘ä¸å»ºè®®ä½ è¿™æ ·åšã€‚ å¦‚æœä½ çš„ç³»ç»Ÿå¯¹æ¶ˆæ¯ä¸¢å¤±çš„å®¹å¿åº¦å¾ˆä½ï¼Œé‚£ä¹ˆä½ å¯ä»¥è€ƒè™‘ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½² Kafka æœåŠ¡ï¼Œé€šè¿‡éƒ¨ç½²å¤šä¸ªå‰¯æœ¬å¤‡ä»½æ•°æ®ï¼Œä¿è¯æ¶ˆæ¯å°½é‡ä¸ä¸¢å¤±ã€‚ é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ Kafka é›†ç¾¤ä¸­æœ‰ä¸€ä¸ª Leader è´Ÿè´£æ¶ˆæ¯çš„å†™å…¥å’Œæ¶ˆè´¹ï¼Œå¯ä»¥æœ‰å¤šä¸ª Follower è´Ÿè´£æ•°æ®çš„å¤‡ä»½ã€‚Follower ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„é›†åˆå«åš ISRï¼ˆin-sync replicasï¼‰ï¼Œå½“ Leader æ•…éšœæ—¶ï¼Œæ–°é€‰ä¸¾å‡ºæ¥çš„ Leader ä¼šä» ISR ä¸­é€‰æ‹©ï¼Œé»˜è®¤ Leader çš„æ•°æ®ä¼šå¼‚æ­¥åœ°å¤åˆ¶ç»™ Followerï¼Œè¿™æ ·åœ¨ Leader å‘ç”Ÿæ‰ç”µæˆ–è€…å®•æœºæ—¶ï¼ŒKafka ä¼šä» Follower ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå‡å°‘æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½ã€‚ ç”±äºé»˜è®¤æ¶ˆæ¯æ˜¯å¼‚æ­¥åœ°ä» Leader å¤åˆ¶åˆ° Follower çš„ï¼Œæ‰€ä»¥ä¸€æ—¦ Leader å®•æœºï¼Œé‚£äº›è¿˜æ²¡æœ‰æ¥å¾—åŠå¤åˆ¶åˆ° Follower çš„æ¶ˆæ¯è¿˜æ˜¯ä¼šä¸¢å¤±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒKafka ä¸ºç”Ÿäº§è€…æä¾›ä¸€ä¸ªé€‰é¡¹å«åšâ€œacksâ€ï¼Œå½“è¿™ä¸ªé€‰é¡¹è¢«è®¾ç½®ä¸ºâ€œallâ€æ—¶ï¼Œç”Ÿäº§è€…å‘é€çš„æ¯ä¸€æ¡æ¶ˆæ¯é™¤äº†å‘ç»™ Leader å¤–è¿˜ä¼šå‘ç»™æ‰€æœ‰çš„ ISRï¼Œå¹¶ä¸”å¿…é¡»å¾—åˆ° Leader å’Œæ‰€æœ‰ ISR çš„ç¡®è®¤åæ‰è¢«è®¤ä¸ºå‘é€æˆåŠŸã€‚è¿™æ ·ï¼Œåªæœ‰ Leader å’Œæ‰€æœ‰çš„ ISR éƒ½æŒ‚äº†ï¼Œæ¶ˆæ¯æ‰ä¼šä¸¢å¤±ã€‚ ä»ä¸Šé¢è¿™å¼ å›¾æ¥çœ‹ï¼Œå½“è®¾ç½®â€œacks=allâ€æ—¶ï¼Œéœ€è¦åŒæ­¥æ‰§è¡Œ 1ï¼Œ3ï¼Œ4 ä¸‰ä¸ªæ­¥éª¤ï¼Œå¯¹äºæ¶ˆæ¯ç”Ÿäº§çš„æ€§èƒ½æ¥è¯´ä¹Ÿæ˜¯æœ‰æ¯”è¾ƒå¤§çš„å½±å“çš„ï¼Œæ‰€ä»¥ä½ åœ¨å®é™…åº”ç”¨ä¸­éœ€è¦ä»”ç»†åœ°æƒè¡¡è€ƒé‡ã€‚æˆ‘ç»™ä½ çš„å»ºè®®æ˜¯ï¼š å¦‚æœä½ éœ€è¦ç¡®ä¿æ¶ˆæ¯ä¸€æ¡éƒ½ä¸èƒ½ä¸¢å¤±ï¼Œé‚£ä¹ˆå»ºè®®ä¸è¦å¼€å¯æ¶ˆæ¯é˜Ÿåˆ—çš„åŒæ­¥åˆ·ç›˜ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨é›†ç¾¤çš„æ–¹å¼æ¥è§£å†³ï¼Œå¯ä»¥é…ç½®å½“æ‰€æœ‰ ISR Follower éƒ½æ¥æ”¶åˆ°æ¶ˆæ¯æ‰è¿”å›æˆåŠŸã€‚ å¦‚æœå¯¹æ¶ˆæ¯çš„ä¸¢å¤±æœ‰ä¸€å®šçš„å®¹å¿åº¦ï¼Œé‚£ä¹ˆå»ºè®®ä¸éƒ¨ç½²é›†ç¾¤ï¼Œå³ä½¿ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œä¹Ÿå»ºè®®é…ç½®åªå‘é€ç»™ä¸€ä¸ª Follower å°±å¯ä»¥è¿”å›æˆåŠŸäº†ã€‚ æˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿä¸€èˆ¬å¯¹äºæ¶ˆæ¯çš„ä¸¢å¤±æœ‰ä¸€å®šçš„å®¹å¿åº¦ï¼Œæ¯”å¦‚è¯´ä»¥ä¸Šé¢çš„çº¢åŒ…ç³»ç»Ÿä¸ºä¾‹ï¼Œå¦‚æœçº¢åŒ…æ¶ˆæ¯ä¸¢å¤±äº†ï¼Œæˆ‘ä»¬åªè¦åç»­ç»™æ²¡æœ‰å‘é€çº¢åŒ…çš„ç”¨æˆ·è¡¥å‘çº¢åŒ…å°±å¥½äº†ã€‚ 3. åœ¨æ¶ˆè´¹çš„è¿‡ç¨‹ä¸­å­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„å¯èƒ½æˆ‘è¿˜æ˜¯ä»¥ Kafka ä¸ºä¾‹æ¥è¯´æ˜ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„è¿›åº¦æ˜¯è®°å½•åœ¨æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ä¸­çš„ï¼Œè€Œæ¶ˆè´¹çš„è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼šæ¥æ”¶æ¶ˆæ¯ã€å¤„ç†æ¶ˆæ¯ã€æ›´æ–°æ¶ˆè´¹è¿›åº¦ã€‚ è¿™é‡Œé¢æ¥æ”¶æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹éƒ½å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸æˆ–è€…å¤±è´¥ï¼Œæ¯”å¦‚è¯´ï¼Œæ¶ˆæ¯æ¥æ”¶æ—¶ç½‘ç»œå‘ç”ŸæŠ–åŠ¨ï¼Œå¯¼è‡´æ¶ˆæ¯å¹¶æ²¡æœ‰è¢«æ­£ç¡®çš„æ¥æ”¶åˆ°ï¼›å¤„ç†æ¶ˆæ¯æ—¶å¯èƒ½å‘ç”Ÿä¸€äº›ä¸šåŠ¡çš„å¼‚å¸¸å¯¼è‡´å¤„ç†æµç¨‹æœªæ‰§è¡Œå®Œæˆï¼Œè¿™æ—¶å¦‚æœæ›´æ–°æ¶ˆè´¹è¿›åº¦ï¼Œé‚£ä¹ˆè¿™æ¡å¤±è´¥çš„æ¶ˆæ¯å°±æ°¸è¿œä¸ä¼šè¢«å¤„ç†äº†ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚ æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€å®šè¦ç­‰åˆ°æ¶ˆæ¯æ¥æ”¶å’Œå¤„ç†å®Œæˆåæ‰èƒ½æ›´æ–°æ¶ˆè´¹è¿›åº¦ï¼Œä½†æ˜¯è¿™ä¹Ÿä¼šé€ æˆæ¶ˆæ¯é‡å¤çš„é—®é¢˜ï¼Œæ¯”æ–¹è¯´æŸä¸€æ¡æ¶ˆæ¯åœ¨å¤„ç†ä¹‹åï¼Œæ¶ˆè´¹è€…æ°å¥½å®•æœºäº†ï¼Œé‚£ä¹ˆå› ä¸ºæ²¡æœ‰æ›´æ–°æ¶ˆè´¹è¿›åº¦ï¼Œæ‰€ä»¥å½“è¿™ä¸ªæ¶ˆè´¹è€…é‡å¯ä¹‹åï¼Œè¿˜ä¼šé‡å¤åœ°æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚ 4. æœ€ä½³å®è·µ ä¸è¦ä½¿ç”¨ producer.send(msg)ï¼Œè€Œè¦ä½¿ç”¨ producer.send(msg, callback)ã€‚è®°ä½ï¼Œä¸€å®šè¦ä½¿ç”¨å¸¦æœ‰å›è°ƒé€šçŸ¥çš„ send æ–¹æ³•ã€‚ è®¾ç½® acks = allã€‚acks æ˜¯ Producer çš„ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨äº†ä½ å¯¹â€œå·²æäº¤â€æ¶ˆæ¯çš„å®šä¹‰ã€‚å¦‚æœè®¾ç½®æˆ allï¼Œåˆ™è¡¨æ˜æ‰€æœ‰å‰¯æœ¬ Broker éƒ½è¦æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯æ‰ç®—æ˜¯â€œå·²æäº¤â€ã€‚è¿™æ˜¯æœ€é«˜ç­‰çº§çš„â€œå·²æäº¤â€å®šä¹‰ã€‚ è®¾ç½® retries ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ã€‚è¿™é‡Œçš„ retries åŒæ ·æ˜¯ Producer çš„å‚æ•°ï¼Œå¯¹åº”å‰é¢æåˆ°çš„ Producer è‡ªåŠ¨é‡è¯•ã€‚å½“å‡ºç°ç½‘ç»œçš„ç¬æ—¶æŠ–åŠ¨æ—¶ï¼Œæ¶ˆæ¯å‘é€å¯èƒ½ä¼šå¤±è´¥ï¼Œæ­¤æ—¶é…ç½®äº† retries &gt; 0 çš„ Producer èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚ è®¾ç½® unclean.leader.election.enable = falseã€‚è¿™æ˜¯ Broker ç«¯çš„å‚æ•°ï¼Œå®ƒæ§åˆ¶çš„æ˜¯å“ªäº› Broker æœ‰èµ„æ ¼ç«é€‰åˆ†åŒºçš„ Leaderã€‚å¦‚æœä¸€ä¸ª Broker è½ååŸå…ˆçš„ Leader å¤ªå¤šï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦æˆä¸ºæ–°çš„ Leaderï¼Œå¿…ç„¶ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚æ•…ä¸€èˆ¬éƒ½è¦å°†è¯¥å‚æ•°è®¾ç½®æˆ falseï¼Œå³ä¸å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚ è®¾ç½® replication.factor &gt;= 3ã€‚è¿™ä¹Ÿæ˜¯ Broker ç«¯çš„å‚æ•°ã€‚å…¶å®è¿™é‡Œæƒ³è¡¨è¿°çš„æ˜¯ï¼Œæœ€å¥½å°†æ¶ˆæ¯å¤šä¿å­˜å‡ ä»½ï¼Œæ¯•ç«Ÿç›®å‰é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±çš„ä¸»è¦æœºåˆ¶å°±æ˜¯å†—ä½™ã€‚ è®¾ç½® min.insync.replicas &gt; 1ã€‚è¿™ä¾ç„¶æ˜¯ Broker ç«¯å‚æ•°ï¼Œæ§åˆ¶çš„æ˜¯æ¶ˆæ¯è‡³å°‘è¦è¢«å†™å…¥åˆ°å¤šå°‘ä¸ªå‰¯æœ¬æ‰ç®—æ˜¯â€œå·²æäº¤â€ã€‚è®¾ç½®æˆå¤§äº 1 å¯ä»¥æå‡æ¶ˆæ¯æŒä¹…æ€§ã€‚åœ¨å®é™…ç¯å¢ƒä¸­åƒä¸‡ä¸è¦ä½¿ç”¨é»˜è®¤å€¼ 1ã€‚ ç¡®ä¿ replication.factor &gt; min.insync.replicasã€‚å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªå‰¯æœ¬æŒ‚æœºï¼Œæ•´ä¸ªåˆ†åŒºå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æˆ‘ä»¬ä¸ä»…è¦æ”¹å–„æ¶ˆæ¯çš„æŒä¹…æ€§ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œè¿˜è¦åœ¨ä¸é™ä½å¯ç”¨æ€§çš„åŸºç¡€ä¸Šå®Œæˆã€‚æ¨èè®¾ç½®æˆ replication.factor = min.insync.replicas + 1ã€‚ ç¡®ä¿æ¶ˆæ¯æ¶ˆè´¹å®Œæˆå†æäº¤ã€‚Consumer ç«¯æœ‰ä¸ªå‚æ•° enable.auto.commitï¼Œæœ€å¥½æŠŠå®ƒè®¾ç½®æˆ falseï¼Œå¹¶é‡‡ç”¨æ‰‹åŠ¨æäº¤ä½ç§»çš„æ–¹å¼ã€‚å°±åƒå‰é¢è¯´çš„ï¼Œè¿™å¯¹äºå• Consumer å¤šçº¿ç¨‹å¤„ç†çš„åœºæ™¯è€Œè¨€æ˜¯è‡³å…³é‡è¦çš„ã€‚","link":"/2019/2019-12-08-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97(%E4%B8%80)-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1/"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—(äºŒ)-æ¶ˆæ¯å¹‚ç­‰","text":"ä»€ä¹ˆæ˜¯å¹‚ç­‰å¹‚ç­‰æ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æ¦‚å¿µï¼Œå®ƒçš„å«ä¹‰æ˜¯å¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œå’Œæ‰§è¡Œä¸€æ¬¡æ“ä½œï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚ å¦‚æœæˆ‘ä»¬æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦ç»™ç°æœ‰çš„åº“å­˜æ•°é‡å‡ 1ï¼Œé‚£ä¹ˆå¦‚æœæ¶ˆè´¹ä¸¤æ¡ç›¸åŒçš„æ¶ˆæ¯å°±ä¼šç»™åº“å­˜æ•°é‡å‡ 2ï¼Œè¿™å°±ä¸æ˜¯å¹‚ç­‰çš„ã€‚è€Œå¦‚æœæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯åï¼Œå¤„ç†é€»è¾‘æ˜¯å°†åº“å­˜çš„æ•°é‡è®¾ç½®ä¸º 0ï¼Œæˆ–è€…æ˜¯å¦‚æœå½“å‰åº“å­˜æ•°é‡æ˜¯ 10 æ—¶åˆ™å‡ 1ï¼Œè¿™æ ·åœ¨æ¶ˆè´¹å¤šæ¡æ¶ˆæ¯æ—¶ï¼Œæ‰€å¾—åˆ°çš„ç»“æœå°±æ˜¯ç›¸åŒçš„ï¼Œè¿™å°±æ˜¯å¹‚ç­‰çš„ã€‚ è¯´ç™½äº†ï¼Œä½ å¯ä»¥è¿™ä¹ˆç†è§£â€œå¹‚ç­‰â€ï¼šä¸€ä»¶äº‹å„¿æ— è®ºåšå¤šå°‘æ¬¡éƒ½å’Œåšä¸€æ¬¡äº§ç”Ÿçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆè¿™ä»¶äº‹å„¿å°±å…·æœ‰å¹‚ç­‰æ€§ã€‚ åœ¨ç”Ÿäº§ã€æ¶ˆè´¹è¿‡ç¨‹ä¸­å¢åŠ æ¶ˆæ¯å¹‚ç­‰æ€§çš„ä¿è¯æ¶ˆæ¯åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹çš„è¿‡ç¨‹ä¸­éƒ½å¯èƒ½ä¼šäº§ç”Ÿé‡å¤ï¼Œæ‰€ä»¥ä½ è¦åšçš„æ˜¯ï¼Œåœ¨ç”Ÿäº§è¿‡ç¨‹å’Œæ¶ˆè´¹è¿‡ç¨‹ä¸­å¢åŠ æ¶ˆæ¯å¹‚ç­‰æ€§çš„ä¿è¯ï¼Œè¿™æ ·å°±å¯ä»¥è®¤ä¸ºä»æœ€ç»ˆç»“æœä¸Šæ¥çœ‹ï¼Œæ¶ˆæ¯å®é™…ä¸Šæ˜¯åªè¢«æ¶ˆè´¹äº†ä¸€æ¬¡çš„ã€‚ åœ¨æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œåœ¨ Kafka0.11 ç‰ˆæœ¬å’Œ Pulsar ä¸­éƒ½æ”¯æŒâ€œproducer idempotencyâ€çš„ç‰¹æ€§ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ç”Ÿäº§è¿‡ç¨‹çš„å¹‚ç­‰æ€§ï¼Œè¿™ç§ç‰¹æ€§ä¿è¯æ¶ˆæ¯è™½ç„¶å¯èƒ½åœ¨ç”Ÿäº§ç«¯äº§ç”Ÿé‡å¤ï¼Œä½†æ˜¯æœ€ç»ˆåœ¨æ¶ˆæ¯é˜Ÿåˆ—å­˜å‚¨æ—¶åªä¼šå­˜å‚¨ä¸€ä»½ã€‚ å®ƒçš„åšæ³•æ˜¯ç»™æ¯ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œå¹¶ä¸”ä¸ºç”Ÿäº§çš„æ¯ä¸€æ¡æ¶ˆæ¯èµ‹äºˆä¸€ä¸ªå”¯ä¸€ IDï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„æœåŠ¡ç«¯ä¼šå­˜å‚¨ &lt; ç”Ÿäº§è€… IDï¼Œæœ€åä¸€æ¡æ¶ˆæ¯ ID&gt; çš„æ˜ å°„ã€‚å½“æŸä¸€ä¸ªç”Ÿäº§è€…äº§ç”Ÿæ–°çš„æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç«¯ä¼šæ¯”å¯¹æ¶ˆæ¯ ID æ˜¯å¦ä¸å­˜å‚¨çš„æœ€åä¸€æ¡ ID ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œå°±è®¤ä¸ºæ˜¯é‡å¤çš„æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨ä¸¢å¼ƒã€‚ è€Œåœ¨æ¶ˆè´¹ç«¯ï¼Œå¹‚ç­‰æ€§çš„ä¿è¯ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œä½ å¯ä»¥ä»é€šç”¨å±‚å’Œä¸šåŠ¡å±‚ä¸¤ä¸ªå±‚é¢æ¥è€ƒè™‘ã€‚ åœ¨é€šç”¨å±‚é¢ï¼Œä½ å¯ä»¥åœ¨æ¶ˆæ¯è¢«ç”Ÿäº§çš„æ—¶å€™ï¼Œä½¿ç”¨å‘å·å™¨ç»™å®ƒç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ¶ˆæ¯ IDï¼Œæ¶ˆæ¯è¢«å¤„ç†ä¹‹åï¼ŒæŠŠè¿™ä¸ª ID å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨å¤„ç†ä¸‹ä¸€æ¡æ¶ˆæ¯ä¹‹å‰ï¼Œå…ˆä»æ•°æ®åº“é‡Œé¢æŸ¥è¯¢è¿™ä¸ªå…¨å±€ ID æ˜¯å¦è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœè¢«æ¶ˆè´¹è¿‡å°±æ”¾å¼ƒæ¶ˆè´¹ã€‚ ä½ å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç”Ÿäº§ç«¯çš„å¹‚ç­‰æ€§ä¿è¯æ–¹å¼ï¼Œè¿˜æ˜¯æ¶ˆè´¹ç«¯é€šç”¨çš„å¹‚ç­‰æ€§ä¿è¯æ–¹å¼ï¼Œå®ƒä»¬çš„å…±åŒç‰¹ç‚¹éƒ½æ˜¯ä¸ºæ¯ä¸€ä¸ªæ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œç„¶ååœ¨ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œå…ˆæ¯”å¯¹è¿™ä¸ª ID æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è®¤ä¸ºæ¶ˆæ¯å·²ç»è¢«ä½¿ç”¨è¿‡ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼æ˜¯ä¸€ç§æ ‡å‡†çš„å®ç°å¹‚ç­‰çš„æ–¹å¼ï¼Œä½ åœ¨é¡¹ç›®ä¹‹ä¸­å¯ä»¥æ‹¿æ¥ç›´æ¥ä½¿ç”¨ï¼Œå®ƒåœ¨é€»è¾‘ä¸Šçš„ä¼ªä»£ç å°±åƒä¸‹é¢è¿™æ ·ï¼š 12345678910111213boolean isIDExisted = selectByID(ID); // åˆ¤æ–­ ID æ˜¯å¦å­˜åœ¨if(isIDExisted) { return; // å­˜åœ¨åˆ™ç›´æ¥è¿”å›} else { process(message); // ä¸å­˜åœ¨ï¼Œåˆ™å¤„ç†æ¶ˆæ¯ saveID(ID); // å­˜å‚¨ ID} ä¸è¿‡è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ¶ˆæ¯åœ¨å¤„ç†ä¹‹åï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™å…¥æ•°æ®åº“ï¼Œæ¶ˆè´¹è€…å®•æœºäº†é‡å¯ä¹‹åå‘ç°æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰è¿™æ¡æ¶ˆæ¯ï¼Œè¿˜æ˜¯ä¼šé‡å¤æ‰§è¡Œä¸¤æ¬¡æ¶ˆè´¹é€»è¾‘ï¼Œè¿™æ—¶ä½ å°±éœ€è¦å¼•å…¥äº‹åŠ¡æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯å¤„ç†å’Œå†™å…¥æ•°æ®åº“å¿…é¡»åŒæ—¶æˆåŠŸæˆ–è€…åŒæ—¶å¤±è´¥ï¼Œä½†æ˜¯è¿™æ ·æ¶ˆæ¯å¤„ç†çš„æˆæœ¬å°±æ›´é«˜äº†ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå¯¹äºæ¶ˆæ¯é‡å¤æ²¡æœ‰ç‰¹åˆ«ä¸¥æ ¼çš„è¦æ±‚ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§é€šç”¨çš„æ–¹æ¡ˆï¼Œè€Œä¸è€ƒè™‘å¼•å…¥äº‹åŠ¡ã€‚ åœ¨ä¸šåŠ¡å±‚é¢æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™é‡Œæœ‰å¾ˆå¤šç§å¤„ç†æ–¹å¼ï¼Œå…¶ä¸­æœ‰ä¸€ç§æ˜¯å¢åŠ ä¹è§‚é”çš„æ–¹å¼ã€‚æ¯”å¦‚ï¼Œä½ çš„æ¶ˆæ¯å¤„ç†ç¨‹åºéœ€è¦ç»™ä¸€ä¸ªäººçš„è´¦å·åŠ é’±ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä¹è§‚é”çš„æ–¹å¼æ¥è§£å†³ã€‚ å…·ä½“çš„æ“ä½œæ–¹å¼æ˜¯è¿™æ ·çš„ï¼šä½ ç»™æ¯ä¸ªäººçš„è´¦å·æ•°æ®ä¸­å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·çš„å­—æ®µï¼Œåœ¨ç”Ÿäº§æ¶ˆæ¯æ—¶å…ˆæŸ¥è¯¢è¿™ä¸ªè´¦æˆ·çš„ç‰ˆæœ¬å·ï¼Œå¹¶ä¸”å°†ç‰ˆæœ¬å·è¿åŒæ¶ˆæ¯ä¸€èµ·å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆè´¹ç«¯åœ¨æ‹¿åˆ°æ¶ˆæ¯å’Œç‰ˆæœ¬å·åï¼Œåœ¨æ‰§è¡Œæ›´æ–°è´¦æˆ·é‡‘é¢ SQL çš„æ—¶å€™å¸¦ä¸Šç‰ˆæœ¬å·ï¼Œç±»ä¼¼äºæ‰§è¡Œï¼š 1update user set amount = amount + 20, version=version+1 where userId=1 and version=1; ä½ çœ‹ï¼Œæˆ‘ä»¬åœ¨æ›´æ–°æ•°æ®æ—¶ç»™æ•°æ®åŠ äº†ä¹è§‚é”ï¼Œè¿™æ ·åœ¨æ¶ˆè´¹ç¬¬ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œversion å€¼ä¸º 1ï¼ŒSQL å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”åŒæ—¶æŠŠ version å€¼æ”¹ä¸ºäº† 2ï¼›åœ¨æ‰§è¡Œç¬¬äºŒæ¡ç›¸åŒçš„æ¶ˆæ¯æ—¶ï¼Œç”±äº version å€¼ä¸å†æ˜¯ 1ï¼Œæ‰€ä»¥è¿™æ¡ SQL ä¸èƒ½æ‰§è¡ŒæˆåŠŸï¼Œä¹Ÿå°±ä¿è¯äº†æ¶ˆæ¯çš„å¹‚ç­‰æ€§ã€‚","link":"/2019/2019-12-08-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97(%E4%BA%8C)-%E6%B6%88%E6%81%AF%E5%B9%82%E7%AD%89/"},{"title":"Boyerâ€“Moore å­—ç¬¦æœç´¢ç®—æ³•","text":"å› ä¸ºå­—ç¬¦æ¯”è¾ƒæ˜¯ä»å³å¾€å·¦æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€å±‚å¾ªç¯ needle.length + 1 &lt;= i &lt; haystack.lengthã€‚ 123456789101112 start=needle.length - 1 end=haystack.length - 1 + + | | | | v-------------------------------------------------------------------v-&gt; 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+| t | h | i | s | | i | s | | a | | s | i | m | p | l | e | | e | x | a | m | p | l | e |+-------------------------------+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---++---------------------------+| e | x | a | m | p | l | e |+---+---+---+---+---+---+---+ ç¬¬äºŒå±‚å¾ªç¯ä¸­iå˜é‡è¡¨ç¤ºåå­—ç¬¦çš„ä½ç½®ã€jè¡¨ç¤ºæœç´¢åå­—ç¬¦å¼€å§‹ä½ç½® 123456789101112131415 i + | v 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+| t | h | i | s | | i | s | | a | | s | i | m | p | l | e | | e | x | a | m | p | l | e |+-------------------------------+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---++---------------------------+| e | x | a | m | p | l | e |+---+---+---+---+---+---+-+-+ ^ | + j i,jæŒ‡é’ˆå‘å·¦æœç´¢,å¦‚æœå®Œå…¨åŒ¹é…ç›´æ¥è¿”å›iå³å¯ 12345for (j = needle.length - 1; needle[j] == haystack[i]; --i, --j) { if (j == 0) { return i; }} åå­—ç¬¦è§„åˆ™å’Œå¥½å­—ç¬¦è§„åˆ™åå­—ç¬¦:ä»å³å‘å·¦ç¬¬ä¸€ä¸ªä¸åŒ¹é…çš„å­—ç¬¦å¥½å­—ç¬¦:ä»åå­—ç¬¦ä¸‹ä¸€ä¸ªå­—ç¬¦ç›´åˆ°æœ€åçš„å­—ç¬¦ å¯ä»¥è®¤ä¸ºå­—ç¬¦ç§»åŠ¨æœ‰ä¸¤ç§ç­–ç•¥ï¼šåå­—ç¬¦å¯¹é½å’Œå¥½å­—ç¬¦å¯¹é½ï¼Œç„¶åé€‰æ‹©å­—ç¬¦ç§»åŠ¨è·ç¦»å¤§çš„ç­–ç•¥å³å¯ wikiå®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687/** * Returns the index within this string of the first occurrence of the * specified substring. If it is not a substring, return -1. * * There is no Galil because it only generates one match. * * @param haystack The string to be scanned * @param needle The target string to search * @return The start index of the substring */public static int indexOf(char[] haystack, char[] needle) { if (needle.length == 0) { return 0; } int charTable[] = makeCharTable(needle); int offsetTable[] = makeOffsetTable(needle); for (int i = needle.length - 1, j; i &lt; haystack.length;) { for (j = needle.length - 1; needle[j] == haystack[i]; --i, --j) { if (j == 0) { return i; } } // i += needle.length - j; // For naive method i += Math.max(offsetTable[needle.length - 1 - j], charTable[haystack[i]]); } return -1;}/** * Makes the jump table based on the mismatched character information. */private static int[] makeCharTable(char[] needle) { final int ALPHABET_SIZE = Character.MAX_VALUE + 1; // 65536 int[] table = new int[ALPHABET_SIZE]; for (int i = 0; i &lt; table.length; ++i) { table[i] = needle.length; } for (int i = 0; i &lt; needle.length - 2; ++i) { table[needle[i]] = needle.length - 1 - i; } return table;}/** * Makes the jump table based on the scan offset which mismatch occurs. * (bad character rule). */private static int[] makeOffsetTable(char[] needle) { int[] table = new int[needle.length]; int lastPrefixPosition = needle.length; for (int i = needle.length; i &gt; 0; --i) { if (isPrefix(needle, i)) { lastPrefixPosition = i; } table[needle.length - i] = lastPrefixPosition - i + needle.length; } for (int i = 0; i &lt; needle.length - 1; ++i) { int slen = suffixLength(needle, i); table[slen] = needle.length - 1 - i + slen; } return table;}/** * Is needle[p:end] a prefix of needle? */private static boolean isPrefix(char[] needle, int p) { for (int i = p, j = 0; i &lt; needle.length; ++i, ++j) { if (needle[i] != needle[j]) { return false; } } return true;}/** * Returns the maximum length of the substring ends at p and is a suffix. * (good suffix rule) */private static int suffixLength(char[] needle, int p) { int len = 0; for (int i = p, j = needle.length - 1; i &gt;= 0 &amp;&amp; needle[i] == needle[j]; --i, --j) { len += 1; } return len;}","link":"/2020/2020-01-10-Boyer%E2%80%93Moore_%E5%AD%97%E7%AC%A6%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/"},{"title":"æ¸…é†’æ€è€ƒçš„è‰ºæœ¯-checklist","text":"å¹¸å­˜è€…åå·®ï¼šé«˜ä¼°äº†æˆåŠŸçš„æ¦‚ç‡ çœ‹æ¸…æ¥šè‡ªå·± æ˜¯å¦é«˜ä¼°è‡ªå·± æ˜¯å¦é™·å…¥ä»ä¼—å¿ƒç† æ˜¯å¦ä¸æ²‰æ²¡æˆæœ¬éš¾èˆéš¾åˆ† æ˜¯å¦æ˜¯äº’æƒ äº’åˆ©é™·é˜± æ‘†è„±ç¡®è®¤åå·®ï¼Œä¸è¦è¯æ˜è‡ªå·±æ˜¯æ­£ç¡®çš„ æ˜¯å¦å±ˆæœäºæƒå¨ æ˜¯å¦ä¾æ®å¯¹æ¯”æ¥åˆ¤æ–­ï¼ˆè¯·ä¸è¦æ€ä¹ˆåšï¼‰ ç°æˆåè§ æ˜¯å¦æ•…æ„è¥é€ ä¸€ç§å±æœºæ°”æ°› æ˜ç¡®åˆ¤æ–­ä»–äººçš„èƒ½åŠ›èŒƒå›´ è­¦æƒ•æ§åˆ¶é”™è§‰ è­¦æƒ•æ¿€åŠ±è¿‡æ• æ˜¯å¦æ˜¯å¹³å‡å€¼ä¼šèµ·ä½œç”¨ï¼Ÿ è­¦æƒ•å…¬åœ°æ‚²å‰§ åˆ‡å‹¿åªä»¥ç»“æœåˆ¤æ–­å†³å®š é¢å¯¹é€‰æ‹©ï¼Œéµå®ˆè‡ªå·±çš„æ ‡å‡† æ’é™¤å¯¹ä»–äººå¥½æ„Ÿçš„å½±å“ ç¦€èµ‹æ•ˆåº” let it go æ— å·§ä¸æˆä¹¦ï¼Œå¦‚æœä»ä¸å‘ç”Ÿæ‰ä»¤äººæ„Ÿåˆ°æ„å¤– å”±åè°ƒçš„äººä¹Ÿè®¸æ˜¯æœ€é‡è¦çš„äºº 0é£é™©åè¯¯ ç¨€æœ‰æ€§è°¬è®º æ¦‚ç‡åè¯¯-å‰è½¦ä¹‹é‰´åäº‹ä¹‹å¸ˆ ç‹¬ç«‹äº‹ä»¶-èµŒå¾’è°¬è®º é”šå®šæ•ˆåº”ï¼Œä½ çš„é”šåœ¨å“ªé‡Œï¼Ÿ è­¦æƒ•å½’çº³æ³•ï¼Œè­¦æƒ•é»‘å¤©é¹…äº‹ä»¶ åŒæ¶é£é™©ï¼Œä½†ä¸è¦æ— è§†æŸå¤± ç¤¾ä¼šæ€§æ‡ˆæ€  èµ¢å®¶è¯…å’’-ä½ ä¼šå¾—åˆ°ä»€ä¹ˆã€å¤±å»ä»€ä¹ˆ æ˜¯å¦é«˜ä¼°äº†äººçš„å½±å“ ç›¸äº’å…³ç³»ä¸ç­‰åŒäºå› æœå…³ç³» é¿å…å…‰ç¯æ•ˆåº”è¿‡åº¦å½±å“æ€»ä½“å°è±¡ åˆç†ä¸ä¸€å®šçœŸå® ä¸è¦è¢«æ¡†æ¶æ•ˆåº”é™åˆ¶æ³¨æ„åŠ› é‡åˆ°ä¸æ˜æƒ…å†µï¼Œå°±ä¼šå‘ç”Ÿè¡ŒåŠ¨åè¯¯ ä¸ä½œä¸ºåè¯¯ï¼Œå¦‚æœä¸è§£å†³é—®é¢˜ï¼Œä½ å°±æ˜¯é—®é¢˜çš„ä¸€éƒ¨åˆ† è‡ªåˆ©åè¯¯ï¼Œä¸ºä»€ä¹ˆä½ ä»æ¥ä¸è‡ªè´£ é¿å…é•¿æ—¶é—´è´Ÿé¢å½±å“ è‡ªæˆ‘é€‰æ‹©åè¯¯ è”æƒ³åè¯¯ï¼Œä¸è¦æ¬ æ‹Ÿåˆä¹Ÿä¸è¦è¿‡æ‹Ÿåˆ è®¤çŸ¥å¤±è°ƒï¼Œæ˜¯å¦åœ¨è‡ªæˆ‘å®‰æ…° å³ä½¿è¡Œä¹ï¼Œåªé™å‘¨æœ«ï¼Œä¸è¦ä¸ºäº†çœ¼å‰çš„åˆ©ç›Šç ´åæœªæ¥çš„åˆ©ç›Š","link":"/2020/2020-02-01-%E6%B8%85%E9%86%92%E6%80%9D%E8%80%83%E7%9A%84%E8%89%BA%E6%9C%AF-checklist/"},{"title":"IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†","text":"","link":"/2020/2020-02-23-IM%E7%B3%BB%E7%BB%9F%E5%85%B3%E9%94%AE%E7%82%B9%E6%A2%B3%E7%90%86/"},{"title":"é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†","text":"åœ¨çº¿è„‘å›¾","link":"/2020/2020-03-23-%E9%AB%98%E5%B9%B6%E5%8F%91%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B3%E9%94%AE%E7%82%B9%E6%A2%B3%E7%90%86/"},{"title":"å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†- BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ","text":"å…ˆæ¥çœ‹è¡¨ç»“æ„ï¼š 1234567891011121314CREATE TABLE a ( `id`bigint AUTO_INCREMENT , `a` int, `b` int, PRIMARY KEY (`id`), KEY `idx_a_b` (`a`,`b`));CREATE TABLE b ( `id`bigint AUTO_INCREMENT , `b` int, `c` int, PRIMARY KEY (`id`)) çœ‹ä¸€ä¸‹joinè¯­å¥ï¼Œå› ä¸ºbä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥mysqlç”¨çš„BLNJï¼š 1234explain select * from a join b using(b)where a = 1order by a, b; id select_type table partitions type possible_keys key key_len ref rows filtered extra 1 SIMPLE a null ref idx_a_b idx_a_b 4 const 5206 100.00 Using temporary; Using filesort 1 SIMPLE b null ALL null null null Null 1000 100.00 Using where; Using join buffer (Block Nested Loop) å¦‚æœbè¡¨æœ‰ç´¢å¼•çš„è¯ï¼š 1234567CREATE TABLE b ( `id`bigint AUTO_INCREMENT , `b` int, `c` int, PRIMARY KEY (`id`), KEY `idx_b` (`b`)) id select_type table partitions type possible_keys key key_len ref rows filtered extra 1 SIMPLE a null ref idx_a_b idx_a_b 8 Const 5206 100.00 Using index condition 1 SIMPLE b null Ref idx_b Idx_b 4 b.b 50 100.00 null å¯ä»¥å‘ç°aè¡¨idx_a_bæœ‰åºæ€§æ²¡æœ‰åˆ©ç”¨ä¸Šï¼Œè‡³äºåŸå› ï¼Œå…ˆçœ‹ä¸€ä¸‹BNLJæ‰§è¡Œçš„æµç¨‹å›¾: æ‰§è¡Œè¿‡ç¨‹ä¸ºï¼š æ‰«æè¡¨ t1ï¼Œé¡ºåºè¯»å–æ•°æ®è¡Œæ”¾å…¥ join_buffer ä¸­ï¼Œç›´åˆ° join_buffer æ»¡äº†ï¼Œç»§ç»­ç¬¬ 2 æ­¥ï¼› æ‰«æè¡¨ t2ï¼ŒæŠŠ t2 ä¸­çš„æ¯ä¸€è¡Œå–å‡ºæ¥ï¼Œè·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œæ»¡è¶³ join æ¡ä»¶çš„ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›ï¼› æ¸…ç©º join_bufferï¼› ç»§ç»­æ‰«æè¡¨ t1ï¼Œé¡ºåºè¯»å–ä¹‹åæ•°æ®æ”¾å…¥ join_buffer ä¸­ï¼Œç»§ç»­æ‰§è¡Œç¬¬ 2 æ­¥ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®è¯»å–å®Œæ¯•ã€‚ å…¶ä¸­éšå«çš„é—®é¢˜åœ¨äºç¬¬äºŒæ­¥ï¼šå³ä½¿t1è¡¨çš„æ•°æ®æ˜¯æœ‰åºè¯»å–åˆ°join_bufferä¸­çš„ï¼Œç”±äºæ˜¯å…ˆæ‰«æt2è¡¨å†å…³è”join_bufferæ•°æ®ï¼Œå¯¼è‡´join_bufferä¸­çš„æœ‰åºæ€§å¤±æ•ˆã€‚ å¦‚æœè¡¨bæœ‰ç´¢å¼•idx_b,é‚£ä¹ˆä½¿ç”¨BKAç®—æ³•ç¬¬äºŒæ­¥çš„å…³è”é¡ºåºä¸BNLJç›¸åï¼Œæ˜¯å…ˆæ‰«æjoin_bufferåé€šè¿‡ç´¢å¼•å…³è”t2,åˆ™å¯ä»¥åˆ©ç”¨join_bufferä¸­çš„æœ‰åºæ•°æ®ã€‚","link":"/2020/2020-03-12-%E5%A5%87%E6%80%AA%E7%9A%84%E7%9F%A5%E8%AF%86%E5%8F%88%E5%A2%9E%E5%8A%A0%E4%BA%86-BLNJ%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E6%9C%89%E5%BA%8F%E6%80%A7%E5%A4%B1%E6%95%88/"},{"title":"[ç‰‡æ®µ] æ–¹æ³•å‚æ•°æ”¶é›†","text":"ä»¥å‰çš„ä»£ç ï¼Œç”¨äºæ”¶é›†å½“å‰æ–¹æ³•çš„æ‰€æœ‰å‚æ•°ï¼Œæ”¾åœ¨mapä¸­æ–¹ä¾¿è°ƒå– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869import com.google.common.collect.ImmutableMap;import lombok.Data;import org.aspectj.lang.JoinPoint;import org.aspectj.lang.annotation.After;import org.aspectj.lang.annotation.Aspect;import org.aspectj.lang.annotation.Before;import org.aspectj.lang.annotation.Pointcut;import org.aspectj.lang.reflect.MethodSignature;import org.springframework.stereotype.Component;import java.util.Arrays;import java.util.Collections;import java.util.HashMap;import java.util.Map;import java.util.stream.IntStream;@Aspect@Componentpublic class ArgumentsCollector { private static final ThreadLocal&lt;Map&lt;String, Object&gt;&gt; ARGUMENTS = ThreadLocal.withInitial(ImmutableMap::of); static Map&lt;String, Object&gt; getArgs() { return ARGUMENTS.get(); } private Object[] args(Object[] args, int exceptLength) { if (exceptLength == args.length) { return args; } return Arrays.copyOf(args, exceptLength); } @Pointcut(\"@annotation(CollectArguments)\") void collectArgumentsAnnotationPointCut() { } @Before(\"collectArgumentsAnnotationPointCut()\") public void doAccessCheck(JoinPoint joinPoint) { final String[] parameterNames = ((MethodSignature) joinPoint.getSignature()).getParameterNames(); final Object[] args = args(joinPoint.getArgs(), parameterNames.length); ARGUMENTS.set(Collections.unmodifiableMap((IntStream.range(0, parameterNames.length) .mapToObj(idx -&gt; Tuple2.of(parameterNames[idx], args[idx])) .collect(HashMap::new, (m, t) -&gt; m.put(t.getT1(), t.getT2()), HashMap::putAll)))); } @After(\"collectArgumentsAnnotationPointCut()\") public void remove() { ARGUMENTS.remove(); } @Data private static class Tuple2&lt;T1, T2&gt; { private T1 t1; private T2 t2; Tuple2(T1 t1, T2 t2) { this.t1 = t1; this.t2 = t2; } public static &lt;T1, T2&gt; Tuple2&lt;T1, T2&gt; of(T1 t1, T2 t2) { return new Tuple2&lt;&gt;(t1, t2); } }} é™„é€ä¸€æ®µä»£ç ï¼Œç”¨äºå°†æ–¹æ³•ä¸­æ”¶é›†çš„å‚æ•°è½¬æ¢æˆBean 12345678910111213141516import org.springframework.beans.BeanUtils;import org.springframework.beans.MutablePropertyValues;import org.springframework.validation.DataBinder;public class BinderUtil { BinderUtil() { } @SuppressWarnings(\"unchecked\") public static &lt;T&gt; T getTarget(Class&lt;T&gt; beanClazz) { final DataBinder binder = new DataBinder(BeanUtils.instantiate(beanClazz)); binder.bind(new MutablePropertyValues(ArgumentsCollector.getArgs())); return (T) binder.getTarget(); }} ä½¿ç”¨å®ä¾‹ï¼š 12345678910@Override@CollectArgumentspublic List&lt;PsJobSequenceVO&gt; findJobSequence( String jobSeqGroupId, String jobSeqId, Integer state, Date endDate) { return jobSequenceHandler.findJobSequence(BinderUtil.getTarget(PsJobSequenceFindRO.class)).getData();}","link":"/2020/2020-03-27-%5B%E7%89%87%E6%AE%B5%5D%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E6%94%B6%E9%9B%86/"},{"title":"IMç³»ç»ŸåŸºç¡€-IMç³»ç»Ÿç»“æ„","text":"ä»ä¸€ä¸ª IM ç³»ç»Ÿå¼€å‘è€…çš„è§’åº¦çœ‹ï¼ŒèŠå¤©ç³»ç»Ÿå¤§æ¦‚ç”±è¿™å‡ å¤§éƒ¨åˆ†ç»„æˆï¼šå®¢æˆ·ç«¯ã€æ¥å…¥æœåŠ¡ã€ä¸šåŠ¡å¤„ç†æœåŠ¡ã€å­˜å‚¨æœåŠ¡å’Œå¤–éƒ¨æ¥å£æœåŠ¡ã€‚ å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬æ˜¯ç”¨æˆ·ç”¨äºæ”¶å‘æ¶ˆæ¯çš„ç»ˆç«¯è®¾å¤‡ï¼Œå†…ç½®çš„å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡ç«¯è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œç”¨æ¥æ‰¿è½½ç”¨æˆ·çš„äº’åŠ¨è¯·æ±‚å’Œæ¶ˆæ¯æ¥æ”¶åŠŸèƒ½ã€‚ æ¥å…¥æœåŠ¡ã€‚æ¥å…¥æœåŠ¡å¯ä»¥è®¤ä¸ºæ˜¯æœåŠ¡ç«¯çš„é—¨æˆ·ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›æ¶ˆæ¯æ”¶å‘çš„å‡ºå…¥å£ã€‚å‘é€çš„æ¶ˆæ¯å…ˆç”±å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œç»™åˆ°æ¥å…¥æœåŠ¡ï¼Œç„¶åå†ç”±æ¥å…¥æœåŠ¡é€’äº¤åˆ°ä¸šåŠ¡å±‚è¿›è¡Œå¤„ç†ã€‚ æ¥å…¥æœåŠ¡ä¸»è¦æœ‰å››å—åŠŸèƒ½ï¼š è¿æ¥ä¿æŒ å½“æœåŠ¡ç«¯æœ‰æ¶ˆæ¯éœ€è¦æ¨é€ç»™å®¢æˆ·ç«¯æ—¶ï¼Œä¹Ÿæ˜¯å°†ç»è¿‡ä¸šåŠ¡å±‚å¤„ç†çš„æ¶ˆæ¯å…ˆé€’äº¤ç»™æ¥å…¥å±‚ï¼Œå†ç”±æ¥å…¥å±‚é€šè¿‡ç½‘ç»œå‘é€åˆ°å®¢æˆ·ç«¯ã€‚ åè®®è§£æ åœ¨å¾ˆå¤šåŸºäºç§æœ‰é€šä¿¡åè®®çš„ IM ç³»ç»Ÿå®ç°ä¸­ï¼Œæ¥å…¥æœåŠ¡è¿˜æä¾›åè®®çš„ç¼–è§£ç å·¥ä½œï¼Œç¼–è§£ç å®é™…ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çœç½‘ç»œæµé‡ï¼Œç³»ç»Ÿä¼šé’ˆå¯¹ä¼ è¾“çš„å†…å®¹è¿›è¡Œç´§å‡‘çš„ç¼–ç ï¼ˆæ¯”å¦‚ Protobufï¼‰ï¼Œä¸ºäº†è®©ä¸šåŠ¡å¤„ç†æ—¶ä¸éœ€è¦å…³å¿ƒè¿™äº›ä¸šåŠ¡æ— å…³çš„ç¼–è§£ç å·¥ä½œï¼Œä¸€èˆ¬ç”±æ¥å…¥å±‚æ¥å¤„ç†ã€‚ Session ç»´æŠ¤ session çš„ä½œç”¨æ˜¯æ ‡è¯†â€œå“ªä¸ªç”¨æˆ·åœ¨å“ªä¸ª TCP è¿æ¥â€ï¼Œç”¨äºåç»­çš„æ¶ˆæ¯æ¨é€èƒ½å¤ŸçŸ¥é“ï¼Œå¦‚ä½•æ‰¾åˆ°æ¥æ”¶äººå¯¹åº”çš„è¿æ¥æ¥å‘é€ã€‚ æ¶ˆæ¯æ¨é€ æ¥å…¥æœåŠ¡è¿˜è´Ÿè´£æœ€ç»ˆæ¶ˆæ¯çš„æ¨é€æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥æŠŠæœ€ç»ˆçš„æ¶ˆæ¯ä»æœåŠ¡å™¨ä¼ è¾“é€è¾¾åˆ°ç”¨æˆ·çš„è®¾å¤‡ä¸Šã€‚ ä¸šåŠ¡å¤„ç†æœåŠ¡ã€‚ä¸šåŠ¡å¤„ç†æœåŠ¡æ˜¯çœŸæ­£çš„æ¶ˆæ¯ä¸šåŠ¡é€»è¾‘å¤„ç†å±‚ï¼Œæ¯”å¦‚æ¶ˆæ¯çš„å­˜å‚¨ã€æœªè¯»æ•°å˜æ›´ã€æ›´æ–°æœ€è¿‘è”ç³»äººç­‰ï¼Œè¿™äº›å†…å®¹éƒ½æ˜¯ä¸šåŠ¡å¤„ç†çš„èŒƒç•´ã€‚ æˆ‘ä»¬å¯ä»¥æƒ³è±¡å¾—åˆ°ï¼Œä¸šåŠ¡å¤„ç†æœåŠ¡æ˜¯æ•´ä¸ª IM ç³»ç»Ÿçš„ä¸­æ¢å¤§è„‘ï¼Œè´Ÿè´£å„ç§å¤æ‚ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ã€‚ å°±å¥½æ¯”ä½ çš„ä¿¡åˆ°è¾¾åˆ†æ‹¨ä¸­å¿ƒåï¼Œåˆ†æ‹¨ä¸­å¿ƒå¯èƒ½éœ€è¦ç»™æ¥æ”¶äººå‘æ¡çŸ­ä¿¡å‘ŠçŸ¥ä¸€ä¸‹ï¼Œæˆ–è€…åˆ†æ‹¨ä¸­å¿ƒå‘ç°æ¥æ”¶äººå‘ŠçŸ¥è¿‡è¦æ‹’ç»æ¥æ”¶è¿™ä¸ªå‘é€è€…çš„ä»»ä½•ä¿¡ä»¶ï¼Œå› æ­¤ä¼šåœ¨è¿™é‡Œç›´æ¥æŠŠä¿¡ä»¶é€€å›ç»™å‘ä¿¡äººã€‚ å­˜å‚¨æœåŠ¡ã€‚è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œè´¦å·ä¿¡æ¯ã€å…³ç³»é“¾ï¼Œä»¥åŠæ¶ˆæ¯æœ¬èº«ï¼Œéƒ½éœ€è¦è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ã€‚ å¦å¤–ä¸€èˆ¬è¿˜ä¼šæœ‰ä¸€äº›ç”¨æˆ·æ¶ˆæ¯ç›¸å…³çš„è®¾ç½®ï¼Œä¹Ÿä¼šè¿›è¡ŒæœåŠ¡ç«¯å­˜å‚¨ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·å¯ä»¥è®¾ç½®ä¸æ¥æ”¶æŸäº›äººçš„æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆè¾–åŒºå†…æ‰€æœ‰äººçš„é€šä¿¡åœ°å€ç°¿ï¼Œä»¥åŠå‚¨å­˜ä¿¡ä»¶çš„ä»“åº“ã€‚ å¤–éƒ¨æ¥å£æœåŠ¡ã€‚ç”±äºæ‰‹æœºæ“ä½œç³»ç»Ÿçš„é™åˆ¶ï¼Œä»¥åŠèµ„æºä¼˜åŒ–çš„è€ƒè™‘ï¼Œå¤§éƒ¨åˆ† App åœ¨è¿›ç¨‹å…³é—­ï¼Œæˆ–è€…é•¿æ—¶é—´åå°è¿è¡Œæ—¶ï¼ŒApp å’Œ IM æœåŠ¡ç«¯çš„è¿æ¥ä¼šè¢«æ‰‹æœºæ“ä½œç³»ç»Ÿæ–­å¼€ã€‚è¿™æ ·å½“æœ‰æ–°çš„æ¶ˆæ¯äº§ç”Ÿæ—¶ï¼Œå°±æ²¡æ³•é€šè¿‡ IM æœåŠ¡å†è§¦è¾¾ç”¨æˆ·ï¼Œå› è€Œä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚ ä¸ºäº†è®©ç”¨æˆ·åœ¨ App æœªæ‰“å¼€æ—¶ï¼Œæˆ–è€…åœ¨åå°è¿è¡Œæ—¶ï¼Œä¹Ÿèƒ½æ¥æ”¶åˆ°æ–°æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¼šå°†æ¶ˆæ¯ç»™åˆ°ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¥å£æœåŠ¡ï¼Œæ¥é€šè¿‡æ‰‹æœºæ“ä½œç³»ç»Ÿè‡ªèº«çš„å…¬å…±è¿æ¥æœåŠ¡æ¥è¿›è¡Œæ“ä½œç³»ç»Ÿçº§çš„â€œæ¶ˆæ¯æ¨é€â€ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ä¸‹å‘çš„æ¶ˆæ¯ä¸€èˆ¬ä¼šåœ¨æ‰‹æœºçš„â€œé€šçŸ¥æ â€å¯¹ç”¨æˆ·è¿›è¡Œæé†’å’Œå±•ç¤ºã€‚ è¿™ç§æœ€å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ç³»ç»Ÿæ¨é€æœåŠ¡æœ‰è‹¹æœæ‰‹æœºè‡ªå¸¦çš„ APNsï¼ˆApple Push Notification serviceï¼‰æœåŠ¡ã€å®‰å“æ‰‹æœºå†…ç½®çš„è°·æ­Œå…¬å¸çš„ GCMï¼ˆGoogle Cloud Messagingï¼‰æœåŠ¡ç­‰ã€‚ ä½† GCM æœåŠ¡åœ¨å›½å†…æ— æ³•ä½¿ç”¨ï¼Œä¸ºæ­¤å¾ˆå¤šå›½å†…æ‰‹æœºå‚å•†åœ¨å„è‡ªæ‰‹æœºç³»ç»Ÿä¸­ï¼Œä¹Ÿæä¾›ç±»ä¼¼çš„å…¬å…±ç³»ç»Ÿæ¨é€æœåŠ¡ï¼Œå¦‚å°ç±³ã€åä¸ºã€OPPOã€vivo ç­‰æ‰‹æœºå‚å•†éƒ½æœ‰ç›¸åº”çš„ SDK æä¾›æ”¯æŒã€‚","link":"/2020/2020-04-13-IM%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80-IM%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€è¡¥å……","text":"åœ¨çº¿è„‘å›¾","link":"/2020/2020-04-08-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%84%91%E5%9B%BE/"},{"title":"AbstractQueuedSynchronizerè§£æ","text":"AbstractQueuedSynchronizer æ•°æ®ç»“æ„123456789101112131415161718 /** * Head of the wait queue , lazily initialized . Except for * initialization , it is modified only via method setHead . Note : * If head exists , its waitStatus is guaranteed not to be * CANCELLED . */ private transient volatile Node head; /** * Tail of the wait queue , lazily initialized . Modified only via * method enq to add new wait node . */ private transient volatile Node tail; /** * The synchronization state . */ private volatile int state; ç¨å¾®æ³¨æ„ä¸‹åœ¨çº¿ç¨‹äº‰ç”¨é”æ˜¯æ‰ä¼šåˆå§‹åŒ–é“¾è¡¨ AbstractQueuedSynchronizer.Node æ•°æ®ç»“æ„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * Status field , taking on only the values : * SIGNAL : The successor of this node is ( or will soon be ) * blocked ( via park ), so the current node must * unpark its successor when it releases or * cancels . To avoid races , acquire methods must * first indicate they need a signal , * then retry the atomic acquire , and then , * on failure , block . * CANCELLED : This node is cancelled due to timeout or interrupt . * Nodes never leave this state . In particular , * a thread with cancelled node never again blocks . * CONDITION : This node is currently on a condition queue . * It will not be used as a sync queue node * until transferred , at which time the status * will be set to 0. ( Use of this value here has * nothing to do with the other uses of the * field , but simplifies mechanics .) * PROPAGATE : A releaseShared should be propagated to other * nodes . This is set ( for head node only ) in * doReleaseShared to ensure propagation * continues , even if other operations have * since intervened . * 0: None of the above * * The values are arranged numerically to simplify use . * Non - negative values mean that a node doesn ' t need to * signal . So , most code doesn ' t need to check for particular * values , just for sign . * * The field is initialized to 0 for normal sync nodes , and * CONDITION for condition nodes . It is modified using CAS * ( or when possible , unconditional volatile writes ). */ volatile int waitStatus; /** * Link to predecessor node that current node / thread relies on * for checking waitStatus . Assigned during enqueuing , and nulled * out ( for sake of GC ) only upon dequeuing . Also , upon * cancellation of a predecessor , we short - circuit while * finding a non - cancelled one , which will always exist * because the head node is never cancelled : A node becomes * head only as a result of successful acquire . A * cancelled thread never succeeds in acquiring , and a thread only * cancels itself , not any other node . */ volatile Node prev; /** * Link to the successor node that the current node / thread * unparks upon release . Assigned during enqueuing , adjusted * when bypassing cancelled predecessors , and nulled out ( for * sake of GC ) when dequeued . The enq operation does not * assign next field of a predecessor until after attachment , * so seeing a null next field does not necessarily mean that * node is at end of queue . However , if a next field appears * to be null , we can scan prev ' s from the tail to * double - check . The next field of cancelled nodes is set to * point to the node itself instead of null , to make life * easier for isOnSyncQueue . */ volatile Node next; /** * The thread that enqueued this node . Initialized on * construction and nulled out after use . */ volatile Thread thread; /** * Link to next node waiting on condition , or the special * value SHARED . Because condition queues are accessed only * when holding in exclusive mode , we just need a simple * linked queue to hold nodes while they are waiting on * conditions . They are then transferred to the queue to * re - acquire . And because conditions can only be exclusive , * we save a field by using special value to indicate shared * mode . */ Node nextWaiter; AbstractQueuedSynchronizer** çš„æ•°æ®ç»“æ„ï¼ˆç›—ç”¨çš„å›¾ï¼‰ AbstractQueuedSynchronizer åšäº†ä»€ä¹ˆ ?å†…éƒ¨ç»´æŠ¤stateå’ŒCLHé˜Ÿåˆ—ï¼Œè´Ÿè´£åœ¨èµ„æºäº‰ç”¨æ—¶çº¿ç¨‹å…¥é˜Ÿï¼Œèµ„æºé‡Šæ”¾æ—¶å”¤é†’é˜Ÿåˆ—ä¸­çº¿ç¨‹ã€‚ è€Œå®ç°ç±»åªéœ€è¦å®ç° ä»€ä¹ˆæ¡ä»¶è·å–èµ„æºæˆåŠŸ å’Œ ä»€ä¹ˆæ¡ä»¶é‡Šæ”¾èµ„æº æˆåŠŸå°±å¯ä»¥äº† æ‰€ä»¥ï¼Œæœ€ç®€å•çš„CountDownLatchä½¿ç”¨AbstractQueuedSynchronizerå®ç°éå¸¸ç®€å•ï¼š ç”³æ˜AbstractQueuedSynchronizerçš„stateæ•°é‡ï¼ˆæ¯”å¦‚åä¸ªï¼‰ awaitæ–¹æ³•å°è¯•è·å–èµ„æºï¼Œå¦‚æœstate&gt;0è¡¨ç¤ºè·å–å¤±è´¥ï¼ˆ ä»€ä¹ˆæ¡ä»¶è·å–èµ„æºæˆåŠŸ ï¼ŒCountDownLatchå®ç°ï¼‰ï¼Œè·å–å¤±è´¥çº¿ç¨‹ä¼‘çœ ï¼ˆAbstractQueuedSynchronizerè´Ÿè´£ï¼‰ countDownæ–¹æ³•state-1ï¼Œå¦‚æœstate==0è¡¨ç¤ºèµ„æºé‡Šæ”¾æˆåŠŸ( ä»€ä¹ˆæ¡ä»¶é‡Šæ”¾èµ„æºæˆåŠŸ ï¼ŒCountDownLatchå®ç°)ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­æ‰€æœ‰çº¿ç¨‹ï¼ˆAbstractQueuedSynchronizerè´Ÿè´£ï¼‰ AbstractQueuedSynchronizer æ€ä¹ˆåšçš„?é¡ºç€ReentrantLock lockã€unlockçœ‹ä¸€éæˆ‘ä»¬å°±å¤§è‡´æ€»ç»“å‡ºAbstractQueuedSynchronizerå·¥ä½œåŸç†äº† å…ˆç®€å•ä»‹ç»ä¸‹ReentrantLockç‰¹æ€§ï¼šå¯é‡å…¥ï¼Œä¸­æ–­ï¼Œæœ‰è¶…æ—¶æœºåˆ¶ã€‚ ReentrantLock lock() æµç¨‹ ( å†ç›—å›¾ ) é»„è‰²è¡¨ç¤ºReentrantLockå®ç°ï¼Œç»¿è‰²è¡¨ç¤ºAbstractQueuedSynchronizerå†…éƒ¨å®ç° lockæ–¹æ³•å…¥å£ ç›´æ¥è°ƒç”¨ AbstractQueuedSynchronizer.acquireæ–¹æ³• tryAcquire addWaiter acquireQueued AbstractQueuedSynchronizer.acquire12345**public** final void acquire ( int arg) { **if** (! tryAcquire (arg) &amp;&amp; acquireQueued ( addWaiter ( Node . EXCLUSIVE ), arg)) selfInterrupt (); } è·å–çš„é”çš„é€»è¾‘ï¼šç›´æ¥è·å–æˆåŠŸåˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰è·å–æˆåŠŸå…¥é˜Ÿä¼‘çœ ï¼ˆå¯¹å°±æ˜¯è¿™ä¹ˆç®€å•ï¼‰ ä¸‹é¢æˆ‘ä»¬ä»”ç»†ä¸€ä¸ªä¸€ä¸ªæ–¹æ³•çœ‹ ReentrantLock.tryAcquireæˆ‘è¿™é‡Œè´´çš„æ—¶éå…¬å¹³çš„æ‰€è·å–ï¼Œå…¬å¹³å’Œä¸å…¬å¹³çš„åŒºåˆ«åœ¨äºå…¬å¹³é”è€è€å®å®çš„ä¼šè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿï¼Œéå…¬å¹³é”ä¼šå…ˆæ£€æŸ¥èµ„æºæ˜¯å¦å¯ç”¨ï¼Œå¦‚æœå¯ç”¨ä¸ç®¡é˜Ÿåˆ—ä¸­çš„æƒ…å†µç›´æ¥å°è¯•è·å–é”ã€‚ 123456789101112131415161718final boolean nonfairTryAcquire ( int acquires) { final Thread current = Thread . currentThread (); int c = getState (); if (c == 0 ) { if ( compareAndSetState ( 0 , acquires)) { setExclusiveOwnerThread (current); return true ; } } else if (current == getExclusiveOwnerThread ()) { int nextc = c + acquires; if (nextc &lt; 0 ) // overflow throw new Error ( \"Maximum lock count exceeded\" ); setState (nextc); return true ; } return false ; } ReentrantLock.tryAcquireè¯»å–åˆ°state==0æ—¶å°è¯•å ç”¨é”ï¼Œå¹¶ä¿è¯åŒä¸€çº¿ç¨‹å¯ä»¥é‡å¤å ç”¨ã€‚å…¶ä»–æƒ…å†µä¸‹è·å–èµ„æºå¤±è´¥ã€‚å¦‚æœè·å–æˆåŠŸå°±æ²¡å•¥äº‹äº†ï¼Œä¸è¿‡å…³é”®ä¸å°±æ˜¯é”äº‰ç”¨çš„æ—¶å€™æ˜¯å¦‚ä½•å¤„ç†çš„å—ï¼Ÿ AbstractQueuedSynchronizer.addWaiter(Node.EXCLUSIVE)12345678910111213141516private Node addWaiter ( Node mode) { Node node = new Node (mode); for (;;) { Node oldTail = tail; if (oldTail != null ) { node. setPrevRelaxed (oldTail); if ( compareAndSetTail (oldTail, node)) { oldTail. next = node; return node; } } else { initializeSyncQueue (); } } } ä¸€æ—¦é”äº‰ç”¨ï¼Œä¸€å®šä¼šåˆå§‹åŒ–é˜Ÿåˆ—ï¼ˆå› ä¸ºæ’é˜Ÿçš„çº¿ç¨‹éœ€è¦å‰é©±èŠ‚ç‚¹å”¤é†’ï¼Œæ‰€ä»¥è¦åˆå§‹åŒ–ä¸€ä¸ªå‰é©±èŠ‚ç‚¹ï¼‰ï¼Œä¹‹åè‡ªæ—‹æˆä¸ºé˜Ÿåˆ—å°¾èŠ‚ç‚¹ã€‚ ç®€å•æ¥è¯´å°±æ˜¯è·å–ä¸åˆ°é”å°±æ”¾è¿›é˜Ÿåˆ—é‡Œç»´æŠ¤èµ·æ¥ï¼Œç­‰é”é‡Šæ”¾çš„æ—¶å€™å†ç”¨ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª å¾ˆå…·æœ‰å‚è€ƒæ€§çš„å°ç»†èŠ‚ ï¼šå…ˆè®¾ç½®æ–°èŠ‚ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œè‡ªæ—‹æˆä¸ºå°¾èŠ‚ç‚¹åè®¾ç½®å‰é©±çš„åé©± AbstractQueuedSynchronizer.acquireQueued1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253final boolean acquireQueued ( final Node node, int arg) { boolean interrupted = false ; try { for (;;) { final Node p = node. predecessor (); if (p == head &amp;&amp; tryAcquire (arg)) { setHead (node); p. next = null ; // help GC return interrupted; } if ( shouldParkAfterFailedAcquire (p, node)) interrupted |= parkAndCheckInterrupt (); } } catch ( Throwable t) { cancelAcquire (node); if (interrupted) selfInterrupt (); throw t; } } private static boolean shouldParkAfterFailedAcquire ( Node pred, Node node) { int ws = pred. waitStatus ; if (ws == Node . SIGNAL ) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true ; if (ws &gt; 0 ) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node. prev = pred = pred. prev ; } while (pred. waitStatus &gt; 0 ); pred. next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ pred. compareAndSetWaitStatus (ws, Node . SIGNAL ); } return false ; } private final boolean parkAndCheckInterrupt () { LockSupport . park ( this ); return Thread . interrupted (); } å‰é¢åªæ˜¯ç»´æŠ¤ä¸‹é“¾è¡¨æ•°æ®ç»“æ„ï¼Œè¿™é‡Œè´Ÿè´£æ‰¾åˆ°åˆé€‚çš„å”¤é†’å‰é©±ï¼Œç„¶åè®©çº¿ç¨‹ä¼‘çœ ã€‚ è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªå¾ªç¯è¿‡ç¨‹ï¼š æ£€æŸ¥æ˜¯å¦èƒ½è·å–åˆ°é”ï¼Œè·å–åˆ°åˆ™è¿”å› å¤±è´¥åˆ™å¯»æ‰¾å‰é¢æœ€è¿‘çš„æœªæ”¾å¼ƒäº‰ç”¨çš„å‰é©±ï¼ŒæŠŠå‰é©±çš„waitStatusè®¾ç½®ä¸º-1ï¼Œå¹¶æŠŠæ”¾å¼ƒäº‰ç”¨çš„èŠ‚ç‚¹æŠ›å¼ƒ æ£€æŸ¥æ˜¯å¦èƒ½ä¼‘çœ  ä½¿ç”¨Usafe.parkä¼‘çœ ï¼ˆä¸æ˜¯waitï¼‰ ReentrantLock lock æ€»ç»“ ReentrantLock unlock()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public final boolean release ( int arg) { if ( tryRelease (arg)) { Node h = head; if (h != null &amp;&amp; h. waitStatus != 0 ) unparkSuccessor (h); return true ; } return false ; } protected final boolean tryRelease ( int releases) { int c = getState () - releases; if ( Thread . currentThread () != getExclusiveOwnerThread ()) throw new IllegalMonitorStateException (); boolean free = false ; if (c == 0 ) { free = true ; setExclusiveOwnerThread ( null ); } setState (c); return free; } private void unparkSuccessor ( Node node) { /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node. waitStatus ; if (ws &lt; 0 ) node. compareAndSetWaitStatus (ws, 0 ); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node. next ; if (s == null || s. waitStatus &gt; 0 ) { s = null ; for ( Node p = tail; p != node &amp;&amp; p != null ; p = p. prev ) if (p. waitStatus &lt;= 0 ) s = p; } if (s != null ) LockSupport . unpark (s. thread ); } unlockçš„ä»£ç ç‰¹åˆ«ç®€å•ï¼š æ¯unlockä¸€æ¬¡state-1 state == 0 æ—¶èµ„æºæˆåŠŸé‡Šæ”¾ å¦‚æœé‡Šæ”¾æˆåŠŸï¼Œå”¤é†’ç¬¬äºŒä¸ªèŠ‚ç‚¹ å¦‚æœç¬¬äºŒä¸ªèŠ‚ç‚¹æ²¡å¼•ç”¨æˆ–è€…æ”¾å¼ƒäº‰ç”¨ï¼Œä»é˜Ÿå°¾å¼€å§‹å¯»æ‰¾å¯ä»¥å”¤é†’çš„çº¿ç¨‹","link":"/2018/2018-07-02-AbstractQueuedSynchronizer%E8%A7%A3%E6%9E%90/"},{"title":"[ç‰‡æ®µ] ä½¿ç”¨redisåˆ›å»ºç®€æ˜“æœç´¢å¼•æ“ï¼ˆæ ¸å¿ƒç¯‡ï¼‰","text":"æ”¯æŒandæŸ¥è¯¢ã€å¤šé€‰ã€å¤šå­—æ®µæ’åºåˆ†é¡µï¼Œç¼ºå°‘çš„åŠŸèƒ½ï¼šor æ¡ä»¶ æ ¸å¿ƒç±»ï¼Œæœ‰ä¸€äº›æµ‹è¯•ä»£ç ï¼Œå°†å°±ä¸€ä¸‹ã€‚å¦å¤–éœ€è¦spring-data-redis 2.0ç‰ˆæœ¬ä»¥ä¸Š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382package app.pooi.redissearch.search;import app.pooi.redissearch.search.anno.CreateIndex;import app.pooi.redissearch.search.anno.Field;import com.google.common.collect.Lists;import com.google.common.collect.Sets;import lombok.Data;import org.apache.commons.lang3.ArrayUtils;import org.springframework.dao.DataAccessException;import org.springframework.data.redis.connection.RedisZSetCommands;import org.springframework.data.redis.core.*;import org.springframework.data.redis.hash.Jackson2HashMapper;import org.springframework.stereotype.Service;import org.springframework.web.bind.annotation.*;import reactor.util.function.Tuple2;import reactor.util.function.Tuples;import java.util.*;import java.util.concurrent.TimeUnit;import java.util.function.Consumer;import java.util.function.Function;import java.util.regex.Matcher;import java.util.regex.Pattern;import java.util.stream.Collectors;import java.util.stream.Stream;import static app.pooi.redissearch.search.SearchCore.Util.*;@RestController@Servicepublic class SearchCore { private StringRedisTemplate redisTemplate; private Jackson2HashMapper hashMapper = new Jackson2HashMapper(true); @Data private static class Person { private Long id; private String name; private Integer age; private Long ctime; } @PostMapping(\"/person\") @CreateIndex( index = \"person\", documentId = \"#p0.id\", fields = { @Field(propertyName = \"name\", value = \"#p0.name\"), @Field(propertyName = \"age\", value = \"#p0.age\", sort = true), @Field(propertyName = \"ctime\", value = \"#p0.ctime\", sort = true) }) Person addPerson(Person person) { return person; } public SearchCore(StringRedisTemplate redisTemplate) { this.redisTemplate = redisTemplate; } public void indexMeta(String index, Map&lt;String, FieldMeta&gt; fieldMeta) { this.redisTemplate.opsForHash().putAll(genIdxMetaName(index), hashMapper.toHash(fieldMeta)); } @PostMapping(\"/index\") public int indexDocument( final String index, final String field, final String documentId, final String document) { return this.indexDocument(index, field, documentId, document, doc -&gt; Lists.newArrayList(doc.split(\"\"))); } public int indexDocument( final String index, final String field, final String documentId, final String document, final Function&lt;String, List&lt;String&gt;&gt; tokenizer) { final List&lt;String&gt; tokens = tokenizer != null ? tokenizer.apply(document) : Collections.singletonList(document); final String docKey = genDocIdxName(index, documentId); final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations; final String[] idxs = tokens.stream() .map(word -&gt; genIdxName(index, field, word)) .peek(idx -&gt; ((StringRedisTemplate) operations).opsForSet().add(idx, documentId)) .toArray(String[]::new); template.opsForSet().add(docKey, idxs); return null; } }); return results.size(); } public int indexSortField( final String index, final String field, final String documentId, final Double document) { final String docKey = genDocIdxName(index, documentId); final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations; final String idxName = genSortIdxName(index, field); template.opsForZSet().add(idxName, documentId, document); template.opsForSet().add(docKey, idxName); return null; } }); return results.size(); } @DeleteMapping(\"/index\") public int deleteDocumentIndex(final String index, final String documentId) { final String docKey = genDocIdxName(index, documentId); final Boolean hasKey = redisTemplate.hasKey(docKey); if (!hasKey) { return 0; } final List&lt;Object&gt; results = redisTemplate.executePipelined(new SessionCallback&lt;Integer&gt;() { @Override public Integer execute(RedisOperations operations) throws DataAccessException { final Set&lt;String&gt; idx = redisTemplate.opsForSet().members(docKey); ((StringRedisTemplate) operations).delete(idx); ((StringRedisTemplate) operations).delete(docKey); return null; } }); return results.size(); } @PatchMapping(\"/index\") public int updateDocumentIndex(final String index, final String field, final String documentId, final String document) { this.deleteDocumentIndex(index, documentId); return this.indexDocument(index, field, documentId, document); } public int updateSortField(final String index, final String field, final String documentId, final Double document) { this.deleteDocumentIndex(index, documentId); return this.indexSortField(index, field, documentId, document); } private Consumer&lt;SetOperations&lt;String, String&gt;&gt; operateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey) { switch (method) { case \"intersectAndStore\": return (so) -&gt; so.intersectAndStore(key, keys, destKey); case \"unionAndStore\": return (so) -&gt; so.unionAndStore(key, keys, destKey); case \"differenceAndStore\": return (so) -&gt; so.differenceAndStore(key, keys, destKey); default: return so -&gt; { }; } } private Consumer&lt;ZSetOperations&lt;String, String&gt;&gt; zOperateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey, final RedisZSetCommands.Weights weights) { switch (method) { case \"intersectAndStore\": return (so) -&gt; so.intersectAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights); case \"unionAndStore\": return (so) -&gt; so.unionAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights); default: return so -&gt; { }; } } private String common(String index, String method, List&lt;String&gt; keys, long ttl) { final String destKey = Util.genQueryIdxName(index); redisTemplate.executePipelined(new SessionCallback&lt;String&gt;() { @Override public &lt;K, V&gt; String execute(RedisOperations&lt;K, V&gt; operations) throws DataAccessException { operateAndStore(method, keys.stream().limit(1L).findFirst().get(), keys.stream().skip(1L).collect(Collectors.toList()), destKey) .accept(((StringRedisTemplate) operations).opsForSet()); ((StringRedisTemplate) operations).expire(destKey, ttl, TimeUnit.SECONDS); return null; } }); return destKey; } public String intersect(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"intersectAndStore\", keys, ttl); } public String union(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"unionAndStore\", keys, ttl); } public String diff(String index, List&lt;String&gt; keys, long ttl) { return common(index, \"differenceAndStore\", keys, ttl); } private static Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parse(String query) { final Pattern pattern = Pattern.compile(\"[+-]?([\\\\w\\\\d]+):(\\\\S+)\"); final Matcher matcher = pattern.matcher(query); Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = Sets.newHashSet(); Set&lt;Tuple2&lt;String, String&gt;&gt; want = Sets.newHashSet(); while (matcher.find()) { String word = matcher.group(); String prefix = null; if (word.length() &gt; 1) { prefix = word.substring(0, 1); } final Tuple2&lt;String, String&gt; t = Tuples.of(matcher.group(1), matcher.group(2)); if (\"-\".equals(prefix)) { unwant.add(t); } else { want.add(t); } } return Tuples.of(want, unwant); } public String query( String index, String query) { final Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parseResult = parse(query); final Set&lt;Tuple2&lt;String, String&gt;&gt; want = parseResult.getT1(); final Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = parseResult.getT2(); if (want.isEmpty()) { return \"\"; } final Map&lt;String, FieldMeta&gt; entries = (Map&lt;String, FieldMeta&gt;) hashMapper.fromHash(redisTemplate.&lt;String, Object&gt;opsForHash().entries(genIdxMetaName(index))); // union final List&lt;Tuple2&lt;String, String&gt;&gt; unionFields = want.stream() .filter(w -&gt; w.getT2().contains(\",\")) .filter(w -&gt; \"true\".equals(entries.get(w.getT1()).getSort())) .collect(Collectors.toList()); final List&lt;String&gt; unionIdx = unionFields.stream() .flatMap(w -&gt; Arrays.stream(w.getT2().split(\",\")).map(value -&gt; Tuples.of(w.getT1(), value))) .map(w -&gt; genIdxName(index, w.getT1(), w.getT2())) .collect(Collectors.toList()); final String unionResultId = unionIdx.isEmpty() ? \"\" : this.union(index, unionIdx, 30L); want.removeAll(unionFields); // intersect final List&lt;String&gt; intersectIdx = want.stream() .flatMap(t -&gt; { if (\"true\".equals(entries.get(t.getT1()).getSort())) return Stream.of(t); return Arrays.stream(t.getT2().split(\"\")).map(value -&gt; Tuples.of(t.getT1(), value)); }) .map(w -&gt; genIdxName(index, w.getT1(), w.getT2())) .collect(Collectors.toList()); if (!unionResultId.isEmpty()) intersectIdx.add(unionResultId); String intersectResult = this.intersect(index, intersectIdx, 30L); // diff return unwant.isEmpty() ? intersectResult : this.diff(index, Stream.concat(Stream.of(intersectResult), unwant.stream().map(w -&gt; genIdxName(index, w.getT1(), w.getT2()))).collect(Collectors.toList()), 30L); } @GetMapping(\"/query/{index}\") public Set&lt;String&gt; queryAndSort( @PathVariable(\"index\") String index, @RequestParam(\"param\") String query, @RequestParam(\"sort\") String sort, Integer start, Integer stop ) { final String[] sorts = sort.split(\" \"); final Map&lt;String, Integer&gt; map = Arrays.stream(sorts).collect( Collectors.toMap(f -&gt; { if (f.startsWith(\"+\") || f.startsWith(\"-\")) { f = f.substring(1); } return genSortIdxName(\"person\", f); }, field -&gt; field.startsWith(\"-\") ? -1 : 1) ); final int[] weights = map.values() .stream() .mapToInt(Integer::intValue) .toArray();// if (!sort.startsWith(\"+\") &amp;&amp; !sort.startsWith(\"-\")) {// sort = \"+\" + sort;// }// boolean desc = sort.startsWith(\"-\");// sort = sort.substring(1); String queryId = this.query(index, query); Long size; if (queryId.length() == 0 || (size = redisTemplate.opsForSet().size(queryId)) == null || size == 0) { return Collections.emptySet(); } final String resultId = genQueryIdxName(index);// String sortField = sort; redisTemplate.executePipelined(new SessionCallback&lt;Object&gt;() { @Override public &lt;K, V&gt; Object execute(RedisOperations&lt;K, V&gt; operations) throws DataAccessException { final StringRedisTemplate template = (StringRedisTemplate) operations;// template.opsForZSet().intersectAndStore(genSortIdxName(index, sortField), queryId, resultId); SearchCore.this.zOperateAndStore(\"intersectAndStore\", map.keySet().stream().limit(1L).findFirst().get(), Stream.concat(map.keySet().stream().skip(1L), Stream.of(queryId)).collect(Collectors.toList()), resultId, RedisZSetCommands.Weights.of(ArrayUtils.add(weights, 0))).accept(template.opsForZSet());// template.opsForZSet().size(resultId); template.expire(resultId, 30L, TimeUnit.SECONDS); return null; } }); // sort return redisTemplate.opsForZSet().range(resultId, start, stop); } static class Util { private Util() { } static String genIdxMetaName(String index) { return String.format(\"meta:idx:%s\", index); } static String genIdxName(String index, String field, String value) { return String.format(\"idx:%s:%s:%s\", index, field, value); } static String genSortIdxName(String index, String field) { return String.format(\"idx:%s:%s\", index, field); } static String genQueryIdxName(String index) { return String.format(\"idx:%s:q:%s\", index, UUID.randomUUID().toString()); } static String genDocIdxName(String index, String documentId) { return String.format(\"doc:%s:%s\", index, documentId); } }} è¾…åŠ©ç±» 123456789101112131415161718import lombok.Data;@Datapublic class FieldMeta { private String sort = \"false\"; private String splitFun = \"\"; public FieldMeta() { } public FieldMeta(boolean sort) { this.sort = Boolean.toString(sort); }} åšä¸€ä¸ªè½»é‡çº§çš„æœç´¢è¿˜æ˜¯å¯ä»¥çš„ã€‚","link":"/2019/2019-03-11-%5B%E7%89%87%E6%AE%B5%5D%E4%BD%BF%E7%94%A8redis%E5%88%9B%E5%BB%BA%E7%AE%80%E6%98%93%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E(%E6%A0%B8%E5%BF%83%E7%AF%87)/"},{"title":"LeetCode äºŒå‰æ ‘æ’åºæ ‘åŸºç¡€ç®—æ³•","text":"ä¿®å‰ªäºŒå‰æœç´¢æ ‘12345678910111213141516171819/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode trimBST(TreeNode root, int L, int R) { if (root == null) return null; if (root.val &lt; L) return trimBST(root.right, L, R); if (root.val &gt; R) return trimBST(root.left, L, R); root.left = trimBST(root.left, L, R); root.right = trimBST(root.right, L, R); return root; }} äºŒå‰æœç´¢æ ‘ä¸­ç¬¬Kå°çš„å…ƒç´ 12345678910111213141516171819202122232425262728293031/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int cnt; private int val; public int kthSmallest(TreeNode root, int k) { search(root, k); return val; } private void search(TreeNode root, int k) { if (root == null) return; // kthSmallest(root.left, k); cnt++; if (cnt == k) { val = root.val; return; } kthSmallest(root.right, k); }} æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘1234567891011121314151617181920212223242526272829303132/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int sum; public TreeNode convertBST(TreeNode root) { // ä¸­åºéå† ä½†æ˜¯æ˜¯ä»å³å¾€å·¦éå† // visit(root); return root; } private void visit(TreeNode root) { if (root == null) return; visit(root.right); sum += root.val; root.val = sum; visit(root.left); }} äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ12345678910111213141516171819/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { // å…¬å…±ç¥–å…ˆåœ¨å·¦è¾¹ if (root.val &gt; p.val &amp;&amp; root.val &gt; q.val) return lowestCommonAncestor(root.left, p, q); // å…¬å…±ç¥–å…ˆåœ¨å³è¾¹ if (root.val &lt; p.val &amp;&amp; root.val &lt; q.val) return lowestCommonAncestor(root.right, p, q); // å…¬å…±ç¥–å…ˆåœ¨è¿™ return root; }} äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ12345678910111213141516171819202122/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) { if (root == null || p == root || q == root) return root; TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); // å·¦å³éƒ½æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œ ä¸Šä¸€çº§å°±æ˜¯å…¬å…±çˆ¶èŠ‚ç‚¹ if(left != null &amp;&amp; right != null) return root; if (left == null &amp;&amp; right == null) return null; if (left != null) return left; return right; }} å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘äºŒå‰æ ‘ä¸­åºéå† 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode sortedArrayToBST(int[] nums) { return build(nums, 0, nums.length -1); } private TreeNode build(int[] nums, int start, int end) { if(start&gt; end) return null; TreeNode node = new TreeNode(nums[(start+end)/2]); node.left = build(nums, start, (start+end)/2 -1); node.right = build(nums, (start+end)/2+1, end); return node; }} æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘é“¾è¡¨è½¬æ•°ç»„ 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } *//** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode sortedListToBST(ListNode head) { List&lt;Integer&gt; list = new LinkedList(); ListNode now = head; while (now != null) { list.add(now.val); now = now.next; } return build(list, 0, list.size() - 1); } private TreeNode build(List&lt;Integer&gt; nums, int start, int end) { if(start&gt; end) return null; TreeNode node = new TreeNode(nums.get((start+end)/2)); node.left = build(nums, start, (start+end)/2 -1); node.right = build(nums, (start+end)/2+1, end); return node; }} è¿˜å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨ä¸­é—´èŠ‚ç‚¹ï¼Œç¼ºç‚¹æ˜¯é‡å¤éå†èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * Definition for singly-linked list. * public class ListNode { * int val; * ListNode next; * ListNode(int x) { val = x; } * } *//** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode sortedListToBST(ListNode head) {// List&lt;Integer&gt; list = new LinkedList();// ListNode now = head;// while (now != null) {// list.add(now.val);// now = now.next;// } // return build(list, 0, list.size() - 1); return sortedListToBST(head, null); } private TreeNode sortedListToBST(ListNode head, ListNode tail) { if (head == tail) return null; ListNode mid = head, end = head; while (end != tail &amp;&amp; end.next != tail) { mid = mid.next; end = end.next.next; } TreeNode root = new TreeNode(mid.val); root.right = sortedListToBST(mid.next, tail); root.left = sortedListToBST(head, mid); return root; } private TreeNode build(List&lt;Integer&gt; nums, int start, int end) { if(start&gt; end) return null; TreeNode node = new TreeNode(nums.get((start+end)/2)); node.left = build(nums, start, (start+end)/2 -1); node.right = build(nums, (start+end)/2+1, end); return node; } } ä¸¤æ•°ä¹‹å’Œ IV - è¾“å…¥ BSTè‡ªå·±å†™ä¸¤æ¬¡éå†æœç´¢äºŒå‰æ ‘ï¼Œæ³¨æ„è¦æ’é™¤è‡ªèº«èŠ‚ç‚¹ 123456789101112131415161718192021222324252627282930313233343536/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private boolean res; private TreeNode r; private TreeNode current; public boolean findTarget(TreeNode root, int k) { r = root; visit(root, k); return res; } private void visit(TreeNode root, int val) { if (root == null) return; visit(root.left, val); current = root; if (find(r, val - root.val)) {res = true; return;} visit(root.right, val); } private boolean find(TreeNode root, int value) { if (root == null) return false; if (root == current) return false; if (root.val == value ) return true; return (value &gt; root.val) ? find(root.right, value): find(root.left, value); }} æ­£ç»æ€è·¯ï¼Œ ä¸­åºéå†è½¬åŒ–ä¸ºæ’åºæ•°ç»„ï¼Œ ä½¿ç”¨åŒæŒ‡é’ˆæŸ¥æ‰¾ 1234567891011121314151617181920212223242526272829303132333435363738/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new ArrayList&lt;&gt;(64); public boolean findTarget(TreeNode root, int k) { visitTree(root); int low = 0, high = res.size() - 1; while (low &lt; high) { int sum = res.get(low) + res.get(high); if (sum == k) return true; if (sum &lt; k) low++; else high--; } return false; } private void visitTree(TreeNode root) { if (root == null) return; visitTree(root.left); res.add(root.val); visitTree(root.right); }}","link":"/2019/2019-06-30-LeetCode_%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8E%92%E5%BA%8F%E6%A0%91%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/"},{"title":"ç¼“å­˜ä¸“é¢˜(å››) åˆ†å¸ƒå¼ç¼“å­˜é«˜å¯ç”¨","text":"åˆ†å¸ƒå¼ç¼“å­˜çš„é«˜å¯ç”¨æ–¹æ¡ˆä¸»è¦é€‰æ‹©çš„æ–¹æ¡ˆæœ‰å®¢æˆ·ç«¯æ–¹æ¡ˆã€ä¸­é—´ä»£ç†å±‚æ–¹æ¡ˆå’ŒæœåŠ¡ç«¯æ–¹æ¡ˆä¸‰å¤§ç±»ï¼š å®¢æˆ·ç«¯æ–¹æ¡ˆå°±æ˜¯åœ¨å®¢æˆ·ç«¯é…ç½®å¤šä¸ªç¼“å­˜çš„èŠ‚ç‚¹ï¼Œé€šè¿‡ç¼“å­˜å†™å…¥å’Œè¯»å–ç®—æ³•ç­–ç•¥æ¥å®ç°åˆ†å¸ƒå¼ï¼Œä»è€Œæé«˜ç¼“å­˜çš„å¯ç”¨æ€§ã€‚ ä¸­é—´ä»£ç†å±‚æ–¹æ¡ˆæ˜¯åœ¨åº”ç”¨ä»£ç å’Œç¼“å­˜èŠ‚ç‚¹ä¹‹é—´å¢åŠ ä»£ç†å±‚ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰çš„å†™å…¥å’Œè¯»å–çš„è¯·æ±‚éƒ½é€šè¿‡ä»£ç†å±‚ï¼Œè€Œä»£ç†å±‚ä¸­ä¼šå†…ç½®é«˜å¯ç”¨ç­–ç•¥ï¼Œå¸®åŠ©æå‡ç¼“å­˜ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚ æœåŠ¡ç«¯æ–¹æ¡ˆå°±æ˜¯ Redis 2.4 ç‰ˆæœ¬åæå‡ºçš„ Redis Sentinel æ–¹æ¡ˆã€‚ æŒæ¡è¿™äº›æ–¹æ¡ˆå¯ä»¥å¸®åŠ©ä½ ï¼ŒæŠµå¾¡éƒ¨åˆ†ç¼“å­˜èŠ‚ç‚¹æ•…éšœå¯¼è‡´çš„ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸‹é™çš„å½±å“ï¼Œå¢å¼ºä½ çš„ç³»ç»Ÿçš„é²æ£’æ€§ã€‚ å®¢æˆ·ç«¯æ–¹æ¡ˆåœ¨å®¢æˆ·ç«¯æ–¹æ¡ˆä¸­ï¼Œä½ éœ€è¦å…³æ³¨ç¼“å­˜çš„å†™å’Œè¯»ä¸¤ä¸ªæ–¹é¢ï¼š å†™å…¥æ•°æ®æ—¶ï¼Œéœ€è¦æŠŠè¢«å†™å…¥ç¼“å­˜çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸­ï¼Œå³è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼› è¯»æ•°æ®æ—¶ï¼Œå¯ä»¥åˆ©ç”¨å¤šç»„çš„ç¼“å­˜æ¥åšå®¹é”™ï¼Œæå‡ç¼“å­˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚å…³äºè¯»æ•°æ®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ä¸»ä»å’Œå¤šå‰¯æœ¬ä¸¤ç§ç­–ç•¥ï¼Œä¸¤ç§ç­–ç•¥æ˜¯ä¸ºäº†è§£å†³ä¸åŒçš„é—®é¢˜è€Œæå‡ºçš„ã€‚ ä¸‹é¢æˆ‘å°±å¸¦ä½ ä¸€èµ·è¯¦ç»†åœ°çœ‹ä¸€ä¸‹åˆ°åº•è¦æ€ä¹ˆåšã€‚ 1. ç¼“å­˜æ•°æ®å¦‚ä½•åˆ†ç‰‡ å•ä¸€çš„ç¼“å­˜èŠ‚ç‚¹å—åˆ°æœºå™¨å†…å­˜ã€ç½‘å¡å¸¦å®½å’Œå•èŠ‚ç‚¹è¯·æ±‚é‡çš„é™åˆ¶ï¼Œä¸èƒ½æ‰¿æ‹…æ¯”è¾ƒé«˜çš„å¹¶å‘ï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘å°†æ•°æ®åˆ†ç‰‡ï¼Œä¾ç…§åˆ†ç‰‡ç®—æ³•å°†æ•°æ®æ‰“æ•£åˆ°å¤šä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨éƒ¨åˆ†æ•°æ®ã€‚ è¿™æ ·åœ¨æŸä¸ªèŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿå¯ä»¥æä¾›æœåŠ¡ï¼Œä¿è¯äº†ä¸€å®šçš„å¯ç”¨æ€§ã€‚è¿™å°±å¥½æ¯”ä¸è¦æŠŠé¸¡è›‹æ”¾åœ¨åŒä¸€ä¸ªç¯®å­é‡Œï¼Œè¿™æ ·ä¸€æ—¦ä¸€ä¸ªç¯®å­æ‰åœ¨åœ°ä¸Šï¼Œæ‘”ç¢äº†ï¼Œåˆ«çš„ç¯®å­é‡Œè¿˜æœ‰æ²¡æ‘”ç¢çš„é¸¡è›‹ï¼Œä¸è‡³äºä¸€ä¸ªä¸å‰©ã€‚ ä¸€èˆ¬æ¥è®²ï¼Œåˆ†ç‰‡ç®—æ³•å¸¸è§çš„å°±æ˜¯ Hash åˆ†ç‰‡ç®—æ³•å’Œä¸€è‡´æ€§ Hash åˆ†ç‰‡ç®—æ³•ä¸¤ç§ã€‚ Hash åˆ†ç‰‡çš„ç®—æ³•å°±æ˜¯å¯¹ç¼“å­˜çš„ Key åšå“ˆå¸Œè®¡ç®—ï¼Œç„¶åå¯¹æ€»çš„ç¼“å­˜èŠ‚ç‚¹ä¸ªæ•°å–ä½™ã€‚ä½ å¯ä»¥è¿™ä¹ˆç†è§£ï¼š æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬éƒ¨ç½²äº†ä¸‰ä¸ªç¼“å­˜èŠ‚ç‚¹ç»„æˆä¸€ä¸ªç¼“å­˜çš„é›†ç¾¤ï¼Œå½“æœ‰æ–°çš„æ•°æ®è¦å†™å…¥æ—¶ï¼Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªç¼“å­˜çš„ Key åšæ¯”å¦‚ crc32 ç­‰ Hash ç®—æ³•ç”Ÿæˆ Hash å€¼ï¼Œç„¶åå¯¹ Hash å€¼æ¨¡ 3ï¼Œå¾—å‡ºçš„ç»“æœå°±æ˜¯è¦å­˜å…¥ç¼“å­˜èŠ‚ç‚¹çš„åºå·ã€‚ è¿™ä¸ªç®—æ³•æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ç®€å•æ˜“ç†è§£ï¼Œç¼ºç‚¹æ˜¯å½“å¢åŠ æˆ–è€…å‡å°‘ç¼“å­˜èŠ‚ç‚¹æ—¶ï¼Œç¼“å­˜æ€»çš„èŠ‚ç‚¹ä¸ªæ•°å˜åŒ–é€ æˆè®¡ç®—å‡ºæ¥çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œé€ æˆç¼“å­˜å¤±æ•ˆä¸å¯ç”¨ã€‚æ‰€ä»¥æˆ‘å»ºè®®ä½ ï¼Œå¦‚æœé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ€å¥½å»ºç«‹åœ¨ä½ å¯¹äºè¿™ç»„ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ä¸æ•æ„Ÿï¼Œæ¯”å¦‚ä¸‹é¢è¿˜æœ‰å¦å¤–ä¸€å±‚ç¼“å­˜æ¥å…œåº•çš„æƒ…å†µä¸‹ã€‚ å½“ç„¶äº†ï¼Œç”¨ä¸€è‡´æ€§ Hash ç®—æ³•å¯ä»¥å¾ˆå¥½åœ°è§£å†³å¢åŠ å’Œåˆ å‡èŠ‚ç‚¹æ—¶ï¼Œå‘½ä¸­ç‡ä¸‹é™çš„é—®é¢˜ã€‚åœ¨è¿™ä¸ªç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æ•´ä¸ª Hash å€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œç„¶åå°†ç¼“å­˜èŠ‚ç‚¹çš„ IP åœ°å€æˆ–è€…ä¸»æœºååš Hash å–å€¼åï¼Œæ”¾ç½®åœ¨è¿™ä¸ªåœ†ç¯ä¸Šã€‚å½“æˆ‘ä»¬éœ€è¦ç¡®å®šæŸä¸€ä¸ª Key éœ€è¦å­˜å–åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šçš„æ—¶å€™ï¼Œå…ˆå¯¹è¿™ä¸ª Key åšåŒæ ·çš„ Hash å–å€¼ï¼Œç¡®å®šåœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œç„¶åæŒ‰ç…§é¡ºæ—¶é’ˆæ–¹å‘åœ¨ç¯ä¸Šâ€œè¡Œèµ°â€ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹å°±æ˜¯è¦è®¿é—®çš„èŠ‚ç‚¹ã€‚æ¯”æ–¹è¯´ä¸‹é¢è¿™å¼ å›¾é‡Œé¢ï¼ŒKey 1 å’Œ Key 2 ä¼šè½å…¥åˆ° Node 1 ä¸­ï¼ŒKey 3ã€Key 4 ä¼šè½å…¥åˆ° Node 2 ä¸­ï¼ŒKey 5 è½å…¥åˆ° Node 3 ä¸­ï¼ŒKey 6 è½å…¥åˆ° Node 4 ä¸­ã€‚ è¿™æ—¶å¦‚æœåœ¨ Node 1 å’Œ Node 2 ä¹‹é—´å¢åŠ ä¸€ä¸ª Node 5ï¼Œä½ å¯ä»¥çœ‹åˆ°åŸæœ¬å‘½ä¸­ Node 2 çš„ Key 3 ç°åœ¨å‘½ä¸­åˆ° Node 5ï¼Œè€Œå…¶å®ƒçš„ Key éƒ½æ²¡æœ‰å˜åŒ–ï¼›åŒæ ·çš„é“ç†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ Node 3 ä»é›†ç¾¤ä¸­ç§»é™¤ï¼Œé‚£ä¹ˆåªä¼šå½±å“åˆ° Key 5 ã€‚æ‰€ä»¥ä½ çœ‹ï¼Œåœ¨å¢åŠ å’Œåˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œåªæœ‰å°‘é‡çš„ Key ä¼šâ€œæ¼‚ç§»â€åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Šï¼Œè€Œå¤§éƒ¨åˆ†çš„ Key å‘½ä¸­çš„èŠ‚ç‚¹è¿˜æ˜¯ä¼šä¿æŒä¸å˜ï¼Œä»è€Œå¯ä»¥ä¿è¯å‘½ä¸­ç‡ä¸ä¼šå¤§å¹…ä¸‹é™ã€‚ ä¸è¿‡ï¼Œäº‹ç‰©æ€»æœ‰ä¸¤é¢æ€§ã€‚è™½ç„¶è¿™ä¸ªç®—æ³•å¯¹å‘½ä¸­ç‡çš„å½±å“æ¯”è¾ƒå°ï¼Œä½†å®ƒè¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼š ç¼“å­˜èŠ‚ç‚¹åœ¨åœ†ç¯ä¸Šåˆ†å¸ƒä¸å¹³å‡ï¼Œä¼šé€ æˆéƒ¨åˆ†ç¼“å­˜èŠ‚ç‚¹çš„å‹åŠ›è¾ƒå¤§ï¼›å½“æŸä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€è¦æ‰¿æ‹…çš„æ‰€æœ‰è®¿é—®éƒ½ä¼šè¢«é¡ºç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä¼šå¯¹åé¢è¿™ä¸ªèŠ‚ç‚¹é€ æˆå‹åŠ›ã€‚ ä¸€è‡´æ€§ Hash ç®—æ³•çš„è„æ•°æ®é—®é¢˜ã€‚ æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸€ä¸ªæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ Aã€Bã€C æ‰¿æ‹…æ•´ä½“çš„è®¿é—®ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è®¿é—®é‡å¹³å‡ï¼ŒA æ•…éšœåï¼ŒB å°†æ‰¿æ‹…åŒå€çš„å‹åŠ›ï¼ˆA å’Œ B çš„å…¨éƒ¨è¯·æ±‚ï¼‰ï¼Œå½“ B æ‰¿æ‹…ä¸äº†æµé‡ Crash åï¼ŒC ä¹Ÿå°†å› ä¸ºè¦æ‰¿æ‹…åŸå…ˆä¸‰å€çš„æµé‡è€Œ Crashï¼Œè¿™å°±é€ æˆäº†æ•´ä½“ç¼“å­˜ç³»ç»Ÿçš„é›ªå´©ã€‚ è¯´åˆ°è¿™å„¿ï¼Œä½ å¯èƒ½è§‰å¾—å¾ˆå¯æ€•ï¼Œä½†ä¹Ÿä¸è¦å¤ªæ‹…å¿ƒï¼Œæˆ‘ä»¬ç¨‹åºå‘˜å°±æ˜¯è¦èƒ½å¤Ÿåˆ›é€ æ€§åœ°è§£å†³å„ç§é—®é¢˜ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä¸€è‡´æ€§ Hash ç®—æ³•ä¸­å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µã€‚ å®ƒå°†ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹è®¡ç®—å¤šä¸ª Hash å€¼åˆ†æ•£åˆ°åœ†ç¯çš„ä¸åŒä½ç½®ï¼Œè¿™æ ·æ—¢å®ç°äº†æ•°æ®çš„å¹³å‡ï¼Œè€Œä¸”å½“æŸä¸€ä¸ªèŠ‚ç‚¹æ•…éšœæˆ–è€…é€€å‡ºçš„æ—¶å€™ï¼Œå®ƒåŸå…ˆæ‰¿æ‹…çš„ Key å°†ä»¥æ›´åŠ å¹³å‡çš„æ–¹å¼åˆ†é…åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä»è€Œé¿å…é›ªå´©çš„å‘ç”Ÿã€‚ å…¶æ¬¡ï¼Œå°±æ˜¯ä¸€è‡´æ€§ Hash ç®—æ³•çš„è„æ•°æ®é—®é¢˜ã€‚ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè„æ•°æ®å‘¢ï¼Ÿæ¯”æ–¹è¯´ï¼Œåœ¨é›†ç¾¤ä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ A å’Œ Bï¼Œå®¢æˆ·ç«¯åˆå§‹å†™å…¥ä¸€ä¸ª Key ä¸º kï¼Œå€¼ä¸º 3 çš„ç¼“å­˜æ•°æ®åˆ° Cache A ä¸­ã€‚è¿™æ—¶å¦‚æœè¦æ›´æ–° k çš„å€¼ä¸º 4ï¼Œä½†æ˜¯ç¼“å­˜ A æ°å¥½å’Œå®¢æˆ·ç«¯è¿æ¥å‡ºç°äº†é—®é¢˜ï¼Œé‚£è¿™æ¬¡å†™å…¥è¯·æ±‚ä¼šå†™å…¥åˆ° Cache B ä¸­ã€‚æ¥ä¸‹æ¥ç¼“å­˜ A å’Œå®¢æˆ·ç«¯çš„è¿æ¥æ¢å¤ï¼Œå½“å®¢æˆ·ç«¯è¦è·å– k çš„å€¼æ—¶ï¼Œå°±ä¼šè·å–åˆ°å­˜åœ¨ Cache A ä¸­çš„è„æ•°æ® 3ï¼Œè€Œä¸æ˜¯ Cache B ä¸­çš„ 4ã€‚ æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ä¸€è‡´æ€§ Hash ç®—æ³•æ—¶ä¸€å®šè¦è®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å½“å‘ç”Ÿæ¼‚ç§»æ—¶ï¼Œä¹‹å‰å­˜å‚¨çš„è„æ•°æ®å¯èƒ½å·²ç»è¿‡æœŸï¼Œå°±å¯ä»¥å‡å°‘å­˜åœ¨è„æ•°æ®çš„å‡ ç‡ã€‚ å¾ˆæ˜¾ç„¶ï¼Œæ•°æ®åˆ†ç‰‡æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ç¼“è§£ç¼“å­˜èŠ‚ç‚¹çš„å­˜å‚¨å’Œè®¿é—®å‹åŠ›ï¼Œä½†åŒæ—¶å®ƒ\bä¹Ÿè®©ç¼“å­˜çš„ä½¿ç”¨\bæ›´åŠ å¤æ‚ã€‚åœ¨ MultiGetï¼ˆæ‰¹é‡è·å–ï¼‰åœºæ™¯ä¸‹ï¼Œå•ä¸ªèŠ‚ç‚¹çš„è®¿é—®é‡å¹¶æ²¡æœ‰å‡å°‘ï¼ŒåŒæ—¶èŠ‚ç‚¹æ•°å¤ªå¤šä¼šé€ æˆç¼“å­˜è®¿é—®çš„ SLAï¼ˆå³â€œæœåŠ¡ç­‰çº§åè®®â€ï¼ŒSLA ä»£è¡¨äº†ç½‘ç«™æœåŠ¡å¯ç”¨æ€§ï¼‰å¾—ä¸åˆ°å¾ˆå¥½çš„ä¿è¯ï¼Œå› ä¸ºæ ¹æ®æœ¨æ¡¶åŸåˆ™ï¼ŒSLA å–å†³äºæœ€æ…¢ã€æœ€åçš„èŠ‚ç‚¹çš„æƒ…å†µï¼ŒèŠ‚ç‚¹æ•°è¿‡å¤šä¹Ÿä¼šå¢åŠ å‡ºé—®é¢˜çš„æ¦‚ç‡ï¼Œå› æ­¤æˆ‘æ¨è 4 åˆ° 6 ä¸ªèŠ‚ç‚¹ä¸ºä½³ã€‚ ä¸­é—´ä»£ç†å±‚æ–¹æ¡ˆè™½ç„¶å®¢æˆ·ç«¯æ–¹æ¡ˆå·²ç»èƒ½è§£å†³å¤§éƒ¨åˆ†çš„é—®é¢˜ï¼Œä½†æ˜¯åªèƒ½åœ¨å•ä¸€è¯­è¨€ç³»ç»Ÿä¹‹é—´å¤ç”¨ã€‚ä¾‹å¦‚å¾®åšä½¿ç”¨ Java è¯­è¨€å®ç°äº†è¿™ä¹ˆä¸€å¥—é€»è¾‘ï¼Œæˆ‘ä½¿ç”¨ PHP å°±éš¾ä»¥å¤ç”¨ï¼Œéœ€è¦é‡æ–°å†™ä¸€å¥—ï¼Œå¾ˆéº»çƒ¦ã€‚è€Œä¸­é—´ä»£ç†å±‚çš„æ–¹æ¡ˆå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥å°†å®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆçš„ç»éªŒç§»æ¤åˆ°ä»£ç†å±‚ä¸­ï¼Œé€šè¿‡é€šç”¨çš„åè®®ï¼ˆå¦‚ Redis åè®®ï¼‰æ¥å®ç°åœ¨å…¶ä»–è¯­è¨€ä¸­çš„å¤ç”¨ã€‚ å¦‚æœä½ æ¥è‡ªç ”ç¼“å­˜ä»£ç†å±‚ï¼Œä½ å°±å¯ä»¥å°†å®¢æˆ·ç«¯æ–¹æ¡ˆä¸­çš„é«˜å¯ç”¨é€»è¾‘å°è£…åœ¨ä»£ç†å±‚ä»£ç é‡Œé¢ï¼Œè¿™æ ·ç”¨æˆ·åœ¨ä½¿ç”¨ä½ çš„ä»£ç†å±‚çš„æ—¶å€™å°±ä¸éœ€è¦å…³å¿ƒç¼“å­˜çš„é«˜å¯ç”¨æ˜¯å¦‚ä½•åšçš„ï¼Œåªéœ€è¦ä¾èµ–ä½ çš„ä»£ç†å±‚å°±å¥½äº†ã€‚ é™¤æ­¤ä»¥å¤–ï¼Œä¸šç•Œä¹Ÿæœ‰å¾ˆå¤šä¸­é—´ä»£ç†å±‚æ–¹æ¡ˆï¼Œæ¯”å¦‚ Facebook çš„Mcrouterï¼ŒTwitter çš„Twemproxyï¼Œè±Œè±†èšçš„Codisã€‚å®ƒä»¬çš„åŸç†åŸºæœ¬ä¸Šå¯ä»¥ç”±ä¸€å¼ å›¾æ¥æ¦‚æ‹¬ï¼š çœ‹è¿™å¼ å›¾ä½ æœ‰ä»€ä¹ˆå‘ç°å—ï¼Ÿ æ‰€æœ‰ç¼“å­˜çš„è¯»å†™è¯·æ±‚éƒ½æ˜¯ç»è¿‡ä»£ç†å±‚å®Œæˆçš„ã€‚ä»£ç†å±‚æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦è´Ÿè´£è¯»å†™è¯·æ±‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­å†…ç½®äº†ä¸€äº›é«˜å¯ç”¨çš„é€»è¾‘ï¼Œä¸åŒçš„å¼€æºä¸­é—´ä»£ç†å±‚æ–¹æ¡ˆä¸­ä½¿ç”¨çš„é«˜å¯ç”¨ç­–ç•¥å„æœ‰ä¸åŒã€‚æ¯”å¦‚åœ¨ Twemproxy ä¸­ï¼ŒProxy ä¿è¯åœ¨æŸä¸€ä¸ª Redis èŠ‚ç‚¹æŒ‚æ‰ä¹‹åä¼šæŠŠå®ƒä»é›†ç¾¤ä¸­ç§»é™¤ï¼Œåç»­çš„è¯·æ±‚å°†ç”±å…¶ä»–èŠ‚ç‚¹æ¥å®Œæˆï¼›è€Œ Codis çš„å®ç°ç•¥å¤æ‚ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå« Codis Ha çš„å·¥å…·æ¥å®ç°è‡ªåŠ¨ä»èŠ‚ç‚¹æä¸»èŠ‚ç‚¹ï¼Œåœ¨ 3.2 ç‰ˆæœ¬ä¹‹åæ¢åšäº† Redis Sentinel æ–¹å¼ï¼Œä»è€Œå®ç° Redis èŠ‚ç‚¹çš„é«˜å¯ç”¨ã€‚ æœåŠ¡ç«¯æ–¹æ¡ˆRedis åœ¨ 2.4 ç‰ˆæœ¬ä¸­æå‡ºäº† Redis Sentinel æ¨¡å¼æ¥è§£å†³ä¸»ä» Redis éƒ¨ç½²æ—¶çš„é«˜å¯ç”¨é—®é¢˜ï¼Œå®ƒå¯ä»¥åœ¨ä¸»èŠ‚ç‚¹æŒ‚äº†ä»¥åè‡ªåŠ¨å°†ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œä¿è¯æ•´ä½“é›†ç¾¤çš„å¯ç”¨æ€§ï¼Œæ•´ä½“çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Redis Sentinel ä¹Ÿæ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œè¿™æ ·å¯ä»¥é¿å… Sentinel èŠ‚ç‚¹æŒ‚æ‰é€ æˆæ— æ³•è‡ªåŠ¨æ•…éšœæ¢å¤çš„é—®é¢˜ï¼Œæ¯ä¸€ä¸ª Sentinel èŠ‚ç‚¹éƒ½æ˜¯æ— çŠ¶æ€çš„ã€‚åœ¨ Sentinel ä¸­ä¼šé…ç½® Master çš„åœ°å€ï¼ŒSentinel ä¼šæ—¶åˆ»ç›‘æ§ Master çš„çŠ¶æ€ï¼Œå½“å‘ç° Master åœ¨é…ç½®çš„æ—¶é—´é—´éš”å†…æ— å“åº”ï¼Œå°±è®¤ä¸º Master å·²ç»æŒ‚äº†ï¼ŒSentinel ä¼šä»ä»èŠ‚ç‚¹ä¸­é€‰å–ä¸€ä¸ªæå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ‰€æœ‰å…¶ä»–çš„ä»èŠ‚ç‚¹ä½œä¸ºæ–°ä¸»çš„ä»èŠ‚ç‚¹ã€‚Sentinel é›†ç¾¤å†…éƒ¨åœ¨ä»²è£çš„æ—¶å€™ï¼Œä¼šæ ¹æ®é…ç½®çš„å€¼æ¥å†³å®šå½“æœ‰å‡ ä¸ª Sentinel èŠ‚ç‚¹è®¤ä¸ºä¸»æŒ‚æ‰å¯ä»¥åšä¸»ä»åˆ‡æ¢çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤å†…éƒ¨éœ€è¦å¯¹ç¼“å­˜èŠ‚ç‚¹çš„çŠ¶æ€è¾¾æˆä¸€è‡´æ‰è¡Œã€‚ Redis Sentinel ä¸å±äºä»£ç†å±‚æ¨¡å¼ï¼Œå› ä¸ºå¯¹äºç¼“å­˜çš„å†™å…¥å’Œè¯»å–è¯·æ±‚ä¸ä¼šç»è¿‡ Sentinel èŠ‚ç‚¹ã€‚Sentinel èŠ‚ç‚¹åœ¨æ¶æ„ä¸Šå’Œä¸»ä»æ˜¯å¹³çº§çš„ï¼Œæ˜¯ä½œä¸ºç®¡ç†è€…å­˜åœ¨çš„ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºæ˜¯åœ¨æœåŠ¡ç«¯æä¾›çš„ä¸€ç§é«˜å¯ç”¨æ–¹æ¡ˆã€‚","link":"/2019/2019-12-04-%E7%BC%93%E5%AD%98%E4%B8%93%E9%A2%98(%E5%9B%9B)_%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E9%AB%98%E5%8F%AF%E7%94%A8/"},{"title":"[ç‰‡æ®µ] Mybatis ParameterHandlerå®è·µ","text":"ç”¨æ¥æ‰¹é‡åŠ å¯†ç”¨@Decryptedæ³¨è§£çš„Stringå­—æ®µï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å‘ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228import com.google.common.cache.CacheBuilder;import com.google.common.cache.CacheLoader;import com.google.common.cache.LoadingCache;import com.ke.zhaopin.manage.server.config.mybatis.interceptor.anno.Decrypted;import com.lianjia.ctt.kinko.spi.CipherSpi;import com.sun.istack.internal.NotNull;import lombok.Getter;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.apache.ibatis.binding.MapperMethod;import org.apache.ibatis.executor.parameter.ParameterHandler;import org.apache.ibatis.plugin.*;import org.apache.ibatis.reflection.MetaObject;import org.apache.ibatis.scripting.defaults.DefaultParameterHandler;import org.apache.ibatis.session.Configuration;import org.apache.ibatis.session.defaults.DefaultSqlSession;import org.joor.Reflect;import reactor.core.publisher.Flux;import java.lang.reflect.Array;import java.lang.reflect.Field;import java.sql.PreparedStatement;import java.util.*;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeUnit;import java.util.function.Function;import java.util.stream.Collectors;@Intercepts({ @Signature(type = ParameterHandler.class, method = \"setParameters\", args = {PreparedStatement.class}),})@Slf4jpublic class EncryptInterceptor implements Interceptor { private static final String COLLECTION_KEY = \"collection\"; private static final String ARRAY_KEY = \"array\"; private final LoadingCache&lt;Class, List&lt;String&gt;&gt; decryptFieldCaches = CacheBuilder.newBuilder() .maximumSize(200) .expireAfterAccess(10L, TimeUnit.MINUTES) .build(new CacheLoader&lt;Class, List&lt;String&gt;&gt;() { @Override public List&lt;String&gt; load(Class key) { return Arrays.stream(key.getDeclaredFields()) .filter(f -&gt; f.getAnnotation(Decrypted.class) != null) .filter(f -&gt; { boolean isString = f.getType() == String.class; if (!isString) { log.warn(f.getName() + \"is not String, actual type is \" + f.getType().getSimpleName() + \" ignored\"); } return isString; }) .map(Field::getName) .collect(Collectors.toList()); } } ); private CipherSpi cipherSpi; public EncryptInterceptor(CipherSpi cipherSpi) { this.cipherSpi = cipherSpi; } @Override public Object intercept(Invocation invocation) throws Throwable { Flux&lt;CryptContext&gt; contextFlux = Flux.empty(); do { if (!(invocation.getTarget() instanceof DefaultParameterHandler)) break; final Reflect parameterHandler = Reflect.on(invocation.getTarget()); final Object parameterObject = parameterHandler.get(\"parameterObject\"); final Configuration configuration = parameterHandler.get(\"configuration\"); if (parameterObject instanceof DefaultSqlSession.StrictMap) { // å•ä¸ªCollection/Map/Arrayå‚æ•° DefaultSqlSession.StrictMap&lt;?&gt; paramMap = (DefaultSqlSession.StrictMap&lt;?&gt;) parameterObject; Collection&lt;?&gt; collection = null; Class&lt;?&gt; componentType = null; if (paramMap.containsKey(COLLECTION_KEY)) { collection = (Collection&lt;?&gt;) paramMap.get(COLLECTION_KEY); componentType = collection.iterator().next().getClass(); } else if (paramMap.containsKey(ARRAY_KEY)) { Object[] array = (Object[]) paramMap.get(ARRAY_KEY); componentType = array.getClass().getComponentType(); collection = Arrays.asList(array); } if (!isUserDefinedClass(componentType)) break; contextFlux = collection(configuration, collection, componentType); } else if (parameterObject instanceof MapperMethod.ParamMap) { // å¤šä¸ªå‚æ•° MapperMethod.ParamMap&lt;?&gt; paramMap = (MapperMethod.ParamMap&lt;?&gt;) parameterObject; final List&lt;?&gt; params = paramMap.values().stream().filter(Objects::nonNull).distinct().collect(Collectors.toList()); for (Object parameter : params) { if (parameter instanceof Collection) { Collection&lt;?&gt; collection = (Collection&lt;?&gt;) parameter; if (collection.isEmpty()) { continue; } Class&lt;?&gt; componentType = collection.iterator().next().getClass(); if (!isUserDefinedClass(componentType)) { continue; } final Flux&lt;CryptContext&gt; collectionFlux = collection(configuration, collection, componentType); contextFlux = contextFlux.concatWith(collectionFlux); } else if (parameter.getClass().isArray()) { if (Array.getLength(parameter) == 0) continue; final Class&lt;?&gt; componentType = parameter.getClass().getComponentType(); if (!isUserDefinedClass(componentType)) { continue; } Collection&lt;?&gt; collection = Arrays.asList((Object[]) parameter); final Flux&lt;CryptContext&gt; collectionFlux = collection(configuration, collection, componentType); contextFlux = contextFlux.concatWith(collectionFlux); } else if (isUserDefinedClass(parameter.getClass())) { final Flux&lt;CryptContext&gt; singleFlux = collection(configuration, Collections.singletonList(parameter), parameter.getClass()); contextFlux = contextFlux.concatWith(singleFlux); } } } else if (isUserDefinedClass(parameterObject.getClass())) { // å•ä¸ªéCollection/Map/Arrayå‚æ•° contextFlux = collection(configuration, Collections.singletonList(parameterObject), parameterObject.getClass()); } else { // ä¸æ˜¯ç”¨interfaceçš„æƒ…å†µ } } while (false); final List&lt;CryptContext&gt; cryptContexts = encrypt(contextFlux); invocation.proceed(); restore(cryptContexts); return null; } private void restore(List&lt;CryptContext&gt; cryptContexts) { for (CryptContext cryptContext : cryptContexts) { cryptContext.metaObject.setValue(cryptContext.fieldName, cryptContext.value); } } private Flux&lt;CryptContext&gt; collection(Configuration configuration, Collection&lt;?&gt; collection, Class&lt;?&gt; componentType) throws ExecutionException { final List&lt;String&gt; fieldNames = this.getDecryptFields(componentType); return Flux.fromIterable(collection) .map(configuration::newMetaObject) .flatMapIterable(metaObject -&gt; fieldNames.stream().map(fieldName -&gt; new CryptContext(metaObject, fieldName)).collect(Collectors.toList())); } private List&lt;CryptContext&gt; encrypt(Flux&lt;CryptContext&gt; contextFlux) { return contextFlux .filter(context -&gt; StringUtils.isNotBlank(context.value)) .buffer(1000) .doOnNext(contexts -&gt; { Map&lt;String, String&gt; secretMap = Collections.emptyMap(); try { secretMap = cipherSpi.batchEncrypt(contexts.stream().map(CryptContext::getValue).distinct().collect(Collectors.toList())); } catch (Exception e) { } for (CryptContext context : contexts) { context.secret = secretMap.get(context.value); } }) .flatMapIterable(Function.identity()) .doOnNext(context -&gt; context.metaObject.setValue(context.fieldName, context.secret)) .collectList() .block(); } @NotNull private List&lt;String&gt; getDecryptFields(Class&lt;?&gt; modelClazz) throws ExecutionException { return this.decryptFieldCaches.get(modelClazz); } private boolean isUserDefinedClass(Class&lt;?&gt; clazz) { return !clazz.isPrimitive() &amp;&amp; !clazz.getPackage().getName().startsWith(\"java\"); } @Override public Object plugin(Object target) { return Plugin.wrap(target, this); } @Override public void setProperties(Properties properties) { }}@Getterclass CryptContext { CryptContext(MetaObject metaObject, String fieldName) { this.metaObject = metaObject; this.fieldName = fieldName; this.value = (String) metaObject.getValue(fieldName); if (StringUtils.isBlank(value)) { this.secret = StringUtils.EMPTY; } } final MetaObject metaObject; final String fieldName; final String value; String secret;}","link":"/2019/2019-12-04-Mybatis_ParameterHandler%E5%AE%9E%E8%B7%B5/"},{"title":"ç¼“å­˜ä¸“é¢˜(äº”) å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€","text":"ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€å…¶å®æ˜¯æŒ‡ä»ç¼“å­˜ä¸­æ²¡æœ‰æŸ¥åˆ°æ•°æ®ï¼Œè€Œä¸å¾—ä¸ä»åç«¯ç³»ç»Ÿï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼‰ä¸­æŸ¥è¯¢çš„æƒ…å†µã€‚ä½ å¯ä»¥æŠŠæ•°æ®åº“æ¯”å–»ä¸ºæ‰‹æœºï¼Œå®ƒæ˜¯ç»å—ä¸äº†å¤ªå¤šçš„åˆ’ç—•å’Œç£•ç¢°çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦ç»™å®ƒè´´ä¸ªè†œå†å¥—ä¸ªä¿æŠ¤å£³ï¼Œå°±èƒ½å¯¹æ‰‹æœºèµ·åˆ°ä¸€å®šçš„ä¿æŠ¤ä½œç”¨äº†ã€‚ ä¸è¿‡ï¼Œå°‘é‡çš„ç¼“å­˜ç©¿é€ä¸å¯é¿å…ï¼Œå¯¹ç³»ç»Ÿä¹Ÿæ˜¯æ²¡æœ‰æŸå®³çš„ï¼Œä¸»è¦æœ‰å‡ ç‚¹åŸå› ï¼š ä¸€æ–¹é¢ï¼Œäº’è”ç½‘ç³»ç»Ÿé€šå¸¸ä¼šé¢ä¸´æå¤§æ•°æ®é‡çš„è€ƒéªŒï¼Œè€Œç¼“å­˜ç³»ç»Ÿåœ¨å®¹é‡ä¸Šæ˜¯æœ‰é™çš„ï¼Œä¸å¯èƒ½å­˜å‚¨ç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢æœªç¼“å­˜æ•°æ®çš„æ—¶å€™å°±ä¼šå‘ç”Ÿç¼“å­˜ç©¿é€ã€‚ å¦ä¸€æ–¹é¢ï¼Œäº’è”ç½‘ç³»ç»Ÿçš„æ•°æ®è®¿é—®æ¨¡å‹ä¸€èˆ¬ä¼šéµä»â€œ80/20 åŸåˆ™â€ã€‚â€œ80/20 åŸåˆ™â€åˆç§°ä¸ºå¸•ç´¯æ‰˜æ³•åˆ™ï¼Œæ˜¯æ„å¤§åˆ©ç»æµå­¦å®¶å¸•ç´¯æ‰˜æå‡ºçš„ä¸€ä¸ªç»æµå­¦çš„ç†è®ºã€‚å®ƒæ˜¯æŒ‡åœ¨ä¸€ç»„äº‹ç‰©ä¸­ï¼Œæœ€é‡è¦çš„äº‹ç‰©é€šå¸¸åªå  20%ï¼Œè€Œå‰©ä½™çš„ 80% çš„äº‹ç‰©ç¡®å®ä¸é‡è¦çš„ã€‚æŠŠå®ƒåº”ç”¨åˆ°æ•°æ®è®¿é—®çš„é¢†åŸŸï¼Œå°±æ˜¯æˆ‘ä»¬ä¼šç»å¸¸è®¿é—® 20% çš„çƒ­ç‚¹æ•°æ®ï¼Œè€Œå¦å¤–çš„ 80% çš„æ•°æ®åˆ™ä¸ä¼šè¢«ç»å¸¸è®¿é—®ã€‚æ¯”å¦‚ä½ ä¹°äº†å¾ˆå¤šè¡£æœï¼Œå¾ˆå¤šä¹¦ï¼Œä½†æ˜¯å…¶å®ç»å¸¸ç©¿çš„ï¼Œç»å¸¸çœ‹çš„ï¼Œå¯èƒ½ä¹Ÿå°±æ˜¯å…¶ä¸­å¾ˆå°çš„ä¸€éƒ¨åˆ†ã€‚ æ—¢ç„¶ç¼“å­˜çš„å®¹é‡æœ‰é™ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†çš„è®¿é—®åªä¼šè¯·æ±‚ 20% çš„çƒ­ç‚¹æ•°æ®ï¼Œé‚£ä¹ˆç†è®ºä¸Šè¯´ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ‰é™çš„ç¼“å­˜ç©ºé—´é‡Œå­˜å‚¨ 20% çš„çƒ­ç‚¹æ•°æ®å°±å¯ä»¥æœ‰æ•ˆåœ°ä¿æŠ¤è„†å¼±çš„åç«¯ç³»ç»Ÿäº†ï¼Œä¹Ÿå°±å¯ä»¥æ”¾å¼ƒç¼“å­˜å¦å¤– 80% çš„éçƒ­ç‚¹æ•°æ®äº†ã€‚æ‰€ä»¥ï¼Œè¿™ç§å°‘é‡çš„ç¼“å­˜ç©¿é€æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†æ˜¯å¯¹ç³»ç»Ÿæ˜¯æ²¡æœ‰æŸå®³çš„ã€‚ é‚£ä¹ˆä»€ä¹ˆæ ·çš„ç¼“å­˜ç©¿é€å¯¹ç³»ç»Ÿæœ‰å®³å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¤§é‡çš„ç©¿é€è¯·æ±‚è¶…è¿‡äº†åç«¯ç³»ç»Ÿçš„æ‰¿å—èŒƒå›´ï¼Œé€ æˆäº†åç«¯ç³»ç»Ÿçš„å´©æºƒã€‚å¦‚æœæŠŠå°‘é‡çš„è¯·æ±‚æ¯”ä½œæ¯›æ¯›ç»†é›¨ï¼Œé‚£ä¹ˆä¸€æ—¦å˜æˆå€¾ç›†å¤§é›¨ï¼Œå¼•å‘æ´ªæ°´ï¼Œå†²å€’æˆ¿å±‹ï¼Œè‚¯å®šå°±ä¸è¡Œäº†ã€‚ äº§ç”Ÿè¿™ç§å¤§é‡ç©¿é€è¯·æ±‚çš„åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°±å¸¦ä½ è§£æè¿™å‡ ç§åœºæ™¯ä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆã€‚ ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆå…ˆæ¥è€ƒè™‘è¿™æ ·ä¸€ç§åœºæ™¯ï¼šåœ¨ä½ çš„ç”µå•†ç³»ç»Ÿçš„ç”¨æˆ·è¡¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç”¨æˆ· ID æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç¼“å­˜çš„è¯»å†™ç­–ç•¥é‡‡ç”¨ Cache Aside ç­–ç•¥ã€‚ é‚£ä¹ˆï¼Œå¦‚æœè¦è¯»å–ä¸€ä¸ªç”¨æˆ·è¡¨ä¸­æœªæ³¨å†Œçš„ç”¨æˆ·ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼ŸæŒ‰ç…§è¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬ä¼šå…ˆè¯»ç¼“å­˜ï¼Œå†ç©¿é€è¯»æ•°æ®åº“ã€‚ç”±äºç”¨æˆ·å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå‘ç¼“å­˜ä¸­å›ç§æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯å‘ç¼“å­˜ä¸­è®¾ç½®å€¼çš„æ„æ€ï¼‰ï¼Œè¿™æ ·å½“å†æ¬¡è¯·æ±‚è¿™ä¸ªç”¨æˆ·æ•°æ®çš„æ—¶å€™è¿˜æ˜¯ä¼šå†æ¬¡ç©¿é€åˆ°æ•°æ®åº“ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œç¼“å­˜å¹¶ä¸èƒ½æœ‰æ•ˆåœ°é˜»æŒ¡è¯·æ±‚ç©¿é€åˆ°æ•°æ®åº“ä¸Šï¼Œå®ƒçš„ä½œç”¨å°±å¾®ä¹å…¶å¾®äº†ã€‚ é‚£å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šå›ç§ç©ºå€¼ä»¥åŠä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ç§æ–¹æ¡ˆã€‚ å›ç§ç©ºå€¼å›é¡¾ä¸Šé¢æåˆ°çš„åœºæ™¯ï¼Œä½ ä¼šå‘ç°æœ€å¤§çš„é—®é¢˜åœ¨äºæ•°æ®åº“ä¸­å¹¶ä¸å­˜åœ¨ç”¨æˆ·çš„æ•°æ®ï¼Œè¿™å°±é€ æˆæ— è®ºæŸ¥è¯¢å¤šå°‘æ¬¡ï¼Œæ•°æ®åº“ä¸­æ°¸è¿œéƒ½ä¸ä¼šå­˜åœ¨è¿™ä¸ªç”¨æˆ·çš„æ•°æ®ï¼Œç©¿é€æ°¸è¿œéƒ½ä¼šå‘ç”Ÿã€‚ ç±»ä¼¼çš„åœºæ™¯è¿˜æœ‰ä¸€äº›ï¼šæ¯”å¦‚ç”±äºä»£ç çš„ bug å¯¼è‡´æŸ¥è¯¢æ•°æ®åº“çš„æ—¶å€™æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™æ ·å¯ä»¥è®¤ä¸ºä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸ºç©ºï¼ŒåŒæ ·ä¸ä¼šå›ç§ç¼“å­˜ã€‚ é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ç©ºå€¼æˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç¼“å­˜ä¸­å›ç§ä¸€ä¸ªç©ºå€¼ã€‚ä½†æ˜¯å› ä¸ºç©ºå€¼å¹¶ä¸æ˜¯å‡†ç¡®çš„ä¸šåŠ¡æ•°æ®ï¼Œå¹¶ä¸”ä¼šå ç”¨ç¼“å­˜çš„ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šç»™è¿™ä¸ªç©ºå€¼åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç©ºå€¼åœ¨çŸ­æ—¶é—´ä¹‹å†…èƒ½å¤Ÿå¿«é€Ÿè¿‡æœŸæ·˜æ±°ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªæµç¨‹çš„ä¼ªä»£ç ï¼š 1234567891011Object nullValue = new Object();try { Object valueFromDB = getFromDB(uid); // ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ® if (valueFromDB == null) { cache.set(uid, nullValue, 10); // å¦‚æœä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ç©ºå€¼ï¼Œå°±æŠŠç©ºå€¼å†™å…¥ç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´ } else { cache.set(uid, valueFromDB, 1000); }} catch(Exception e) { cache.set(uid, nullValue, 10);} å›ç§ç©ºå€¼è™½ç„¶èƒ½å¤Ÿé˜»æŒ¡å¤§é‡ç©¿é€çš„è¯·æ±‚ï¼Œä½†å¦‚æœæœ‰å¤§é‡è·å–æœªæ³¨å†Œç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚ï¼Œç¼“å­˜å†…å°±ä¼šæœ‰æœ‰å¤§é‡çš„ç©ºå€¼ç¼“å­˜ï¼Œä¹Ÿå°±ä¼šæµªè´¹ç¼“å­˜çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¢«å æ»¡äº†ï¼Œè¿˜ä¼šå‰”é™¤æ‰ä¸€äº›å·²ç»è¢«ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯åè€Œä¼šé€ æˆç¼“å­˜å‘½ä¸­ç‡çš„ä¸‹é™ã€‚ æ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘å»ºè®®ä½ åœ¨ä½¿ç”¨çš„æ—¶å€™åº”è¯¥è¯„ä¼°ä¸€ä¸‹ç¼“å­˜å®¹é‡æ˜¯å¦èƒ½å¤Ÿæ”¯æ’‘ã€‚å¦‚æœéœ€è¦å¤§é‡çš„ç¼“å­˜èŠ‚ç‚¹æ¥æ”¯æŒï¼Œé‚£ä¹ˆå°±æ— æ³•é€šè¿‡é€šè¿‡å›ç§ç©ºå€¼çš„æ–¹å¼æ¥è§£å†³ï¼Œè¿™æ—¶ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ã€‚ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨1970 å¹´å¸ƒéš†æå‡ºäº†ä¸€ç§å¸ƒéš†è¿‡æ»¤å™¨çš„ç®—æ³•ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚è¿™ç§ç®—æ³•ç”±ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„å’Œä¸€ä¸ª Hash ç®—æ³•ç»„æˆã€‚å®ƒçš„åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š æˆ‘ä»¬æŠŠé›†åˆä¸­çš„æ¯ä¸€ä¸ªå€¼æŒ‰ç…§æä¾›çš„ Hash ç®—æ³•ç®—å‡ºå¯¹åº”çš„ Hash å€¼ï¼Œç„¶åå°† Hash å€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡åå¾—åˆ°éœ€è¦è®¡å…¥æ•°ç»„çš„ç´¢å¼•å€¼ï¼Œå¹¶ä¸”å°†æ•°ç»„è¿™ä¸ªä½ç½®çš„å€¼ä» 0 æ”¹æˆ 1ã€‚åœ¨åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºè¿™ä¸ªé›†åˆä¸­æ—¶ï¼Œä½ åªéœ€è¦å°†è¿™ä¸ªå…ƒç´ æŒ‰ç…§ç›¸åŒçš„ç®—æ³•è®¡ç®—å‡ºç´¢å¼•å€¼ï¼Œå¦‚æœè¿™ä¸ªä½ç½®çš„å€¼ä¸º 1 å°±è®¤ä¸ºè¿™ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ï¼Œå¦åˆ™åˆ™è®¤ä¸ºä¸åœ¨é›†åˆä¸­ã€‚ ä¸‹å›¾æ˜¯å¸ƒéš†è¿‡æ»¤å™¨ç¤ºæ„å›¾ï¼Œæˆ‘æ¥å¸¦ä½ åˆ†æä¸€ä¸‹å›¾å†…çš„ä¿¡æ¯ã€‚ Aã€Bã€C ç­‰å…ƒç´ ç»„æˆäº†ä¸€ä¸ªé›†åˆï¼Œå…ƒç´  D è®¡ç®—å‡ºçš„ Hash å€¼æ‰€å¯¹åº”çš„çš„æ•°ç»„ä¸­å€¼æ˜¯ 1ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸º D ä¹Ÿåœ¨é›†åˆä¸­ã€‚è€Œ F åœ¨æ•°ç»„ä¸­çš„å€¼æ˜¯ 0ï¼Œæ‰€ä»¥ F ä¸åœ¨æ•°ç»„ä¸­ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³ç¼“å­˜ç©¿é€çš„é—®é¢˜å‘¢ï¼Ÿ è¿˜æ˜¯ä»¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„è¡¨ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ï¼Œæ¯”æ–¹è¯´é•¿åº¦ä¸º 20 äº¿çš„æ•°ç»„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª Hash ç®—æ³•ï¼Œç„¶åæˆ‘ä»¬å°†ç›®å‰ç°æœ‰çš„æ‰€æœ‰ç”¨æˆ·çš„ ID è®¡ç®—å‡º Hash å€¼å¹¶ä¸”æ˜ å°„åˆ°è¿™ä¸ªå¤§æ•°ç»„ä¸­ï¼Œæ˜ å°„ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ï¼Œå…¶å®ƒå€¼è®¾ç½®ä¸º 0ã€‚ æ–°æ³¨å†Œçš„ç”¨æˆ·é™¤äº†éœ€è¦å†™å…¥åˆ°æ•°æ®åº“ä¸­ä¹‹å¤–ï¼Œå®ƒä¹Ÿéœ€è¦ä¾ç…§åŒæ ·çš„ç®—æ³•æ›´æ–°å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°ç»„ä¸­ï¼Œç›¸åº”ä½ç½®çš„å€¼ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦æŸ¥è¯¢æŸä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥è¯¢è¿™ä¸ª ID åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ç©ºå€¼ï¼Œè€Œä¸éœ€è¦ç»§ç»­æŸ¥è¯¢æ•°æ®åº“å’Œç¼“å­˜ï¼Œè¿™æ ·å°±å¯ä»¥æå¤§åœ°å‡å°‘å¼‚å¸¸æŸ¥è¯¢å¸¦æ¥çš„ç¼“å­˜ç©¿é€ã€‚ å¸ƒéš†è¿‡æ»¤å™¨æ‹¥æœ‰æé«˜çš„æ€§èƒ½ï¼Œæ— è®ºæ˜¯å†™å…¥æ“ä½œè¿˜æ˜¯è¯»å–æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ï¼Œæ˜¯å¸¸é‡å€¼ã€‚åœ¨ç©ºé—´ä¸Šï¼Œç›¸å¯¹äºå…¶ä»–æ•°æ®ç»“æ„å®ƒä¹Ÿæœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚ï¼Œ20 äº¿çš„æ•°ç»„éœ€è¦ 2000000000/8/1024/1024 = 238M çš„ç©ºé—´ï¼Œè€Œå¦‚æœä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Œå‡è®¾æ¯ä¸ªç”¨æˆ· ID å ç”¨ 4 ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œé‚£ä¹ˆå­˜å‚¨ 20 äº¿ç”¨æˆ·éœ€è¦ 2000000000 * 4 / 1024 / 1024 = 7600M çš„ç©ºé—´ï¼Œæ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„ 32 å€ã€‚ ä¸è¿‡ï¼Œä»»ä½•äº‹ç‰©éƒ½æœ‰ä¸¤é¢æ€§ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿä¸ä¾‹å¤–ï¼Œå®ƒä¸»è¦æœ‰ä¸¤ä¸ªç¼ºé™·ï¼š å®ƒåœ¨åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­æ—¶æ˜¯æœ‰ä¸€å®šé”™è¯¯å‡ ç‡çš„ï¼Œæ¯”å¦‚å®ƒä¼šæŠŠä¸æ˜¯é›†åˆä¸­çš„å…ƒç´ åˆ¤æ–­ä¸ºå¤„åœ¨é›†åˆä¸­ï¼› ä¸æ”¯æŒåˆ é™¤å…ƒç´ ã€‚ å…³äºç¬¬ä¸€ä¸ªç¼ºé™·ï¼Œä¸»è¦æ˜¯ Hash ç®—æ³•çš„é—®é¢˜ã€‚å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ç”±ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„å’Œä¸€ä¸ª Hash ç®—æ³•ç»„æˆçš„ï¼ŒHash ç®—æ³•å­˜åœ¨ç€ä¸€å®šçš„ç¢°æ’å‡ ç‡ã€‚Hash ç¢°æ’çš„å«ä¹‰æ˜¯ä¸åŒçš„è¾“å…¥å€¼ç»è¿‡ Hash è¿ç®—åå¾—åˆ°äº†ç›¸åŒçš„ Hash ç»“æœã€‚ æœ¬æ¥ï¼ŒHash çš„å«ä¹‰æ˜¯ä¸åŒçš„è¾“å…¥ï¼Œä¾æ®ä¸åŒçš„ç®—æ³•æ˜ å°„æˆç‹¬ä¸€æ— äºŒçš„å›ºå®šé•¿åº¦çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘è¾“å…¥å­—ç¬¦ä¸²â€œ1â€ï¼Œæ ¹æ® CRC32 ç®—æ³•ï¼Œå€¼æ˜¯ 2212294583ã€‚ä½†æ˜¯ç°å®ä¸­ Hash ç®—æ³•çš„è¾“å…¥å€¼æ˜¯æ— é™çš„ï¼Œè¾“å‡ºå€¼çš„å€¼ç©ºé—´å´æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚ 16 ä½çš„ Hash å€¼çš„å€¼ç©ºé—´æ˜¯ 65535ï¼Œé‚£ä¹ˆå®ƒçš„ç¢°æ’å‡ ç‡å°±æ˜¯ 1/65535ï¼Œå³å¦‚æœè¾“å…¥å€¼çš„ä¸ªæ•°è¶…è¿‡ 65535 å°±ä¸€å®šä¼šå‘ç”Ÿç¢°æ’ã€‚ é‚£ä¹ˆä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆä¸æ˜ å°„æˆæ›´é•¿çš„ Hash å€¼å‘¢ï¼Ÿ å› ä¸ºæ›´é•¿çš„ Hash å€¼ä¼šå¸¦æ¥æ›´é«˜çš„å­˜å‚¨æˆæœ¬å’Œè®¡ç®—æˆæœ¬ã€‚å³ä½¿ä½¿ç”¨ 32 ä½çš„ Hash ç®—æ³•ï¼Œå®ƒçš„å€¼ç©ºé—´é•¿åº¦æ˜¯ 2 çš„ 32 æ¬¡å¹‚å‡ä¸€ï¼Œçº¦ç­‰äº 42 äº¿ï¼Œç”¨æ¥æ˜ å°„ 20 äº¿çš„ç”¨æˆ·æ•°æ®ï¼Œç¢°æ’å‡ ç‡ä¾ç„¶æœ‰æ¥è¿‘ 50%ã€‚ Hash çš„ç¢°æ’å°±é€ æˆäº†ä¸¤ä¸ªç”¨æˆ· ID ï¼ŒA å’Œ B ä¼šè®¡ç®—å‡ºç›¸åŒçš„ Hash å€¼ï¼Œé‚£ä¹ˆå¦‚æœ A æ˜¯æ³¨å†Œçš„ç”¨æˆ·ï¼Œå®ƒçš„ Hash å€¼å¯¹åº”çš„æ•°ç»„ä¸­çš„å€¼æ˜¯ 1ï¼Œé‚£ä¹ˆ B å³ä½¿ä¸æ˜¯æ³¨å†Œç”¨æˆ·ï¼Œå®ƒåœ¨æ•°ç»„ä¸­çš„ä½ç½®å’Œ A æ˜¯ç›¸åŒçš„ï¼Œå¯¹åº”çš„å€¼ä¹Ÿæ˜¯ 1ï¼Œè¿™å°±äº§ç”Ÿäº†è¯¯åˆ¤ã€‚ å¸ƒéš†è¿‡æ»¤å™¨çš„è¯¯åˆ¤æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒåªä¼šå‡ºç°â€œfalse positiveâ€çš„æƒ…å†µã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå½“å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å…ƒç´ åœ¨é›†åˆä¸­æ—¶ï¼Œè¿™ä¸ªå…ƒç´ å¯èƒ½ä¸åœ¨é›†åˆä¸­ã€‚ä½†æ˜¯ä¸€æ—¦å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªå…ƒç´ ä¸åœ¨é›†åˆä¸­æ—¶ï¼Œå®ƒä¸€å®šä¸åœ¨é›†åˆä¸­ã€‚è¿™ä¸€ç‚¹éå¸¸é€‚åˆè§£å†³ç¼“å­˜ç©¿é€çš„é—®é¢˜ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä½ æƒ³ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨ä¼šå°†é›†åˆä¸­çš„å…ƒç´ åˆ¤å®šä¸ºä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç¡®å®šï¼Œè¢«å¸ƒéš†è¿‡æ»¤å™¨åˆ¤å®šä¸ºä¸åœ¨é›†åˆä¸­çš„å…ƒç´ ï¼Œæ˜¯ä¸æ˜¯åœ¨é›†åˆä¸­ã€‚å‡è®¾åœ¨åˆšæ‰çš„åœºæ™¯ä¸­ï¼Œå¦‚æœæœ‰å¤§é‡æŸ¥è¯¢æœªæ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚å­˜åœ¨ï¼Œé‚£ä¹ˆè¿™äº›è¯·æ±‚åˆ°è¾¾å¸ƒéš†è¿‡æ»¤å™¨ä¹‹åï¼Œå³ä½¿å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸ºä¸æ˜¯æ³¨å†Œç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¸ç¡®å®šå®ƒæ˜¯ä¸æ˜¯çœŸçš„ä¸æ˜¯æ³¨å†Œç”¨æˆ·ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯éœ€è¦å»æ•°æ®åº“å’Œç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œè¿™å°±ä½¿å¸ƒéš†è¿‡æ»¤å™¨å¤±å»äº†ä»·å€¼ã€‚ æ‰€ä»¥ä½ çœ‹ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è™½ç„¶å­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå‡å°‘ç¼“å­˜ç©¿é€çš„æƒ…å†µå‘ç”Ÿï¼Œåªæ˜¯æˆ‘ä»¬éœ€è¦å°½é‡å‡å°‘è¯¯åˆ¤çš„å‡ ç‡ï¼Œè¿™æ ·å¸ƒéš†è¿‡æ»¤å™¨çš„åˆ¤æ–­æ­£ç¡®çš„å‡ ç‡æ›´é«˜ï¼Œå¯¹ç¼“å­˜çš„ç©¿é€ä¹Ÿæ›´å°‘ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ï¼š ä½¿ç”¨å¤šä¸ª Hash ç®—æ³•ä¸ºå…ƒç´ è®¡ç®—å‡ºå¤šä¸ª Hash å€¼ï¼Œåªæœ‰æ‰€æœ‰ Hash å€¼å¯¹åº”çš„æ•°ç»„ä¸­çš„å€¼éƒ½ä¸º 1 æ—¶ï¼Œæ‰ä¼šè®¤ä¸ºè¿™ä¸ªå…ƒç´ åœ¨é›†åˆä¸­ã€‚ å¸ƒéš†è¿‡æ»¤å™¨ä¸æ”¯æŒåˆ é™¤å…ƒç´ çš„ç¼ºé™·ä¹Ÿå’Œ Hash ç¢°æ’æœ‰å…³ã€‚ç»™ä½ ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡å¦‚ä¸¤ä¸ªå…ƒç´  A å’Œ B éƒ½æ˜¯é›†åˆä¸­çš„å…ƒç´ ï¼Œå®ƒä»¬æœ‰ç›¸åŒçš„ Hash å€¼ï¼Œå®ƒä»¬å°±ä¼šæ˜ å°„åˆ°æ•°ç»„çš„åŒä¸€ä¸ªä½ç½®ã€‚è¿™æ—¶æˆ‘ä»¬åˆ é™¤äº† Aï¼Œæ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„å€¼ä¹Ÿä» 1 å˜æˆ 0ï¼Œé‚£ä¹ˆåœ¨åˆ¤æ–­ B çš„æ—¶å€™å‘ç°å€¼æ˜¯ 0ï¼Œä¹Ÿä¼šåˆ¤æ–­ B æ˜¯ä¸åœ¨é›†åˆä¸­çš„å…ƒç´ ï¼Œå°±ä¼šå¾—åˆ°é”™è¯¯çš„ç»“è®ºã€‚ é‚£ä¹ˆæˆ‘æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿæˆ‘ä¼šè®©æ•°ç»„ä¸­ä¸å†åªæœ‰ 0 å’Œ 1 ä¸¤ä¸ªå€¼ï¼Œè€Œæ˜¯å­˜å‚¨ä¸€ä¸ªè®¡æ•°ã€‚æ¯”å¦‚å¦‚æœ A å’Œ B åŒæ—¶å‘½ä¸­äº†ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®çš„å€¼å°±æ˜¯ 2ï¼Œå¦‚æœ A è¢«åˆ é™¤äº†å°±æŠŠè¿™ä¸ªå€¼ä» 2 æ”¹ä¸º 1ã€‚è¿™ä¸ªæ–¹æ¡ˆä¸­çš„æ•°ç»„ä¸å†å­˜å‚¨ bit ä½ï¼Œè€Œæ˜¯å­˜å‚¨æ•°å€¼ï¼Œä¹Ÿå°±ä¼šå¢åŠ ç©ºé—´çš„æ¶ˆè€—ã€‚æ‰€ä»¥ï¼Œä½ è¦ä¾æ®ä¸šåŠ¡åœºæ™¯æ¥é€‰æ‹©æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚åƒæ˜¯æ³¨å†Œç”¨æˆ·çš„åœºæ™¯ä¸‹ï¼Œå› ä¸ºç”¨æˆ·åˆ é™¤çš„æƒ…å†µåŸºæœ¬ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è§£å†³ç¼“å­˜ç©¿é€çš„é—®é¢˜çš„ã€‚ è®²äº†è¿™ä¹ˆå¤šï¼Œå…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„ä½¿ç”¨ä¸Šï¼Œæˆ‘ä¹Ÿç»™ä½ å‡ ä¸ªå»ºè®®ï¼š é€‰æ‹©å¤šä¸ª Hash å‡½æ•°è®¡ç®—å¤šä¸ª Hash å€¼ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¯¯åˆ¤çš„å‡ ç‡ï¼› å¸ƒéš†è¿‡æ»¤å™¨ä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ—¶éœ€è¦è¯„ä¼°ä½ çš„ä¸šåŠ¡åœºæ™¯ä¸‹éœ€è¦å¤šå¤§çš„å†…å­˜ï¼Œå­˜å‚¨çš„æˆæœ¬æ˜¯å¦å¯ä»¥æ¥å—ã€‚ æ€»çš„æ¥è¯´ï¼Œå›ç§ç©ºå€¼å’Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜çš„ä¸¤ç§æœ€ä¸»è¦çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰å„è‡ªçš„é€‚ç”¨åœºæ™¯ï¼Œå¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ã€‚æ¯”æ–¹è¯´å½“æœ‰ä¸€ä¸ªæçƒ­ç‚¹çš„ç¼“å­˜é¡¹ï¼Œå®ƒä¸€æ—¦å¤±æ•ˆä¼šæœ‰å¤§é‡è¯·æ±‚ç©¿é€åˆ°æ•°æ®åº“ï¼Œè¿™ä¼šå¯¹æ•°æ®åº“é€ æˆç¬æ—¶æå¤§çš„å‹åŠ›ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å«åšâ€œdog-pile effectâ€ï¼ˆç‹—æ¡©æ•ˆåº”ï¼‰ï¼Œ è¿™æ˜¯å…¸å‹çš„ç¼“å­˜å¹¶å‘ç©¿é€çš„é—®é¢˜ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè§£å†³ç‹—æ¡©æ•ˆåº”çš„æ€è·¯æ˜¯å°½é‡åœ°å‡å°‘ç¼“å­˜ç©¿é€åçš„å¹¶å‘ï¼Œæ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼š åœ¨ä»£ç ä¸­ï¼Œæ§åˆ¶åœ¨æŸä¸€ä¸ªçƒ­ç‚¹ç¼“å­˜é¡¹å¤±æ•ˆä¹‹åå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œç©¿é€åˆ°æ•°æ®åº“ï¼Œå°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œåœ¨ç¼“å­˜æœªåŠ è½½ä¹‹å‰ï¼Œæ‰€æœ‰è®¿é—®è¿™ä¸ªç¼“å­˜çš„è¯·æ±‚éƒ½ä¸å†ç©¿é€è€Œç›´æ¥è¿”å›ã€‚ é€šè¿‡åœ¨ Memcached æˆ–è€… Redis ä¸­è®¾ç½®åˆ†å¸ƒå¼é”ï¼Œåªæœ‰è·å–åˆ°é”çš„è¯·æ±‚æ‰èƒ½å¤Ÿç©¿é€åˆ°æ•°æ®åº“ã€‚ åˆ†å¸ƒå¼é”çš„æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ¯”æ–¹è¯´ ID ä¸º 1 çš„ç”¨æˆ·æ˜¯ä¸€ä¸ªçƒ­ç‚¹ç”¨æˆ·ï¼Œå½“ä»–çš„ç”¨æˆ·ä¿¡æ¯ç¼“å­˜å¤±æ•ˆåï¼Œæˆ‘ä»¬éœ€è¦ä»æ•°æ®åº“ä¸­é‡æ–°åŠ è½½æ•°æ®æ—¶ï¼Œå…ˆå‘ Memcached ä¸­å†™å…¥ä¸€ä¸ª Key ä¸ºâ€lock.1â€çš„ç¼“å­˜é¡¹ï¼Œç„¶åå»æ•°æ®åº“é‡Œé¢åŠ è½½æ•°æ®ï¼Œå½“æ•°æ®åŠ è½½å®Œæˆåå†æŠŠè¿™ä¸ª Key åˆ æ‰ã€‚è¿™æ—¶ï¼Œå¦‚æœå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè¦è¯·æ±‚è¿™ä¸ªç”¨æˆ·çš„æ•°æ®ï¼Œå®ƒå‘ç°ç¼“å­˜ä¸­æœ‰ Key ä¸ºâ€œlock.1â€çš„ç¼“å­˜ï¼Œå°±è®¤ä¸ºç›®å‰å·²ç»æœ‰çº¿ç¨‹åœ¨åŠ è½½æ•°æ®åº“ä¸­çš„å€¼åˆ°ç¼“å­˜ä¸­äº†ï¼Œå®ƒå°±å¯ä»¥é‡æ–°å»ç¼“å­˜ä¸­æŸ¥è¯¢æ•°æ®ï¼Œä¸å†ç©¿é€æ•°æ®åº“äº†ã€‚","link":"/2019/2019-12-04-%E7%BC%93%E5%AD%98%E4%B8%93%E9%A2%98(%E4%BA%94)_%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F/"},{"title":"é«˜æ€§èƒ½MySql 4è‡³6ç« è¯»ä¹¦ç¬”è®°","text":"ç¬¬å››ç«  Schemaè®¾è®¡é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹æ›´å°çš„é€šå¸¸æ›´å¥½ï¼Œä½†æ˜¯è¦ç¡®ä¿æ²¡æœ‰ä½ä¼°éœ€è¦å­˜å‚¨çš„å€¼çš„èŒƒå›´ï¼Œå› ä¸ºåœ¨schemaä¸­çš„å¤šä¸ªåœ°æ–¹å¢åŠ æ•°æ®ç±»å‹èŒƒå›´æ˜¯ä¸€ä¸ªååˆ†è€—æ—¶çš„æ“ä½œã€‚ ç®€å•å°±å¥½ç®€å•çš„æ•°æ®ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦æ›´å°‘çš„cpuæ—¶é—´ã€‚ å°½é‡é¿å…NULLå¯ä¸ºNULLçš„åˆ—ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•æ¯”ç»Ÿè®¡å’Œå€¼æ¯”è¾ƒéƒ½æ›´ä¸ºå¤æ‚ã€‚ å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼ŒInnoDBä½¿ç”¨å•ç‹¬çš„ä½å­˜å‚¨NULLå€¼ï¼Œ æ‰€ä»¥å¯¹äºç¨€ç–æ•°æ®æœ‰å¾ˆå¥½çš„ç©ºé—´æ•ˆç‡ã€‚ é€‰æ‹©æ ‡è¯†ç¬¦ä¸€æ—¦é€‰å®šä¸€ç§ç±»å‹ï¼Œè¦ç¡®ä¿åœ¨æ‰€æœ‰çš„å…³è”è¡¨ä¸­éƒ½ä½¿ç”¨åŒæ ·çš„ç±»å‹ã€‚ç±»å‹ä¹‹é—´éœ€è¦ç²¾ç¡®åŒ¹é…ï¼ŒåŒ…æ‹¬åƒUNSIGNEDè¿™æ ·çš„å±æ€§ã€‚å°½é‡åªç”¨æ•´å‹å®šä¹‰æ ‡è¯†ç¬¦ã€‚ æ³¨æ„å¯å˜é•¿å­—ç¬¦ä¸²å…¶åœ¨ä¸´æ—¶è¡¨å’Œæ’åºæ—¶å¯èƒ½å¯¼è‡´æ‚²è§‚çš„æŒ‰æœ€å¤§é•¿åº¦åˆ†é…å†…å­˜ èŒƒå¼ä¸åèŒƒå¼èŒƒå¼æ˜¯å¥½çš„ï¼Œä½†æ˜¯åèŒƒå¼æœ‰æ—¶ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå¹¶ä¸”èƒ½å¸¦æ¥å¥½å¤„ã€‚ ç¬¬äº”ç«  åˆ›å»ºé«˜æ€§èƒ½ç´¢å¼•B-Tree ç´¢å¼•çš„æŸ¥è¯¢ç±»å‹ å…¨å€¼åŒ¹é…ï¼š æŒ‡çš„æ˜¯å’Œç´¢å¼•çš„æ‰€æœ‰åˆ—è¿›è¡ŒåŒ¹é… åŒ¹é…æœ€å·¦å‰ç¼€ï¼š æŸ¥æ‰¾ç´¢å¼•å‰å‡ åˆ—è¿›è¡ŒåŒ¹é… åŒ¹é…åˆ—å‰ç¼€: åªåŒ¹é…æŸä¸€åˆ—çš„å€¼çš„å¼€å¤´éƒ¨åˆ† åŒ¹é…èŒƒå›´å€¼ï¼š æŸ¥æ‰¾ç´¢å¼•æŸä¸€èŒƒå›´çš„å€¼ ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å¹¶èŒƒå›´åŒ¹é…å¦å¤–ä¸€åˆ— åªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼šè¦†ç›–ç´¢å¼• B-Tree ç´¢å¼•çš„é™åˆ¶ å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾ï¼Œåˆ™æ— æ³•ä½¿ç”¨ç´¢å¼• ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ— å¦‚æœæŸ¥è¯¢ä¸­æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™å…¶å³è¾¹çš„æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼š ä¾‹å¦‚æŸ¥è¯¢ ç´¢å¼•ä¸ºkey(last_name, fisrt_name, dob) 1where last_name = 'a' and first_name like 'J%' and dob = '1877-12-23' ç´¢å¼•çš„ä¼˜ç‚¹ å¤§å¤§å‡å°‘æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ å°†éšæœºI/Oå˜ä¸ºé¡ºåºI/O é«˜æ€§èƒ½ç´¢å¼•-ç‹¬ç«‹çš„åˆ—å¦‚æœæŸ¥è¯¢ä¸­åˆ—ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ™mysqlä¸ä¼šä½¿ç”¨ç´¢å¼• 1select actor_id from sakila.actor where actor_id + 1 = 5; é«˜æ€§èƒ½ç´¢å¼•-å‰ç¼€ç´¢å¼•å’Œç´¢å¼•é€‰æ‹©æ€§æœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦åˆ—ï¼Œé€šå¸¸å¯ä»¥ç´¢å¼•å¼€å§‹éƒ¨åˆ†çš„å­—ç¬¦ï¼ŒåŒæ—¶ä¹Ÿä¼šé™ä½ç´¢å¼•çš„é€‰æ‹©æ€§ã€‚ ç´¢å¼•çš„é€‰æ‹©æ€§æŒ‡çš„æ˜¯ï¼Œä¸é‡å¤çš„ç´¢å¼•å€¼å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ã€‚ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šé«˜è¡¨ç¤ºæŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå› ä¸ºé€‰æ‹©æ€§é«˜çš„ç´¢å¼•å¯ä»¥è¿‡æ»¤æ‰æ›´å¤šçš„è¡Œã€‚ å‰ç¼€ç´¢å¼•æ˜¯ä¸€ç§èƒ½ä½¿ç´¢å¼•æ›´å°ï¼Œæ›´å¿«çš„æœ‰æ•ˆæ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼šå‰ç¼€ç´¢å¼•æ— æ³•åšorder by å’Œ group byï¼Œä¹Ÿæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšè¦†ç›–ç´¢å¼•ã€‚ é«˜æ€§èƒ½ç´¢å¼•-å¤šåˆ—ç´¢å¼•æœ€å®¹æ˜“é‡åˆ°çš„å›°æƒ‘æ˜¯å¤šåˆ—ç´¢å¼•çš„é¡ºåºï¼Œæ­£ç¡®çš„é¡ºåºä¾èµ–äºä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ï¼ŒåŒæ—¶éœ€è¦è€ƒè™‘å¦‚ä½•æ›´å¥½çš„æ»¡è¶³æ’åºå’Œåˆ†ç»„éœ€è¦ã€‚å¯¹äºå¦‚ä½•é€‰æ‹©ç´¢å¼•çš„åˆ—é¡ºåºæœ‰ä¸€ä¸ªç»éªŒæ³•åˆ™ï¼šå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨ç´¢å¼•çš„æœ€å‰åˆ—ã€‚åªæœ‰ä¸éœ€è¦è€ƒè™‘æ’åºå’Œåˆ†ç»„æ—¶ï¼Œå°†é€‰æ‹©æ€§è·Ÿé«˜çš„åˆ—æ”¾åœ¨æœ€å‰é¢é€šå¸¸æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯è€ƒè™‘é—®é¢˜éœ€è¦æ›´å…¨é¢ï¼Œé¿å…éšæœºI/Oå’Œæ’åºæ›´åŠ é‡è¦ã€‚ é«˜æ€§èƒ½ç´¢å¼•-è¦†ç›–ç´¢å¼•å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç§°ä¹‹ä¸ºâ€œè¦†ç›–ç´¢å¼•â€ è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š ç´¢å¼•æ¡ç›®é€šå¸¸è¿œå°äºæ•°æ®è¡Œå¤§å°ï¼Œæ‰€ä»¥å¦‚æœåªéœ€è¦è¯»å–ç´¢å¼•ï¼Œé‚£mysqlå°±ä¼šæå¤§çš„å‡å°‘æ•°æ®è®¿é—®é‡ã€‚ å› ä¸ºç´¢å¼•æ˜¯æŒ‰ç…§åˆ—å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥å¯¹äºI/Oå¯†é›†å‹èŒƒå›´æŸ¥è¯¢å›é¿éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œæ•°æ®çš„I/Oè¦å°çš„å¤š ç”±äºInnodbçš„èšç°‡ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•å¯¹Innodbè¡¨ç‰¹åˆ«æœ‰ç”¨ï¼Œå¯ä»¥é¿å…å¯¹ä¸»é”®ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚ è¦†ç›–ç´¢å¼•çš„é™·é˜±ï¼š 1select * from products where actor = 'SEAN CARREY' and title like '%APOLLO%'; æ²¡æœ‰ç´¢å¼•èƒ½å¤Ÿè¦†ç›–è¿™ä¸ªæŸ¥è¯¢ï¼Œå› ä¸ºæŸ¥è¯¢ä»è¡¨ä¸­é€‰æ‹©äº†æ‰€æœ‰çš„åˆ— mysqlä¸èƒ½å†ç´¢å¼•ä¸­æ‰§è¡Œlikeæ“ä½œï¼Œåªèƒ½åšæœ€å·¦å‰ç¼€åŒ¹é… é«˜æ€§èƒ½ç´¢å¼•-ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åºmysqlæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”Ÿæˆæœ‰åºçš„ç»“æœï¼šé€šè¿‡æ’åºæ“ä½œï¼›æˆ–è€…ä½¿ç”¨ç´¢å¼•é¡ºåºæ‰«æã€‚mysqlå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•æ—¢æ»¡è¶³æ’åºï¼Œæœ‰ç”¨äºæŸ¥æ‰¾è¡Œã€‚ åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåºå’ŒORDER BYå­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘éƒ½ä¸€æ ·æ—¶ï¼Œmysqlæ‰èƒ½ä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åºã€‚å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨ï¼Œåˆ™åªæœ‰å½“ORDER BYå­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶ï¼Œæ‰èƒ½ç”¨ç´¢å¼•åšæ’åºã€‚ORDER BYå­å¥å’ŒæŸ¥è¯¢çš„é™åˆ¶æ˜¯ä¸€æ ·çš„ï¼šéœ€è¦æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚ã€‚ æœ‰ä¸€ç§æƒ…å†µä¸‹ORDER BYå­å¥å¯ä»¥ä¸æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€è¦æ±‚ï¼š 12select rental_id, staff_id from sakila.rental where rental_date = '2005-05-25'order by inventory_id, customer_id; ç´¢å¼•ä¸ºkey(rental_date, inventory_id, customer_id)ï¼Œå‰å¯¼åˆ—ä¸ºå¸¸é‡çš„æ—¶å€™ï¼Œå¦‚æœwhereå­å¥æˆ–è€…joinå­å¥ä¸­å¯¹è¿™äº›åˆ—æŒ‡å®šäº†å¸¸é‡ï¼Œå°±å¯ä»¥å¼¥è¡¥ORDER BYçš„ä¸è¶³ã€‚ 12where rental_date &gt; '2005-12-25' order by inventory_id, customer_id;where rental_date = '2005-12-25' and inventory_id in (1, 2) order by cusomter_id; å¯¹äºç´¢å¼•ä¸Šæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œmysqlæ— æ³•ä½¿ç”¨ä¹‹åçš„ç´¢å¼•åˆ— é«˜æ€§èƒ½ç´¢å¼•-ä½¿ç”¨ç´¢å¼•æ‰«æå‡å°‘é”ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œï¼Œå¦‚æœä½ çš„æŸ¥è¯¢ä»ä¸è®¿é—®é‚£äº›ä¸éœ€è¦çš„è¡Œï¼Œé‚£ä¹ˆå°±ä¼šé”å®šæ›´å°‘çš„è¡Œã€‚ä½†è¿™åªæœ‰å½“innoDBåœ¨å­˜å‚¨å¼•æ“å±‚èƒ½å¤Ÿè¿‡æ»¤æ‰æ‰€æœ‰ä¸éœ€è¦çš„è¡Œæ˜¯æ‰æœ‰æ•ˆã€‚å¦‚æœç´¢å¼•æ— æ³•è¿‡æ»¤æ‰æ— æ•ˆçš„è¡Œï¼Œé‚£ä¹ˆinnoDBæ£€ç´¢åˆ°æ•°æ®å¹¶è¿”å›ç»™æœåŠ¡å™¨å±‚åï¼ŒinnoDBå·²ç»é”å®šè¿™äº›è¡Œäº†ï¼ˆmysql 5.6åæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼‰ã€‚ é«˜æ€§èƒ½ç´¢å¼•-é¿å…å¤šä¸ªèŒƒå›´æ¡ä»¶ä¸‹é¢çš„æŸ¥è¯¢ï¼š 1where last_online &gt; date_sub(now(), interval 7 day) and age bwtween 18 and 25 è¿™ä¸ªæŸ¥è¯¢æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå®ƒæœ‰ä¸¤ä¸ªèŒƒå›´æ¡ä»¶,last_onlineå’Œageåˆ—ï¼Œmysqlå¯ä»¥ä½¿ç”¨last_onlineçš„ç´¢å¼•æˆ–è€…æ˜¯ageåˆ—çš„ç´¢å¼•ï¼Œä½†æ˜¯æ— æ³•åŒæ—¶ä½¿ç”¨å®ƒä»¬ã€‚ é«˜æ€§èƒ½ç´¢å¼•-å»¶è¿Ÿå…³è”ä¼˜åŒ–åˆ†é¡µå¦‚æœä¸€ä¸ªæŸ¥è¯¢åŒ¹é…ç»“æœæœ‰ä¸Šç™¾ä¸‡è¡Œçš„è¯ä¼šæ€æ ·ï¼Ÿ 1select * from profiles where sex = 'm' order by rating limit 10; å³ä½¿æœ‰ç´¢å¼•ï¼Œå¦‚æœç”¨æˆ·ç•Œé¢éœ€è¦ç¿»é¡µï¼Œå¹¶ä¸”ç¿»é¡µåˆ°æ¯”è¾ƒé åçš„åœ°æ–¹ä¹Ÿä¼šéå¸¸æ…¢ï¼Œå¦‚ï¼š 1select * from profiles where sex = 'm' order by rating limit 1000000, 10; æ— è®ºå¦‚ä½•åˆ›å»ºç´¢å¼•ï¼Œè¿™ç§æŸ¥è¯¢éƒ½æ˜¯ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œmysqléœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´æ¥æ‰«æéœ€è¦ä¸¢å¼ƒçš„æ•°æ®ã€‚å…¶ä¸­ä¸€ä¸ªè§£å†³çš„åŠæ³•æ˜¯é™åˆ¶èƒ½å¤Ÿç¿»é¡µçš„æ•°é‡ã€‚ ä¼˜åŒ–è¿™ç±»ç´¢å¼•çš„å¦ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç­–ç•¥æ˜¯ä½¿ç”¨å»¶è¿Ÿå…³è”ï¼Œé€šè¿‡ä½¿ç”¨è¦†ç›–ç´¢å¼•è¿”å›éœ€è¦çš„ä¸»å»ºï¼Œå†æ ¹æ®è¿™äº›ä¸»å»ºå›ä¸»è¡¨è·å¾—éœ€è¦çš„è¡Œï¼Œè¿™æ ·å¯ä»¥å‡å°‘mysqlæ‰«æéœ€è¦ä¸¢å¼ƒçš„è¡Œæ•°ã€‚ 12345select * from profiles innner join ( select id fomr profiles p where p.sex = 'm' order by rating limit 1000000, 10) as t using (id); ç¬¬å…­ç«  æ…¢æŸ¥è¯¢ä¼˜åŒ–ä¼˜åŒ–æ•°æ®è®¿é—®æŸ¥è¯¢æ€§èƒ½ä½ä¸‹æœ€åŸºæœ¬çš„åŸå› æ˜¯è®¿é—®æ•°æ®å¤ªå¤šã€‚æŸäº›æŸ¥è¯¢å¯èƒ½ä¸å¯é¿å…çš„éœ€è¦ç­›é€‰å¤§é‡æ•°æ®ï¼Œå•è¿™å¹¶ä¸å¸¸è§ã€‚å¤§éƒ¨åˆ†æ€§èƒ½ä½ä¸‹çš„æŸ¥è¯¢éƒ½å¯ä»¥é€šè¿‡å‡å°‘è®¿é—®çš„æ•°æ®é‡çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºä½æ•ˆçš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬å‘ç°é€šè¿‡ä¸‹é¢å‡ ä¸ªæ­¥éª¤æ¥åˆ†ææ€»æ˜¯å¾ˆæœ‰æ•ˆï¼š ç¡®è®¤åº”ç”¨ç¨‹åºæ—¶å€™æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®ã€‚ ç¡®è®¤mysqlæœåŠ¡å±‚æ˜¯å¦åœ¨åˆ†è®¸å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œã€‚ ç¬¬ä¸€ç§æƒ…å†µå¯ä»¥ä½¿ç”¨limitå’Œé€‰æ‹©éœ€è¦çš„åˆ—æ¥è§£å†³ã€‚åœ¨ç¡®å®šæŸ¥è¯¢åªè¿”å›éœ€è¦çš„æ•°æ®ä¹‹åï¼Œæ¥ä¸‹æ¥åº”è¯¥çœ‹çœ‹æŸ¥è¯¢ä¸ºäº†è¿”å›ç»“æœæ˜¯å¦æ‰«æäº†è¿‡å¤šçš„æ•°æ®ï¼Œå¯¹äºmysqlæœ‰ä¸‰ä¸ªè¡¡é‡æŸ¥è¯¢å¼€é”€çš„æŒ‡æ ‡ï¼š å“åº”æ—¶é—´ æ‰«æçš„è¡Œæ•° è¿”å›çš„è¡Œæ•° æ²¡æœ‰é‚£ä¸ªæŒ‡æ ‡èƒ½å®Œç¾åœ°è¡¡é‡æŸ¥è¯¢çš„å¼€é”€ï¼Œä½†å®ƒä»¬å¤§è‡´åæ˜ äº†mysqlå†…éƒ¨æŸ¥è¯¢æ—¶éœ€è¦è®¿é—®å¤šå°‘æ•°æ®ï¼Œå¹¶å¯ä»¥å¤§æ¦‚æ¨ç®—å‡ºæŸ¥è¯¢è¿è¡Œçš„æ—¶é—´ã€‚ åœ¨è¯„ä¼°æŸ¥è¯¢å¼€é”€çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸‹ä»è¡¨ä¸­æ‰¾åˆ°æŸä¸€è¡Œæ•°æ®çš„æˆæœ¬ã€‚mysqlæœ‰å¥½å‡ ç§è®¿é—®æ–¹å¼å¯ä»¥æŸ¥æ‰¾å¹¶è¿”å›ä¸€è¡Œç»“æœã€‚æœ‰äº›è®¿é—®æ–¹å¼å¯èƒ½éœ€è¦æ‰«æå¾ˆå¤šè¡Œæ‰èƒ½è¿”å›ä¸€è¡Œç»“æœï¼Œä¹Ÿæœ‰äº›è®¿é—®æ–¹å¼å¯èƒ½æ— éœ€æ‰«æå°±èƒ½è¿”å›ç»“æœã€‚ åœ¨explainè¯­å¥ä¸­çš„typeåˆ—ååº”äº†è®¿é—®ç±»å‹ã€‚è®¿é—®ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œä»å…¨è¡¨æ‰«æåˆ°ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æã€å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€å¸¸æ•°å¼•ç”¨ç­‰ã€‚è¿™é‡Œåˆ—çš„è¿™äº›ï¼Œé€Ÿåº¦æ˜¯ä»æ…¢åˆ°å¿«ï¼Œæ‰«æè¡Œæ•°ä¹Ÿæ˜¯ä»å¤§åˆ°å°ã€‚å¦‚æœæŸ¥è¯¢æ²¡æœ‰åŠæ³•æ‰¾åˆ°åˆé€‚æ˜¯è®¿é—®ç±»å‹ï¼Œé‚£ä¹ˆè§£å†³çš„æœ€å¥½åŠæ³•é€šå¸¸æ˜¯å¢åŠ ä¸€ä¸ªåˆé€‚çš„ç´¢å¼•ã€‚ ä¸€èˆ¬mysqlèƒ½å¤Ÿä½¿ç”¨å¦‚ä¸‹ä¸‰ç§æ–¹å¼åº”ç”¨whereæ¡ä»¶ï¼Œä»å¥½åˆ°åä¾æ¬¡ä¸ºï¼š ä»ç´¢å¼•ä¸­ä½¿ç”¨whereæ¡ä»¶å—æ¥è¿‡æ»¤ä¸åŒ¹é…çš„è®°å½•ï¼Œè¿™æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®Œæˆçš„ã€‚ ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«ææ¥è¿”å›è®°å½•ï¼ˆextraå‡ºç°using indexï¼‰ï¼Œç›´æ¥ä»ç´¢å¼•ä¸­è¿‡æ»¤ä¸éœ€è¦çš„æ•°æ®å¹¶è¿”å›å‘½ä¸­ç»“æœã€‚è¿™æ˜¯åœ¨mysqlæœåŠ¡å±‚å®Œæˆçš„ï¼Œä½†æ— éœ€å†å›è¡¨æŸ¥è¯¢è®°å½•ã€‚ ä»æ•°æ®è¡¨ä¸­è¿”å›æ•°æ®ï¼Œç„¶åè¿‡æ»¤ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼ˆextraå‡ºç°using whereï¼‰ã€‚è¿™æ˜¯åœ¨mysqlæœåŠ¡å™¨å±‚å®Œæˆï¼Œmysqléœ€è¦ä»æ•°æ®è¡¨ä¸­è¯»å‡ºè®°å½•ç„¶åè¿‡æ»¤ã€‚ å¦‚æœå‘ç°æŸ¥è¯¢éœ€è¦æ‰«æå¤§é‡çš„æ•°æ®ä½†åªè¿”å›å°‘æ•°çš„è¡Œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŠ€å·§å»ä¼˜åŒ–å®ƒï¼š ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ŒæŠŠéœ€è¦ç”¨çš„åˆ—éƒ½æ”¾åˆ°ç´¢å¼•ä¸­ æ”¹å˜åº“è¡¨ç»“æ„ã€‚ä¾‹å¦‚ä½¿ç”¨å•ç‹¬çš„æ±‡æ€»è¡¨ é‡å†™å¤æ‚çš„æŸ¥è¯¢ï¼Œ è®©mysqlä¼˜åŒ–å™¨èƒ½å¤Ÿä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ é‡æ„æŸ¥è¯¢æ–¹å¼-åˆ‡åˆ†æŸ¥è¯¢æœ‰æ—¶å€™å¯¹äºä¸€ä¸ªå¤§æŸ¥è¯¢æˆ‘ä»¬éœ€è¦åˆ†è€Œæ²»ä¹‹ï¼Œå°†å¤§æŸ¥è¯¢åˆ†æˆå°æŸ¥è¯¢ã€‚åˆ é™¤æ—§æ•°æ®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå¦‚æœç”¨ä¸€ä¸ªå¤§çš„è¯­å¥ä¸€æ¬¡æ€§å®Œæˆï¼Œåˆ™å¯èƒ½ä¸€æ¬¡éœ€è¦é”ä½å¾ˆå¤šæ•°æ®ã€å æ»¡æ•´ä¸ªäº‹åŠ¡æ—¥å¿—ã€è€—å°½ç³»ç»Ÿèµ„æºã€é˜»å¡æ¨åˆ°é‡è¦çš„æŸ¥è¯¢ã€‚ é‡æ„æŸ¥è¯¢æ–¹å¼-åˆ†è§£å…³è”æŸ¥è¯¢ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢ï¼š 1234select * from tagjoin tag_post on tag_post.tag_id = tag.idjoin post on tag_post.post_id = post.idwhere tag.tag = 'mysql'; å¯ä»¥åˆ†è§£æˆä¸‹é¢è¿™ä¸ªæŸ¥è¯¢æ¥ä»£æ›¿ï¼š 12345select * from tag where tag = 'mysql';select * from tag_post where tag_id = 1234;select * from post where post.id in (123,456,567); ç”¨åˆ†è§£å…³è”æŸ¥è¯¢çš„æ–¹å¼é‡æ„æŸ¥è¯¢æœ‰å¦‚ä¸‹çš„ä¼˜åŠ¿ï¼š è®©ç¼“å­˜æ•ˆç‡æ›´é«˜ã€‚è®¸å¤šåº”ç”¨ç¨‹åºå¯ä»¥æ–¹ä¾¿åœ°ç¼“å­˜å•è¡¨æŸ¥è¯¢å¯¹åº”çš„ç»“æœå¯¹è±¡ã€‚ å°†æŸ¥è¯¢åˆ†è§£åï¼Œæ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚ åœ¨åº”ç”¨å±‚åšå…³è”ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œé«˜æ‰©å±•ã€‚ æŸ¥è¯¢æœ¬èº«æ•ˆç‡å¯èƒ½æå‡ï¼Œä½¿ç”¨inä»£æ›¿å…³è”æŸ¥è¯¢ï¼Œå¯èƒ½æ¯”éšæœºå…³è”æ›´é«˜æ•ˆã€‚ å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ ç›¸å½“äºåœ¨åº”ç”¨å±‚å®ç°äº†å“ˆå¸Œå…³è” é‡æ„æŸ¥è¯¢æ–¹å¼-ä¼˜åŒ–å…³è”æŸ¥è¯¢ ç¡®ä¿onæˆ–è€…usingå­å¥ä¸Šçš„åˆ—ä¸Šæœ‰ç´¢å¼•ã€‚ ç¡®ä¿ä»»ä½•group byå’Œ order by çš„è¡¨è¾¾å¼ä¸­åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·mysqlæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹","link":"/2020/2020-01-28-%E9%AB%98%E6%80%A7%E8%83%BDMySql%204%E8%87%B36%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€æ¦‚å¿µ","text":"æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„åŠŸèƒ½ å¼‚æ­¥å¤„ç† æµé‡æ§åˆ¶ æ¶ˆæ¯è§£è€¦ é˜Ÿåˆ—å’Œä¸»é¢˜çš„åŒºåˆ«æœ€åˆçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªä¸¥æ ¼æ„ä¹‰ä¸Šçš„é˜Ÿåˆ—ã€‚åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œâ€œé˜Ÿåˆ—ï¼ˆQueueï¼‰â€æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæœ‰å®Œæ•´è€Œä¸¥æ ¼çš„å®šä¹‰ã€‚åœ¨ç»´åŸºç™¾ç§‘ä¸­ï¼Œé˜Ÿåˆ—çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First-In-First-Outï¼‰çš„çº¿æ€§è¡¨ï¼ˆLinear Listï¼‰ã€‚åœ¨å…·ä½“åº”ç”¨ä¸­é€šå¸¸ç”¨é“¾è¡¨æˆ–è€…æ•°ç»„æ¥å®ç°ã€‚é˜Ÿåˆ—åªå…è®¸åœ¨åç«¯ï¼ˆç§°ä¸º rearï¼‰è¿›è¡Œæ’å…¥æ“ä½œï¼Œåœ¨å‰ç«¯ï¼ˆç§°ä¸º frontï¼‰è¿›è¡Œåˆ é™¤æ“ä½œã€‚ æ—©æœŸçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æ˜¯æŒ‰ç…§â€œé˜Ÿåˆ—â€çš„æ•°æ®ç»“æ„æ¥è®¾è®¡çš„ã€‚æˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹è¿™ä¸ªå›¾ï¼Œç”Ÿäº§è€…ï¼ˆProducerï¼‰å‘æ¶ˆæ¯å°±æ˜¯å…¥é˜Ÿæ“ä½œï¼Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰æ”¶æ¶ˆæ¯å°±æ˜¯å‡ºé˜Ÿä¹Ÿå°±æ˜¯åˆ é™¤æ“ä½œï¼ŒæœåŠ¡ç«¯å­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨è‡ªç„¶å°±ç§°ä¸ºâ€œé˜Ÿåˆ—â€ã€‚ è¿™å°±æ˜¯æœ€åˆçš„ä¸€ç§æ¶ˆæ¯æ¨¡å‹ï¼šé˜Ÿåˆ—æ¨¡å‹ã€‚ å¦‚æœéœ€è¦å°†ä¸€ä»½æ¶ˆæ¯æ•°æ®åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œè¦æ±‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°å…¨é‡çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼Œå¯¹äºä¸€ä»½è®¢å•æ•°æ®ï¼Œé£æ§ç³»ç»Ÿã€åˆ†æç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿç­‰éƒ½éœ€è¦æ¥æ”¶æ¶ˆæ¯ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå•ä¸ªé˜Ÿåˆ—å°±æ»¡è¶³ä¸äº†éœ€æ±‚ï¼Œä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹å¼æ˜¯ï¼Œä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œè®©ç”Ÿäº§è€…å‘é€å¤šä»½ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¼”åŒ–å‡ºäº†å¦å¤–ä¸€ç§æ¶ˆæ¯æ¨¡å‹ï¼šâ€œå‘å¸ƒ - è®¢é˜…æ¨¡å‹ï¼ˆPublish-Subscribe Patternï¼‰â€ã€‚ åœ¨å‘å¸ƒ - è®¢é˜…æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹ç§°ä¸ºå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œæ¶ˆæ¯çš„æ¥æ”¶æ–¹ç§°ä¸ºè®¢é˜…è€…ï¼ˆSubscriberï¼‰ï¼ŒæœåŠ¡ç«¯å­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ç§°ä¸ºä¸»é¢˜ï¼ˆTopicï¼‰ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹å‰éœ€è¦å…ˆâ€œè®¢é˜…ä¸»é¢˜â€ã€‚â€œè®¢é˜…â€åœ¨è¿™é‡Œæ—¢æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¤ä¸ºæ˜¯ä¸»é¢˜åœ¨æ¶ˆè´¹æ—¶çš„ä¸€ä¸ªé€»è¾‘å‰¯æœ¬ï¼Œæ¯ä»½è®¢é˜…ä¸­ï¼Œè®¢é˜…è€…éƒ½å¯ä»¥æ¥æ”¶åˆ°ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ã€‚ ä¿éšœæ¶ˆæ¯é˜Ÿåˆ—ä¸ä¸¢å¤±å…¶å®ï¼Œç°åœ¨ä¸»æµçš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“éƒ½æä¾›äº†éå¸¸å®Œå–„çš„æ¶ˆæ¯å¯é æ€§ä¿è¯æœºåˆ¶ï¼Œå®Œå…¨å¯ä»¥åšåˆ°åœ¨æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å‘ç”Ÿç½‘ç»œä¸­æ–­æˆ–è€…ç¡¬ä»¶æ•…éšœï¼Œä¹Ÿèƒ½ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Œä¸ä¸¢æ¶ˆæ¯ã€‚ ç»å¤§éƒ¨åˆ†ä¸¢æ¶ˆæ¯çš„åŸå› éƒ½æ˜¯ç”±äºå¼€å‘è€…ä¸ç†Ÿæ‚‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ²¡æœ‰æ­£ç¡®ä½¿ç”¨å’Œé…ç½®æ¶ˆæ¯é˜Ÿåˆ—å¯¼è‡´çš„ã€‚è™½ç„¶ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„ API ä¸ä¸€æ ·ï¼Œç›¸å…³çš„é…ç½®é¡¹ä¹Ÿä¸åŒï¼Œä½†æ˜¯åœ¨ä¿è¯æ¶ˆæ¯å¯é ä¼ é€’è¿™å—å„¿ï¼Œå®ƒä»¬çš„å®ç°åŸç†æ˜¯ä¸€æ ·çš„ã€‚ æ£€æµ‹æ¶ˆæ¯ä¸¢å¤±çš„æ–¹æ³• åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªç³»ç»Ÿ æ ¹æ®ç”Ÿäº§è€…æ ‡ç¤º+åˆ†åŒºå·+é€’å¢æ¶ˆæ¯å·åˆ¤æ–­ ç”Ÿäº§è€…ä¿å­˜éœ€è¦æ ¸å¯¹æ˜¯å¦ä¸¢å¤±çš„æ•°æ®ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹å®Œä¹‹åéœ€è¦ä¸ç”Ÿäº§è€…æ ¸å¯¹æ•°æ® åƒ Kafka å’Œ RocketMQ è¿™æ ·çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸ä¿è¯åœ¨ Topic ä¸Šçš„ä¸¥æ ¼é¡ºåºçš„ï¼Œåªèƒ½ä¿è¯åˆ†åŒºä¸Šçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å‘æ¶ˆæ¯çš„æ—¶å€™å¿…é¡»è¦æŒ‡å®šåˆ†åŒºï¼Œå¹¶ä¸”ï¼Œåœ¨æ¯ä¸ªåˆ†åŒºå•ç‹¬æ£€æµ‹æ¶ˆæ¯åºå·çš„è¿ç»­æ€§ã€‚ å¦‚æœä½ çš„ç³»ç»Ÿä¸­ Producer æ˜¯å¤šå®ä¾‹çš„ï¼Œç”±äºå¹¶ä¸å¥½åè°ƒå¤šä¸ª Producer ä¹‹é—´çš„å‘é€é¡ºåºï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æ¯ä¸ª Producer åˆ†åˆ«ç”Ÿæˆå„è‡ªçš„æ¶ˆæ¯åºå·ï¼Œå¹¶ä¸”éœ€è¦é™„åŠ ä¸Š Producer çš„æ ‡è¯†ï¼Œåœ¨ Consumer ç«¯æŒ‰ç…§æ¯ä¸ª Producer åˆ†åˆ«æ¥æ£€æµ‹åºå·çš„è¿ç»­æ€§ã€‚ Consumer å®ä¾‹çš„æ•°é‡æœ€å¥½å’Œåˆ†åŒºæ•°é‡ä¸€è‡´ï¼Œåšåˆ° Consumer å’Œåˆ†åŒºä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒæ–¹ä¾¿åœ°åœ¨ Consumer å†…æ£€æµ‹æ¶ˆæ¯åºå·çš„è¿ç»­æ€§ã€‚ å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ä¸€æ¡æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥åˆ’åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š ç”Ÿäº§é˜¶æ®µ åœ¨ç”Ÿäº§é˜¶æ®µï¼Œæ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡æœ€å¸¸ç”¨çš„è¯·æ±‚ç¡®è®¤æœºåˆ¶ï¼Œæ¥ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼šå½“ä½ çš„ä»£ç è°ƒç”¨å‘æ¶ˆæ¯æ–¹æ³•æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®¢æˆ·ç«¯ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªç¡®è®¤å“åº”ï¼Œè¡¨æ˜æ¶ˆæ¯å·²ç»æ”¶åˆ°äº†ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œå®Œæˆäº†ä¸€æ¬¡æ­£å¸¸æ¶ˆæ¯çš„å‘é€ã€‚ åªè¦ Producer æ”¶åˆ°äº† Broker çš„ç¡®è®¤å“åº”ï¼Œå°±å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨ç”Ÿäº§é˜¶æ®µä¸ä¼šä¸¢å¤±ã€‚æœ‰äº›æ¶ˆæ¯é˜Ÿåˆ—åœ¨é•¿æ—¶é—´æ²¡æ”¶åˆ°å‘é€ç¡®è®¤å“åº”åï¼Œä¼šè‡ªåŠ¨é‡è¯•ï¼Œå¦‚æœé‡è¯•å†å¤±è´¥ï¼Œå°±ä¼šä»¥è¿”å›å€¼æˆ–è€…å¼‚å¸¸çš„æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·ã€‚ ä½ åœ¨ç¼–å†™å‘é€æ¶ˆæ¯ä»£ç æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼Œæ­£ç¡®å¤„ç†è¿”å›å€¼æˆ–è€…æ•è·å¼‚å¸¸ï¼Œå°±å¯ä»¥ä¿è¯è¿™ä¸ªé˜¶æ®µçš„æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚ å­˜å‚¨é˜¶æ®µ åœ¨å­˜å‚¨é˜¶æ®µæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ Broker åœ¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šå‡ºç°ä¸¢å¤±æ¶ˆæ¯çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ Broker å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚è¿›ç¨‹æ­»æ‰äº†æˆ–è€…æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯çš„ã€‚ å¦‚æœå¯¹æ¶ˆæ¯çš„å¯é æ€§è¦æ±‚éå¸¸é«˜ï¼Œå¯ä»¥é€šè¿‡é…ç½® Broker å‚æ•°æ¥é¿å…å› ä¸ºå®•æœºä¸¢æ¶ˆæ¯ã€‚ å¯¹äºå•ä¸ªèŠ‚ç‚¹çš„ Brokerï¼Œéœ€è¦é…ç½® Broker å‚æ•°ï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯å†™å…¥ç£ç›˜åå†ç»™ Producer è¿”å›ç¡®è®¤å“åº”ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿå®•æœºï¼Œç”±äºæ¶ˆæ¯å·²ç»è¢«å†™å…¥ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œæ¢å¤åè¿˜å¯ä»¥ç»§ç»­æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ RocketMQ ä¸­ï¼Œéœ€è¦å°†åˆ·ç›˜æ–¹å¼ flushDiskType é…ç½®ä¸º SYNC_FLUSH åŒæ­¥åˆ·ç›˜ã€‚ å¦‚æœæ˜¯ Broker æ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œéœ€è¦å°† Broker é›†ç¾¤é…ç½®æˆï¼šè‡³å°‘å°†æ¶ˆæ¯å‘é€åˆ° 2 ä¸ªä»¥ä¸Šçš„èŠ‚ç‚¹ï¼Œå†ç»™å®¢æˆ·ç«¯å›å¤å‘é€ç¡®è®¤å“åº”ã€‚è¿™æ ·å½“æŸä¸ª Broker å®•æœºæ—¶ï¼Œå…¶ä»–çš„ Broker å¯ä»¥æ›¿ä»£å®•æœºçš„ Brokerï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±ã€‚ æ¶ˆè´¹é˜¶æ®µ æ¶ˆè´¹é˜¶æ®µé‡‡ç”¨å’Œç”Ÿäº§é˜¶æ®µç±»ä¼¼çš„ç¡®è®¤æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Œå®¢æˆ·ç«¯ä» Broker æ‹‰å–æ¶ˆæ¯åï¼Œæ‰§è¡Œç”¨æˆ·çš„æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸåï¼Œæ‰ä¼šç»™ Broker å‘é€æ¶ˆè´¹ç¡®è®¤å“åº”ã€‚å¦‚æœ Broker æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹ç¡®è®¤å“åº”ï¼Œä¸‹æ¬¡æ‹‰æ¶ˆæ¯çš„æ—¶å€™è¿˜ä¼šè¿”å›åŒä¸€æ¡æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šå› ä¸ºå®¢æˆ·ç«¯åœ¨æ‰§è¡Œæ¶ˆè´¹é€»è¾‘ä¸­å‡ºé”™å¯¼è‡´ä¸¢å¤±ã€‚ ä½ åœ¨ç¼–å†™æ¶ˆè´¹ä»£ç æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦åœ¨æ”¶åˆ°æ¶ˆæ¯åå°±ç«‹å³å‘é€æ¶ˆè´¹ç¡®è®¤ï¼Œè€Œæ˜¯åº”è¯¥åœ¨æ‰§è¡Œå®Œæ‰€æœ‰æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå†å‘é€æ¶ˆè´¹ç¡®è®¤ã€‚ å¯¹äºkafkaçš„ç›¸å…³ä½¿ç”¨å¯ä»¥å‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€æ¶ˆæ¯é˜Ÿåˆ—(ä¸€)-å¦‚ä½•è§£å†³æ¶ˆæ¯ä¸¢å¤±ã€‘ è§£å†³æ¶ˆæ¯é‡å¤é—®é¢˜æ¶ˆæ¯é‡å¤çš„æƒ…å†µå¿…ç„¶å­˜åœ¨åœ¨ MQTT åè®®ä¸­ï¼Œç»™å‡ºäº†ä¸‰ç§ä¼ é€’æ¶ˆæ¯æ—¶èƒ½å¤Ÿæä¾›çš„æœåŠ¡è´¨é‡æ ‡å‡†ï¼Œè¿™ä¸‰ç§æœåŠ¡è´¨é‡ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼š At most once: è‡³å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œæœ€å¤šä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚æ¢ä¸€ä¸ªè¯´æ³•å°±æ˜¯ï¼Œæ²¡ä»€ä¹ˆæ¶ˆæ¯å¯é æ€§ä¿è¯ï¼Œå…è®¸ä¸¢æ¶ˆæ¯ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸å¤ªé«˜çš„ç›‘æ§åœºæ™¯ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿä¸ŠæŠ¥ä¸€æ¬¡æœºæˆ¿æ¸©åº¦æ•°æ®ï¼Œå¯ä»¥æ¥å—æ•°æ®å°‘é‡ä¸¢å¤±ã€‚ At least once: è‡³å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œè‡³å°‘ä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸ä¸¢æ¶ˆæ¯ï¼Œä½†æ˜¯å…è®¸æœ‰å°‘é‡é‡å¤æ¶ˆæ¯å‡ºç°ã€‚ Exactly onceï¼šæ°å¥½ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œåªä¼šè¢«é€è¾¾ä¸€æ¬¡ï¼Œä¸å…è®¸ä¸¢å¤±ä¹Ÿä¸å…è®¸é‡å¤ï¼Œè¿™ä¸ªæ˜¯æœ€é«˜çš„ç­‰çº§ã€‚ è¿™ä¸ªæœåŠ¡è´¨é‡æ ‡å‡†ä¸ä»…é€‚ç”¨äº MQTTï¼Œå¯¹æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯é€‚ç”¨çš„ã€‚æˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„ç»å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„æœåŠ¡è´¨é‡éƒ½æ˜¯ At least onceï¼ŒåŒ…æ‹¬ RocketMQã€RabbitMQ å’Œ Kafka éƒ½æ˜¯è¿™æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¾ˆéš¾ä¿è¯æ¶ˆæ¯ä¸é‡å¤ã€‚ åˆ©ç”¨å¹‚ç­‰æ€§è§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜ åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰ ä¸å…‰æ˜¯å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œåªè¦æ˜¯æ”¯æŒç±»ä¼¼â€œINSERT IF NOT EXISTâ€è¯­ä¹‰çš„å­˜å‚¨ç±»ç³»ç»Ÿéƒ½å¯ä»¥ç”¨äºå®ç°å¹‚ç­‰ï¼Œæ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨ Redis çš„ SETNX å‘½ä»¤æ¥æ›¿ä»£æ•°æ®åº“ä¸­çš„å”¯ä¸€çº¦æŸï¼Œæ¥å®ç°å¹‚ç­‰æ¶ˆè´¹ã€‚ ä¸ºæ›´æ–°çš„æ•°æ®è®¾ç½®å‰ç½®æ¡ä»¶ å¦å¤–ä¸€ç§å®ç°å¹‚ç­‰çš„æ€è·¯æ˜¯ï¼Œç»™æ•°æ®å˜æ›´è®¾ç½®ä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶å°±æ›´æ–°æ•°æ®ï¼Œå¦åˆ™æ‹’ç»æ›´æ–°æ•°æ®ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ—¶å˜æ›´å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ã€‚è¿™æ ·ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œç”±äºç¬¬ä¸€æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™å·²ç»å˜æ›´äº†å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ï¼Œä¸æ»¡è¶³å‰ç½®æ¡ä»¶ï¼Œåˆ™ä¸ä¼šé‡å¤æ‰§è¡Œæ›´æ–°æ•°æ®æ“ä½œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦æ›´æ–°çš„æ•°æ®ä¸æ˜¯æ•°å€¼ï¼Œæˆ–è€…æˆ‘ä»¬è¦åšä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ›´æ–°æ“ä½œæ€ä¹ˆåŠï¼Ÿç”¨ä»€ä¹ˆä½œä¸ºå‰ç½®åˆ¤æ–­æ¡ä»¶å‘¢ï¼Ÿæ›´åŠ é€šç”¨çš„æ–¹æ³•æ˜¯ï¼Œç»™ä½ çš„æ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·å±æ€§ï¼Œæ¯æ¬¡æ›´æ•°æ®å‰ï¼Œæ¯”è¾ƒå½“å‰æ•°æ®çš„ç‰ˆæœ¬å·æ˜¯å¦å’Œæ¶ˆæ¯ä¸­çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±æ‹’ç»æ›´æ–°æ•°æ®ï¼Œæ›´æ–°æ•°æ®çš„åŒæ—¶å°†ç‰ˆæœ¬å· +1ï¼Œä¸€æ ·å¯ä»¥å®ç°å¹‚ç­‰æ›´æ–°ã€‚ è®°å½•å¹¶æ£€æŸ¥æ“ä½œ å¦‚æœä¸Šé¢æåˆ°çš„ä¸¤ç§å®ç°å¹‚ç­‰æ–¹æ³•éƒ½ä¸èƒ½é€‚ç”¨äºä½ çš„åœºæ™¯ï¼Œè¿˜æœ‰ä¸€ç§é€šç”¨æ€§æœ€å¼ºï¼Œé€‚ç”¨èŒƒå›´æœ€å¹¿çš„å®ç°å¹‚ç­‰æ€§æ–¹æ³•ï¼šè®°å½•å¹¶æ£€æŸ¥æ“ä½œï¼Œä¹Ÿç§°ä¸ºâ€œToken æœºåˆ¶æˆ–è€… GUIDï¼ˆå…¨å±€å”¯ä¸€ IDï¼‰æœºåˆ¶â€ï¼Œå®ç°çš„æ€è·¯ç‰¹åˆ«ç®€å•ï¼šåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æ‰§è¡Œè¿‡è¿™ä¸ªæ›´æ–°æ“ä½œã€‚ å…·ä½“çš„å®ç°æ–¹æ³•æ˜¯ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¯æ¡æ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œæ¶ˆè´¹æ—¶ï¼Œå…ˆæ ¹æ®è¿™ä¸ª ID æ£€æŸ¥è¿™æ¡æ¶ˆæ¯æ˜¯å¦æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œæ‰æ›´æ–°æ•°æ®ï¼Œç„¶åå°†æ¶ˆè´¹çŠ¶æ€ç½®ä¸ºå·²æ¶ˆè´¹ã€‚ åŸç†å’Œå®ç°æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå…¶å®ä¸€ç‚¹å„¿éƒ½ä¸ç®€å•ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯éå¸¸éš¾å®ç°çš„ï¼Œåœ¨â€œæ£€æŸ¥æ¶ˆè´¹çŠ¶æ€ï¼Œç„¶åæ›´æ–°æ•°æ®å¹¶ä¸”è®¾ç½®æ¶ˆè´¹çŠ¶æ€â€ä¸­ï¼Œä¸‰ä¸ªæ“ä½œå¿…é¡»ä½œä¸ºä¸€ç»„æ“ä½œä¿è¯åŸå­æ€§ï¼Œæ‰èƒ½çœŸæ­£å®ç°å¹‚ç­‰ï¼Œå¦åˆ™å°±ä¼šå‡ºç° Bugã€‚ å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ç”¨äº‹åŠ¡æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é”æ¥å®ç°ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ— è®ºæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¿˜æ˜¯åˆ†å¸ƒå¼é”éƒ½æ˜¯æ¯”è¾ƒéš¾è§£å†³é—®é¢˜ã€‚ å¯¹äºkafkaçš„ç›¸å…³ä½¿ç”¨å¯ä»¥å‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€æ¶ˆæ¯é˜Ÿåˆ—(äºŒ)-æ¶ˆæ¯å¹‚ç­‰ã€‘ å¤„ç†æ¶ˆæ¯ç§¯å‹ä¼˜åŒ–æ¶ˆæ¯æ”¶å‘æ€§èƒ½ï¼Œé¢„é˜²æ¶ˆæ¯ç§¯å‹çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œå¢åŠ æ‰¹é‡æˆ–è€…æ˜¯å¢åŠ å¹¶å‘ï¼Œåœ¨å‘é€ç«¯è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ï¼Œåœ¨æ¶ˆè´¹ç«¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¢åŠ å¹¶å‘éœ€è¦åŒæ­¥æ‰©å®¹åˆ†åŒºæ•°é‡ï¼Œå¦åˆ™æ˜¯èµ·ä¸åˆ°æ•ˆæœçš„ã€‚ å¯¹äºç³»ç»Ÿå‘ç”Ÿæ¶ˆæ¯ç§¯å‹çš„æƒ…å†µï¼Œéœ€è¦å…ˆè§£å†³ç§¯å‹ï¼Œå†åˆ†æåŸå› ï¼Œæ¯•ç«Ÿä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§æ˜¯é¦–å…ˆè¦è§£å†³çš„é—®é¢˜ã€‚å¿«é€Ÿè§£å†³ç§¯å‹çš„æ–¹æ³•å°±æ˜¯é€šè¿‡æ°´å¹³æ‰©å®¹å¢åŠ  Consumer çš„å®ä¾‹æ•°é‡ã€‚","link":"/2020/2020-04-02-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"},{"title":"LeetCodeäºŒå‰æ ‘åŸºç¡€ç®—æ³•","text":"æ ‘çš„é«˜åº¦104. Maximum Depth of Binary Tree (Easy) é€’å½’è®¡ç®—äºŒå‰æ ‘å·¦å³ä¸¤è¾¹æ·±åº¦ï¼Œå–æœ€å¤§å€¼ã€‚ 12345678910111213141516171819/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int maxDepth(TreeNode root) { if (root == null) return 0; int left = maxDepth(root.left); int right = maxDepth(root.right); return Math.max(left, right) + 1; }} å¹³è¡¡æ ‘110. Balanced Binary Tree (Easy) é€’å½’éå†äºŒå‰æ ‘å·¦å³å­æ ‘æ·±åº¦ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private boolean balance = true; public boolean isBalanced(TreeNode root) { visitTree(root); return balance; } private int visitTree(TreeNode root) { if (root == null) return 0; int left = visitTree(root.left); int right = visitTree(root.right); if (Math.abs(left - right) &gt; 1 ) this.balance = false; return Math.max(left, right) + 1; }} ä¸¤èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„543. Diameter of Binary Tree (Easy) é€’å½’éå†äºŒå‰æ ‘å·¦å³å­æ ‘æ·±åº¦ï¼Œ è·¯å¾„å°±æ˜¯ä¸¤è¾¹å­æ ‘æ·±åº¦ä¹‹å’Œ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int max; public int diameterOfBinaryTree(TreeNode root) { deep(root); return max; } private int deep(TreeNode root) { if (root == null) return 0; int left = deep(root.left); int right = deep(root.right); max = Math.max(max,left+right); return Math.max(left, right) + 1; }} ç¿»è½¬æ ‘226. Invert Binary Tree (Easy) é€’å½’äº¤æ¢å·¦å³å­æ ‘çš„å¼•ç”¨ 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode invertTree(TreeNode root) { if (root == null) return root; TreeNode right =root.right; root.right = invertTree(root.left); root.left = invertTree(right); return root; }} å½’å¹¶ä¸¤æ£µæ ‘617. Merge Two Binary Trees (Easy) é€’å½’æ—¶å¦‚æœå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç©ºï¼Œå¯ä»¥ç›´æ¥å¤ç”¨è¯¥èŠ‚ç‚¹ã€‚å¦‚æœæ–°å»ºèŠ‚ç‚¹ï¼Œéœ€è¦æ‹·è´èŠ‚ç‚¹çš„å·¦å³å­æ ‘å¼•ç”¨ï¼Œé€’å½’æ—¶ä¼šç”¨åˆ°ã€‚ 1234567891011121314151617181920/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public TreeNode mergeTrees(TreeNode t1, TreeNode t2) { if (t1 == null &amp;&amp; t2 == null ) return null; if (t1 == null) return t2; if (t2 == null) return t1; TreeNode root = new TreeNode(t1.val + t2.val); root.left = mergeTrees(t1.left, t2.left); root.right = mergeTrees(t1.right, t2.right); return root; }} åˆ¤æ–­è·¯å¾„å’Œæ˜¯å¦ç­‰äºä¸€ä¸ªæ•°Leetcode : 112. Path Sum (Easy) é€’å½’æŸ¥è¯¢å­æ ‘å’Œæ˜¯å¦ç­‰äºç›®æ ‡å’Œ 12345678910111213141516/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean hasPathSum(TreeNode root, int sum) { if (root == null) return false; if (root.val == sum &amp;&amp; root.left == null &amp;&amp; root.right == null) return true; return hasPathSum(root.left, sum - root.val) || hasPathSum(root.right, sum - root.val); }} ç»Ÿè®¡è·¯å¾„å’Œç­‰äºä¸€ä¸ªæ•°çš„è·¯å¾„æ•°é‡437. Path Sum III (Easy) åŒå±‚é€’å½’ ä»¥å½“å‰èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ å½“å‰èŠ‚ç‚¹ä»¥ä¸‹èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ ä»¥rootä¸ºæ ¹èŠ‚ç‚¹çš„è·¯å¾„æ•°é‡= ä»¥rootä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ+rootå·¦èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ+rootå³èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»Ÿè®¡è·¯å¾„å’Œ 123456789101112131415161718192021222324/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int pathSum(TreeNode root, int sum) { if (root == null) return 0; //ç»“æœæ•° ç­‰äº ä»¥å½“å‰rootä¸ºçˆ¶èŠ‚ç‚¹å’Œ rootä»¥ä¸‹ä¸ºçˆ¶èŠ‚ç‚¹ç»“æœæ•°ä¹‹å’Œ return sum(root, sum) + pathSum(root.left, sum) + pathSum(root.right, sum); } // è®¡ç®—ä»¥å½“å‰nodeä¸ºçˆ¶èŠ‚ç‚¹èƒ½éƒ½å¤šå°‘è·¯å¾„æ•° private int sum(TreeNode node, int sum) { if (node == null) return 0; int count = 0; if (node.val == sum) count++; count += sum(node.left, sum - node.val) + sum(node.right, sum - node.val); return count; }} å­æ ‘572. Subtree of Another Tree (Easy) 12345678910111213141516171819202122/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean isSubtree(TreeNode s, TreeNode t) { if (s == null) return false; return isSubRoot(s, t) || isSubtree(s.left, t) || isSubtree(s.right, t); } public boolean isSubRoot(TreeNode node, TreeNode t) { if (node == null &amp;&amp; t == null) return true; if (node == null || t == null) return false; if (node.val != t.val) return false; return isSubRoot(node.left, t.left) &amp;&amp; isSubRoot(node.right, t.right); }} æ ‘çš„å¯¹ç§°101. Symmetric Tree (Easy) 12345678910111213141516171819202122/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public boolean isSymmetric(TreeNode root) { if (root == null) return true; return isSymmetric(root.left, root.right); } public boolean isSymmetric(TreeNode left, TreeNode right) { if (left == null &amp;&amp; right == null) return true; if (left == null || right == null) return false; if (left.val != right.val) return false; return isSymmetric(left.left, right.right) &amp;&amp; isSymmetric(left.right, right.left); }} æœ€å°è·¯å¾„111. Minimum Depth of Binary Tree (Easy) å’Œæœ€å¤§è·¯å¾„ç±»ä¼¼ 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int minDepth(TreeNode root) { if (root == null) return 0; int left = minDepth(root.left); int right = minDepth(root.right); if (left == 0 || right == 0) return left + right + 1; return Math.min(left, right) + 1; }} ç»Ÿè®¡å·¦å¶å­èŠ‚ç‚¹çš„å’Œ404. Sum of Left Leaves (Easy) 123456789101112131415161718/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int sumOfLeftLeaves(TreeNode root) { if (root == null) return 0; if (root.left != null &amp;&amp; root.left.left == null &amp;&amp; root.left.right == null) return root.left.val + sumOfLeftLeaves(root.right); return sumOfLeftLeaves(root.left) + sumOfLeftLeaves(root.right); }}` ç›¸åŒèŠ‚ç‚¹å€¼çš„æœ€å¤§è·¯å¾„é•¿åº¦687. Longest Univalue Path (Easy) é€’å½’æŸ¥æ‰¾å·¦å³å­æ ‘ç›¸åŒèŠ‚ç‚¹å€¼æœ€å¤§è·¯å¾„ï¼Œæœ€å¤§è·¯å¾„çš„è®¡ç®—ï¼šå¦‚æœç›¸ç­‰è·¯å¾„+1ï¼Œå¦‚æœä¸ç›¸ç­‰ç½®ä¸º0ã€‚ 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int path = 0; public int longestUnivaluePath(TreeNode root) { visit(root); return path; } private int visit(TreeNode root) { if (root == null) return 0; int left = visit(root.left); int right = visit(root.right); left = (root.left != null &amp;&amp; root.val == root.left.val) ? left + 1 : 0; right = (root.right != null &amp;&amp; root.val == root.right.val)? right + 1 : 0; path = Math.max(path, left+right); return Math.max(left, right ); }} é—´éš”éå†337. House Robber III (Medium) é€’å½’æŸ¥è¯¢ä¸¤ç§æƒ…å†µ å¦‚æœä»å½“å‰èŠ‚ç‚¹å¼€å§‹ ä»å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¼€å§‹ 1234567891011121314151617181920/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int rob(TreeNode root) { if (root == null) return 0; int val1 = root.val, val2 = 0; if (root.left != null) val1+= rob(root.left.left) + rob(root.left.right); if (root.right != null) val1+= rob(root.right.left) + rob(root.right.right); val2 = rob(root.left) + rob(root.right); return Math.max(val1, val2); }} æ‰¾å‡ºäºŒå‰æ ‘ä¸­ç¬¬äºŒå°çš„èŠ‚ç‚¹Second Minimum Node In a Binary Tree (Easy) ç¬¬äºŒå°èŠ‚ç‚¹åœ¨å­æ ‘èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœå­æ ‘å€¼ä¸æ ¹èŠ‚ç‚¹ç›¸ç­‰ï¼Œç»§ç»­å‘ä¸‹æŸ¥æ‰¾ 123456789101112131415161718192021/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public int findSecondMinimumValue(TreeNode root) { if (root == null) return -1; if (root.left == null) return -1; int left = root.left.val, right = root.right.val; if (root.val == root.left.val) left = findSecondMinimumValue(root.left); if (root.val == root.right.val) right = findSecondMinimumValue(root.right); if (left != -1 &amp;&amp; right != -1) return Math.min(left, right); if (left &gt; -1) return left; return right; }} äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼637. Average of Levels in Binary Tree (Easy) BFS 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { public List&lt;Double&gt; averageOfLevels(TreeNode root) { List&lt;Double&gt; ret = new ArrayList&lt;&gt;(); if (root == null) return ret; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while(!queue.isEmpty()) { int count = queue.size(); double sum = 0d; for(int i = 0; i &lt; count; i++) { TreeNode node = queue.poll(); sum+= node.val; if (node.left != null) queue.add(node.left); if (node.right != null) queue.add(node.right); } ret.add(sum/count); } return ret; }} æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼513. Find Bottom Left Tree Value (Easy) DFS 123456789101112131415161718192021222324252627282930/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private int val = 0; public int findBottomLeftValue(TreeNode root) { if (root == null) return val; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.add(root); while(!queue.isEmpty()) { // è¿™ä¸€è¡Œçš„æ•°é‡ int count = queue.size(); for (int i = 0; i &lt; count; i++) { TreeNode node = queue.poll(); if(i == 0) val = node.val; if (node.left != null) queue.add(node.left); if (node.right != null) queue.add(node.right); } } return val; }} éé€’å½’å®ç°äºŒå‰æ ‘çš„ååºéå†å…¥æ ˆæ¡ä»¶ï¼š æœªè®¿é—®è¿‡è¯¥èŠ‚ç‚¹å‡ºæ ˆæ¡ä»¶ï¼š è®¿é—®è¿‡è¯¥èŠ‚ç‚¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); private Set&lt;TreeNode&gt; visited = new HashSet&lt;&gt;(); public List&lt;Integer&gt; postorderTraversal(TreeNode root) { if (root == null) return res; stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.peek(); if ((node.left == null &amp;&amp; node.right == null) || visited.contains(node)) { TreeNode i = stack.pop(); res.add(i.val); } else { visited.add(node); if (node.right != null) stack.push(node.right); if (node.left != null) stack.push(node.left); } } return res; } private void visit(TreeNode root) { if(root == null) return; visit(root.left); visit(root.right); res.add(root.val); }} éé€’å½’å®ç°äºŒå‰æ ‘çš„å‰åºéå†å…¥æ ˆæ¡ä»¶ï¼š æ— å‡ºæ ˆæ¡ä»¶ï¼š ç›´æ¥å‡ºæ ˆ 1234567891011121314151617181920212223242526/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); public List&lt;Integer&gt; preorderTraversal(TreeNode root) { if (root == null) return res; stack.push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); res.add(node.val); if (node.right != null) stack.push(node.right); if (node.left != null) stack.push(node.left); } return res; }} éé€’å½’å®ç°äºŒå‰æ ‘çš„ä¸­åºéå†å…¥æ ˆæ¡ä»¶ï¼š æœªè®¿é—®è¿‡è¯¥èŠ‚ç‚¹å‡ºæ ˆæ¡ä»¶ï¼š è®¿é—®è¿‡è¯¥èŠ‚ç‚¹å…¥æ ˆé¡ºåº: right -&gt; middle -&gt; left 12345678910111213141516171819202122232425262728293031323334353637/** * Definition for a binary tree node. * public class TreeNode { * int val; * TreeNode left; * TreeNode right; * TreeNode(int x) { val = x; } * } */class Solution { private List&lt;Integer&gt; res = new LinkedList&lt;&gt;(); private Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); private Set&lt;TreeNode&gt; visited = new HashSet&lt;&gt;(); public List&lt;Integer&gt; inorderTraversal(TreeNode root) { if (root == null) return res; push(root); while (!stack.isEmpty()) { TreeNode node = stack.pop(); if ((node.left == null &amp;&amp; node.right == null) || visited.contains(node)) { res.add(node.val); } else { push(node); } } return res; } private void push(TreeNode root) { if (root == null) return; visited.add(root); if (root.right != null) stack.push(root.right); stack.push(root); if (root.left != null) stack.push(root.left); }}","link":"/2019/2019-06-15-LeetCode%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/"},{"title":"æ’æŸ¥docker oomkilldedé—®é¢˜","text":"å¹´å‰docker oomkilled é—®é¢˜ä¸€ç›´åœ¨å›°æ‰°æˆ‘ä»¬é¡¹ç›®ç»„ï¼Œå¤§è‡´ç°è±¡ä¸ºjavaå †Xmxé…ç½®äº†6Gï¼Œä½†è¿è¡Œä¸€æ®µæ—¶é—´åå¸¸é©»å†…å­˜RSSä»5Gé€æ¸å¢é•¿åˆ°8Gå®¹å™¨é˜ˆå€¼ï¼Œæœ€åæŠ¥å‡ºom killed ä¹‹åé‡å¯ã€‚å› ä¸ºæˆ‘ä»¬ä¸šåŠ¡å¯¹å†…å­˜éœ€æ±‚ä¸æ˜¯å¾ˆè¿«åˆ‡ï¼Œæ‰€ä»¥å ç”¨8Gå†…å­˜æ˜æ˜¾ä¸åˆç†ï¼Œæ‰€ä»¥ä¹‹åæœ‰äº†ä¸€åœºæ¼«é•¿çš„æ’æŸ¥é—®é¢˜ä¹‹æ—…ã€‚ åŸºç¡€ä¸­çš„åŸºç¡€-JVMå†…å­˜æ¨¡å‹å¼€å§‹é€æ­¥å¯¹å †å¤–å†…å­˜è¿›è¡Œæ’æŸ¥ï¼Œé¦–å…ˆäº†è§£ä¸€ä¸‹JVMå†…å­˜æ¨¡å‹ã€‚æ ¹æ®JVMè§„èŒƒï¼ŒJVMè¿è¡Œæ—¶æ•°æ®åŒºå…±åˆ†ä¸ºè™šæ‹Ÿæœºæ ˆã€å †ã€æ–¹æ³•åŒºã€ç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆäº”ä¸ªéƒ¨åˆ†ã€‚ï¿¼ PC å¯„å­˜å™¨ï¼Œä¹Ÿå«ç¨‹åºè®¡æ•°å™¨ã€‚å¯ä»¥çœ‹æˆæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ä¸æ˜¯é‡ç‚¹ã€‚ è™šæ‹Ÿæœºæ ˆï¼Œæè¿°Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜åŒºåŸŸï¼Œå®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ ˆå¸§åœ¨æ•´ä¸ªJVMä½“ç³»ä¸­çš„åœ°ä½é¢‡é«˜,åŒ…æ‹¬å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€ç­‰ã€‚å½“ç”³è¯·ä¸åˆ°ç©ºé—´æ—¶ï¼Œä¼šæŠ›å‡º OutOfMemoryErrorã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼Œå’Œè™šæ‹Ÿæœºæ ˆå®ç°çš„åŠŸèƒ½ä¸æŠ›å‡ºå¼‚å¸¸å‡ ä¹ç›¸åŒã€‚ å †å†…å­˜ã€‚å †å†…å­˜æ˜¯ JVM æ‰€æœ‰çº¿ç¨‹å…±äº«çš„éƒ¨åˆ†ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™å°±å·²ç»åˆ›å»ºã€‚æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„éƒ½åœ¨å †ä¸Šè¿›è¡Œåˆ†é…ã€‚è¿™éƒ¨åˆ†ç©ºé—´å¯é€šè¿‡ GC è¿›è¡Œå›æ”¶ã€‚å½“ç”³è¯·ä¸åˆ°ç©ºé—´æ—¶ä¼šæŠ›å‡º OutOfMemoryErrorã€‚ Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰åœ¨JDK 1.8å¼€å§‹ï¼Œæ–¹æ³•åŒºå®ç°é‡‡ç”¨Metaspaceä»£æ›¿ï¼Œè¿™äº›å…ƒæ•°æ®ä¿¡æ¯ç›´æ¥ä½¿ç”¨æœ¬åœ°å†…å­˜æ¥åˆ†é…ã€‚å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´ä¸å±äºJVMä½¿ç”¨çš„å†…å­˜ï¼Œè€Œæ˜¯ä½¿ç”¨ï¼ˆè¿›ç¨‹ä¸­çš„ï¼‰ç›´æ¥å†…å­˜ã€‚å½“ç”³è¯·ä¸åˆ°ç©ºé—´æ—¶ä¼šæŠ›å‡º OutOfMemoryErrorã€‚ ç›´æ¥å†…å­˜java 8ä¸‹æ˜¯æŒ‡é™¤äº†Xmxè®¾ç½®çš„javaå †å¤–ï¼Œjavaè¿›ç¨‹ä½¿ç”¨çš„å…¶ä»–å†…å­˜ã€‚ä¸»è¦åŒ…æ‹¬ï¼šDirectByteBufferåˆ†é…çš„å†…å­˜ï¼ŒJNIé‡Œåˆ†é…çš„å†…å­˜ï¼Œçº¿ç¨‹æ ˆåˆ†é…å ç”¨çš„ç³»ç»Ÿå†…å­˜ï¼Œjvmæœ¬èº«è¿è¡Œè¿‡ç¨‹åˆ†é…çš„å†…å­˜ï¼ŒcodeCacheï¼Œmetaspaceå…ƒæ•°æ®ç©ºé—´ã€‚ JVMç›‘æ§åˆ†æ å¯ä»¥çœ‹åˆ°é‡å¯å‰å †å†…å­˜ã€æ ˆå†…å­˜ã€å…ƒç©ºé—´ã€ç›´æ¥å†…å­˜å ç”¨ç©ºé—´éƒ½æ²¡æœ‰å¼‚å¸¸ï¼Œå¤šæ•°é—®é¢˜é€šè¿‡ç›‘æ§å°±èƒ½å®šä½å¤§è‡´æ–¹å‘ï¼Œå¯æƒœè¿™æ¬¡ç›‘æ§å¤§æ³•æ²¡æœ‰ç”Ÿæ•ˆï¼Œæ€€ç–‘æ˜¯JVMé—®é¢˜è½¬å‘JVMåŸç”Ÿå†…å­˜ä½¿ç”¨æ–¹å‘æ’æŸ¥ã€‚ ä½¿ç”¨NMTæ’æŸ¥JVMåŸç”Ÿå†…å­˜ä½¿ç”¨Native Memory Trackingï¼ˆNMTï¼‰ä½¿ç”¨NMTæ˜¯Java7U40å¼•å…¥çš„HotSpotæ–°ç‰¹æ€§ï¼Œå¯ç”¨äºç›‘æ§JVMåŸç”Ÿå†…å­˜çš„ä½¿ç”¨ï¼Œä½†æ¯”è¾ƒå¯æƒœçš„æ˜¯ï¼Œç›®å‰çš„NMTä¸èƒ½ç›‘æ§åˆ°JVMä¹‹å¤–æˆ–åŸç”Ÿåº“åˆ†é…çš„å†…å­˜ã€‚javaè¿›ç¨‹å¯åŠ¨æ—¶æŒ‡å®šå¼€å¯NMTï¼ˆæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼‰ï¼Œè¾“å‡ºçº§åˆ«å¯ä»¥è®¾ç½®ä¸ºâ€œsummaryâ€æˆ–â€œdetailâ€çº§åˆ«ã€‚å¦‚ï¼š 12-XX:NativeMemoryTracking=summary æˆ–è€… -XX:NativeMemoryTracking=detail å¼€å¯åï¼Œé€šè¿‡jcmdå¯ä»¥è®¿é—®æ”¶é›†åˆ°çš„æ•°æ®ã€‚ 1jcmd &lt;pid&gt; VM.native_memory [summary | detail | baseline | summary.diff | detail.diff å¦‚ï¼šjcmd 1 VM.native_memoryï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647Native Memory Tracking:Total: reserved=12259645KBï¼ˆä¿ç•™å†…å­˜ï¼‰, committed=11036265KB ï¼ˆæäº¤å†…å­˜ï¼‰å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä¿ç•™å†…å­˜å’Œæäº¤å†…å­˜å’ŒXmsã€Xmxä¸€è‡´ï¼Œéƒ½æ˜¯8Gã€‚- Java Heap (reserved=8388608KB, committed=8388608KB) (mmap: reserved=8388608KB, committed=8388608KB)ç”¨äºå­˜å‚¨ç±»å…ƒæ•°æ®ä¿¡æ¯ä½¿ç”¨åˆ°çš„åŸç”Ÿå†…å­˜ï¼Œæ€»å…±12045ä¸ªç±»ï¼Œæ•´ä½“å®é™…ä½¿ç”¨äº†79Må†…å­˜ã€‚- Class (reserved=1119963KB, committed=79751KB) (classes #12045) (malloc=1755KB #29277) (mmap: reserved=1118208KB, committed=77996KB)æ€»å…±2064ä¸ªçº¿ç¨‹ï¼Œæäº¤å†…å­˜æ˜¯2.1Gå·¦å³ï¼Œä¸€ä¸ªçº¿ç¨‹1Mï¼Œå’Œè®¾ç½®Xss1mç›¸ç¬¦ã€‚- Thread (reserved=2130294KB, committed=2130294KB) (thread #2064) (stack: reserved=2120764KB, committed=2120764KB) (malloc=6824KB #10341) (arena=2706KB #4127)JITçš„ä»£ç ç¼“å­˜ï¼Œ12045ä¸ªç±»JITç¼–è¯‘åä»£ç ç¼“å­˜æ•´ä½“ä½¿ç”¨79Må†…å­˜ã€‚- Code (reserved=263071KB, committed=79903KB) (malloc=13471KB #15191) (mmap: reserved=249600KB, committed=66432KB)GCç›¸å…³ä½¿ç”¨åˆ°çš„ä¸€äº›å †å¤–å†…å­˜ï¼Œæ¯”å¦‚GCç®—æ³•çš„å¤„ç†é”ä¼šä½¿ç”¨ä¸€äº›å †å¤–ç©ºé—´ã€‚118Må·¦å³ã€‚- GC (reserved=118432KB, committed=118432KB) (malloc=93848KB #453) (mmap: reserved=24584KB, committed=24584KB)JAVAç¼–è¯‘å™¨è‡ªèº«æ“ä½œä½¿ç”¨åˆ°çš„ä¸€äº›å †å¤–å†…å­˜ï¼Œå¾ˆå°‘ã€‚- Compiler (reserved=975KB, committed=975KB) (malloc=844KB #1074) (arena=131KB #3)Internalï¼šmemory used by the command line parser, JVMTI, propertiesç­‰ã€‚- Internal (reserved=117158KB, committed=117158KB) (malloc=117126KB #44857) (mmap: reserved=32KB, committed=32KB)Symbolï¼šä¿ç•™å­—ç¬¦ä¸²ï¼ˆInterned Stringï¼‰çš„å¼•ç”¨ä¸ç¬¦å·è¡¨å¼•ç”¨æ”¾åœ¨è¿™é‡Œï¼Œ17Må·¦å³- Symbol (reserved=17133KB, committed=17133KB) (malloc=13354KB #145640) (arena=3780KB #1)NMTæœ¬èº«å ç”¨çš„å †å¤–å†…å­˜ï¼Œ4Må·¦å³- Native Memory Tracking (reserved=4402KB, committed=4402KB) (malloc=396KB #5287) (tracking overhead=4006KB)ä¸çŸ¥é“å•¥ï¼Œç”¨çš„å¾ˆå°‘ã€‚- Arena Chunk (reserved=272KB, committed=272KB) (malloc=272KB)å…¶ä»–æœªåˆ†ç±»çš„å †å¤–å†…å­˜å ç”¨ï¼Œ100Må·¦å³ã€‚- Unknown (reserved=99336KB, committed=99336KB) (mmap: reserved=99336KB, committed=99336KB) ä¿ç•™å†…å­˜ï¼ˆreservedï¼‰ï¼šreserved memory æ˜¯æŒ‡JVM é€šè¿‡mmaped PROT_NONE ç”³è¯·çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œåœ¨é¡µè¡¨ä¸­å·²ç»å­˜åœ¨äº†è®°å½•ï¼ˆentriesï¼‰ï¼Œä¿è¯äº†å…¶ä»–è¿›ç¨‹ä¸ä¼šè¢«å ç”¨ï¼Œä¸”ä¿è¯äº†é€»è¾‘åœ°å€çš„è¿ç»­æ€§ï¼Œèƒ½ç®€åŒ–æŒ‡é’ˆè¿ç®—ã€‚ æäº¤å†…å­˜ï¼ˆcommitedï¼‰ï¼šcommitted memory æ˜¯JVMå‘æ“åšç³»ç»Ÿå®é™…åˆ†é…çš„å†…å­˜ï¼ˆmalloc/mmapï¼‰,mmaped PROT_READ | PROT_WRITE,ä»ç„¶ä¼špage faultsï¼Œä½†æ˜¯è·Ÿ reserved ä¸åŒï¼Œå®Œå…¨å†…æ ¸å¤„ç†åƒä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿä¸€æ ·ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šç”±äºmalloc/mmapçš„lazy allocation and pagingæœºåˆ¶ï¼Œå³ä½¿æ˜¯commitedçš„å†…å­˜ï¼Œä¹Ÿä¸ä¸€å®šä¼šçœŸæ­£åˆ†é…ç‰©ç†å†…å­˜ã€‚ malloc/mmap is lazy unless told otherwise. Pages are only backed by physical memory once theyâ€™re accessed. Tipsï¼šç”±äºå†…å­˜æ˜¯ä¸€ç›´åœ¨ç¼“æ…¢å¢é•¿ï¼Œå› æ­¤åœ¨ä½¿ç”¨NMTè·Ÿè¸ªå †å¤–å†…å­˜æ—¶ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯ï¼Œå…ˆå»ºç«‹ä¸€ä¸ªå†…å­˜ä½¿ç”¨åŸºçº¿ï¼Œä¸€æ®µæ—¶é—´åå†ç”¨å½“æ—¶æ•°æ®å’ŒåŸºçº¿è¿›è¡Œå·®åˆ«æ¯”è¾ƒï¼Œè¿™æ ·æ¯”è¾ƒå®¹æ˜“å®šä½é—®é¢˜ã€‚ 1jcmd 1 VM.native_memory baseline åŒæ—¶pmapçœ‹ä¸€ä¸‹ç‰©ç†å†…å­˜çš„åˆ†é…ï¼ŒRSSå ç”¨äº†10Gã€‚ 1pmap -x 1 | sort -n -k3 ï¿¼ è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œåšä¸€ä¸‹summaryçº§åˆ«çš„diffï¼Œçœ‹ä¸‹å†…å­˜å˜åŒ–ï¼ŒåŒæ—¶å†æ¬¡pmapçœ‹ä¸‹RSSå¢é•¿æƒ…å†µã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748jcmd 1 VM.native_memory summary.diffNative Memory Tracking:Total: reserved=13089769KB +112323KB, committed=11877285KB +117915KB- Java Heap (reserved=8388608KB, committed=8388608KB) (mmap: reserved=8388608KB, committed=8388608KB)- Class (reserved=1126527KB +2161KB, committed=85771KB +2033KB) (classes #12682 +154) (malloc=2175KB +113KB #37289 +2205) (mmap: reserved=1124352KB +2048KB, committed=83596KB +1920KB)- Thread (reserved=2861485KB +94989KB, committed=2861485KB +94989KB) (thread #2772 +92) (stack: reserved=2848588KB +94576KB, committed=2848588KB +94576KB) (malloc=9169KB +305KB #13881 +460) (arena=3728KB +108 #5543 +184)- Code (reserved=265858KB +1146KB, committed=94130KB +6866KB) (malloc=16258KB +1146KB #18187 +1146) (mmap: reserved=249600KB, committed=77872KB +5720KB)- GC (reserved=118433KB +1KB, committed=118433KB +1KB) (malloc=93849KB +1KB #487 +24) (mmap: reserved=24584KB, committed=24584KB)- Compiler (reserved=1956KB +253KB, committed=1956KB +253KB) (malloc=1826KB +253KB #2098 +271) (arena=131KB #3)- Internal (reserved=203932KB +13143KB, committed=203932KB +13143KB) (malloc=203900KB +13143KB #62342 +3942) (mmap: reserved=32KB, committed=32KB)- Symbol (reserved=17820KB +108KB, committed=17820KB +108KB) (malloc=13977KB +76KB #152204 +257) (arena=3844KB +32 #1)- Native Memory Tracking (reserved=5519KB +517KB, committed=5519KB +517KB) (malloc=797KB +325KB #9992 +3789) (tracking overhead=4722KB +192KB)- Arena Chunk (reserved=294KB +5KB, committed=294KB +5KB) (malloc=294KB +5KB)- Unknown (reserved=99336KB, committed=99336KB) (mmap: reserved=99336KB, committed=99336KB ï¿¼ å‘ç°è¿™æ®µæ—¶é—´pmapçœ‹åˆ°çš„RSSå¢é•¿äº†3Gå¤šï¼Œä½†NMTè§‚å¯Ÿåˆ°çš„å†…å­˜å¢é•¿äº†ä¸åˆ°120Mï¼Œè¿˜æœ‰å¤§æ¦‚2Gå¤šå¸¸é©»å†…å­˜ä¸çŸ¥å»å‘ï¼Œå› æ­¤ä¹ŸåŸºæœ¬æ’é™¤äº†ç”±äºJVMè‡ªèº«ç®¡ç†çš„å †å¤–å†…å­˜çš„å«Œç–‘ã€‚ gdbåˆ†æå†…å­˜å—å†…å®¹ä¸Šé¢æåˆ°ä½¿ç”¨pmapæ¥æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æ˜ å°„ï¼Œpmapå‘½ä»¤å®é™…æ˜¯è¯»å–äº†/proc/pid/mapså’Œ/porc/pid/smapsæ–‡ä»¶æ¥è¾“å‡ºã€‚å‘ç°ä¸€ä¸ªç»†èŠ‚ï¼Œpmapå–å‡ºçš„å†…å­˜æ˜ å°„å‘ç°å¾ˆå¤š64Må¤§å°çš„å†…å­˜å—ã€‚è¿™ç§å†…å­˜å—é€æ¸å˜å¤šä¸”å ç”¨çš„RSSå¸¸é©»å†…å­˜ä¹Ÿé€æ¸å¢é•¿åˆ°reservedä¿ç•™å†…å­˜å¤§å°ï¼Œå†…å­˜å¢é•¿çš„2Gå¤šåŸºæœ¬ä¸Šä¹Ÿæ˜¯ç”±äºè¿™äº›64Mçš„å†…å­˜å—å¯¼è‡´çš„ï¼Œå› æ­¤çœ‹ä¸€ä¸‹è¿™äº›å†…å­˜å—é‡Œå…·ä½“å†…å®¹ã€‚ pmap -x 1çœ‹ä¸€ä¸‹å®é™…å†…å­˜åˆ†é…æƒ…å†µï¼šï¿¼ æ‰¾ä¸€å—å†…å­˜å—è¿›è¡Œdumpï¼š 1gdb --batch --pid 1 -ex \"dump memory a.dump 0x7fd488000000 0x7fd488000000+56124000\" ç®€å•åˆ†æä¸€ä¸‹å†…å®¹ï¼Œå‘ç°ç»å¤§éƒ¨åˆ†æ˜¯ä¹±ç çš„äºŒè¿›åˆ¶å†…å®¹ï¼Œçœ‹ä¸å‡ºä»€ä¹ˆé—®é¢˜ã€‚strings a.dump | lessæˆ–è€…ï¼š hexdump -C a.dump | lessæˆ–è€…ï¼š view a.dump æ²¡å•¥æ€è·¯çš„æ—¶å€™ï¼Œéšä¾¿æœäº†ä¸€ä¸‹å‘ç°è²Œä¼¼å¾ˆå¤šäººç¢°åˆ°è¿™ç§64Må†…å­˜å—çš„é—®é¢˜ï¼Œäº†è§£åˆ°glibcçš„å†…å­˜åˆ†é…ç­–ç•¥åœ¨é«˜ç‰ˆæœ¬æœ‰è¾ƒå¤§è°ƒæ•´ï¼š ä»glibc 2.11ï¼ˆä¸ºåº”ç”¨ç³»ç»Ÿåœ¨å¤šæ ¸å¿ƒCPUå’Œå¤šSocketsç¯å¢ƒä¸­é«˜ä¼¸ç¼©æ€§æä¾›äº†ä¸€ä¸ªåŠ¨æ€å†…å­˜åˆ†é…çš„ç‰¹æ€§å¢å¼ºï¼‰ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†per thread arenaå†…å­˜æ± ï¼ŒNative HeapåŒºè¢«æ‰“æ•£ä¸ºsub-pools ï¼Œè¿™éƒ¨åˆ†å†…å­˜æ± å«åšArenaå†…å­˜æ± ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥å‰åªæœ‰ä¸€ä¸ªmain arenaï¼Œç›®å‰æ˜¯ä¸€ä¸ªmain arenaï¼ˆè¿˜æ˜¯ä½äºNative HeapåŒºï¼‰ + å¤šä¸ªper thread arenaï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´ä¸å†å…±ç”¨ä¸€ä¸ªarenaå†…å­˜åŒºåŸŸäº†ï¼Œä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå †ï¼Œè¿™æ ·é¿å…å†…å­˜åˆ†é…æ—¶éœ€è¦é¢å¤–çš„é”æ¥é™ä½æ€§èƒ½ã€‚main arenaä¸»è¦é€šè¿‡brk/sbrkç³»ç»Ÿè°ƒç”¨å»ç®¡ç†ï¼Œper thread arenaä¸»è¦é€šè¿‡mmapç³»ç»Ÿè°ƒç”¨å»åˆ†é…å’Œç®¡ç†ã€‚ ä¸€ä¸ª32ä½çš„åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œæœ€å¤§å¯åˆ›å»º 2 CPUæ€»æ ¸æ•°ä¸ªarenaå†…å­˜æ± ï¼ˆMALLOC_ARENA_MAXï¼‰ï¼Œæ¯ä¸ªarenaå†…å­˜æ± å¤§å°ä¸º1MBï¼Œä¸€ä¸ª64ä½çš„åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œæœ€å¤§å¯åˆ›å»º 8 CPUæ€»æ ¸æ•°ä¸ªarenaå†…å­˜æ± ï¼ˆMALLOC_ARENA_MAXï¼‰ï¼Œæ¯ä¸ªarenaå†…å­˜æ± å¤§å°ä¸º64MB ptmalloc2å†…å­˜åˆ†é…å’Œé‡Šæ”¾ å½“æŸä¸€çº¿ç¨‹éœ€è¦è°ƒç”¨ malloc()åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œ è¯¥çº¿ç¨‹å…ˆæŸ¥çœ‹çº¿ç¨‹ç§æœ‰å˜é‡ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªåˆ†é…åŒºï¼Œå¦‚æœå­˜åœ¨ï¼Œ å°è¯•å¯¹è¯¥åˆ†é…åŒºåŠ é”ï¼Œå¦‚æœåŠ é”æˆåŠŸï¼Œä½¿ç”¨è¯¥åˆ†é…åŒºåˆ†é…å†…å­˜ï¼Œå¦‚æœå¤±è´¥ï¼Œ è¯¥çº¿ç¨‹æœç´¢å¾ªç¯é“¾è¡¨è¯•å›¾è·å¾—ä¸€ä¸ªæ²¡æœ‰åŠ é”çš„åˆ†é…åŒºã€‚å¦‚æœæ‰€æœ‰çš„åˆ†é…åŒºéƒ½å·²ç»åŠ é”ï¼Œé‚£ä¹ˆ malloc()ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„åˆ†é…åŒºï¼ŒæŠŠè¯¥åˆ†é…åŒºåŠ å…¥åˆ°å…¨å±€åˆ†é…åŒºå¾ªç¯é“¾è¡¨å¹¶åŠ é”ï¼Œç„¶åä½¿ç”¨è¯¥åˆ†é…åŒºè¿›è¡Œåˆ†é…å†…å­˜æ“ä½œã€‚åœ¨é‡Šæ”¾æ“ä½œä¸­ï¼Œçº¿ç¨‹åŒæ ·è¯•å›¾è·å¾—å¾…é‡Šæ”¾å†…å­˜å—æ‰€åœ¨åˆ†é…åŒºçš„é”ï¼Œå¦‚æœè¯¥åˆ†é…åŒºæ­£åœ¨è¢«åˆ«çš„çº¿ç¨‹ä½¿ç”¨ï¼Œåˆ™éœ€è¦ç­‰å¾…ç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾è¯¥åˆ†é…åŒºçš„äº’æ–¥é”ä¹‹åæ‰å¯ä»¥è¿›è¡Œé‡Šæ”¾æ“ä½œã€‚ç”¨æˆ· free æ‰çš„å†…å­˜å¹¶ä¸æ˜¯éƒ½ä¼šé©¬ä¸Šå½’è¿˜ç»™ç³»ç»Ÿï¼Œptmalloc2 ä¼šç»Ÿä¸€ç®¡ç† heap å’Œ mmap æ˜ å°„åŒºåŸŸä¸­çš„ç©ºé—²çš„chunkï¼Œå½“ç”¨æˆ·è¿›è¡Œä¸‹ä¸€æ¬¡åˆ†é…è¯·æ±‚æ—¶ï¼Œ ptmalloc2 ä¼šé¦–å…ˆè¯•å›¾åœ¨ç©ºé—²çš„chunk ä¸­æŒ‘é€‰ä¸€å—ç»™ç”¨æˆ·ï¼Œè¿™æ ·å°±é¿å…äº†é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œé™ä½äº†å†…å­˜åˆ†é…çš„å¼€é”€ã€‚ ptmalloc2çš„å†…å­˜æ”¶ç¼©æœºåˆ¶ ä¸šåŠ¡å±‚è°ƒç”¨freeæ–¹æ³•é‡Šæ”¾å†…å­˜æ—¶ï¼Œptmalloc2å…ˆåˆ¤æ–­ top chunk çš„å¤§å°æ˜¯å¦å¤§äº mmap æ”¶ç¼©é˜ˆå€¼(é»˜è®¤ä¸º 128KB)ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå¯¹äºä¸»åˆ†é…åŒºï¼Œåˆ™ä¼šè¯•å›¾å½’è¿˜ top chunk ä¸­çš„ä¸€éƒ¨åˆ†ç»™æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯æœ€å…ˆåˆ†é…çš„ 128KB ç©ºé—´æ˜¯ä¸ä¼šå½’è¿˜çš„ï¼Œptmalloc ä¼šä¸€ç›´ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ï¼Œç”¨äºå“åº”ç”¨æˆ·çš„åˆ†é… è¯·æ±‚;å¦‚æœä¸ºéä¸»åˆ†é…åŒºï¼Œä¼šè¿›è¡Œ sub-heap æ”¶ç¼©ï¼Œå°† top chunk çš„ä¸€éƒ¨åˆ†è¿”å›ç»™æ“ ä½œç³»ç»Ÿï¼Œå¦‚æœ top chunk ä¸ºæ•´ä¸ª sub-heapï¼Œä¼šæŠŠæ•´ä¸ª sub-heap è¿˜å›ç»™æ“ä½œç³»ç»Ÿã€‚åš å®Œè¿™ä¸€æ­¥ä¹‹åï¼Œé‡Šæ”¾ç»“æŸï¼Œä» free() å‡½æ•°é€€å‡ºã€‚å¯ä»¥çœ‹å‡ºï¼Œæ”¶ç¼©å †çš„æ¡ä»¶æ˜¯å½“å‰ free çš„ chunk å¤§å°åŠ ä¸Šå‰åèƒ½åˆå¹¶ chunk çš„å¤§å°å¤§äº 64kï¼Œå¹¶ä¸”è¦ top chunk çš„å¤§ å°è¦è¾¾åˆ° mmap æ”¶ç¼©é˜ˆå€¼ï¼Œæ‰æœ‰å¯èƒ½æ”¶ç¼©å †ã€‚ ptmalloc2çš„mmapåˆ†é…é˜ˆå€¼åŠ¨æ€è°ƒæ•´ M_MMAP_THRESHOLD ç”¨äºè®¾ç½® mmap åˆ†é…é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º 128KBï¼Œptmalloc é»˜è®¤å¼€å¯ åŠ¨æ€è°ƒæ•´ mmap åˆ†é…é˜ˆå€¼å’Œ mmap æ”¶ç¼©é˜ˆå€¼ã€‚å½“ç”¨æˆ·éœ€è¦åˆ†é…çš„å†…å­˜å¤§äº mmap åˆ†é…é˜ˆå€¼ï¼Œptmalloc çš„ malloc()å‡½æ•°å…¶å®ç›¸å½“äº mmap() çš„ç®€å•å°è£…ï¼Œfree å‡½æ•°ç›¸å½“äº munmap()çš„ç®€å•å°è£…ã€‚ç›¸å½“äºç›´æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ†é…å†…å­˜ï¼Œ å›æ”¶çš„å†…å­˜å°±ç›´æ¥è¿”å›ç»™æ“ä½œç³»ç»Ÿäº†ã€‚å› ä¸ºè¿™äº›å¤§å—å†…å­˜ä¸èƒ½è¢« ptmalloc ç¼“å­˜ç®¡ç†ï¼Œä¸èƒ½é‡ç”¨ï¼Œæ‰€ä»¥ ptmalloc ä¹Ÿåªæœ‰åœ¨ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨è¯¥æ–¹å¼åˆ†é…å†…å­˜ã€‚ å¦‚ä½•ä¼˜åŒ–è§£å†³ä¸‰ç§æ–¹æ¡ˆï¼šç¬¬ä¸€ç§ï¼šæ§åˆ¶åˆ†é…åŒºçš„æ€»æ•°ä¸Šé™ã€‚é»˜è®¤64ä½ç³»ç»Ÿåˆ†é…åŒºæ•°ä¸ºï¼šcpuæ ¸æ•°*8ï¼Œå¦‚å½“å‰ç¯å¢ƒ40æ ¸ç³»ç»Ÿåˆ†é…åŒºæ•°ä¸º320ä¸ªï¼Œæ¯ä¸ª64Mä¸Šé™çš„è¯æœ€å¤šå¯è¾¾20Gï¼Œé™åˆ¶ä¸Šé™åï¼Œåç»­ä¸å¤Ÿçš„ç”³è¯·ä¼šç›´æ¥èµ°mmapåˆ†é…å’Œmunmapå›æ”¶ï¼Œä¸ä¼šè¿›å…¥ptmalloc2çš„bufferæ± ã€‚æ‰€ä»¥ç¬¬ä¸€ç§æ–¹æ¡ˆè°ƒæ•´ä¸€ä¸‹åˆ†é…æ± ä¸Šé™ä¸ªæ•°åˆ°4ï¼š 1export MALLOC_ARENA_MAX=4 ç¬¬äºŒç§ï¼šä¹‹å‰é™åˆ°ptmalloc2é»˜è®¤ä¼šåŠ¨æ€è°ƒæ•´mmapåˆ†é…é˜ˆå€¼ï¼Œå› æ­¤å¯¹äºè¾ƒå¤§çš„å†…å­˜è¯·æ±‚ä¹Ÿä¼šè¿›å…¥ptmalloc2çš„å†…å­˜bufferæ± é‡Œï¼Œè¿™é‡Œå¯ä»¥å»æ‰ptmallocçš„åŠ¨æ€è°ƒæ•´åŠŸèƒ½ã€‚å¯ä»¥è®¾ç½® M_TRIM_THRESHOLDï¼ŒM_MMAP_THRESHOLDï¼ŒM_TOP_PAD å’Œ M_MMAP_MAX ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚è¿™é‡Œå¯ä»¥å›ºå®šåˆ†é…é˜ˆå€¼ä¸º128Kï¼Œè¿™æ ·è¶…è¿‡128Kçš„å†…å­˜åˆ†é…è¯·æ±‚éƒ½ä¸ä¼šè¿›å…¥ptmallocçš„bufferæ± è€Œæ˜¯ç›´æ¥èµ°mmapåˆ†é…å’Œmunmapå›æ”¶ï¼ˆæ€§èƒ½ä¸Šä¼šæœ‰æŸè€—ï¼‰ï¼š 1234export MALLOC_MMAP_THRESHOLD_=131072export MALLOC_TRIM_THRESHOLD_=131072export MALLOC_TOP_PAD_=131072export MALLOC_MMAP_MAX_=65536 ç¬¬ä¸‰ç§ï¼šä½¿ç”¨tcmallocæ¥æ›¿ä»£é»˜è®¤çš„ptmalloc2ã€‚googleçš„tcmallocæä¾›æ›´ä¼˜çš„å†…å­˜åˆ†é…æ•ˆç‡ï¼Œæ€§èƒ½æ›´å¥½ï¼ŒThreadCacheä¼šé˜¶æ®µæ€§çš„å›æ”¶å†…å­˜åˆ°CentralCacheé‡Œã€‚ è§£å†³äº†ptmalloc2ä¸­arenaä¹‹é—´ä¸èƒ½è¿ç§»å¯¼è‡´å†…å­˜æµªè´¹çš„é—®é¢˜ã€‚ æ€»ç»“æ”¶è· å®šä½é—®é¢˜ï¼Œä¸€å®šè¦äº†è§£é—®é¢˜çš„é¢†åŸŸèŒƒå›´ï¼Œåœ¨è¿™æ¬¡æ’æŸ¥ä¸­ï¼Œå®šä½OOMé—®é¢˜é¢†åŸŸé¡ºåºå°±æ˜¯ jvmå†…å­˜ -&gt; jvmå†…éƒ¨å†…å­˜ -&gt; è¿›ç¨‹å†…å­˜ã€‚ æ“ä½œç³»ç»ŸçŸ¥è¯†ä¸èƒ½ä¸¢ï¼Œæ‰å®çš„åŸºç¡€çŸ¥è¯†å¯ä»¥èŠ‚çœéå¸¸å¤šç™¾åº¦çš„æ—¶é—´å’Œæ¨ç†é—®é¢˜çš„æ—¶é—´ çŸ¥è¯†é¢†åŸŸæ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚è¿™æ¬¡çš„ptmallocå†…å­˜åˆ†é…åŸºæœ¬åŸç†å’Œmetaspaceå†…å­˜åˆ†é…ã€nettyçš„å†…å­˜åˆ†é…åŸç†éå¸¸ç›¸ä¼¼ å½“æ—¶æ’æŸ¥é—®é¢˜æ—¶å› ä¸ºå·²ç»å®šä½åˆ°æ˜¯å†…å­˜åˆ†é…é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰ç•™ä¸‹é—®é¢˜æ’æŸ¥ä¸­é—´è¿‡ç¨‹çš„ç›¸å…³æ•°æ®ã€‚æœ€è¿‘å¶ç„¶çœ‹åˆ°ä¸€ç¯‡åšå®¢çš„è®°å½•å’Œæˆ‘çš„ç»å†æä¸ºç›¸ä¼¼ï¼Œäºæ˜¯æˆ‘å‚è€ƒåšå®¢å’Œè‡ªå·±çš„æ’æŸ¥ç»éªŒæ•´åˆäº†è¿™ç¯‡æ’æŸ¥é—®é¢˜è®°å½•ã€‚ç»“æœå’Œè¿‡ç¨‹éƒ½å¾ˆé‡è¦ï¼Œåªæœ‰ç»“æœï¼Œæ²¡æœ‰è¿‡ç¨‹å®¹æ˜“æ‹›è‡´ä»–äººçš„ä¸ç†è§£ï¼Œèƒ½è¢«äººç†è§£ä¹Ÿæ˜¯ä¸€é—¨å­¦é—®ï½","link":"/2020/2020-05-10-%E6%8E%92%E6%9F%A5docker_oomkillded%E9%97%AE%E9%A2%98/"},{"title":"ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”","text":"ä¸ºäº†ä¾¿äºè¯´æ˜é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ä¸€ä¸ªå°ä¸€ç‚¹å„¿çš„è¡¨ï¼Œå»ºè¡¨å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼š 123456789101112131415CREATE TABLE `t` ( `id` int(11) NOT NULL, `c` int(11) DEFAULT NULL, `d` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `c` (`c`)) ENGINE=InnoDB; insert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25); è¿™ä¸ªè¡¨é™¤äº†ä¸»é”® id å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç´¢å¼• cï¼Œåˆå§‹åŒ–è¯­å¥åœ¨è¡¨ä¸­æ’å…¥äº† 6 è¡Œæ•°æ®ã€‚ ä¸‹é¢çš„è¯­å¥åºåˆ—ï¼Œæ˜¯æ€ä¹ˆåŠ é”çš„ï¼ŒåŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„å‘¢ï¼Ÿ 1select * from t where d = 5 for update; æ¯”è¾ƒå¥½ç†è§£çš„æ˜¯ï¼Œè¿™ä¸ªè¯­å¥ä¼šå‘½ä¸­ d = 5 çš„è¿™ä¸€è¡Œï¼Œå¯¹åº”çš„ä¸»é”® id = 5ï¼Œå› æ­¤åœ¨ select è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨id = 5 è¿™ä¸€è¡Œä¸»é”®ä¸ŠåŠ ä¸€ä¸ªå†™é”ï¼Œè€Œä¸”ç”±äºä¸¤é˜¶æ®µé”åè®®ï¼Œè¿™ä¸ªå†™é”ä¼šåœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™é‡Šæ”¾ã€‚ ç”±äºå­—æ®µ d ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œå› æ­¤è¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šåšå…¨è¡¨æ‰«æã€‚é‚£ä¹ˆï¼Œå…¶ä»–è¢«æ‰«æåˆ°çš„ï¼Œä½†æ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ 5 è¡Œè®°å½•ä¸Šï¼Œä¼šä¸ä¼šè¢«åŠ é”å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ï¼ŒInnoDB çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œæ‰€ä»¥æœ¬æ–‡æ¥ä¸‹æ¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯è®¾å®šåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ã€‚ å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ï¼Œå‡è®¾åªåœ¨ id = 5è¿™ä¸€è¡ŒåŠ é”ï¼Œè€Œå…¶ä»–è¡Œçš„ä¸åŠ é”çš„è¯ï¼Œä¼šæ€ä¹ˆæ ·ã€‚ ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼ˆè¿™ä¸ªç»“æœæ˜¯å»ºç«‹åœ¨å‰é¢å‡è®¾ä¹‹ä¸Šï¼Œå®é™…ä¸Šæ˜¯é”™è¯¯çš„ï¼‰ï¼š å‡è®¾åªåœ¨ id = 5 è¿™ä¸€è¡ŒåŠ è¡Œé”ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œsession A é‡Œæ‰§è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢ï¼Œåˆ†åˆ«æ˜¯ Q1ã€Q2 å’Œ Q3ã€‚å®ƒä»¬çš„ SQL è¯­å¥ç›¸åŒï¼Œéƒ½æ˜¯select * fom t where d=5 for updateã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸‰æ¡ SQL è¯­å¥ï¼Œåˆ†åˆ«ä¼šè¿”å›ä»€ä¹ˆç»“æœã€‚ Q1 åªè¿”å› id = 5 è¿™ä¸€è¡Œï¼› åœ¨ T2 æ—¶åˆ»ï¼Œsession B æŠŠ id = 0 è¿™ä¸€è¡Œçš„ d å€¼æ”¹æˆäº† 5ï¼Œå› æ­¤ T3 æ—¶åˆ» Q2 æŸ¥å‡ºæ¥çš„æ˜¯id = 0 å’Œid = 5 è¿™ä¸¤è¡Œï¼› åœ¨ T4 æ—¶åˆ»ï¼Œsession C åˆæ’å…¥ä¸€è¡Œï¼ˆ1,1,5ï¼‰ï¼Œå› æ­¤ T5 æ—¶åˆ» Q3 æŸ¥å‡ºæ¥çš„æ˜¯id = 0ã€id = 1 å’Œ id = 5 çš„è¿™ä¸‰è¡Œã€‚ å…¶ä¸­ï¼ŒQ3 è¯»åˆ°id = 1 è¿™ä¸€è¡Œçš„ç°è±¡ï¼Œè¢«ç§°ä¸ºâ€œå¹»è¯»â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œã€‚ è¿™é‡Œï¼Œæˆ‘éœ€è¦å¯¹â€œå¹»è¯»â€åšä¸€ä¸ªè¯´æ˜ï¼š åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨å½“å‰è¯»ä¸‹æ‰ä¼šå‡ºç°ã€‚ ä¸Šé¢ session B çš„ä¿®æ”¹ç»“æœï¼Œè¢« session A ä¹‹åçš„ select è¯­å¥ç”¨å½“å‰è¯»çœ‹åˆ°ï¼Œä¸èƒ½ç§°ä¸ºå¹»è¯»ã€‚å¹»è¯»ä»…ä¸“æŒ‡æ–°æ’å…¥çš„è¡Œã€‚ å¦‚æœåªä»æˆ‘ä»¬å­¦åˆ°çš„äº‹åŠ¡å¯è§æ€§è§„åˆ™æ¥åˆ†æçš„è¯ï¼Œä¸Šé¢è¿™ä¸‰æ¡ SQL è¯­å¥çš„è¿”å›ç»“æœéƒ½æ²¡æœ‰é—®é¢˜ã€‚ å› ä¸ºè¿™ä¸‰ä¸ªæŸ¥è¯¢éƒ½æ˜¯åŠ äº† for updateï¼Œéƒ½æ˜¯å½“å‰è¯»ã€‚è€Œå½“å‰è¯»çš„è§„åˆ™ï¼Œå°±æ˜¯è¦èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤çš„è®°å½•çš„æœ€æ–°å€¼ã€‚å¹¶ä¸”ï¼Œsession B å’Œ sessionC çš„ä¸¤æ¡è¯­å¥ï¼Œæ‰§è¡Œåå°±ä¼šæäº¤ï¼Œæ‰€ä»¥ Q2 å’Œ Q3 å°±æ˜¯åº”è¯¥çœ‹åˆ°è¿™ä¸¤ä¸ªäº‹åŠ¡çš„æ“ä½œæ•ˆæœï¼Œè€Œä¸”ä¹Ÿçœ‹åˆ°äº†ï¼Œè¿™è·Ÿäº‹åŠ¡çš„å¯è§æ€§è§„åˆ™å¹¶ä¸çŸ›ç›¾ã€‚ å¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿé¦–å…ˆæ˜¯è¯­ä¹‰ä¸Šçš„ã€‚session A åœ¨ T1 æ—¶åˆ»å°±å£°æ˜äº†ï¼Œâ€œæˆ‘è¦æŠŠæ‰€æœ‰ d=5 çš„è¡Œé”ä½ï¼Œä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œâ€ã€‚æ‰€ä»¥æˆ‘ä»¬å‡è®¾åªé”äº†id = 5è¿™ä¸€è¡Œçš„è¯­ä¹‰ä¸select * from t where d = 5 for update ä¸åŒã€‚ å…¶æ¬¡ï¼Œæ˜¯æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ è¿™ä¸ªæ•°æ®ä¸ä¸€è‡´åˆ°åº•æ˜¯æ€ä¹ˆå¼•å…¥çš„ï¼Ÿè‚¯å®šæ˜¯å‰é¢çš„å‡è®¾æœ‰é—®é¢˜ã€‚ æˆ‘ä»¬æŠŠæ‰«æè¿‡ç¨‹ä¸­ç¢°åˆ°çš„è¡Œï¼Œä¹Ÿéƒ½åŠ ä¸Šå†™é”ï¼Œå†æ¥çœ‹çœ‹æ‰§è¡Œæ•ˆæœã€‚ ç”±äº session A æŠŠæ‰€æœ‰çš„è¡Œéƒ½åŠ äº†å†™é”ï¼Œæ‰€ä»¥ session B åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª update è¯­å¥çš„æ—¶å€™å°±è¢«é”ä½äº†ã€‚éœ€è¦ç­‰åˆ° T6 æ—¶åˆ» session A æäº¤ä»¥åï¼Œsession B æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ è¿™æ ·å¯¹äº id = 0 è¿™ä¸€è¡Œï¼Œåœ¨æ•°æ®åº“é‡Œçš„æœ€ç»ˆç»“æœè¿˜æ˜¯ (0,5,5)ã€‚åœ¨ binlog é‡Œé¢ï¼Œæ‰§è¡Œåºåˆ—æ˜¯è¿™æ ·çš„ï¼š 1234567insert into t values(1,1,5); /*(1,1,5)*/update t set c=5 where id=1; /*(1,5,5)*/ update t set d=100 where d=5;/* æ‰€æœ‰ d=5 çš„è¡Œï¼Œd æ”¹æˆ 100*/ update t set d=5 where id=0; /*(0,0,5)*/update t set c=5 where id=0; /*(0,5,5)*/ å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§æ—¥å¿—é¡ºåºæ‰§è¡Œï¼Œid = 0 è¿™ä¸€è¡Œçš„æœ€ç»ˆç»“æœä¹Ÿæ˜¯ (0,5,5)ã€‚æ‰€ä»¥ï¼Œid = 0 è¿™ä¸€è¡Œçš„é—®é¢˜è§£å†³äº†ã€‚ ä½†åŒæ—¶ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œid = 1 è¿™ä¸€è¡Œï¼Œåœ¨æ•°æ®åº“é‡Œé¢çš„ç»“æœæ˜¯ (1,5,5)ï¼Œè€Œæ ¹æ® binlog çš„æ‰§è¡Œç»“æœæ˜¯ (1,5,100)ï¼Œä¹Ÿå°±æ˜¯è¯´å¹»è¯»çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬å·²ç»è¿™ä¹ˆâ€œå‡¶æ®‹â€åœ°ï¼ŒæŠŠæ‰€æœ‰çš„è®°å½•éƒ½ä¸Šäº†é”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº† id = 1 è¿™ä¸€è¡Œçš„æ’å…¥å’Œæ›´æ–°å‘¢ï¼Ÿ åŸå› å¾ˆç®€å•ã€‚åœ¨ T3 æ—¶åˆ»ï¼Œæˆ‘ä»¬ç»™æ‰€æœ‰è¡ŒåŠ é”çš„æ—¶å€™ï¼Œid = 1 è¿™ä¸€è¡Œè¿˜ä¸å­˜åœ¨ï¼Œä¸å­˜åœ¨ä¹Ÿå°±åŠ ä¸ä¸Šé”ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æŠŠæ‰€æœ‰çš„è®°å½•éƒ½åŠ ä¸Šé”ï¼Œè¿˜æ˜¯é˜»æ­¢ä¸äº†æ–°æ’å…¥çš„è®°å½•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆâ€œå¹»è¯»â€ä¼šè¢«å•ç‹¬æ‹¿å‡ºæ¥è§£å†³çš„åŸå› ã€‚ å¦‚ä½•è§£å†³å¹»è¯»ï¼Ÿç°åœ¨ä½ çŸ¥é“äº†ï¼Œäº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼Œè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ã€‚å› æ­¤ï¼Œä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ŒInnoDB åªå¥½å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é” (Gap Lock)ã€‚ é¡¾åæ€ä¹‰ï¼Œé—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ã€‚æ¯”å¦‚æ–‡ç« å¼€å¤´çš„è¡¨ tï¼Œåˆå§‹åŒ–æ’å…¥äº† 6 ä¸ªè®°å½•ï¼Œè¿™å°±äº§ç”Ÿäº† 7 ä¸ªé—´éš™ã€‚ è¿™æ ·ï¼Œå½“ä½ æ‰§è¡Œ select * from t where d=5 for update çš„æ—¶å€™ï¼Œå°±ä¸æ­¢æ˜¯ç»™æ•°æ®åº“ä¸­å·²æœ‰çš„ 6 ä¸ªè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜åŒæ—¶åŠ äº† 7 ä¸ªé—´éš™é”ã€‚è¿™æ ·å°±ç¡®ä¿äº†æ— æ³•å†æ’å…¥æ–°çš„è®°å½•ã€‚ ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™ï¼Œåœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…å°†ç»™è¡ŒåŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œä¸¤è¾¹çš„ç©ºéš™ï¼Œä¹ŸåŠ ä¸Šäº†é—´éš™é”ã€‚ ç°åœ¨ä½ çŸ¥é“äº†ï¼Œæ•°æ®è¡Œæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®ä½“ï¼Œæ•°æ®è¡Œä¹‹é—´çš„é—´éš™ï¼Œä¹Ÿæ˜¯å¯ä»¥åŠ ä¸Šé”çš„å®ä½“ã€‚ä½†æ˜¯é—´éš™é”è·Ÿæˆ‘ä»¬ä¹‹å‰ç¢°åˆ°è¿‡çš„é”éƒ½ä¸å¤ªä¸€æ ·ã€‚ æ¯”å¦‚è¡Œé”ï¼Œåˆ†æˆè¯»é”å’Œå†™é”ã€‚ä¸‹å›¾å°±æ˜¯è¿™ä¸¤ç§ç±»å‹è¡Œé”çš„å†²çªå…³ç³»ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè·Ÿè¡Œé”æœ‰å†²çªå…³ç³»çš„æ˜¯â€œå¦å¤–ä¸€ä¸ªè¡Œé”â€ã€‚ ä½†æ˜¯é—´éš™é”ä¸ä¸€æ ·ï¼Œè·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚ è¿™å¥è¯ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼š è¿™é‡Œ session B å¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨ t é‡Œå¹¶æ²¡æœ‰ c = 7 è¿™ä¸ªè®°å½•ï¼Œå› æ­¤ session A åŠ çš„æ˜¯é—´éš™é” (5,10)ã€‚è€Œ session B ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå³ï¼šä¿æŠ¤è¿™ä¸ªé—´éš™ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚ é—´éš™é”å’Œè¡Œé”åˆç§° next-key lockï¼Œæ¯ä¸ª next-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„è¡¨ t åˆå§‹åŒ–ä»¥åï¼Œå¦‚æœç”¨ select * from t for update è¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥ï¼Œå°±å½¢æˆäº† 7 ä¸ª next-key lockï¼Œåˆ†åˆ«æ˜¯ (-âˆ,0]ã€(0,5]ã€(5,10]ã€(10,15]ã€(15,20]ã€(20, 25]ã€(25, +supremum]ã€‚ å¤‡æ³¨ï¼šè¿™ç¯‡æ–‡ç« ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œæˆ‘ä»¬æŠŠé—´éš™é”è®°ä¸ºå¼€åŒºé—´ï¼ŒæŠŠ next-key lock è®°ä¸ºå‰å¼€åé—­åŒºé—´ã€‚ ä½ å¯èƒ½ä¼šé—®è¯´ï¼Œè¿™ä¸ª supremum ä»å“ªå„¿æ¥çš„å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸º +âˆæ˜¯å¼€åŒºé—´ã€‚å®ç°ä¸Šï¼ŒInnoDB ç»™æ¯ä¸ªç´¢å¼•åŠ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æœ€å¤§å€¼ supremumï¼Œè¿™æ ·æ‰ç¬¦åˆæˆ‘ä»¬å‰é¢è¯´çš„â€œéƒ½æ˜¯å‰å¼€åé—­åŒºé—´â€ã€‚ é—´éš™é”å’Œ next-key lock çš„å¼•å…¥ï¼Œå¸®æˆ‘ä»¬è§£å†³äº†å¹»è¯»çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›â€œå›°æ‰°â€ã€‚ å¯¹åº”åˆ°æˆ‘ä»¬è¿™ä¸ªä¾‹å­çš„è¡¨æ¥è¯´ï¼Œä¸šåŠ¡é€»è¾‘è¿™æ ·çš„ï¼šä»»æ„é”ä½ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸€è¡Œä¸å­˜åœ¨çš„è¯å°±æ’å…¥ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸€è¡Œå°±æ›´æ–°å®ƒçš„æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789begin;select * from t where id=N for update; /* å¦‚æœè¡Œä¸å­˜åœ¨ */insert into t values(N,N,N);/* å¦‚æœè¡Œå­˜åœ¨ */update t set d=N set id=N; commit; è¿™ä¸ªé€»è¾‘ä¸€æ—¦æœ‰å¹¶å‘ï¼Œå°±ä¼šç¢°åˆ°æ­»é”ã€‚ä½ ä¸€å®šä¹Ÿè§‰å¾—å¥‡æ€ªï¼Œè¿™ä¸ªé€»è¾‘æ¯æ¬¡æ“ä½œå‰ç”¨ for update é”èµ·æ¥ï¼Œå·²ç»æ˜¯æœ€ä¸¥æ ¼çš„æ¨¡å¼äº†ï¼Œæ€ä¹ˆè¿˜ä¼šæœ‰æ­»é”å‘¢ï¼Ÿ è¿™é‡Œï¼Œæˆ‘ç”¨ä¸¤ä¸ª session æ¥æ¨¡æ‹Ÿå¹¶å‘ï¼Œå¹¶å‡è®¾ N=9ã€‚ å›¾ 8 é—´éš™é”å¯¼è‡´çš„æ­»é” ä½ çœ‹åˆ°äº†ï¼Œå…¶å®éƒ½ä¸éœ€è¦ç”¨åˆ°åé¢çš„ update è¯­å¥ï¼Œå°±å·²ç»å½¢æˆæ­»é”äº†ã€‚æˆ‘ä»¬æŒ‰è¯­å¥æ‰§è¡Œé¡ºåºæ¥åˆ†æä¸€ä¸‹ï¼š session A æ‰§è¡Œ select â€¦ for update è¯­å¥ï¼Œç”±äº id = 9 è¿™ä¸€è¡Œå¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä¼šåŠ ä¸Šé—´éš™é” (5,10); session B æ‰§è¡Œ select â€¦ for update è¯­å¥ï¼ŒåŒæ ·ä¼šåŠ ä¸Šé—´éš™é” (5,10)ï¼Œé—´éš™é”ä¹‹é—´ä¸ä¼šå†²çªï¼Œå› æ­¤è¿™ä¸ªè¯­å¥å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼› session B è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9)ï¼Œè¢« session A çš„é—´éš™é”æŒ¡ä½äº†ï¼Œåªå¥½è¿›å…¥ç­‰å¾…ï¼› session A è¯•å›¾æ’å…¥ä¸€è¡Œ (9,9,9)ï¼Œè¢« session B çš„é—´éš™é”æŒ¡ä½äº†ã€‚ è‡³æ­¤ï¼Œä¸¤ä¸ª session è¿›å…¥äº’ç›¸ç­‰å¾…çŠ¶æ€ï¼Œå½¢æˆæ­»é”ã€‚å½“ç„¶ï¼ŒInnoDB çš„æ­»é”æ£€æµ‹é©¬ä¸Šå°±å‘ç°äº†è¿™å¯¹æ­»é”å…³ç³»ï¼Œè®© session A çš„ insert è¯­å¥æŠ¥é”™è¿”å›äº†ã€‚ ä½ ç°åœ¨çŸ¥é“äº†ï¼Œé—´éš™é”çš„å¼•å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒæ ·çš„è¯­å¥é”ä½æ›´å¤§çš„èŒƒå›´ï¼Œè¿™å…¶å®æ˜¯å½±å“äº†å¹¶å‘åº¦çš„ã€‚ ä½ å¯èƒ½ä¼šè¯´ï¼Œä¸ºäº†è§£å†³å¹»è¯»çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¿™ä¹ˆä¸€å¤§ä¸²å†…å®¹ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•ä¸€ç‚¹çš„å¤„ç†æ–¹æ³•å‘¢ã€‚ æˆ‘åœ¨æ–‡ç« ä¸€å¼€å§‹å°±è¯´è¿‡ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»Šå¤©å’Œä½ åˆ†æçš„é—®é¢˜éƒ½æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹çš„ï¼Œé—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ã€‚æ‰€ä»¥ï¼Œä½ å¦‚æœæŠŠéš”ç¦»çº§åˆ«è®¾ç½®ä¸ºè¯»æäº¤çš„è¯ï¼Œå°±æ²¡æœ‰é—´éš™é”äº†ã€‚ä½†åŒæ—¶ï¼Œä½ è¦è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º rowã€‚è¿™ï¼Œä¹Ÿæ˜¯ç°åœ¨ä¸å°‘å…¬å¸ä½¿ç”¨çš„é…ç½®ç»„åˆã€‚","link":"/2020/2020-02-27-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%95%E5%85%A5%E9%97%B4%E9%9A%99%E9%94%81/"}],"tags":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","link":"/tags/%E8%AF%BB%E4%B9%A6/"},{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/tags/%E5%B7%A5%E4%BD%9C/"},{"name":"ä»£ç ","slug":"ä»£ç ","link":"/tags/%E4%BB%A3%E7%A0%81/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/tags/%E7%AE%97%E6%B3%95/"},{"name":"æ„Ÿæ‚Ÿ","slug":"æ„Ÿæ‚Ÿ","link":"/tags/%E6%84%9F%E6%82%9F/"},{"name":"å›¢é˜Ÿ","slug":"å›¢é˜Ÿ","link":"/tags/%E5%9B%A2%E9%98%9F/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"spring","slug":"spring","link":"/tags/spring/"},{"name":"aop","slug":"aop","link":"/tags/aop/"},{"name":"mybatis","slug":"mybatis","link":"/tags/mybatis/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"ç¼“å­˜","slug":"ç¼“å­˜","link":"/tags/%E7%BC%93%E5%AD%98/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","link":"/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","link":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"æ¶ˆæ¯","slug":"æ¶ˆæ¯","link":"/tags/%E6%B6%88%E6%81%AF/"},{"name":"IMç³»ç»Ÿ","slug":"IMç³»ç»Ÿ","link":"/tags/IM%E7%B3%BB%E7%BB%9F/"},{"name":"æ¶æ„","slug":"æ¶æ„","link":"/tags/%E6%9E%B6%E6%9E%84/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","link":"/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","link":"/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"æœç´¢","slug":"æœç´¢","link":"/tags/%E6%90%9C%E7%B4%A2/"},{"name":"redis","slug":"redis","link":"/tags/redis/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","link":"/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"categories":[{"name":"è¯»ä¹¦","slug":"è¯»ä¹¦","link":"/categories/%E8%AF%BB%E4%B9%A6/"},{"name":"å·¥ä½œ","slug":"å·¥ä½œ","link":"/categories/%E5%B7%A5%E4%BD%9C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/categories/%E7%AE%97%E6%B3%95/"},{"name":"Javaæ¡†æ¶","slug":"Javaæ¡†æ¶","link":"/categories/Java%E6%A1%86%E6%9E%B6/"},{"name":"æŒ‘æˆ˜","slug":"å·¥ä½œ/æŒ‘æˆ˜","link":"/categories/%E5%B7%A5%E4%BD%9C/%E6%8C%91%E6%88%98/"},{"name":"å­—ç¬¦ä¸²","slug":"ç®—æ³•/å­—ç¬¦ä¸²","link":"/categories/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"name":"JavaåŸºç¡€","slug":"JavaåŸºç¡€","link":"/categories/Java%E5%9F%BA%E7%A1%80/"},{"name":"æ€»ç»“","slug":"å·¥ä½œ/æ€»ç»“","link":"/categories/%E5%B7%A5%E4%BD%9C/%E6%80%BB%E7%BB%93/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"Spring","slug":"Javaæ¡†æ¶/Spring","link":"/categories/Java%E6%A1%86%E6%9E%B6/Spring/"},{"name":"Mybatis","slug":"Javaæ¡†æ¶/Mybatis","link":"/categories/Java%E6%A1%86%E6%9E%B6/Mybatis/"},{"name":"æ’åº","slug":"ç®—æ³•/æ’åº","link":"/categories/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/"},{"name":"æ¶æ„","slug":"æ¶æ„","link":"/categories/%E6%9E%B6%E6%9E%84/"},{"name":"mysql","slug":"ä¸­é—´ä»¶/mysql","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/"},{"name":"resilience4j","slug":"ä¸­é—´ä»¶/resilience4j","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/resilience4j/"},{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"ä¸­é—´ä»¶/æ¶ˆæ¯é˜Ÿåˆ—","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"},{"name":"ç¼“å­˜","slug":"ä¸­é—´ä»¶/ç¼“å­˜","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E7%BC%93%E5%AD%98/"},{"name":"nosql","slug":"ä¸­é—´ä»¶/nosql","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/nosql/"},{"name":"Javaå¹¶å‘","slug":"Javaå¹¶å‘","link":"/categories/Java%E5%B9%B6%E5%8F%91/"},{"name":"æœç´¢å¼•æ“","slug":"ä¸­é—´ä»¶/æœç´¢å¼•æ“","link":"/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"},{"name":"äºŒå‰æ ‘","slug":"ç®—æ³•/äºŒå‰æ ‘","link":"/categories/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]}