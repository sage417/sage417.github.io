<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>æ ‡ç­¾: ä»£ç  - å¡‘æ–™å†…å­˜</title>


    <meta name="description" content="éšç¬”">
<meta property="og:type" content="website">
<meta property="og:title" content="å¡‘æ–™å†…å­˜">
<meta property="og:url" content="http://blog.yamato.moe/tags/ä»£ç /page/2/index.html">
<meta property="og:site_name" content="å¡‘æ–™å†…å­˜">
<meta property="og:description" content="éšç¬”">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.yamato.moe/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å¡‘æ–™å†…å­˜">
<meta name="twitter:description" content="éšç¬”">
<meta name="twitter:image" content="http://blog.yamato.moe/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="å¡‘æ–™å†…å­˜" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="http://github.com/sage417/sage417.github.io">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="æœç´¢" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/tags">æ ‡ç­¾</a></li>
            <li class="is-active"><a href="#" aria-current="page">ä»£ç </a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-18T02:00:00.000Z">2019-04-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ä¸­é—´ä»¶/">ä¸­é—´ä»¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ä¸­é—´ä»¶/resilience4j/">resilience4j</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 431 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/18/resilience4j-retryæºç é˜…è¯»/">resilience4j-retryæºç é˜…è¯»</a>
            
        </h1>
        <div class="content">
            <p>resilience4j æºç è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ç®€å•çš„ï¼Œæ¯”è¾ƒé€‚åˆé˜…è¯»ã€‚</p>
<p>æ”¾ä¸€å¼ ä¸»è¦ç±»çš„ç»“æ„å›¾ï¼š</p>
<p><img src="https://i.loli.net/2019/04/18/5cb7e40673fcf.png" alt=""></p>
<h4 id="Retryå…¥å£"><a href="#Retryå…¥å£" class="headerlink" title="Retryå…¥å£"></a>Retryå…¥å£</h4><p>Retryæ¥å£æ˜¯æä¾›é‡è¯•åŠŸèƒ½çš„å…¥å£ï¼Œä¸»è¦æä¾›äº†æ–¹æ³•æ¨¡ç‰ˆï¼Œå…·ä½“æ ¡éªŒç»“æ„ï¼Œå¤±è´¥åå¤„ç†ç”±Contextå­ç±»å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a retryable supplier.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> retry    the retry context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> supplier the original function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;      the type of results supplied by this supplier</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a retryable function</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">Supplier&lt;T&gt; <span class="title">decorateSupplier</span><span class="params">(Retry retry, Supplier&lt;T&gt; supplier)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">		Retry.Context&lt;T&gt; context = retry.context();</span><br><span class="line">		<span class="keyword">do</span> <span class="keyword">try</span> &#123;</span><br><span class="line">			T result = supplier.get();</span><br><span class="line">			<span class="keyword">final</span> <span class="keyword">boolean</span> validationOfResult = context.onResult(result);</span><br><span class="line">			<span class="keyword">if</span> (!validationOfResult) &#123;</span><br><span class="line">				context.onSuccess();</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (RuntimeException runtimeException) &#123;</span><br><span class="line">			context.onRuntimeError(runtimeException);</span><br><span class="line">		&#125; <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ‘˜æŠ„äº†ä¸€æ®µæ ¸å¿ƒä»£ç ï¼Œä½œç”¨æ˜¯å¾ªç¯ç›´åˆ°context.onResult(result)è¿”å›trueä¸ºæ­¢ï¼Œéœ€è¦ç•™æ„context.onResult/onRuntimeError/onErrorå¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œ onSuccessåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè¿™é‡Œæ¯æ¬¡è¿›å…¥é‡è¯•éƒ½æ˜¯ä¸€ä¸ªæ–°çš„contextå¯¹è±¡ã€‚</p>
<h4 id="Retry-ContextImpl"><a href="#Retry-ContextImpl" class="headerlink" title="Retry.ContextImpl"></a>Retry.ContextImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onResult</span><span class="params">(T result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != resultPredicate &amp;&amp; resultPredicate.test(result)) &#123;</span><br><span class="line">        <span class="keyword">int</span> currentNumOfAttempts = numOfAttempts.incrementAndGet();</span><br><span class="line">        <span class="keyword">if</span> (currentNumOfAttempts &gt;= maxAttempts) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            waitIntervalAfterFailure(currentNumOfAttempts, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRuntimeError</span><span class="params">(RuntimeException runtimeException)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (exceptionPredicate.test(runtimeException)) &#123;</span><br><span class="line">        lastRuntimeException.set(runtimeException);</span><br><span class="line">        throwOrSleepAfterRuntimeException();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        failedWithoutRetryCounter.increment();</span><br><span class="line">        publishRetryEvent(() -&gt; <span class="keyword">new</span> RetryOnIgnoredErrorEvent(getName(), runtimeException));</span><br><span class="line">        <span class="keyword">throw</span> runtimeException;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆå…³æ³¨onResultï¼Œå®ƒè´Ÿè´£åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­é‡è¯•ï¼Œå¦‚æœé€šè¿‡æ ¡éªŒæˆ–è€…é‡è¯•è¶…è¿‡æ­¤æ•°ï¼Œä¼šåœæ­¢é‡è¯•ã€‚</p>
<p>onRuntimeError/onError, è´Ÿè´£æŠŠcatchçš„å¼‚å¸¸å­˜å‚¨åœ¨lastRuntimeExceptionä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> currentNumOfAttempts = numOfAttempts.get();</span><br><span class="line">	<span class="keyword">if</span> (currentNumOfAttempts &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		succeededAfterRetryCounter.increment();</span><br><span class="line">		Throwable throwable = Option.of(lastException.get()).getOrElse(lastRuntimeException.get());</span><br><span class="line">		publishRetryEvent(() -&gt; <span class="keyword">new</span> RetryOnSuccessEvent(getName(), currentNumOfAttempts, throwable));</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		succeededWithoutRetryCounter.increment();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>onSuccessè´Ÿè´£ç»Ÿè®¡å’Œå‘é€äº‹ä»¶ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æ€»ä½“æ¥è¯´retryæ¯”è¾ƒç®€å•ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹æœ‰ä¸€ä¸ªå¦‚æœè®¾ç½®äº†ç»“æœæ ¡éªŒï¼Œå¦‚æœä¸€ç›´æ ¡éªŒä¸é€šè¿‡ï¼Œå°†è¿”å›æœªé€šè¿‡çš„ç»“æœï¼Œè€Œä¸æ˜¯è¿”å›å¤±è´¥ã€‚</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-04-04T02:00:00.000Z">2019-04-04</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Mybatis/">Mybatis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 515 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/04/2019-04-04-Mybatis ResultSetHandlerç»­/">[ç‰‡æ®µ] Mybatis ResultSetHandler å®è·µ-ç»­</a>
            
        </h1>
        <div class="content">
            <p>è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µã€‚</p>
<p>ä¸Šæ¬¡çš„å±€é™æ˜¯åªèƒ½æ‰¹é‡è§£å¯†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰åŠ å¯†å­—æ®µï¼Œå¯¹æ‰¹é‡æ•°æ®æ¥è¯´ç¨æ˜¾ä¸è¶³ï¼Œè¿™ä¸ªä¸»è¦æ”¹è¿›äº†è¿™ä¸€ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">handleResultSets</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  ErrorContext.instance().activity(<span class="string">"handling results"</span>).object(mappedStatement.getId());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">  ResultSetWrapper rsw = getFirstResultSet(stmt);</span><br><span class="line"></span><br><span class="line">  List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps();</span><br><span class="line">  <span class="keyword">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">  validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line">  <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">    ResultMap resultMap = resultMaps.get(resultSetCount);</span><br><span class="line">    handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">    rsw = getNextResultSet(stmt);</span><br><span class="line">    cleanUpAfterHandlingResultSet();</span><br><span class="line">    resultSetCount++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  String[] resultSets = mappedStatement.getResultSets();</span><br><span class="line">  <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">      ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]);</span><br><span class="line">      <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">        ResultMap resultMap = configuration.getResultMap(nestedResultMapId);</span><br><span class="line">        handleResultSet(rsw, resultMap, <span class="keyword">null</span>, parentMapping);</span><br><span class="line">      &#125;</span><br><span class="line">      rsw = getNextResultSet(stmt);</span><br><span class="line">      cleanUpAfterHandlingResultSet();</span><br><span class="line">      resultSetCount++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> collapseSingleResultList(multipleResults);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> app.pooi.common.encrypt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app.pooi.common.encrypt.anno.CipherSpi;</span><br><span class="line"><span class="keyword">import</span> app.pooi.common.encrypt.anno.Encrypted;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.resultset.ResultSetHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.SystemMetaObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">        <span class="meta">@Signature</span>(type = ResultSetHandler.class, method = <span class="string">"handleResultSets"</span>, args = &#123;Statement.class&#125;),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecryptInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(DecryptInterceptor.class.getName());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CipherSpi cipherSpi;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecryptInterceptor</span><span class="params">(CipherSpi cipherSpi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cipherSpi = cipherSpi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Object proceed = invocation.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (proceed == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;?&gt; results = (List&lt;?&gt;) proceed;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (results.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Object first = results.iterator().next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Class&lt;?&gt; modelClazz = first.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; decryptFields = getDecryptFields(modelClazz);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (decryptFields.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;List&lt;String&gt;&gt; secret = Flux.fromIterable(results)</span><br><span class="line">                .map(SystemMetaObject::forObject)</span><br><span class="line">                .flatMapIterable(mo -&gt; decryptFields.stream().map(mo::getValue).collect(Collectors.toList()))</span><br><span class="line">                .cast(String.class)</span><br><span class="line">                .buffer(<span class="number">1000</span>)</span><br><span class="line">                .collectList()</span><br><span class="line">                .block();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, String&gt; secretMap = secret.stream()</span><br><span class="line">                .map(secrets -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> cipherSpi.batchDecrypt(secrets);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        <span class="keyword">return</span> Maps.&lt;String, String&gt;newHashMap();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).reduce(Maps.newHashMap(), (m1, m2) -&gt; &#123;</span><br><span class="line">                    m1.putAll(m2);</span><br><span class="line">                    <span class="keyword">return</span> m1;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        secretMap.put(<span class="string">""</span>, <span class="string">"0"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object r : results) &#123;</span><br><span class="line">            <span class="keyword">final</span> MetaObject metaObject = SystemMetaObject.forObject(r);</span><br><span class="line">            decryptFields.forEach(f -&gt; metaObject.setValue(f, secretMap.get(metaObject.getValue(f))));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">getDecryptFields</span><span class="params">(Class&lt;?&gt; modelClazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(modelClazz.getDeclaredFields())</span><br><span class="line">                .filter(f -&gt; f.getAnnotation(Decrypted.class) != <span class="keyword">null</span>)</span><br><span class="line">                .filter(f -&gt; &#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isString = f.getType() == String.class;</span><br><span class="line">                    <span class="keyword">if</span> (!isString) &#123;</span><br><span class="line">                        logger.warning(f.getName() + <span class="string">"is not String, actual type is "</span> + f.getType().getSimpleName() + <span class="string">" ignored"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> isString;</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(Field::getName)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tuple2</span>&lt;<span class="title">T1</span>, <span class="title">T2</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T1 t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T2 t2;</span><br><span class="line"></span><br><span class="line">    Tuple2(T1 t1, T2 t2) &#123;</span><br><span class="line">        <span class="keyword">this</span>.t1 = t1;</span><br><span class="line">        <span class="keyword">this</span>.t2 = t2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T1, T2&gt; <span class="function">Tuple2&lt;T1, T2&gt; <span class="title">of</span><span class="params">(T1 t1, T2 t2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(t1, t2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-03-13T02:00:00.000Z">2019-03-13</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Mybatis/">Mybatis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 438 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/03/13/ã€ç‰‡æ®µã€‘SpringBoot Mybatisé…ç½®/">[ç‰‡æ®µ] SpringBoot Mybatisé…ç½®</a>
            
        </h1>
        <div class="content">
            <p>çº¯è®°å½•ï¼Œä¾›è‡ªå·±å‚è€ƒğŸ¤£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MybatisProperties properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Interceptor[] interceptors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceLoader resourceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DatabaseIdProvider databaseIdProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;ConfigurationCustomizer&gt; configurationCustomizers;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DataSourceConfig</span><span class="params">(MybatisProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                        ObjectProvider&lt;Interceptor[]&gt; interceptorsProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">                        ResourceLoader resourceLoader,</span></span></span><br><span class="line"><span class="function"><span class="params">                        ObjectProvider&lt;DatabaseIdProvider&gt; databaseIdProvider,</span></span></span><br><span class="line"><span class="function"><span class="params">                        ObjectProvider&lt;List&lt;ConfigurationCustomizer&gt;&gt; configurationCustomizersProvider)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    <span class="keyword">this</span>.interceptors = interceptorsProvider.getIfAvailable();</span><br><span class="line">    <span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">    <span class="keyword">this</span>.databaseIdProvider = databaseIdProvider.getIfAvailable();</span><br><span class="line">    <span class="keyword">this</span>.configurationCustomizers = configurationCustomizersProvider.getIfAvailable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ™®é€šæ•°æ®æº</span></span><br><span class="line"><span class="comment"> * ä¸»æ•°æ®æºï¼Œå¿…é¡»é…ç½®ï¼Œspringå¯åŠ¨æ—¶ä¼šæ‰§è¡Œåˆå§‹åŒ–æ•°æ®æ“ä½œï¼ˆæ— è®ºæ˜¯å¦çœŸçš„éœ€è¦ï¼‰ï¼Œé€‰æ‹©æŸ¥æ‰¾DataSource classç±»å‹çš„æ•°æ®æº</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> DataSource&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@Bean</span>(name = BEANNAME_DATASOURCE_COMMON)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"com.lianjia.confucius.bridge.boot.datasource.common"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSourceCommon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åªè¯»æ•°æ®æº</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@link</span> DataSource&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = BEANNAME_DATASOURCE_READONLY)</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"com.lianjia.confucius.bridge.boot.datasource.readonly"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSourceReadonly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> SqlSessionFactory <span class="title">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSessionFactoryBean factory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">    factory.setDataSource(dataSource);</span><br><span class="line">    factory.setVfs(SpringBootVFS.class);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.properties.getConfigLocation())) &#123;</span><br><span class="line">        factory.setConfigLocation(<span class="keyword">this</span>.resourceLoader.getResource(<span class="keyword">this</span>.properties.getConfigLocation()));</span><br><span class="line">    &#125;</span><br><span class="line">    org.apache.ibatis.session.Configuration configuration = <span class="keyword">this</span>.properties.getConfiguration();</span><br><span class="line">    <span class="keyword">if</span> (configuration == <span class="keyword">null</span> &amp;&amp; !StringUtils.hasText(<span class="keyword">this</span>.properties.getConfigLocation())) &#123;</span><br><span class="line">        configuration = <span class="keyword">new</span> org.apache.ibatis.session.Configuration();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (configuration != <span class="keyword">null</span> &amp;&amp; !CollectionUtils.isEmpty(<span class="keyword">this</span>.configurationCustomizers)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (ConfigurationCustomizer customizer : <span class="keyword">this</span>.configurationCustomizers) &#123;</span><br><span class="line">            customizer.customize(configuration);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    factory.setConfiguration(configuration);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.properties.getConfigurationProperties() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        factory.setConfigurationProperties(<span class="keyword">this</span>.properties.getConfigurationProperties());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="keyword">this</span>.interceptors)) &#123;</span><br><span class="line">        factory.setPlugins(<span class="keyword">this</span>.interceptors);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.databaseIdProvider != <span class="keyword">null</span>) &#123;</span><br><span class="line">        factory.setDatabaseIdProvider(<span class="keyword">this</span>.databaseIdProvider);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(<span class="keyword">this</span>.properties.getTypeAliasesPackage())) &#123;</span><br><span class="line">        factory.setTypeAliasesPackage(<span class="keyword">this</span>.properties.getTypeAliasesPackage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(<span class="keyword">this</span>.properties.getTypeHandlersPackage())) &#123;</span><br><span class="line">        factory.setTypeHandlersPackage(<span class="keyword">this</span>.properties.getTypeHandlersPackage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="keyword">this</span>.properties.resolveMapperLocations())) &#123;</span><br><span class="line">        factory.setMapperLocations(<span class="keyword">this</span>.properties.resolveMapperLocations());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> factory.getObject();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">sqlSessionTemplate</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">    ExecutorType executorType = <span class="keyword">this</span>.properties.getExecutorType();</span><br><span class="line">    <span class="keyword">if</span> (executorType != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory, executorType);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">primarySqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionFactory(<span class="keyword">this</span>.createDataSourceCommon());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">secondarySqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionFactory(<span class="keyword">this</span>.createDataSourceReadonly());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä¾‹æ™®é€šçš„ sqlSession</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> SqlSession</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception when any exception occured</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = BEANNAME_SQLSESSION_COMMON)</span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSession <span class="title">initSqlSessionCommon</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionTemplate(<span class="keyword">this</span>.primarySqlSessionFactory());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä¾‹åªè¯»çš„ sqlSession</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> SqlSession</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception when any exception occured</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = BEANNAME_SQLSESSION_READONLY)</span><br><span class="line"><span class="function"><span class="keyword">public</span> SqlSession <span class="title">initSqlSessionReadonly</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sqlSessionTemplate(<span class="keyword">this</span>.secondarySqlSessionFactory());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan</span>(annotationClass = PrimaryMapper.class,</span><br><span class="line">        sqlSessionTemplateRef = BEANNAME_SQLSESSION_COMMON,</span><br><span class="line">        basePackageClasses = ITalentApplicationSpringBootStart.class)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimaryMapperConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan</span>(annotationClass = SecondaryMapper.class,</span><br><span class="line">        sqlSessionTemplateRef = BEANNAME_SQLSESSION_READONLY,</span><br><span class="line">        basePackageClasses = ITalentApplicationSpringBootStart.class)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondaryMapperConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-03-11T09:57:57.000Z">2019-03-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/ä¸­é—´ä»¶/">ä¸­é—´ä»¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/ä¸­é—´ä»¶/æœç´¢å¼•æ“/">æœç´¢å¼•æ“</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 1336 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/03/11/[ç‰‡æ®µ]ä½¿ç”¨redisåˆ›å»ºç®€æ˜“æœç´¢å¼•æ“ï¼ˆæ ¸å¿ƒç¯‡ï¼‰/">[ç‰‡æ®µ] ä½¿ç”¨redisåˆ›å»ºç®€æ˜“æœç´¢å¼•æ“ï¼ˆæ ¸å¿ƒç¯‡ï¼‰</a>
            
        </h1>
        <div class="content">
            <p>æ”¯æŒandæŸ¥è¯¢ã€å¤šé€‰ã€å¤šå­—æ®µæ’åºåˆ†é¡µï¼Œç¼ºå°‘çš„åŠŸèƒ½ï¼šor æ¡ä»¶</p>
<p>æ ¸å¿ƒç±»ï¼Œæœ‰ä¸€äº›æµ‹è¯•ä»£ç ï¼Œå°†å°±ä¸€ä¸‹ã€‚å¦å¤–éœ€è¦spring-data-redis 2.0ç‰ˆæœ¬ä»¥ä¸Š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> app.pooi.redissearch.search;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app.pooi.redissearch.search.anno.CreateIndex;</span><br><span class="line"><span class="keyword">import</span> app.pooi.redissearch.search.anno.Field;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Sets;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ArrayUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisZSetCommands;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.hash.Jackson2HashMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> reactor.util.function.Tuple2;</span><br><span class="line"><span class="keyword">import</span> reactor.util.function.Tuples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> app.pooi.redissearch.search.SearchCore.Util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchCore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jackson2HashMapper hashMapper = <span class="keyword">new</span> Jackson2HashMapper(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line">        <span class="keyword">private</span> Long ctime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/person"</span>)</span><br><span class="line">    <span class="meta">@CreateIndex</span>(</span><br><span class="line">            index = <span class="string">"person"</span>,</span><br><span class="line">            documentId = <span class="string">"#p0.id"</span>,</span><br><span class="line">            fields = &#123;</span><br><span class="line">                    <span class="meta">@Field</span>(propertyName = <span class="string">"name"</span>, value = <span class="string">"#p0.name"</span>),</span><br><span class="line">                    <span class="meta">@Field</span>(propertyName = <span class="string">"age"</span>, value = <span class="string">"#p0.age"</span>, sort = <span class="keyword">true</span>),</span><br><span class="line">                    <span class="meta">@Field</span>(propertyName = <span class="string">"ctime"</span>, value = <span class="string">"#p0.ctime"</span>, sort = <span class="keyword">true</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">    <span class="function">Person <span class="title">addPerson</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SearchCore</span><span class="params">(StringRedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexMeta</span><span class="params">(String index, Map&lt;String, FieldMeta&gt; fieldMeta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForHash().putAll(genIdxMetaName(index), hashMapper.toHash(fieldMeta));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexDocument</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String index,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String field,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String documentId,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String document)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.indexDocument(index, field, documentId, document, doc -&gt; Lists.newArrayList(doc.split(<span class="string">""</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexDocument</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String index,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String field,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String documentId,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String document,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> Function&lt;String, List&lt;String&gt;&gt; tokenizer)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; tokens = tokenizer != <span class="keyword">null</span> ?</span><br><span class="line">                tokenizer.apply(document) :</span><br><span class="line">                Collections.singletonList(document);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String docKey = genDocIdxName(index, documentId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;Object&gt; results = redisTemplate.executePipelined(<span class="keyword">new</span> SessionCallback&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> StringRedisTemplate template = (StringRedisTemplate) operations;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> String[] idxs = tokens.stream()</span><br><span class="line">                        .map(word -&gt; genIdxName(index, field, word))</span><br><span class="line">                        .peek(idx -&gt; ((StringRedisTemplate) operations).opsForSet().add(idx, documentId))</span><br><span class="line">                        .toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">                template.opsForSet().add(docKey, idxs);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> results.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexSortField</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String index,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String field,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> String documentId,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> Double document)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String docKey = genDocIdxName(index, documentId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;Object&gt; results = redisTemplate.executePipelined(<span class="keyword">new</span> SessionCallback&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> StringRedisTemplate template = (StringRedisTemplate) operations;</span><br><span class="line">                <span class="keyword">final</span> String idxName = genSortIdxName(index, field);</span><br><span class="line">                template.opsForZSet().add(idxName, documentId, document);</span><br><span class="line">                template.opsForSet().add(docKey, idxName);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> results.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDocumentIndex</span><span class="params">(<span class="keyword">final</span> String index, <span class="keyword">final</span> String documentId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String docKey = genDocIdxName(index, documentId);</span><br><span class="line">        <span class="keyword">final</span> Boolean hasKey = redisTemplate.hasKey(docKey);</span><br><span class="line">        <span class="keyword">if</span> (!hasKey) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;Object&gt; results = redisTemplate.executePipelined(<span class="keyword">new</span> SessionCallback&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> Set&lt;String&gt; idx = redisTemplate.opsForSet().members(docKey);</span><br><span class="line">                ((StringRedisTemplate) operations).delete(idx);</span><br><span class="line">                ((StringRedisTemplate) operations).delete(docKey);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> results.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PatchMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDocumentIndex</span><span class="params">(<span class="keyword">final</span> String index, <span class="keyword">final</span> String field, <span class="keyword">final</span> String documentId, <span class="keyword">final</span> String document)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deleteDocumentIndex(index, documentId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.indexDocument(index, field, documentId, document);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateSortField</span><span class="params">(<span class="keyword">final</span> String index, <span class="keyword">final</span> String field, <span class="keyword">final</span> String documentId, <span class="keyword">final</span> Double document)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deleteDocumentIndex(index, documentId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.indexSortField(index, field, documentId, document);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Consumer&lt;SetOperations&lt;String, String&gt;&gt; operateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"intersectAndStore"</span>:</span><br><span class="line">                <span class="keyword">return</span> (so) -&gt; so.intersectAndStore(key, keys, destKey);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"unionAndStore"</span>:</span><br><span class="line">                <span class="keyword">return</span> (so) -&gt; so.unionAndStore(key, keys, destKey);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"differenceAndStore"</span>:</span><br><span class="line">                <span class="keyword">return</span> (so) -&gt; so.differenceAndStore(key, keys, destKey);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> so -&gt; &#123;</span><br><span class="line">                &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Consumer&lt;ZSetOperations&lt;String, String&gt;&gt; zOperateAndStore(String method, String key, Collection&lt;String&gt; keys, String destKey, <span class="keyword">final</span> RedisZSetCommands.Weights weights) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"intersectAndStore"</span>:</span><br><span class="line">                <span class="keyword">return</span> (so) -&gt; so.intersectAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"unionAndStore"</span>:</span><br><span class="line">                <span class="keyword">return</span> (so) -&gt; so.unionAndStore(key, keys, destKey, RedisZSetCommands.Aggregate.SUM, weights);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> so -&gt; &#123;</span><br><span class="line">                &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">common</span><span class="params">(String index, String method, List&lt;String&gt; keys, <span class="keyword">long</span> ttl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String destKey = Util.genQueryIdxName(index);</span><br><span class="line"></span><br><span class="line">        redisTemplate.executePipelined(<span class="keyword">new</span> SessionCallback&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> &lt;K, V&gt; <span class="function">String <span class="title">execute</span><span class="params">(RedisOperations&lt;K, V&gt; operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                operateAndStore(method,</span><br><span class="line">                        keys.stream().limit(<span class="number">1L</span>).findFirst().get(),</span><br><span class="line">                        keys.stream().skip(<span class="number">1L</span>).collect(Collectors.toList()),</span><br><span class="line">                        destKey)</span><br><span class="line">                        .accept(((StringRedisTemplate) operations).opsForSet());</span><br><span class="line">                ((StringRedisTemplate) operations).expire(destKey, ttl, TimeUnit.SECONDS);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> destKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intersect</span><span class="params">(String index, List&lt;String&gt; keys, <span class="keyword">long</span> ttl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> common(index, <span class="string">"intersectAndStore"</span>, keys, ttl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">union</span><span class="params">(String index, List&lt;String&gt; keys, <span class="keyword">long</span> ttl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> common(index, <span class="string">"unionAndStore"</span>, keys, ttl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">diff</span><span class="params">(String index, List&lt;String&gt; keys, <span class="keyword">long</span> ttl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> common(index, <span class="string">"differenceAndStore"</span>, keys, ttl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parse(String query) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Pattern pattern = Pattern.compile(<span class="string">"[+-]?([\\w\\d]+):(\\S+)"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Matcher matcher = pattern.matcher(query);</span><br><span class="line"></span><br><span class="line">        Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = Sets.newHashSet();</span><br><span class="line">        Set&lt;Tuple2&lt;String, String&gt;&gt; want = Sets.newHashSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            String word = matcher.group();</span><br><span class="line"></span><br><span class="line">            String prefix = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (word.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                prefix = word.substring(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> Tuple2&lt;String, String&gt; t = Tuples.of(matcher.group(<span class="number">1</span>), matcher.group(<span class="number">2</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"-"</span>.equals(prefix)) &#123;</span><br><span class="line">                unwant.add(t);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                want.add(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Tuples.of(want, unwant);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            String index,</span></span></span><br><span class="line"><span class="function"><span class="params">            String query)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Tuple2&lt;Set&lt;Tuple2&lt;String, String&gt;&gt;, Set&lt;Tuple2&lt;String, String&gt;&gt;&gt; parseResult = parse(query);</span><br><span class="line">        <span class="keyword">final</span> Set&lt;Tuple2&lt;String, String&gt;&gt; want = parseResult.getT1();</span><br><span class="line">        <span class="keyword">final</span> Set&lt;Tuple2&lt;String, String&gt;&gt; unwant = parseResult.getT2();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (want.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, FieldMeta&gt; entries = (Map&lt;String, FieldMeta&gt;) hashMapper.fromHash(redisTemplate.&lt;String, Object&gt;opsForHash().entries(genIdxMetaName(index)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// union</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;Tuple2&lt;String, String&gt;&gt; unionFields = want.stream()</span><br><span class="line">                .filter(w -&gt; w.getT2().contains(<span class="string">","</span>))</span><br><span class="line">                .filter(w -&gt; <span class="string">"true"</span>.equals(entries.get(w.getT1()).getSort()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; unionIdx = unionFields.stream()</span><br><span class="line">                .flatMap(w -&gt; Arrays.stream(w.getT2().split(<span class="string">","</span>)).map(value -&gt; Tuples.of(w.getT1(), value)))</span><br><span class="line">                .map(w -&gt; genIdxName(index, w.getT1(), w.getT2()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String unionResultId = unionIdx.isEmpty() ? <span class="string">""</span> : <span class="keyword">this</span>.union(index, unionIdx, <span class="number">30L</span>);</span><br><span class="line"></span><br><span class="line">        want.removeAll(unionFields);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// intersect</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; intersectIdx = want.stream()</span><br><span class="line">                .flatMap(t -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"true"</span>.equals(entries.get(t.getT1()).getSort()))</span><br><span class="line">                        <span class="keyword">return</span> Stream.of(t);</span><br><span class="line">                    <span class="keyword">return</span> Arrays.stream(t.getT2().split(<span class="string">""</span>)).map(value -&gt; Tuples.of(t.getT1(), value));</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(w -&gt; genIdxName(index, w.getT1(), w.getT2()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!unionResultId.isEmpty())</span><br><span class="line">            intersectIdx.add(unionResultId);</span><br><span class="line"></span><br><span class="line">        String intersectResult = <span class="keyword">this</span>.intersect(index, intersectIdx, <span class="number">30L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// diff</span></span><br><span class="line">        <span class="keyword">return</span> unwant.isEmpty() ?</span><br><span class="line">                intersectResult :</span><br><span class="line">                <span class="keyword">this</span>.diff(index, Stream.concat(Stream.of(intersectResult), unwant.stream().map(w -&gt; genIdxName(index, w.getT1(), w.getT2()))).collect(Collectors.toList()), <span class="number">30L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/query/&#123;index&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">queryAndSort</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @PathVariable(<span class="string">"index"</span>)</span> String index,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(<span class="string">"param"</span>)</span> String query,</span></span><br><span class="line"><span class="function">            @<span class="title">RequestParam</span><span class="params">(<span class="string">"sort"</span>)</span> String sort,</span></span><br><span class="line"><span class="function">            Integer start,</span></span><br><span class="line"><span class="function">            Integer stop</span></span><br><span class="line"><span class="function">    ) </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String[] sorts = sort.split(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Integer&gt; map = Arrays.stream(sorts).collect(</span><br><span class="line">                Collectors.toMap(f -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (f.startsWith(<span class="string">"+"</span>) || f.startsWith(<span class="string">"-"</span>)) &#123;</span><br><span class="line">                        f = f.substring(<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> genSortIdxName(<span class="string">"person"</span>, f);</span><br><span class="line">                &#125;, field -&gt; field.startsWith(<span class="string">"-"</span>) ? -<span class="number">1</span> : <span class="number">1</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span>[] weights = map.values()</span><br><span class="line">                .stream()</span><br><span class="line">                .mapToInt(Integer::intValue)</span><br><span class="line">                .toArray();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        if (!sort.startsWith("+") &amp;&amp; !sort.startsWith("-")) &#123;</span></span><br><span class="line"><span class="comment">//            sort = "+" + sort;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        boolean desc = sort.startsWith("-");</span></span><br><span class="line"><span class="comment">//        sort = sort.substring(1);</span></span><br><span class="line"></span><br><span class="line">        String queryId = <span class="keyword">this</span>.query(index, query);</span><br><span class="line">        Long size;</span><br><span class="line">        <span class="keyword">if</span> (queryId.length() == <span class="number">0</span> || (size = redisTemplate.opsForSet().size(queryId)) == <span class="keyword">null</span> || size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptySet();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String resultId = genQueryIdxName(index);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        String sortField = sort;</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.executePipelined(<span class="keyword">new</span> SessionCallback&lt;Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Object <span class="title">execute</span><span class="params">(RedisOperations&lt;K, V&gt; operations)</span> <span class="keyword">throws</span> DataAccessException </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> StringRedisTemplate template = (StringRedisTemplate) operations;</span><br><span class="line"></span><br><span class="line"><span class="comment">//                template.opsForZSet().intersectAndStore(genSortIdxName(index, sortField), queryId, resultId);</span></span><br><span class="line"></span><br><span class="line">                SearchCore.<span class="keyword">this</span>.zOperateAndStore(<span class="string">"intersectAndStore"</span>,</span><br><span class="line">                        map.keySet().stream().limit(<span class="number">1L</span>).findFirst().get(),</span><br><span class="line">                        Stream.concat(map.keySet().stream().skip(<span class="number">1L</span>), Stream.of(queryId)).collect(Collectors.toList()),</span><br><span class="line">                        resultId, RedisZSetCommands.Weights.of(ArrayUtils.add(weights, <span class="number">0</span>))).accept(template.opsForZSet());</span><br><span class="line"></span><br><span class="line"><span class="comment">//                template.opsForZSet().size(resultId);</span></span><br><span class="line">                template.expire(resultId, <span class="number">30L</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// sort</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForZSet().range(resultId, start, stop);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Util</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Util</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> String <span class="title">genIdxMetaName</span><span class="params">(String index)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">"meta:idx:%s"</span>, index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> String <span class="title">genIdxName</span><span class="params">(String index, String field, String value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">"idx:%s:%s:%s"</span>, index, field, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> String <span class="title">genSortIdxName</span><span class="params">(String index, String field)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">"idx:%s:%s"</span>, index, field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> String <span class="title">genQueryIdxName</span><span class="params">(String index)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">"idx:%s:q:%s"</span>, index, UUID.randomUUID().toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> String <span class="title">genDocIdxName</span><span class="params">(String index, String documentId)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">"doc:%s:%s"</span>, index, documentId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾…åŠ©ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldMeta</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sort = <span class="string">"false"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String splitFun = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FieldMeta</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FieldMeta</span><span class="params">(<span class="keyword">boolean</span> sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = Boolean.toString(sort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åšä¸€ä¸ªè½»é‡çº§çš„æœç´¢è¿˜æ˜¯å¯ä»¥çš„ã€‚</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-02-26T02:00:00.000Z">2019-02-26</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JavaåŸºç¡€/">JavaåŸºç¡€</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 197 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/02/26/2019-02-26-java-genic-type/">[ç‰‡æ®µ]ä½¿ç”¨TypeTokenåœ¨è¿è¡ŒæœŸä¿å­˜æ³›å‹ä¿¡æ¯</a>
            
        </h1>
        <div class="content">
            <p>ä¸€èˆ¬æ¥è¯´å¯ä»¥ä½¿ç”¨getGenericSuperclass è·å–å­ç±»èŒƒå‹ä¿¡æ¯ï¼Œä½†æ˜¯æ³›å‹æœ‰åµŒå¥—çš„è¯æƒ³è·å–å®Œæ•´ä¿¡æ¯è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ã€‚ä¾‹å¦‚ï¼šMessage&lt;List<T>&gt; æœ‰ä¸¤ä¸ªæ³›å‹ä¿¡æ¯ã€‚</p>
<p>guavaä¸­æœ‰å¼ºå¤§çš„TypeTokenå¸®åŠ©ä½ ä¿å­˜å¤æ‚æ³›å‹ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ParameterizedTypeReference&lt;Message&lt;T&gt;&gt; responseTypeRef = </span><br><span class="line">	ParameterizedTypeReferenceBuilder.fromTypeToken(</span><br><span class="line">        <span class="keyword">new</span> TypeToken&lt;Message&lt;T&gt;&gt;() &#123;&#125;.where(<span class="keyword">new</span> TypeParameter&lt;T&gt;() &#123;&#125;, <span class="keyword">new</span> TypeToken&lt;List&lt;OrgSugVOV1&gt;&gt;() &#123;&#125;));</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦åœ¨springæ¡†æ¶ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä¸€ä¸ªé€‚é…å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParameterizedTypeReferenceBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ParameterizedTypeReference&lt;T&gt; <span class="title">fromTypeToken</span><span class="params">(TypeToken&lt;T&gt; typeToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TypeTokenParameterizedTypeReference&lt;&gt;(typeToken);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeTokenParameterizedTypeReference</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">ParameterizedTypeReference</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Type type;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">TypeTokenParameterizedTypeReference</span><span class="params">(TypeToken&lt;T&gt; typeToken)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.type = typeToken.getType();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Type <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> type;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">this</span> == obj || (obj <span class="keyword">instanceof</span> ParameterizedTypeReference &amp;&amp;</span><br><span class="line">                    <span class="keyword">this</span>.type.equals(((ParameterizedTypeReference&lt;?&gt;) obj).getType())));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.type.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ParameterizedTypeReference&lt;"</span> + <span class="keyword">this</span>.type + <span class="string">"&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³äºjavaçš„æ³›å‹æˆ‘å°±ä¸å¤šåšåæ§½äº†ã€‚</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-02-11T02:00:00.000Z">2019-02-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Mybatis/">Mybatis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 227 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/02/11/ã€ç‰‡æ®µã€‘@CreatedBy  @ModifiedBy/">[ç‰‡æ®µ] @CreatedBy / @ModifiedBy æ‹¦æˆªå™¨å®ç°</a>
            
        </h1>
        <div class="content">
            <p>æ‹¦æˆªå™¨å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> app.pooi.common.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app.pooi.common.entity.anno.CreatedBy;</span><br><span class="line"><span class="keyword">import</span> app.pooi.common.entity.anno.ModifiedBy;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.Executor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Intercepts;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Plugin;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.Signature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">        <span class="meta">@Signature</span>(type = Executor.class, method = <span class="string">"update"</span>, args = &#123;MappedStatement.class, Object.class&#125;),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EntityInterceptor</span> <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">ibatis</span>.<span class="title">plugin</span>.<span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Supplier&lt;Long&gt; auditorAware;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Executor executor = (Executor) invocation.getTarget();</span><br><span class="line"></span><br><span class="line">        MappedStatement ms = (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        Object o = invocation.getArgs()[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        Arrays.stream(o.getClass().getDeclaredFields())</span><br><span class="line">                .forEach(field -&gt; &#123;</span><br><span class="line">                    <span class="keyword">final</span> CreatedBy createdBy = field.getAnnotation(CreatedBy.class);</span><br><span class="line">                    <span class="keyword">final</span> ModifiedBy modifiedBy = field.getAnnotation(ModifiedBy.class);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (createdBy != <span class="keyword">null</span> || modifiedBy != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            field.set(o, auditorAware.get());</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalAccessException ignore) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> invocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisInterceptorConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Interceptor[] configurationCustomizer(CipherSpi cipherSpi) &#123;</span><br><span class="line">        <span class="keyword">final</span> EntityInterceptor entityInterceptor = <span class="keyword">new</span> EntityInterceptor();</span><br><span class="line"></span><br><span class="line">        entityInterceptor.setAuditorAware(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">final</span> String header = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getHeader(XHeaders.LOGIN_USER_ID);</span><br><span class="line">            <span class="keyword">return</span> Long.valueOf(header);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Interceptor[]&#123;<span class="keyword">new</span> DecryptInterceptor(cipherSpi), entityInterceptor&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-22T02:00:00.000Z">2019-01-22</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Spring/">Spring</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 215 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/22/2019-01-22-Spring_aop_argument_collector/">[ç‰‡æ®µ] Javaæ”¶é›†æ–¹æ³•å‚æ•°+Spring DataBinder</a>
            
        </h1>
        <div class="content">
            <h4 id="æ”¶é›†å‚æ•°"><a href="#æ”¶é›†å‚æ•°" class="headerlink" title="æ”¶é›†å‚æ•°"></a>æ”¶é›†å‚æ•°</h4><p>ç›®å‰æ˜¯ä½¿ç”¨äº†spring aop æ¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼ŒæŠŠæ–¹æ³•å‚æ•°åŒ…è£…æˆMapå½¢å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CollectArguments &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArgumentsCollector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Map&lt;String, Object&gt;&gt; ARGUMENTS = ThreadLocal.withInitial(ImmutableMap::of);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">getArgs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ARGUMENTS.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] args(Object[] args, <span class="keyword">int</span> exceptLength) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exceptLength == args.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> args;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(args, exceptLength);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"@annotation(CollectArguments)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">collectArgumentsAnnotationPointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"collectArgumentsAnnotationPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String[] parameterNames = ((MethodSignature) joinPoint.getSignature()).getParameterNames();</span><br><span class="line">        <span class="keyword">final</span> Object[] args = args(joinPoint.getArgs(), parameterNames.length);</span><br><span class="line"></span><br><span class="line">        ARGUMENTS.set(Collections.unmodifiableMap((IntStream.range(<span class="number">0</span>, parameterNames.length - <span class="number">1</span>)</span><br><span class="line">                .mapToObj(idx -&gt; Tuple2.of(parameterNames[idx], args[idx]))</span><br><span class="line">                .collect(HashMap::<span class="keyword">new</span>, (m, t) -&gt; m.put(t.getT1(), t.getT2()), HashMap::putAll))));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"collectArgumentsAnnotationPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ARGUMENTS.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple2</span>&lt;<span class="title">T1</span>, <span class="title">T2</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> T1 t1;</span><br><span class="line">        <span class="keyword">private</span> T2 t2;</span><br><span class="line"></span><br><span class="line">        Tuple2(T1 t1, T2 t2) &#123;</span><br><span class="line">            <span class="keyword">this</span>.t1 = t1;</span><br><span class="line">            <span class="keyword">this</span>.t2 = t2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;T1, T2&gt; <span class="function">Tuple2&lt;T1, T2&gt; <span class="title">of</span><span class="params">(T1 t1, T2 t2)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(t1, t2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é€šè¿‡Mapæ„é€ å¯¹è±¡"><a href="#é€šè¿‡Mapæ„é€ å¯¹è±¡" class="headerlink" title="é€šè¿‡Mapæ„é€ å¯¹è±¡"></a>é€šè¿‡Mapæ„é€ å¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinderUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    BinderUtil() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getTarget</span><span class="params">(Class&lt;T&gt; beanClazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> DataBinder binder = <span class="keyword">new</span> DataBinder(BeanUtils.instantiate(beanClazz));</span><br><span class="line">        binder.bind(<span class="keyword">new</span> MutablePropertyValues(ArgumentsCollector.getArgs()));</span><br><span class="line">        <span class="keyword">return</span> (T) binder.getTarget();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-01-09T02:00:00.000Z">2019-01-09</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Mybatis/">Mybatis</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 497 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/01/09/2019-01-09-Mybatis ResultSetHandler/">[ç‰‡æ®µ] Mybatis ResultSetHandler å®è·µ</a>
            
        </h1>
        <div class="content">
            <p>è¿™æ¬¡æ‹¦æˆªçš„æ–¹æ³•æ˜¯handleResultSets(Statement stmt)ï¼Œç”¨æ¥æ‰¹é‡è§£å¯†ç”¨@Encryptedæ³¨è§£çš„Stringå­—æ®µï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">handleResultSets</span><span class="params">(Statement stmt)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  ErrorContext.instance().activity(<span class="string">"handling results"</span>).object(mappedStatement.getId());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> List&lt;Object&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">  ResultSetWrapper rsw = getFirstResultSet(stmt);</span><br><span class="line"></span><br><span class="line">  List&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps();</span><br><span class="line">  <span class="keyword">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">  validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line">  <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">    ResultMap resultMap = resultMaps.get(resultSetCount);</span><br><span class="line">    handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">    rsw = getNextResultSet(stmt);</span><br><span class="line">    cleanUpAfterHandlingResultSet();</span><br><span class="line">    resultSetCount++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  String[] resultSets = mappedStatement.getResultSets();</span><br><span class="line">  <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">      ResultMapping parentMapping = nextResultMaps.get(resultSets[resultSetCount]);</span><br><span class="line">      <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">        String nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">        ResultMap resultMap = configuration.getResultMap(nestedResultMapId);</span><br><span class="line">        handleResultSet(rsw, resultMap, <span class="keyword">null</span>, parentMapping);</span><br><span class="line">      &#125;</span><br><span class="line">      rsw = getNextResultSet(stmt);</span><br><span class="line">      cleanUpAfterHandlingResultSet();</span><br><span class="line">      resultSetCount++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> collapseSingleResultList(multipleResults);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> app.pooi.common.encrypt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> app.pooi.common.encrypt.anno.CipherSpi;</span><br><span class="line"><span class="keyword">import</span> app.pooi.common.encrypt.anno.Encrypted;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.resultset.ResultSetHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.SystemMetaObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts</span>(&#123;</span><br><span class="line">        <span class="meta">@Signature</span>(type = ResultSetHandler.class, method = <span class="string">"handleResultSets"</span>, args = &#123;Statement.class&#125;),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncryptInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(EncryptInterceptor.class.getName());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CipherSpi cipherSpi;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EncryptInterceptor</span><span class="params">(CipherSpi cipherSpi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cipherSpi = cipherSpi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Object proceed = invocation.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (proceed == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;?&gt; results = (List&lt;?&gt;) proceed;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (results.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> proceed;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Object first = results.iterator().next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Class&lt;?&gt; modelClazz = first.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; fieldsNeedDecrypt = Arrays.stream(modelClazz.getDeclaredFields())</span><br><span class="line">                .filter(f -&gt; f.getAnnotation(Encrypted.class) != <span class="keyword">null</span>)</span><br><span class="line">                .filter(f -&gt; &#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isString = f.getType() == String.class;</span><br><span class="line">                    <span class="keyword">if</span> (!isString) &#123;</span><br><span class="line">                        logger.warning(f.getName() + <span class="string">"is not String, actual type is "</span> + f.getType().getSimpleName() + <span class="string">" ignored"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> isString;</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(Field::getName)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> List&lt;List&lt;String&gt;&gt; partition = partition(fieldsNeedDecrypt, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object r : results) &#123;</span><br><span class="line">            <span class="keyword">final</span> MetaObject metaObject = SystemMetaObject.forObject(r);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (List&lt;String&gt; fields : partition) &#123;</span><br><span class="line">                <span class="keyword">final</span> Map&lt;String, String&gt; fieldValueMap = fields.stream().collect(Collectors.toMap(Function.identity(), f -&gt; (String) metaObject.getValue(f)));</span><br><span class="line">                <span class="keyword">final</span> ArrayList&lt;String&gt; values = <span class="keyword">new</span> ArrayList&lt;&gt;(fieldValueMap.values());</span><br><span class="line">                Map&lt;String, String&gt; decryptValues = cipherSpi.decrypt(values);</span><br><span class="line"></span><br><span class="line">                fieldValueMap.entrySet()</span><br><span class="line">                        .stream()</span><br><span class="line">                        .map(e -&gt; Tuple2.of(e.getKey(), decryptValues.getOrDefault(e.getValue(), <span class="string">""</span>)))</span><br><span class="line">                        .forEach(e -&gt; metaObject.setValue(e.getT1(), e.getT2()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; List&lt;List&lt;T&gt;&gt; partition(List&lt;T&gt; list, <span class="keyword">int</span> batchCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(batchCount &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"batch count must greater than zero"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;List&lt;T&gt;&gt; partitionList = <span class="keyword">new</span> ArrayList&lt;&gt;(list.size() / (batchCount + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i += batchCount) &#123;</span><br><span class="line">            partitionList.add(list.stream().skip(i).limit(batchCount).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> partitionList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tuple2</span>&lt;<span class="title">T1</span>, <span class="title">T2</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T1 t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T2 t2;</span><br><span class="line"></span><br><span class="line">    Tuple2(T1 t1, T2 t2) &#123;</span><br><span class="line">        <span class="keyword">this</span>.t1 = t1;</span><br><span class="line">        <span class="keyword">this</span>.t2 = t2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &lt;T1, T2&gt; <span class="function">Tuple2&lt;T1, T2&gt; <span class="title">of</span><span class="params">(T1 t1, T2 t2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(t1, t2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-12-27T02:00:00.000Z">2018-12-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/è¯»ä¹¦/">è¯»ä¹¦</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 484 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/12/27/2018-12-27-softablity/">ä»£ç å¤–çš„ç”Ÿå­˜ä¹‹é“-è¯»ä¹¦ç¬”è®°-èŒä¸šç¯‡</a>
            
        </h1>
        <div class="content">
            <p>èŒä¸šå‘å±•çš„é©±åŠ¨åŠ›åº”è¯¥æ¥è‡ªè‡ªèº«ï¼Œå·¥ä½œå±äºå…¬å¸ï¼ŒèŒä¸šç”Ÿæ¶¯å±äºè‡ªå·±ã€‚</p>
<h3 id="ç¬¬ä¸€è¦åŠ¡-æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€"><a href="#ç¬¬ä¸€è¦åŠ¡-æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€" class="headerlink" title="ç¬¬ä¸€è¦åŠ¡ æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€"></a>ç¬¬ä¸€è¦åŠ¡ æ‹¥æœ‰æ­£ç¡®çš„å¿ƒæ€</h3><p>å¤§å¤šæ•°äººå½¢æˆçš„é”™è¯¯çš„å¿ƒæ€: è®¤ä¸ºåœ¨ä¸ºå…¬å¸æ‰“å·¥ï¼Œæ²¡æœ‰æŠŠè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å½“ä½œç”Ÿæ„æ¥çœ‹å¾…ã€‚é“­è®°åœ¨å¿ƒï¼Œå¼€å§‹ç§¯æä¸»åŠ¨çš„ç®¡ç†è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯å§ã€‚</p>
<h5 id="åƒä¼ä¸šä¸€æ ·æ€è€ƒ"><a href="#åƒä¼ä¸šä¸€æ ·æ€è€ƒ" class="headerlink" title="åƒä¼ä¸šä¸€æ ·æ€è€ƒ"></a>åƒä¼ä¸šä¸€æ ·æ€è€ƒ</h5><p>è‡ªå·±èƒ½æä¾›ä»€ä¹ˆ:è‡ªå·±çš„èƒ½åŠ›å°±æ˜¯åˆ›é€ è½¯ä»¶<br>è‡ªå·±éœ€è¦åšä»€ä¹ˆ: </p>
<ul>
<li><p>æŒç»­ä¸æ–­åœ°æ”¹è¿›å’Œå®Œå–„è‡ªå·±çš„äº§å“</p>
</li>
<li><p>ä¼ è¾¾è‡ªå·±çš„ä»·å€¼ï¼Œå’Œåƒä¸‡åŒè¡Œçš„ç‹¬ç‰¹ä¹‹å¤„</p>
</li>
</ul>
<p>ä¸€å¤´æ‰è¿›å·¥ä½œä¸å¯èƒ½éåŒå‡¡å“ï¼Œä½ åº”è¯¥ï¼š</p>
<ul>
<li>ä¸“æ³¨äºä½ æ­£åœ¨æä¾›æ€æ ·çš„æœåŠ¡ï¼Œ ä»¥åŠå¦‚ä½•è¥é”€è¿™é¡¹æœåŠ¡ï¼›</li>
<li>æƒ³æ–¹è®¾ æå‡ä½ çš„æœåŠ¡ï¼›</li>
<li>æ€è€ƒä½ å¯ä»¥ä¸“æ³¨ä¸ºå“ªä¸€ ç‰¹å®šç±»å‹çš„å®¢æˆ·æˆ–è¡Œä¸šæä¾›ç‰¹å®šçš„æœåŠ¡ï¼›</li>
<li>é›†ä¸­ç²¾åŠ›æˆä¸ºä¸€ä½ä¸“å®¶ï¼Œä¸“é—¨ä¸ºæŸä¸€ç‰¹å®šç±»å‹çš„å®¢æˆ·æä¾›ä¸“ä¸šçš„æ•´ä½“æœåŠ¡ï¼ˆ è®°ä½ï¼Œ ä½œä¸ºä¸€ä¸ªè½¯ä»¶å¼€å‘ äººå‘˜ï¼Œ ä½  åªæœ‰çœŸæ­£ä¸“æ³¨ äºä¸€ç±»å®¢æˆ·ï¼Œæ‰èƒ½æ‰¾åˆ°éå¸¸å¥½çš„å·¥ä½œï¼‰ã€‚</li>
<li>æ›´å¥½çš„å®£ä¼ è‡ªå·±çš„äº§å“ï¼Œæ›´å¥½çš„æ‰¾åˆ°ä½ çš„å®¢æˆ·</li>
</ul>
<h3 id="ç¬¬äºŒè¦åŠ¡-è®¾å®šè‡ªå·±çš„ç›®æ ‡"><a href="#ç¬¬äºŒè¦åŠ¡-è®¾å®šè‡ªå·±çš„ç›®æ ‡" class="headerlink" title="ç¬¬äºŒè¦åŠ¡ è®¾å®šè‡ªå·±çš„ç›®æ ‡"></a>ç¬¬äºŒè¦åŠ¡ è®¾å®šè‡ªå·±çš„ç›®æ ‡</h3><p>æ— è®ºå› ä¸ºä½•ç§åŸå› ä½ æ²¡æœ‰ä¸ºè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯è®¾å®šç›®æ ‡ï¼Œ ç°åœ¨éƒ½æ˜¯æ—¶å€™è®¾å®šç›®æ ‡äº†ã€‚ ä¸æ˜¯æ˜å¤©ï¼Œ ä¹Ÿä¸æ˜¯ä¸‹å‘¨ï¼Œ å°±æ˜¯ç°åœ¨ã€‚ æ²¡æœ‰æ˜ç¡®çš„æ–¹å‘ï¼Œ ä½ èµ°çš„æ¯ä¸€æ­¥éƒ½æ˜¯å¾’åŠ³çš„ã€‚</p>
<h5 id="å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿ"><a href="#å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿ"></a>å¦‚ä½•è®¾å®šç›®æ ‡ï¼Ÿ</h5><p>å…ˆåœ¨å¿ƒä¸­æ ‘ç«‹ä¸€ä¸ªå¤§ç›®æ ‡ï¼Œç„¶ååˆ†è§£æˆå¤šä¸ªå°ç›®æ ‡</p>
<h5 id="è¿½è¸ªä½ çš„ç›®æ ‡"><a href="#è¿½è¸ªä½ çš„ç›®æ ‡" class="headerlink" title="è¿½è¸ªä½ çš„ç›®æ ‡"></a>è¿½è¸ªä½ çš„ç›®æ ‡</h5><p>å®šæœŸæ ¸å¯¹è‡ªå·±çš„ç›®æ ‡ï¼Œå¿…è¦æ—¶è¿˜è¦è°ƒæ•´ã€‚</p>
<h3 id="äººé™…äº¤å¾€èƒ½åŠ›"><a href="#äººé™…äº¤å¾€èƒ½åŠ›" class="headerlink" title="äººé™…äº¤å¾€èƒ½åŠ›"></a>äººé™…äº¤å¾€èƒ½åŠ›</h3>
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-11-19T02:00:00.000Z">2018-11-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/è¯»ä¹¦/">è¯»ä¹¦</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    13 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 1895 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/11/19/Distributed architecture concepts I learned while building a large payments system/">æ„å»ºå¤§å‹æ”¯ä»˜ç³»ç»Ÿæ—¶åˆ†å¸ƒå¼æ¶æ„çš„å…³é”®ç‚¹</a>
            
        </h1>
        <div class="content">
            <h2 id="SLA"><a href="#SLA" class="headerlink" title="SLA"></a>SLA</h2><p>åœ¨æ„å»ºå¤§å‹ç³»ç»Ÿæ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°å„ç§é”™è¯¯ã€‚åœ¨è®¡åˆ’æ„å»ºä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œå®šä¹‰ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ååˆ†é‡è¦ã€‚</p>
<p>â€œå¥åº·çŠ¶æ€â€å¿…é¡»æ˜¯å¯åº¦é‡çš„ï¼Œä¸€èˆ¬åšæ³•æ˜¯ä½¿ç”¨SLAsæ¥åº¦é‡ç³»ç»Ÿçš„â€œå¥åº·çŠ¶æ€â€ã€‚æœ€å¸¸è§çš„SLAä¸º</p>
<ul>
<li><p>å¯è¾¾æ€§ </p>
<p>ä»æ—¶é—´ç»´åº¦è¡¡é‡ï¼ˆ99.999%å¯è¾¾æ€§ï¼Œæ¯å¹´ä¸‹çº¿50åˆ†é’Ÿï¼‰</p>
</li>
<li><p>å‡†ç¡®æ€§</p>
<p>å¯¹äºæ•°æ®çš„ä¸¢å¤±æˆ–å¤±çœŸæ˜¯å¦å¯ä»¥æ¥å—ï¼Ÿå¯ä»¥è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”ï¼Ÿå¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œä¸æ¥å—ä»»ä½•æ•°æ®çš„ä¸¢å¤±å’Œå¤±çœŸ</p>
</li>
<li><p>å®¹é‡</p>
<p>ç³»ç»Ÿæ”¯æŒå¹¶å‘</p>
</li>
<li><p>å»¶è¿Ÿ</p>
<p>å“åº”å»¶è¿Ÿï¼Œä¸€èˆ¬è¡¡é‡95%è¯·æ±‚çš„å“åº”æ—¶é—´å’Œ99%è¯·æ±‚å“åº”æ—¶é—´</p>
</li>
</ul>
<p>ç¡®ä¿æ–°ç³»ç»Ÿæ¯”è¢«æ›¿ä»£ç³»ç»Ÿâ€œæ›´å¥½â€ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢å››ä¸ªSLAæŒ‡æ ‡æ¥è¡¡é‡ï¼Œå¯è¾¾æ€§æ˜¯æœ€é‡è¦çš„éœ€æ±‚ã€‚</p>
<h2 id="æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©"><a href="#æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©" class="headerlink" title="æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©"></a>æ°´å¹³å’Œå‚ç›´ä¼¸ç¼©</h2><p>éšç€æ–°ä¸šåŠ¡çš„å¢é•¿ï¼Œè´Ÿè½½ä¹Ÿä¼šå¢åŠ ã€‚æœ€å¸¸è§çš„ä¼¸ç¼©ç­–ç•¥æ˜¯å‚ç›´å’Œæ°´å¹³ä¼¸ç¼©ã€‚</p>
<p>æ°´å¹³ä¼¸ç¼©å°±æ˜¯å¢åŠ æ›´å¤šçš„æœºå™¨æˆ–èŠ‚ç‚¹ï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´æ°´å¹³ä¼¸ç¼©æ˜¯æœ€å¸¸æœ‰çš„æ–¹å¼ã€‚</p>
<p>å‚ç›´ä¼¸ç¼©åŸºæœ¬ä¸Šå°±æ˜¯ä¹°æ›´å¤§/å¥½çš„æœºå™¨ã€‚</p>
<h2 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h2><p>å¯è¾¾æ€§å¯¹äºä»»ä½•ç³»ç»Ÿéƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œä½†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸€èˆ¬éƒ½æ„å»ºåœ¨ä½å¯è¾¾æ€§çš„æœºå™¨ä¸Šï¼ˆæ¯”å¦‚ï¼šæœåŠ¡çš„å¯è¾¾æ€§è¦æ±‚99.999% æœºå™¨çš„å¯è¾¾æ€§ä¸º99.9%ï¼‰ã€‚ç®€å•çš„åšæ³•æ˜¯ç»´æŠ¤ä¸€ç»„æœºå™¨ç»„æˆé›†ç¾¤ï¼Œè¿™æ ·æœåŠ¡çš„å¯è¾¾æ€§ä¸ä¾èµ–å•ç‹¬çš„æœºå™¨ã€‚</p>
<p>ä¸€è‡´æ€§æ˜¯åœ¨é«˜å¯ç”¨ç³»ç»Ÿä¸­æœ€éœ€è¦å…³å¿ƒçš„ã€‚ä¸€ä¸ªä¸€è‡´æ€§ç³»ç»Ÿåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šçœ‹åˆ°å’Œè¿”å›çš„æ•°æ®åœ¨åŒä¸€æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚å¦‚æœä½¿ç”¨ä¸€ç»„æœºå™¨æ¥ç»„æˆé›†ç¾¤ï¼Œå®ƒä»¬è¿˜éœ€è¦äº’ç›¸å‘é€æ¶ˆæ¯æ¥ä¿æŒåŒæ­¥ï¼Œä½†æ˜¯å‘é€æ¶ˆæ¯å¯èƒ½å¤±è´¥ï¼Œè¿™æ ·ä¸€äº›èŠ‚ç‚¹å°±ä¼šå› ä¸ºä¸ä¸€è‡´è€Œä¸å¯è¾¾ã€‚</p>
<p>ä¸€è‡´æ€§æœ‰å¤šä¸ªæ¨¡å‹ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¸¸ç”¨çš„æ˜¯å¼ºä¸€è‡´æ€§ï¼Œå¼±ä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€è‡´æ€§è¦æ±‚è¶Šä½ï¼Œç³»ç»Ÿå¯ä»¥å·¥ä½œçš„æ›´å¿«ï¼Œä½†æ˜¯è¿”å›çš„æ•°æ®ä¸ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚</p>
<p>ç³»ç»Ÿä¸­çš„æ•°æ®éœ€è¦æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯åˆ°åº•æ˜¯æ€æ ·çš„ä¸€è‡´ï¼Ÿå¯¹äºä¸€äº›ç³»ç»Ÿï¼Œéœ€è¦å¼ºä¸€è‡´æ€§ï¼Œæ¯”å¦‚ä¸€æ¬¡æ”¯ä»˜å¿…é¡»æ˜¯å¼ºä¸€è‡´çš„å­˜å‚¨ä¸‹æ¥ã€‚å¯¹äºæ²¡é‚£ä¹ˆé‡è¦çš„éƒ¨åˆ†ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¯ä»¥è€ƒè™‘çš„æƒè¡¡ã€‚æ¯”å¦‚åˆ—å‡ºæœ€è¿‘çš„äº¤æ˜“ã€‚</p>
<h2 id="æ•°æ®æŒä¹…æ€§"><a href="#æ•°æ®æŒä¹…æ€§" class="headerlink" title="æ•°æ®æŒä¹…æ€§"></a>æ•°æ®æŒä¹…æ€§</h2><p>æŒä¹…æ€§è¡¨ç¤ºä¸€æ—¦æ•°æ®æˆåŠŸæ·»åŠ åˆ°æ•°æ®å­˜å‚¨ï¼Œå®ƒå°±æ°¸è¿œå¯ä»¥è®¿é—®åˆ°ã€‚ä¸åŒçš„åˆ†å¸ƒå¼æ•°æ®åº“æ‹¥æœ‰ä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ä¸€èˆ¬ä½¿ç”¨å‰¯æœ¬æ¥å¢åŠ æ•°æ®æŒä¹…æ€§ã€‚</p>
<p>å¯¹äºæ”¯ä»˜ç³»ç»Ÿæ¥è¯´ï¼Œæ•°æ®ä¸å…è®¸ä¸¢å¤±ã€‚æˆ‘ä»¬æ„å»ºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨éœ€è¦æ”¯æŒé›†ç¾¤çº§åˆ«çš„æ•°æ®æŒä¹…å‹ã€‚ç›®å‰Cassandra, MongoDB, HDFSå’ŒDynamodb éƒ½æ”¯æŒå¤šç§çº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚</p>
<h1 id="æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§"><a href="#æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§" class="headerlink" title="æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§"></a>æ¶ˆæ¯ä¿æŒä¸æŒä¹…æ€§</h1><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æ‰§è¡Œè®¡ç®—ï¼Œå­˜å‚¨æ•°æ®ï¼Œäº’ç›¸å‘é€æ¶ˆæ¯ã€‚å‘é€æ¶ˆæ¯çš„å…³é”®æ˜¯æ¶ˆæ¯çš„å¯é åˆ°è¾¾ã€‚å¯¹äºå…³é”®ç³»ç»Ÿï¼Œç»å¸¸éœ€è¦æ¶ˆæ¯é›¶ä¸¢å¤±ã€‚</p>
<p>å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå‘é€æ¶ˆæ¯ä¸€èˆ¬çŸ³æ²¹åˆ†å¸ƒå¼æ¶ˆæ¯æœåŠ¡å‘é€ï¼Œå¦‚RabbitMQï¼ŒKafkaã€‚è¿™äº›æ¶ˆæ¯æœåŠ¡æ”¯æŒä¸åŒçº§åˆ«çš„æ¶ˆæ¯æŠ•é€’å¯é æ€§ã€‚</p>
<p>æ¶ˆæ¯ä¿æŒè¡¨ç¤ºå½“èŠ‚ç‚¹å¤„ç†æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œåœ¨é”™è¯¯è¢«è§£å†³å‰æ¶ˆæ¯ä¸€ç›´è¢«ä¿æŒç€ã€‚æ¶ˆæ¯çš„æŒä¹…æ€§ä¸€èˆ¬åœ¨æ¶ˆæ¯é˜Ÿåˆ—å±‚è¢«ä½¿ç”¨ã€‚å¦‚æœåœ¨æ¶ˆæ¯å‘é€çš„æ—¶å€™é˜Ÿåˆ—æˆ–èŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œé‚£åœ¨å®ƒä»¬é‡æ–°ä¸Šçº¿æ˜¯è¿˜èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<p>åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­æˆ‘ä»¬éœ€è¦æ¯ä¸€æ¡æ¶ˆæ¯æŠ•é€’ä¸€æ¬¡ï¼Œåœ¨æ„å»ºç³»ç»Ÿä¸­ä¿è¯æŠ•é€’ä¸€æ¬¡å’ŒæŠ•é€’è‡³å°‘ä¸€æ¬¡åœ¨å®ç°ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚æœ€åæˆ‘ä»¬ä½¿ç”¨äº†kafkaæ¥ä¿è¯æŠ•é€’è‡³å°‘ä¸€æ¬¡ã€‚</p>
<h2 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾ˆå¤šä¸œè¥¿éƒ½å¯èƒ½å‡ºé”™ï¼Œè¿æ¥ä¼šä¸¢åŒ…æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯ç»å¸¸ä¼šé‡è¯•è¿™äº›è¯·æ±‚ã€‚ä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿä¿è¯æ— è®ºå¤šå°‘ç‰¹å®šçš„è¯·æ±‚è¢«æ‰§è¡Œï¼Œä¸€ä¸ªè¯·æ±‚å®é™…çš„æ“ä½œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚æ”¯ä»˜è¯·æ±‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ”¯ä»˜å¹¶ä¸”è¯·æ±‚å·²ç»æˆåŠŸï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¶…æ—¶äº†ï¼Œå®¢æˆ·ç«¯æ˜¯èƒ½å¤Ÿé‡è¯•ç›¸åŒçš„è¯·æ±‚çš„ã€‚å¯¹äºä¸€ä¸ªå¹‚ç­‰çš„ç³»ç»Ÿï¼Œä¸€ä¸ªä¸ªäººçš„æ”¯ä»˜æ˜¯ä¸èƒ½è¢«æ”¶å–ä¸¤æ¬¡çš„ã€‚</p>
<p>å¯¹å¹‚ç­‰çš„è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦æŸç§åˆ†å¸ƒå¼é”æœºåˆ¶ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¹è§‚é”æ¥å®ç°å¹‚ç­‰æ€§ï¼Œè¿™æ—¶ç³»ç»Ÿéœ€è¦å¼ºä¸€è‡´æ€§çš„é”æ¥æ‰§è¡Œæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç‰ˆæœ¬çš„ä¹è§‚é”æ¥æ£€æŸ¥æ˜¯å¦æœ‰å¯åŠ¨äº†é¢å¤–çš„æ“ä½œã€‚</p>
<p>æ ¹æ®ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œæ“ä½œçš„ç±»å‹ï¼Œæœ‰å¾ˆå¤šæ–¹å¼æ¥å®ç°å¹‚ç­‰æ€§ã€‚åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œå¹‚ç­‰æ€§æ—¶æœ€å®¹æ˜“å¿½ç•¥çš„ã€‚åœ¨æ”¯ä»˜ç³»ç»Ÿä¸­ï¼Œå¹‚ç­‰æ“ä½œæ—¶æœ€é‡è¦çš„ï¼Œå®ƒé¿å…äº†åŒèŠ±å’ŒåŒæ”¶é—®é¢˜ã€‚æ¶ˆæ¯ç³»ç»Ÿå·²ç»ä¿è¯äº†æ¶ˆæ¯è‡³å°‘æ¶ˆè´¹ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯æ‰€æœ‰é‡å¤çš„æ¶ˆæ¯ä¿è¯å¹‚ç­‰æ€§å³å¯ã€‚æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ä¹è§‚é”ï¼Œå¹¶ä½¿ç”¨å¼ºä¸€è‡´æ€§å­˜å‚¨ä½œä¸ºä¹è§‚é”çš„æ•°æ®æºã€‚</p>
<h2 id="åˆ†ç‰‡å’Œæ³•å®šäººæ•°"><a href="#åˆ†ç‰‡å’Œæ³•å®šäººæ•°" class="headerlink" title="åˆ†ç‰‡å’Œæ³•å®šäººæ•°"></a>åˆ†ç‰‡å’Œæ³•å®šäººæ•°</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿç»å¸¸éœ€è¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œè¿œè¶…ä¸€å°èŠ‚ç‚¹çš„å®¹é‡ã€‚ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆæ—¶ä½¿ç”¨åˆ†ç‰‡ï¼Œæ•°æ®ä½¿ç”¨æŸç§hashç®—æ³•è¢«æ°´å¹³åˆ†åŒºã€‚å°½ç®¡å¾ˆå¤šåˆ†å¸ƒå¼æ•°æ®åº“å±è”½äº†åˆ†ç‰‡çš„å®ç°ï¼Œä½†æ˜¯åˆ†ç‰‡è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œç‰¹åˆ«æ˜¯å…³äºé‡æ–°åˆ†ç‰‡ã€‚</p>
<p>è®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šä¸ªæ‹¥æœ‰æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ã€‚ä¸ºä¿è¯å¯¹æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ï¼Œä½¿ç”¨åŸºäºæŠ•ç¥¨çš„æ–¹å¼æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰è¶…è¿‡ä¸€å®šæ•°é‡çš„èŠ‚ç‚¹æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªæ“ä½œæ‰æ˜¯æˆåŠŸçš„ï¼Œè¿™ä¸ªå«åšæ³•å®šäººæ•°ã€‚</p>
<h2 id="Actoræ¨¡å‹"><a href="#Actoræ¨¡å‹" class="headerlink" title="Actoræ¨¡å‹"></a>Actoræ¨¡å‹</h2><p>æè¿°åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æ™®éçš„åšæ³•æ˜¯ä½¿ç”¨Actoræ¨¡å‹ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯CSPã€‚</p>
<p>Actoræ¨¡å‹åŸºäºactoräº’ç›¸å‘é€æ¶ˆæ¯å¹¶ä½œå‡ºå›åº”ã€‚æ¯ä¸€ä¸ªactoråªèƒ½åšå°‘é‡çš„åŠ¨ä½œï¼Œåˆ›å»ºå…¶ä»–actors, å‘é€æ¶ˆæ¯æˆ–è€…å†³å®šå¦‚ä½•å¤„ç†ä¸‹ä¸ªæ¶ˆæ¯ã€‚é€šè¿‡è¿™äº›ç®€å•çš„è§„åˆ™ï¼Œå¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥è¢«å‡†ç¡®æè¿°ï¼Œå¯ä»¥åœ¨actorå´©æºƒåè‡ªæˆ‘ä¿®å¤ã€‚</p>
<p>ä½¿ç”¨akkaæä¾›äº†æ ‡å‡†çš„åˆ†å¸ƒå¼æ¨¡å‹ï¼Œé¿å…æˆ‘ä»¬é‡å¤é€ è½®å­ã€‚</p>
<h2 id="ååº”å¼æ¶æ„"><a href="#ååº”å¼æ¶æ„" class="headerlink" title="ååº”å¼æ¶æ„"></a>ååº”å¼æ¶æ„</h2><p>å½“æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œç›®æ ‡å¸¸å¸¸æ˜¯å®ƒä»¬çš„å¼¹æ€§ï¼Œä¼¸ç¼©æ€§ï¼Œå’Œæ‰©å±•æ€§ã€‚ååº”å¼æ¶æ„æ˜¯åœ¨è¿™ä¸ªé¢†åŸŸæœ€æµè¡Œå’Œæœ€é€šç”¨çš„æ–¹æ¡ˆã€‚</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/tags/ä»£ç /">ä¸Šä¸€é¡µ</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/tags/ä»£ç /page/3/">ä¸‹ä¸€é¡µ</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/ä»£ç /">1</a></li>
            
            <li><a class="pagination-link is-current" href="/tags/ä»£ç /page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/tags/ä»£ç /page/3/">3</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.png" alt="sage417">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        sage417
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Take Your Time
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>China/Shanghai</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        æ–‡ç« 
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            42
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        åˆ†ç±»
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            21
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        æ ‡ç­¾
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            17
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="http://github.com/sage417" target="_blank" rel="noopener">
                å…³æ³¨æˆ‘</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="http://github.com/sage417">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            é“¾æ¥
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://mysql.taobao.org" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">taobaomysql</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">mysql.taobao.org</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://luck-cheng.github.io" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">luck-cheng</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">luck-cheng.github.io</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                åˆ†ç±»
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/JavaåŸºç¡€/">
            <span class="level-start">
                <span class="level-item">JavaåŸºç¡€</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Javaå¹¶å‘/">
            <span class="level-start">
                <span class="level-item">Javaå¹¶å‘</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Javaæ¡†æ¶/">
            <span class="level-start">
                <span class="level-item">Javaæ¡†æ¶</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Javaæ¡†æ¶/Mybatis/">
            <span class="level-start">
                <span class="level-item">Mybatis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Javaæ¡†æ¶/Spring/">
            <span class="level-start">
                <span class="level-item">Spring</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ä¸­é—´ä»¶/">
            <span class="level-start">
                <span class="level-item">ä¸­é—´ä»¶</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ä¸­é—´ä»¶/resilience4j/">
            <span class="level-start">
                <span class="level-item">resilience4j</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ä¸­é—´ä»¶/æœç´¢å¼•æ“/">
            <span class="level-start">
                <span class="level-item">æœç´¢å¼•æ“</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/å·¥ä½œ/">
            <span class="level-start">
                <span class="level-item">å·¥ä½œ</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/å·¥ä½œ/æ€»ç»“/">
            <span class="level-start">
                <span class="level-item">æ€»ç»“</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/å·¥ä½œ/æŒ‘æˆ˜/">
            <span class="level-start">
                <span class="level-item">æŒ‘æˆ˜</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/æ¶æ„/">
            <span class="level-start">
                <span class="level-item">æ¶æ„</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">13</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/æ¶æ„/mysql/">
            <span class="level-start">
                <span class="level-item">mysql</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/æ¶æ„/nosql/">
            <span class="level-start">
                <span class="level-item">nosql</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/æ¶æ„/æ¶ˆæ¯/">
            <span class="level-start">
                <span class="level-item">æ¶ˆæ¯</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/æ¶æ„/ç¼“å­˜/">
            <span class="level-start">
                <span class="level-item">ç¼“å­˜</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ç®—æ³•/">
            <span class="level-start">
                <span class="level-item">ç®—æ³•</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ç®—æ³•/äºŒå‰æ ‘/">
            <span class="level-start">
                <span class="level-item">äºŒå‰æ ‘</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ç®—æ³•/å­—ç¬¦ä¸²/">
            <span class="level-start">
                <span class="level-item">å­—ç¬¦ä¸²</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/ç®—æ³•/æ’åº/">
            <span class="level-start">
                <span class="level-item">æ’åº</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/è¯»ä¹¦/">
            <span class="level-start">
                <span class="level-item">è¯»ä¹¦</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            æ ‡ç­¾äº‘
        </h3>
        <a href="/tags/aop/" style="font-size: 10px;">aop</a> <a href="/tags/java/" style="font-size: 18px;">java</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mybatis/" style="font-size: 14px;">mybatis</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/spring/" style="font-size: 11px;">spring</a> <a href="/tags/ä»£ç /" style="font-size: 20px;">ä»£ç </a> <a href="/tags/åˆ†å¸ƒå¼/" style="font-size: 16px;">åˆ†å¸ƒå¼</a> <a href="/tags/å›¢é˜Ÿ/" style="font-size: 10px;">å›¢é˜Ÿ</a> <a href="/tags/å·¥ä½œ/" style="font-size: 19px;">å·¥ä½œ</a> <a href="/tags/æ„Ÿæ‚Ÿ/" style="font-size: 12px;">æ„Ÿæ‚Ÿ</a> <a href="/tags/æœç´¢/" style="font-size: 10px;">æœç´¢</a> <a href="/tags/æ•°æ®åº“/" style="font-size: 13px;">æ•°æ®åº“</a> <a href="/tags/æ¶ˆæ¯/" style="font-size: 11px;">æ¶ˆæ¯</a> <a href="/tags/ç®—æ³•/" style="font-size: 15px;">ç®—æ³•</a> <a href="/tags/ç¼“å­˜/" style="font-size: 15px;">ç¼“å­˜</a> <a href="/tags/è¯»ä¹¦/" style="font-size: 17px;">è¯»ä¹¦</a>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            æœ€æ–°æ–‡ç« 
        </h3>
        
        <article class="media">
            
            <a href="/2020/03/27/2020-03-27_ã€ç‰‡æ®µã€‘æ–¹æ³•å‚æ•°æ”¶é›†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/27/DKo1cSZmtew2sTP.jpg" alt="ã€ç‰‡æ®µã€‘ æ–¹æ³•å‚æ•°æ”¶é›†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-26T16:00:00.000Z">2020-03-27</time></div>
                    <a href="/2020/03/27/2020-03-27_ã€ç‰‡æ®µã€‘æ–¹æ³•å‚æ•°æ”¶é›†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ã€ç‰‡æ®µã€‘ æ–¹æ³•å‚æ•°æ”¶é›†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a> / <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Spring/">Spring</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/2020-02-23_IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/23/FwNYL9kIoCRDVT5.jpg" alt="IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-23T03:55:01.694Z">2020-03-23</time></div>
                    <a href="/2020/03/23/2020-02-23_IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/2020-03-23_é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/23/eNkhvRJ12jaXwgr.jpg" alt="é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-22T16:00:00.000Z">2020-03-23</time></div>
                    <a href="/2020/03/23/2020-03-23_é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/12/2020-03-12-å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†-BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/12/lKwIQ94qN5htP2U.png" alt="å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†- BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-11T16:00:00.000Z">2020-03-12</time></div>
                    <a href="/2020/03/12/2020-03-12-å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†-BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ/" class="title has-link-black-ter is-size-6 has-text-weight-normal">å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†- BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/02/27/2020-02-27-ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/02/27/bY675l1AuosdCPt.jpg" alt="ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-02-26T16:00:00.000Z">2020-02-27</time></div>
                    <a href="/2020/02/27/2020-02-27-ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            å½’æ¡£
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">ä¸‰æœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">äºŒæœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">ä¸€æœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">åäºŒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">åä¸€æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">ä¹æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">å…«æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">ä¸ƒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">å…­æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">äº”æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">å››æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">ä¸‰æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">äºŒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">ä¸€æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">åäºŒæœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">åä¸€æœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">ä¹æœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">ä¸ƒæœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                æ ‡ç­¾
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aop/">
                        <span class="tag">aop</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ä»£ç /">
                        <span class="tag">ä»£ç </span>
                        <span class="tag is-grey">23</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/åˆ†å¸ƒå¼/">
                        <span class="tag">åˆ†å¸ƒå¼</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/å›¢é˜Ÿ/">
                        <span class="tag">å›¢é˜Ÿ</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/å·¥ä½œ/">
                        <span class="tag">å·¥ä½œ</span>
                        <span class="tag is-grey">21</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ„Ÿæ‚Ÿ/">
                        <span class="tag">æ„Ÿæ‚Ÿ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æœç´¢/">
                        <span class="tag">æœç´¢</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ•°æ®åº“/">
                        <span class="tag">æ•°æ®åº“</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ¶ˆæ¯/">
                        <span class="tag">æ¶ˆæ¯</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ç®—æ³•/">
                        <span class="tag">ç®—æ³•</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ç¼“å­˜/">
                        <span class="tag">ç¼“å­˜</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/è¯»ä¹¦/">
                        <span class="tag">è¯»ä¹¦</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            æœ€æ–°æ–‡ç« 
        </h3>
        
        <article class="media">
            
            <a href="/2020/03/27/2020-03-27_ã€ç‰‡æ®µã€‘æ–¹æ³•å‚æ•°æ”¶é›†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/27/DKo1cSZmtew2sTP.jpg" alt="ã€ç‰‡æ®µã€‘ æ–¹æ³•å‚æ•°æ”¶é›†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-26T16:00:00.000Z">2020-03-27</time></div>
                    <a href="/2020/03/27/2020-03-27_ã€ç‰‡æ®µã€‘æ–¹æ³•å‚æ•°æ”¶é›†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ã€ç‰‡æ®µã€‘ æ–¹æ³•å‚æ•°æ”¶é›†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/">Javaæ¡†æ¶</a> / <a class="has-link-grey -link" href="/categories/Javaæ¡†æ¶/Spring/">Spring</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/2020-02-23_IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/23/FwNYL9kIoCRDVT5.jpg" alt="IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-23T03:55:01.694Z">2020-03-23</time></div>
                    <a href="/2020/03/23/2020-02-23_IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">IMç³»ç»Ÿå…³é”®ç‚¹æ¢³ç†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/2020-03-23_é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/23/eNkhvRJ12jaXwgr.jpg" alt="é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-22T16:00:00.000Z">2020-03-23</time></div>
                    <a href="/2020/03/23/2020-03-23_é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†/" class="title has-link-black-ter is-size-6 has-text-weight-normal">é«˜å¹¶å‘ç³»ç»Ÿ-æ•°æ®åº“å…³é”®ç‚¹æ¢³ç†</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/12/2020-03-12-å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†-BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/03/12/lKwIQ94qN5htP2U.png" alt="å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†- BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-11T16:00:00.000Z">2020-03-12</time></div>
                    <a href="/2020/03/12/2020-03-12-å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†-BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ/" class="title has-link-black-ter is-size-6 has-text-weight-normal">å¥‡æ€ªçš„çŸ¥è¯†åˆå¢åŠ äº†- BLNJå¯¼è‡´ç´¢å¼•æœ‰åºæ€§å¤±æ•ˆ</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/02/27/2020-02-27-ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://i.loli.net/2020/02/27/bY675l1AuosdCPt.jpg" alt="ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-02-26T16:00:00.000Z">2020-02-27</time></div>
                    <a href="/2020/02/27/2020-02-27-ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ä¸ºä»€ä¹ˆå¼•å…¥é—´éš™é”</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ¶æ„/">æ¶æ„</a> / <a class="has-link-grey -link" href="/categories/æ¶æ„/mysql/">mysql</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            å½’æ¡£
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">ä¸‰æœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">äºŒæœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">ä¸€æœˆ 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">åäºŒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">åä¸€æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">ä¹æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">å…«æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">ä¸ƒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">å…­æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">äº”æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">å››æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">ä¸‰æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">äºŒæœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">ä¸€æœˆ 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">åäºŒæœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">åä¸€æœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">ä¹æœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">ä¸ƒæœˆ 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                æ ‡ç­¾
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/aop/">
                        <span class="tag">aop</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/java/">
                        <span class="tag">java</span>
                        <span class="tag is-grey">14</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/linux/">
                        <span class="tag">linux</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mybatis/">
                        <span class="tag">mybatis</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/redis/">
                        <span class="tag">redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/spring/">
                        <span class="tag">spring</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ä»£ç /">
                        <span class="tag">ä»£ç </span>
                        <span class="tag is-grey">23</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/åˆ†å¸ƒå¼/">
                        <span class="tag">åˆ†å¸ƒå¼</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/å›¢é˜Ÿ/">
                        <span class="tag">å›¢é˜Ÿ</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/å·¥ä½œ/">
                        <span class="tag">å·¥ä½œ</span>
                        <span class="tag is-grey">21</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ„Ÿæ‚Ÿ/">
                        <span class="tag">æ„Ÿæ‚Ÿ</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æœç´¢/">
                        <span class="tag">æœç´¢</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ•°æ®åº“/">
                        <span class="tag">æ•°æ®åº“</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/æ¶ˆæ¯/">
                        <span class="tag">æ¶ˆæ¯</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ç®—æ³•/">
                        <span class="tag">ç®—æ³•</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ç¼“å­˜/">
                        <span class="tag">ç¼“å­˜</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/è¯»ä¹¦/">
                        <span class="tag">è¯»ä¹¦</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="å¡‘æ–™å†…å­˜" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 NightWish417&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://blog.yamato.moe',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'æ–‡ç« ',
                PAGES: 'é¡µé¢',
                CATEGORIES: 'åˆ†ç±»',
                TAGS: 'æ ‡ç­¾',
                UNTITLED: '(æ— æ ‡é¢˜)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>